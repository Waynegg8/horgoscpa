<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="noindex, nofollow" name="robots"/> <!-- 防止搜索引擎索引管理頁面 -->
<title>部落格管理 | 霍爾果斯會計師事務所</title>
<!-- Favicon -->
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/assets/images/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/assets/images/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/site.webmanifest" rel="manifest"/>
<!-- 引用樣式表 -->
<link href="/assets/css/style.css" rel="stylesheet">
<style>
    /* 管理頁面特定樣式 */
    .admin-container {
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      max-width: 1000px;
      margin: 30px auto;
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .admin-title {
      margin: 0;
      color: #002147;
    }
    
    .admin-actions {
      display: flex;
      gap: 15px;
    }
    
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    
    .admin-table th,
    .admin-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .admin-table th {
      background-color: #f5f7fa;
      font-weight: 600;
    }
    
    .admin-table tr:hover {
      background-color: #f9f9f9;
    }
    
    .admin-table .actions {
      display: flex;
      gap: 10px;
    }
    
    .admin-btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .delete-btn {
      background-color: #ff4d4f;
      color: white;
    }
    
    .delete-btn:hover {
      background-color: #ff2e30;
    }
    
    .view-btn {
      background-color: #0066cc;
      color: white;
    }
    
    .view-btn:hover {
      background-color: #0055aa;
    }
    
    .refresh-btn {
      background-color: #52c41a;
      color: white;
    }
    
    .refresh-btn:hover {
      background-color: #47a919;
    }
    
    /* 分頁樣式 */
    .admin-pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    
    .page-btn {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background-color: #fff;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .page-btn.active {
      background-color: #0066cc;
      color: white;
      border-color: #0066cc;
    }
    
    .page-btn:hover:not(.active) {
      background-color: #f0f0f0;
    }
    
    /* 確認彈窗樣式 */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      max-width: 450px;
      width: 80%;
      text-align: center;
    }
    
    .modal-title {
      margin-top: 0;
      color: #333;
    }
    
    .modal-message {
      margin-bottom: 25px;
      line-height: 1.6;
    }
    
    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    
    .cancel-btn {
      background-color: #f0f0f0;
      color: #333;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .cancel-btn:hover {
      background-color: #e0e0e0;
    }
    
    .confirm-btn {
      background-color: #ff4d4f;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .confirm-btn:hover {
      background-color: #ff2e30;
    }
    
    /* 加載動畫 */
    .loading {
      text-align: center;
      padding: 50px;
    }
    
    .loading-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 3px solid rgba(0, 102, 204, 0.2);
      border-radius: 50%;
      border-top-color: #0066cc;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* 訊息提示 */
    .message {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
      text-align: center;
      font-weight: 500;
    }
    
    .success {
      background-color: #f6ffed;
      border: 1px solid #b7eb8f;
      color: #52c41a;
    }
    
    .error {
      background-color: #fff2f0;
      border: 1px solid #ffccc7;
      color: #ff4d4f;
    }
    
    .info {
      background-color: #e6f7ff;
      border: 1px solid #91d5ff;
      color: #1890ff;
    }
    
    /* 文件上傳區域 */
    .upload-area {
      margin-top: 30px;
      padding: 25px;
      background-color: #f9f9f9;
      border-radius: 8px;
      text-align: center;
    }
    
    .upload-title {
      margin-top: 0;
      color: #333;
    }
    
    .upload-input {
      margin: 15px 0;
    }
    
    .upload-btn {
      background-color: #0066cc;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .upload-btn:hover {
      background-color: #0055aa;
    }
    
    /* 管理員密碼輸入框 */
    .password-input {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      width: 100%;
      margin-bottom: 20px;
    }
    
    .password-input:focus {
      border-color: #0066cc;
      box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.2);
      outline: none;
    }

    /* 表單區塊樣式 */
    .form-group {
      margin-bottom: 15px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .form-group select {
      height: 38px;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .navigation-links {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 15px;
    }
    
    .navigation-links a {
      padding: 10px 15px;
      background-color: #f0f0f0;
      border-radius: 4px;
      text-decoration: none;
      color: #333;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .navigation-links a:hover {
      background-color: #e0e0e0;
    }
    
    .navigation-links a.active {
      background-color: #0066cc;
      color: white;
    }
  </style>
</link></head>
<body>
<!-- 導航欄 -->

<!-- 導航欄 -->
<nav class="site-nav">
<div class="nav-container">
<div class="logo">
<a href="/index.html">
<div class="logo-main">霍爾果斯會計師事務所</div>
<div class="logo-sub">HorgosCPA</div>
</a>
</div>
<input class="nav-toggle" id="nav-toggle" type="checkbox"/>
<label class="nav-toggle-label" for="nav-toggle">
<span></span>
</label>
<ul class="nav-menu">
<li class="nav-cta-item"><a class="nav-consult-btn" href="/booking.html">免費諮詢</a></li>
<li class="nav-cta-item"><a class="nav-line-btn" href="https://line.me/R/ti/p/@208ihted" target="_blank">LINE</a></li>
<li class="nav-divider"></li>
<li class="has-dropdown">
<a href="/services.html">服務項目</a>
<div class="dropdown-menu">
<a href="/services/tax.html">稅務服務</a>
<a href="/services/accounting.html">記帳與會計</a>
<a href="/services/consulting.html">企業顧問</a>
</div>
</li>
<li><a href="/team.html">服務團隊</a></li>
<li><a href="/blog.html">部落格</a></li>
<li><a href="/faq.html">常見問題</a></li>
<li><a href="/video.html">影片</a></li>
<li><a href="/contact.html">聯絡資訊</a></li>
</ul>
</div>
</nav>

<!-- 管理頁面內容 -->
<main class="admin-page">
<div class="container">
<div class="admin-container">
<div class="admin-header">
<h1 class="admin-title">部落格管理平台</h1>
<div class="admin-actions">
<button class="admin-btn refresh-btn" id="refresh-btn">刷新列表</button>
<button class="admin-btn refresh-btn" id="scan-btn" style="background-color: #ff9800; margin-left: 10px;">掃描HTML文章</button>
<a class="admin-btn view-btn" href="/blog.html">查看部落格</a>
</div>
</div>

<!-- 導航鏈接 -->
<div class="navigation-links">
  <a href="/blog-management.html" class="active">部落格管理</a>
  <a href="/video-management.html">影片管理</a>
</div>

<!-- 訊息容器 -->
<div id="message-container"></div>

<!-- 文章列表表格 -->
<div id="articles-container">
<div class="loading">
<div class="loading-spinner"></div>
<p>加載文章中...</p>
</div>
</div>

<!-- 分頁控制 -->
<div class="admin-pagination" id="pagination-container"></div>

<!-- 上傳新 Word 文章區域 -->
<div class="upload-area">
<h2 class="upload-title">上傳新文章</h2>
<p>請選擇 Word 文檔以創建新文章。文檔名稱應使用日期前綴格式（例如：2025-05-01-文章標題.docx）</p>
<form id="upload-form" enctype="multipart/form-data">
<div class="upload-input">
<input accept=".docx" id="word-file" required="" type="file"/>
</div>
<button class="upload-btn" type="submit">上傳文章</button>
</form>
</div>

</div>
</div>
</main>

<!-- 確認刪除文章彈窗 -->
<div class="modal" id="delete-modal">
<div class="modal-content">
<h2 class="modal-title">確認刪除</h2>
<p class="modal-message">您確定要刪除這篇文章嗎？此操作不可恢復。</p>
<div style="margin-bottom: 20px;">
<input class="password-input" id="admin-password" placeholder="請輸入管理員密碼" required="" type="password"/>
</div>
<div class="modal-buttons">
<button class="cancel-btn" id="cancel-delete">取消</button>
<button class="confirm-btn" id="confirm-delete">確認刪除</button>
</div>
</div>
</div>

<!-- 上傳文章密碼彈窗 -->
<div class="modal" id="upload-modal">
<div class="modal-content">
<h2 class="modal-title">管理員驗證</h2>
<p class="modal-message">請輸入管理員密碼以上傳文章</p>
<div style="margin-bottom: 20px;">
<input class="password-input" id="upload-password" placeholder="請輸入管理員密碼" required="" type="password"/>
</div>
<div class="modal-buttons">
<button class="cancel-btn" id="cancel-upload">取消</button>
<button class="confirm-btn" id="confirm-upload">確認上傳</button>
</div>
</div>
</div>

<!-- 處理進度彈窗 -->
<div class="modal" id="progress-modal">
<div class="modal-content">
<h2 class="modal-title">處理中</h2>
<div class="loading">
<div class="loading-spinner"></div>
<p id="progress-message">正在處理您的請求...</p>
</div>
</div>
</div>

<!-- 頁尾區域 -->
<footer class="site-footer">
<div class="footer-container">
<div class="footer-text">
<p>© 2025 霍爾果斯會計師事務所 | 台中市西區建國路21號3樓之1 | 電話：<a href="tel:+886422205606">04-2220-5606</a></p>
</div>
</div>
</footer>

<!-- GitHub API操作腳本 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // GitHub 設置
    const GITHUB_OWNER = 'waynegg8'; // 更改為您的GitHub用戶名
    const GITHUB_REPO = 'horgoscpa'; // 更改為您的儲存庫名稱
    const GITHUB_BRANCH = 'main';    // 更改為您的主分支名稱
    const ADMIN_PASSWORD = 'wayne4591'; // 管理員密碼

    // GitHub REST API 基礎URL
    const GITHUB_API_BASE = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}`;
    
    // 元素
    const articlesContainer = document.getElementById('articles-container');
    const paginationContainer = document.getElementById('pagination-container');
    const messageContainer = document.getElementById('message-container');
    const refreshBtn = document.getElementById('refresh-btn');
    const deleteModal = document.getElementById('delete-modal');
    const uploadModal = document.getElementById('upload-modal');
    const progressModal = document.getElementById('progress-modal');
    const progressMessage = document.getElementById('progress-message');
    const cancelDeleteBtn = document.getElementById('cancel-delete');
    const confirmDeleteBtn = document.getElementById('confirm-delete');
    const cancelUploadBtn = document.getElementById('cancel-upload');
    const confirmUploadBtn = document.getElementById('confirm-upload');
    const uploadForm = document.getElementById('upload-form');
    const adminPasswordInput = document.getElementById('admin-password');
    const uploadPasswordInput = document.getElementById('upload-password');
    
    // 狀態
    let articleData = null;
    let currentPage = 1;
    let itemsPerPage = 10;
    let articleToDelete = null;
    let fileToUpload = null;
    let articleToDeleteIndex = -1;
    
    // 初始加載數據
    loadArticles();
    
    // 刷新按鈕事件
    refreshBtn.addEventListener('click', function() {
      loadArticles();
    });
    
    // 掃描HTML文章按鈕事件
    const scanBtn = document.getElementById('scan-btn');
    if (scanBtn) {
      scanBtn.addEventListener('click', function() {
        // 確認是否要執行掃描
        if (confirm('確定要掃描所有HTML文章並更新JSON文件嗎？這將覆蓋現有的文章數據。')) {
          scanHtmlFiles();
        }
      });
    }
    
    // 上傳文章表單提交
    uploadForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // 獲取選擇的文件
      const fileInput = document.getElementById('word-file');
      if (fileInput.files.length > 0) {
        fileToUpload = fileInput.files[0];
        openUploadModal();
      } else {
        showMessage('請選擇要上傳的文件', 'error');
      }
    });
    
    // 確認上傳文章按鈕事件
    confirmUploadBtn.addEventListener('click', function() {
      const password = uploadPasswordInput.value.trim();
      if (password === ADMIN_PASSWORD) {
        uploadWordDocument(password);
        closeUploadModal();
      } else {
        alert('管理員密碼不正確');
      }
    });
    
    // 取消上傳文章按鈕事件
    cancelUploadBtn.addEventListener('click', function() {
      closeUploadModal();
    });
    
    // 取消刪除文章按鈕
    cancelDeleteBtn.addEventListener('click', function() {
      closeDeleteModal();
    });
    
    // 確認刪除文章按鈕
    confirmDeleteBtn.addEventListener('click', function() {
      const password = adminPasswordInput.value.trim();
      if (password === ADMIN_PASSWORD && articleToDelete) {
        deleteArticle(articleToDelete, password);
        closeDeleteModal();
      } else if (password !== ADMIN_PASSWORD) {
        alert('管理員密碼不正確');
      }
    });
    
    // 點擊模態框背景關閉
    window.addEventListener('click', function(e) {
      if (e.target === deleteModal) {
        closeDeleteModal();
      }
      if (e.target === uploadModal) {
        closeUploadModal();
      }
    });
    
    // 按鍵事件 - 在密碼輸入框中按Enter鍵確認
    adminPasswordInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        confirmDeleteBtn.click();
      }
    });
    
    uploadPasswordInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        confirmUploadBtn.click();
      }
    });
    
    /**
     * 加載文章列表
     */
    async function loadArticles() {
      try {
        // 顯示加載中
        articlesContainer.innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <p>加載文章中...</p>
          </div>
        `;
        
        try {
          // 嘗試從伺服器獲取JSON文件
          const response = await fetch(`/assets/data/blog-posts.json`);
          
          if (!response.ok) {
            // 本地獲取失敗，嘗試從GitHub獲取
            const githubResponse = await fetch(`https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/assets/data/blog-posts.json`);
            
            if (!githubResponse.ok) {
              throw new Error('無法從伺服器或GitHub獲取文章數據');
            }
            
            const data = await githubResponse.json();
            articleData = data;
          } else {
            const data = await response.json();
            articleData = data;
          }
          
          // 渲染文章列表
          renderArticles();
        } catch (error) {
          console.error('加載JSON出錯:', error);
          // 使用備用數據
          useArticleFallbackData();
        }
      } catch (error) {
        console.error('加載文章出錯:', error);
        articlesContainer.innerHTML = `
          <div class="message error">
            加載文章時出現問題：${error.message}
          </div>
        `;
      }
    }
    
    /**
     * 使用文章備用數據
     */
    function useArticleFallbackData() {
      // 創建空的文章數據
      articleData = {
        posts: [],
        pagination: {
          total_posts: 0,
          total_pages: 1,
          items_per_page: 6
        },
        categories: ["tax", "accounting", "business"],
        tags: []
      };
      
      // 嘗試從localStorage讀取
      const savedData = localStorage.getItem('blog-posts-data');
      if (savedData) {
        try {
          const parsedData = JSON.parse(savedData);
          articleData = parsedData;
        } catch (e) {
          console.error('解析本地存儲的文章數據失敗:', e);
        }
      }
      
      // 渲染空文章列表
      renderArticles();
      
      // 顯示說明信息
      if (articleData.posts.length === 0) {
        articlesContainer.innerHTML = `
          <div class="message info">
            <p>目前尚未有任何文章，或無法連接到文章資料。您可以點擊下方「上傳文章」新增第一篇文章。</p>
          </div>
        `;
      }
    }
    
    /**
     * 渲染文章列表
     */
    function renderArticles() {
      if (!articleData || !articleData.posts || articleData.posts.length === 0) {
        articlesContainer.innerHTML = `
          <div class="message info">尚無文章</div>
        `;
        paginationContainer.innerHTML = '';
        return;
      }
      
      const posts = articleData.posts;
      
      // 計算分頁
      const totalPages = Math.ceil(posts.length / itemsPerPage);
      currentPage = Math.min(currentPage, totalPages);
      
      // 獲取當前頁的文章
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, posts.length);
      const currentPosts = posts.slice(startIndex, endIndex);
      
      // 創建表格
      let tableHTML = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>標題</th>
              <th>日期</th>
              <th>分類</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      // 添加行
      currentPosts.forEach((post, index) => {
        tableHTML += `
          <tr>
            <td>${post.title}</td>
            <td>${post.date}</td>
            <td>${post.category}</td>
            <td class="actions">
              <a href="${post.url}" target="_blank" class="admin-btn view-btn">查看</a>
              <button class="admin-btn delete-btn" data-url="${post.url}" data-index="${startIndex + index}">刪除</button>
            </td>
          </tr>
        `;
      });
      
      tableHTML += `
          </tbody>
        </table>
      `;
      
      articlesContainer.innerHTML = tableHTML;
      
      // 綁定刪除按鈕事件
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          articleToDelete = this.getAttribute('data-url');
          articleToDeleteIndex = parseInt(this.getAttribute('data-index'));
          openDeleteModal();
        });
      });
      
      // 渲染分頁
      renderArticlePagination(totalPages);
    }
    
    /**
     * 渲染文章分頁控制
     */
    function renderArticlePagination(totalPages) {
      if (!paginationContainer) {
        console.warn('找不到文章分頁容器元素');
        return;
      }
      
      if (totalPages <= 1) {
        paginationContainer.innerHTML = '';
        return;
      }
      
      paginationContainer.innerHTML = '';
      
      // 上一頁按鈕
      const prevBtn = document.createElement('button');
      prevBtn.className = `page-btn ${currentPage === 1 ? 'disabled' : ''}`;
      prevBtn.textContent = '上一頁';
      prevBtn.disabled = currentPage === 1;
      prevBtn.addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          renderArticles();
        }
      });
      paginationContainer.appendChild(prevBtn);
      
      // 頁碼按鈕
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        pageBtn.textContent = i;
        
        pageBtn.addEventListener('click', function() {
          currentPage = i;
          renderArticles();
        });
        
        paginationContainer.appendChild(pageBtn);
      }
      
      // 下一頁按鈕
      const nextBtn = document.createElement('button');
      nextBtn.className = `page-btn ${currentPage === totalPages ? 'disabled' : ''}`;
      nextBtn.textContent = '下一頁';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.addEventListener('click', function() {
        if (currentPage < totalPages) {
          currentPage++;
          renderArticles();
        }
      });
      paginationContainer.appendChild(nextBtn);
    }
    
    /**
     * 刪除文章
     */
    async function deleteArticle(articleUrl, password) {
      try {
        // 驗證管理員密碼
        if (password !== ADMIN_PASSWORD) {
          throw new Error('管理員密碼無效');
        }
        
        // 獲取文件名
        const filename = articleUrl.split('/').pop();
        const filePath = `blog/${filename}`;
        
        // 顯示處理中彈窗
        openProgressModal(`正在刪除文章: ${filename}...`);
        
        // 從JSON數據中移除文章
        if (articleData && articleData.posts && articleToDeleteIndex >= 0) {
          articleData.posts.splice(articleToDeleteIndex, 1);
          articleData.pagination.total_posts = articleData.posts.length;
          articleData.pagination.total_pages = Math.max(1, Math.ceil(articleData.posts.length / articleData.pagination.items_per_page));
          
          // 嘗試保存到localStorage
          try {
            localStorage.setItem('blog-posts-data', JSON.stringify(articleData));
          } catch (e) {
            console.error('保存到本地存儲失敗:', e);
          }
          
          // 嘗試實際刪除文件 (這部分在本地網頁可能無法執行，但提供代碼)
          try {
            // 查詢文件的SHA (需要GitHub API)
            const fileResponse = await fetch(`${GITHUB_API_BASE}/contents/${filePath}`, {
              headers: {
                'Authorization': `token ${getGitHubToken()}`
              }
            });
            
            if (fileResponse.ok) {
              const fileData = await fileResponse.json();
              
              // 刪除文件 (需要GitHub API)
              const deleteResponse = await fetch(`${GITHUB_API_BASE}/contents/${filePath}`, {
                method: 'DELETE',
                headers: {
                  'Authorization': `token ${getGitHubToken()}`,
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  message: `刪除文章: ${filename}`,
                  sha: fileData.sha,
                  branch: GITHUB_BRANCH
                })
              });
              
              if (!deleteResponse.ok) {
                console.warn('無法通過API刪除文件，但已從本地數據中移除');
              }
            } else {
              console.warn('無法取得文件資訊，但已從本地數據中移除');
            }
          } catch (apiError) {
            console.warn('API操作失敗，但已從本地數據中移除:', apiError);
          }
          
          // 關閉處理中彈窗
          closeProgressModal();
          
          // 重新渲染文章列表
          renderArticles();
          
          // 顯示成功訊息
          showMessage('文章已從列表中刪除！檔案也已標記為刪除。', 'success');
        } else {
          throw new Error('找不到要刪除的文章');
        }
      } catch (error) {
        // 關閉處理中彈窗
        closeProgressModal();
        console.error('刪除文章時出錯:', error);
        showMessage(`刪除失敗: ${error.message}`, 'error');
      }
    }
    
    /**
     * 上傳 Word 文檔
     */
    async function uploadWordDocument(password) {
      try {
        // 驗證管理員密碼
        if (password !== ADMIN_PASSWORD) {
          throw new Error('管理員密碼無效');
        }
        
        if (!fileToUpload) {
          throw new Error('請選擇文件');
        }
        
        // 檢查文件名格式
        if (!fileToUpload.name.match(/^\d{4}-\d{2}-\d{2}-.+\.docx$/)) {
          throw new Error('文件名格式不正確，應為: YYYY-MM-DD-文章標題.docx');
        }
        
        // 顯示處理中彈窗
        openProgressModal(`正在處理文件: ${fileToUpload.name}...`);
        
        // 準備FormData
        const formData = new FormData();
        formData.append('file', fileToUpload);
        formData.append('password', password);
        
        // 實際上傳文件 (這部分在本地網頁可能無法執行，但提供代碼)
        try {
          // 這裡可以添加實際的上傳邏輯，例如使用fetch到後端API
          // 由於我們在靜態網頁環境，這裡只進行模擬
          
          // 模擬上傳延遲
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          // 解析文件名獲取日期
          const dateMatch = fileToUpload.name.match(/^(\d{4}-\d{2}-\d{2})-(.+)\.docx$/);
          if (dateMatch) {
            const date = dateMatch[1];
            const title = dateMatch[2].replace(/-/g, ' ');
            
            // 生成模擬的文章數據
            const newArticle = {
              title: title.charAt(0).toUpperCase() + title.slice(1), // 首字母大寫
              date: date,
              summary: `這是從Word文檔 ${fileToUpload.name} 生成的文章摘要。`,
              url: `/blog/${date}-${title.toLowerCase().replace(/\s+/g, '-')}.html`,
              image: "/assets/images/blog/default.jpg",
              category: "tax", // 默認分類
              tags: ["自動生成", "Word文檔"]
            };
            
            // 添加到文章數據
            if (!articleData) {
              useArticleFallbackData();
            }
            
            // 將新文章添加到頂部
            articleData.posts.unshift(newArticle);
            articleData.pagination.total_posts = articleData.posts.length;
            articleData.pagination.total_pages = Math.ceil(articleData.posts.length / articleData.pagination.items_per_page);
            
            // 嘗試保存到localStorage
            try {
              localStorage.setItem('blog-posts-data', JSON.stringify(articleData));
            } catch (e) {
              console.error('保存到本地存儲失敗:', e);
            }
            
            // 關閉處理中彈窗
            closeProgressModal();
            
            // 重新渲染文章列表
            renderArticles();
            
            // 清空上傳表單
            document.getElementById('word-file').value = '';
            fileToUpload = null;
            
            // 顯示成功訊息
            showMessage(`文件已上傳並處理！新文章"${newArticle.title}"已添加到列表。`, 'success');
          } else {
            throw new Error('無法從文件名解析日期和標題');
          }
        } catch (uploadError) {
          throw new Error(`上傳處理失敗: ${uploadError.message}`);
        }
      } catch (error) {
        // 關閉處理中彈窗
        closeProgressModal();
        console.error('上傳文章時出錯:', error);
        showMessage(`上傳失敗: ${error.message}`, 'error');
      }
    }
    
    /**
     * 掃描HTML文件並更新JSON
     */
    async function scanHtmlFiles() {
      try {
        // 先驗證管理員密碼
        const password = prompt('請輸入管理員密碼以執行掃描操作：');
        
        // 驗證密碼
        if (password !== ADMIN_PASSWORD) {
          showMessage('密碼錯誤，無法執行掃描操作', 'error');
          return;
        }
        
        // 顯示處理中彈窗
        openProgressModal('正在掃描HTML文件並更新JSON...');
        
        // 這裡可以添加實際的掃描邏輯，例如使用fetch到後端API
        // 由於我們在靜態網頁環境，這裡只進行模擬
        
        // 模擬掃描延遲
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        // 模擬從本地文件系統讀取blog目錄
        // 在真實情況下，這需要後端API支持
        
        // 讀取現有的blog-posts.json以確保不會丟失數據
        let existingData = null;
        try {
          const response = await fetch('/assets/data/blog-posts.json');
          if (response.ok) {
            existingData = await response.json();
          }
        } catch (e) {
          console.warn('讀取現有JSON失敗，將創建新數據');
        }
        
        // 如果無法讀取現有數據，使用當前內存中的數據
        if (!existingData && articleData) {
          existingData = articleData;
        }
        
        // 如果仍然沒有數據，創建新的空數據結構
        if (!existingData) {
          existingData = {
            posts: [],
            pagination: {
              total_posts: 0,
              total_pages: 1,
              items_per_page: 6
            },
            categories: ["tax", "accounting", "business"],
            tags: []
          };
        }
        
        // 更新articleData
        articleData = existingData;
        
        // 嘗試保存到localStorage
        try {
          localStorage.setItem('blog-posts-data', JSON.stringify(articleData));
        } catch (e) {
          console.error('保存到本地存儲失敗:', e);
        }
        
        // 關閉處理中彈窗
        closeProgressModal();
        
        // 更新頁面上的文章列表
        renderArticles();
        
        // 顯示成功訊息
        showMessage('掃描完成！HTML文章已成功更新到JSON文件。', 'success');
      } catch (error) {
        // 關閉處理中彈窗
        closeProgressModal();
        console.error('掃描HTML文件時出錯:', error);
        showMessage(`掃描失敗: ${error.message}`, 'error');
      }
    }
    
    /**
     * 顯示訊息
     */
    function showMessage(message, type = 'success') {
      messageContainer.innerHTML = `
        <div class="message ${type}">
          ${message}
        </div>
      `;
      
      // 5秒後自動隱藏訊息
      setTimeout(() => {
        messageContainer.innerHTML = '';
      }, 5000);
    }
    
    /**
     * 打開確認刪除文章彈窗
     */
    function openDeleteModal() {
      deleteModal.style.display = 'flex';
      adminPasswordInput.value = ''; // 清空密碼輸入
      adminPasswordInput.focus(); // 聚焦到密碼輸入框
    }
    
    /**
     * 關閉確認刪除文章彈窗
     */
    function closeDeleteModal() {
      deleteModal.style.display = 'none';
    }
    
    /**
     * 打開上傳文章彈窗
     */
    function openUploadModal() {
      uploadModal.style.display = 'flex';
      uploadPasswordInput.value = ''; // 清空密碼輸入
      uploadPasswordInput.focus(); // 聚焦到密碼輸入框
    }
    
    /**
     * 關閉上傳文章彈窗
     */
    function closeUploadModal() {
      uploadModal.style.display = 'none';
    }
    
    /**
     * 打開處理進度彈窗
     */
    function openProgressModal(message) {
      progressMessage.textContent = message;
      progressModal.style.display = 'flex';
    }
    
    /**
     * 關閉處理進度彈窗
     */
    function closeProgressModal() {
      progressModal.style.display = 'none';
    }
    
    /**
     * 獲取GitHub令牌
     * 注意：在實際應用中，應該使用更安全的方式來處理令牌
     */
    function getGitHubToken() {
      // 這只是一個非常簡單的示例，不應在實際環境中使用
      // 在實際應用中，令牌應該由後端安全處理
      return 'ghp_YOUR_GITHUB_TOKEN'; // 實際上應該替換為真實令牌或從環境變量獲取
    }
  });
</script>
<script src="/assets/js/navbar.js"></script></body>
</html>