# 專案設計文件：會計師事務所內部營運管理平台

**文件版本：** 1.0 (全新專案)  
**日期：** 2025年10月27日  
**專案負責人：** [管理員姓名]  
**技術架構：** Cloudflare (Pages, Workers, D1, R2)

---

## 目錄

1. [專案概述](#1-專案概述)
2. [系統架構](#2-系統架構-the-cloudflare-stack)
3. [資料庫設計](#3-資料庫設計-cloudflare-d1-schema)
4. [核心功能模塊詳解](#4-核心功能模塊詳解)
5. [權限模型](#5-權限模型能看見就能編輯)
6. [自動化流程](#6-自動化流程週期性任務-cron-trigger)
7. [系統初始化與資料導入](#7-系統初始化與資料導入)
8. [介面原型概念](#8-介面原型概念-uiux)
9. [開發指南](#9-開發指南-developer-guide)

---

## 1. 專案概述

### 1.1. 專案目的

本專案旨在建構一個現代化、自動化、且易於維護的內部營運管理平台 (Internal Operations Platform)。平台將利用 Cloudflare 的 Serverless 架構，實現資料的即時同步、業務邏輯的自動化，並為非技術背景的管理員提供一個直觀的網頁管理介面。

### 1.2. 核心目標

- **核心邏輯：** 建立一個強大的業務邏輯引擎，用於處理工時表、加權工時計算及複雜的假期規則。
- **(關鍵) 進度追蹤：** 建立一個多步驟的「SOP 檢查表」進度追蹤系統，用於管理記帳、工商登記等複雜流程。
- **權限簡化：** 實現一個僅有「管理員」和「員工」兩級的系統，員工的存取權限由管理員在網頁上「勾選可見模塊」來動態決定。
- **自動化：** 移除所有手動審批流程（如假期），改為「員工自主登記、系統自動計算」。
- **易用性：** 為 1 位管理員和 3 位員工提供一個直觀、反應迅速的網頁介面，降低新系統導入的阻力。

### 1.3. 使用者角色

#### 1. 管理員 (Admin)

- 擁有系統的完整存取權限
- 唯一能存取「系統設定」模塊的人
- 負責設定所有業務規則（如假期規則、加班費率、**SOP 檢查表模板**）
- **核心職責：** 決定「員工」群組能看到（並因此能編輯）哪些功能模塊

#### 2. 員工 (Employee)

- 登入後，看到的導航菜單由管理員配置
- **核心原則：** 「能看見，就能編輯」。如果一個模塊（如 SOP）對員工可見，員工即擁有該模塊的完整編輯權限

---

## 2. 系統架構 (The Cloudflare Stack)

本系統將完全部署在 Cloudflare 的全球邊緣網路上，確保高效能與低延遲。

### 2.1. 前端 (Frontend): **Cloudflare Pages**

- 使用現代 JavaScript 框架 (如 Vue.js 或 React) 開發單頁應用 (SPA)
- 部署於 `admin.yourfirm.com`

### 2.2. 後端 (Backend API): **Cloudflare Workers**

- 使用 Hono 框架來建構模塊化的 RESTful API
- 處理所有業務邏輯、資料庫查詢和身份驗證
- 系統的核心計算（如假期時數）將在此以 TypeScript 函數實現

### 2.3. 資料庫 (Database): **Cloudflare D1**

- 一個 Serverless SQL 資料庫，用於儲存所有結構化資料（用戶、工時、客戶、規則、進度）

### 2.4. 檔案儲存 (File Storage): **Cloudflare R2**

- S3 兼容的對象儲存
- 用於儲存所有 SOP、CMS 中的圖片，以及資源中心的文件（PDF, DOCX 等）

### 2.5. 身份驗證 (Authentication): **自訂登入流程**

- **取代 Cloudflare Access**，建立一個使用 `username` (帳號) 和 `password` (密碼) 的登入頁面
- **登入 API：** 一個專門的 Cloudflare Worker 端點 (例如：`/api/auth/login`)
- **密碼安全：** 密碼將使用標準雜湊算法 (Hashing) 處理後，才儲存於 `Users` 資料庫表中
- **會話管理 (Session)：** 登入成功後，Worker 將產生一個安全的 HttpOnly Cookie 來維護使用者的登入狀態

### 2.6. 自動化 (Automation): **Cloudflare Workers Cron Triggers**

- 定時觸發器，用於執行週期性任務（例如：每月自動為客戶生成檢查表）

---

## 3. 資料庫設計 (Cloudflare D1 Schema)

此 Schema 是為會計師事務所的營運需求量身打造。

### 3.1. 核心業務資料表

#### `Users` (員工資料庫)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `user_id` | INTEGER PK | 員工唯一識別碼 |
| `name` | TEXT | 員工姓名（例如：'紜蓁', '凱閔'） |
| `username` | TEXT UNIQUE | 登入帳號（例如：'employee1@firm.com'） |
| `hashed_password` | TEXT | 雜湊處理後的密碼 |
| `is_admin` | BOOLEAN | 是否為管理員 |
| `gender` | TEXT | 性別（'male', 'female', 'other'） |

#### `TimeLogs` (工時紀錄資料庫)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `log_id` | INTEGER PK | 工時記錄唯一識別碼 |
| `user_id` | INTEGER FK | 員工 ID |
| `client_id` | TEXT FK | 客戶 ID |
| `business_type` | TEXT | 業務類型 |
| `work_date` | TEXT | 工作日期 |
| `work_type` | TEXT | 工時類型（例如：'正常工時', '平日加班(1.34)'） |
| `hours` | REAL | 原始時數 |
| `weighted_hours` | REAL | 加權時數 |
| `leave_type` | TEXT | 假別 |
| `leave_hours` | REAL | 請假時數 |

#### `Clients` (客戶資料)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `client_id` | TEXT PK | 統一編號 |
| `company_name` | TEXT | 公司名稱 |
| `status` | TEXT | 狀態（例如：'營業'） |
| `assignee_user_id` | INTEGER FK | 負責員工 ID |
| `contact_person_1` | TEXT | 聯絡人 1 |
| `contact_person_2` | TEXT | 聯絡人 2 |
| `phone` | TEXT | 電話 |
| `email` | TEXT | 電子郵件 |
| `invoice_count` | INTEGER | 發票數量 |
| `difficulty` | TEXT | 難易度 |
| `remarks` | TEXT | 備註 |

### 3.2. 業務服務系統資料表

#### `ServiceTemplates` (服務模板)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `template_id` | INTEGER PK | 服務模板 ID |
| `name` | TEXT | 服務名稱（例如：'記帳服務', '工商登記服務'） |
| `description` | TEXT | 服務說明 |

#### `ClientServices` (客戶訂閱服務)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `client_service_id` | INTEGER PK | 客戶服務 ID |
| `client_id` | TEXT FK | 客戶 ID |
| `service_template_id` | INTEGER FK | 服務模板 ID |
| `frequency` | TEXT | 頻率（'每月', '雙月', '單次'） |
| `fee` | INTEGER | 費用 |
| `trigger_months` | TEXT | 觸發月份（JSON：`[1,3,5,7,9,11]`） |
| `is_active` | BOOLEAN | 是否啟用 |
| `payment_remarks` | TEXT | 付款備註 |
| `service_remarks` | TEXT | 服務備註 |

### 3.3. 任務追蹤系統資料表（多階段任務）

#### `TaskTemplates` (任務模板)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `task_template_id` | INTEGER PK | 任務模板 ID |
| `name` | TEXT | 模板名稱（例如：'記帳標準流程', '公司設立流程'） |
| `service_template_id` | INTEGER FK | 關聯的服務模板（可選） |
| `description` | TEXT | 模板說明 |

#### `TaskStageTemplates` (任務階段模板)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `stage_template_id` | INTEGER PK | 階段模板 ID |
| `task_template_id` | INTEGER FK | 任務模板 ID |
| `stage_name` | TEXT | 階段名稱（例如：'資料收集', '營業稅申報', '提列折舊'） |
| `stage_order` | INTEGER | 階段順序（1, 2, 3...） |
| `estimated_days` | INTEGER | 預計所需天數 |
| `description` | TEXT | 階段說明 |

#### `ActiveTasks` (執行中任務)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `active_task_id` | INTEGER PK | 執行中任務 ID |
| `client_id` | TEXT FK | 客戶 ID |
| `client_service_id` | INTEGER FK | 關聯的客戶服務 ID |
| `task_template_id` | INTEGER FK | 任務模板 ID |
| `title` | TEXT | 任務標題（例如：'仟鑽-記帳-114年9-10月'） |
| `assigned_user_id` | INTEGER FK | 負責員工 ID |
| `start_date` | TEXT | 開始日期 |
| `due_date` | TEXT | 到期日期（自動計算） |
| `status` | TEXT | 整體狀態（'進行中', '已完成', '逾期'） |
| `year` | INTEGER | 年份 |
| `period` | TEXT | 期間（例如：'9-10月'） |

#### `ActiveTaskStages` (執行中任務階段)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `active_stage_id` | INTEGER PK | 執行中階段 ID |
| `active_task_id` | INTEGER FK | 執行中任務 ID |
| `stage_template_id` | INTEGER FK | 階段模板 ID |
| `stage_name` | TEXT | 階段名稱 |
| `stage_order` | INTEGER | 階段順序 |
| `estimated_days` | INTEGER | 預計天數 |
| `start_date` | TEXT | 實際開始日期 |
| `due_date` | TEXT | 該階段到期日 |
| `completed_date` | TEXT | 完成日期 |
| `status` | TEXT | 狀態（'未開始', '進行中', '已完成', '逾期'） |
| `notes` | TEXT | 備註 |

### 3.4. SOP 知識庫系統資料表

#### `SOPDocuments` (SOP 文件)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `sop_id` | INTEGER PK | SOP 文件 ID |
| `title` | TEXT | SOP 標題（例如：'記帳服務標準作業流程'） |
| `service_template_id` | INTEGER FK | 關聯的服務模板（可選） |
| `content` | TEXT | SOP 內容（HTML/Markdown） |
| `last_edited_by` | INTEGER FK | 最後編輯者 |
| `version` | INTEGER | 版本號 |
| `created_at` | TEXT | 建立時間 |
| `updated_at` | TEXT | 更新時間 |

#### `ClientSOPLinks` (客戶專屬 SOP 連結)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `link_id` | INTEGER PK | 連結 ID |
| `client_id` | TEXT FK | 客戶 ID |
| `client_service_id` | INTEGER FK | 客戶服務 ID |
| `sop_id` | INTEGER FK | SOP 文件 ID |
| `custom_notes` | TEXT | 該客戶的特殊備註 |

### 3.5. 通用知識庫資料表

#### `KnowledgeBase` (內部知識庫 / FAQ)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `doc_id` | INTEGER PK | 文件 ID |
| `title` | TEXT | 標題 |
| `category` | TEXT | 分類（'FAQ', '教學', '政策'） |
| `content` | TEXT | 內容（HTML/Markdown） |
| `last_edited_by` | INTEGER FK | 最後編輯者 |
| `created_at` | TEXT | 建立時間 |
| `updated_at` | TEXT | 更新時間 |

### 3.6. 外部網站內容資料表

#### `PublicContent` (外部網站 CMS)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `content_id` | INTEGER PK | 內容 ID |
| `type` | TEXT | 類型（例如：'article', 'faq'） |
| `title` | TEXT | 標題 |
| `content` | TEXT | 內容 |
| `created_at` | TEXT | 建立時間 |
| `updated_at` | TEXT | 更新時間 |

#### `PublicResources` (外部資源中心)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `resource_id` | INTEGER PK | 資源 ID |
| `file_name` | TEXT | 檔案名稱 |
| `r2_object_key` | TEXT | R2 儲存鍵值 |
| `file_type` | TEXT | 檔案類型 |
| `uploaded_at` | TEXT | 上傳時間 |

### 3.7. 假期與業務規則資料表

#### `Holidays` (國定假日)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `holiday_date` | TEXT PK | 假日日期（格式：'YYYY-MM-DD'） |
| `name` | TEXT | 假日名稱 |

#### `LeaveTypes` (假別類型)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `name` | TEXT PK | 假別名稱 |
| `is_gender_specific` | BOOLEAN | 是否性別專屬（例如：'生理假' = true） |

#### `BusinessTypes` (業務類型)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `name` | TEXT PK | 業務類型名稱 |

#### `OvertimeRates` (加班費率)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `rate_id` | INTEGER PK | 費率 ID |
| `overtime_type` | TEXT | 加班類型（例如：'平日加班'） |
| `start_hour` | INTEGER | 起始時段 |
| `end_hour` | INTEGER | 結束時段 |
| `rate` | REAL | 費率倍數 |

#### `AnnualLeaveRules` (特休規則)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `rule_id` | INTEGER PK | 規則 ID |
| `min_seniority_years` | INTEGER | 最低年資 |
| `grant_days` | INTEGER | 給假天數 |

#### `OtherLeaveRules` (其他假期規則)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `name` | TEXT PK | 假別名稱（例如：'病假', '婚假'） |
| `grant_days` | INTEGER | 給假天數 |
| `grant_type` | TEXT | 給假類型（例如：'年度給假', '事件給假'） |

#### `LeaveEvents` (假期事件登記簿)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `event_id` | INTEGER PK | 事件 ID |
| `user_id` | INTEGER FK | 員工 ID |
| `event_type` | TEXT FK | 事件類型 |
| `event_date` | TEXT | 事件日期 |

> **註：** 此表由員工自行填寫

### 3.8. 系統設定資料表

#### `SystemSettings` (系統參數)

| 欄位 | 類型 | 說明 |
|------|------|------|
| `key` | TEXT PK | 設定鍵值 |
| `value` | TEXT | 設定值 |
| `updated_at` | TEXT | 更新時間 |

**範例資料（用於權限控制）：**

```json
{ "key": "module_visibility_sop", "value": "true" }
{ "key": "module_visibility_tasks", "value": "true" }
{ "key": "module_visibility_clients", "value": "false" }
```

---

## 4. 核心功能模塊詳解

### 模塊一：系統設定（僅限管理員）

此為系統的大腦，用於集中管理所有業務規則。

#### 4.1. 員工可見模塊設定

- **UI：** 一系列勾選框，用於設定「員工」群組的導航欄可見性
- **選項：**
  - `[ ]` 儀表板
  - `[ ]` 工時表
  - `[ ]` SOP 進度管理
  - `[ ]` SOP / 知識庫
  - `[ ]` 假期管理
  - `[ ]` 客戶管理
  - `[ ]` 外部網站編輯

#### 4.2. 業務規則設定

- **UI：** 多個網頁表單，用於編輯 D1 資料庫中的規則表
- **表單：** `Holidays`, `LeaveTypes`, `BusinessTypes`, `ServiceTemplates`, `OvertimeRates`, `AnnualLeaveRules`, `OtherLeaveRules`

#### 4.3. SOP 檢查表模板設定

- **UI：** 一個管理介面，讓管理員可以建立和編輯 `ChecklistTemplates`
- **邏輯：** 管理員建立一個模板（例如：'雙月記帳'），然後在該模板下新增 `ChecklistTemplateItems`（例如：'營業稅過帳', '提列折舊'等）

#### 4.4. CSV 導入

- 提供 `Clients` 表的 CSV 模板下載及上傳導入功能

#### 4.5. 員工管理（含帳號）

- **UI：** 一個管理 `Users` 表的介面
- **功能（新增）：** 新增員工帳號（設定其 `username` 及初始密碼）
- **功能（重設）：** 重設員工密碼（由管理員指定新密碼）
- **功能（停用）：** 停用員工帳號

---

### 模塊二：個人中心（所有使用者）

#### 4.6. 儀表板 (Dashboard)

- 登入後的首頁，**無通知中心（小鈴鐺）**
- **資訊看板 (Widgets)：**
  - **「我的任務」：** 列表顯示 `ActiveTasks` 中指派給該員工的任務（含進度和到期日）
  - **「待辦階段」：** 顯示目前進行中任務的各階段狀態（逾期會以紅色標示）
  - **「工時表快捷入口」：** 連結至本月工時表
  - **「我的假期狀態」：** 顯示假期總覽（例如：特休 剩餘 X 天）

#### 4.7. 個人資料

- **UI：** 員工可在此設定個人資料
- **`gender` 設定（核心）：** 提供下拉選單（男性/女性/其他），員工自行設定。此設定將儲存於 `Users.gender`

---

### 模塊三：工時表 & 報表 (Timesheet & Reports)

此模塊是事務所日常營運的核心。

#### 4.8. 工時表介面

- **UI：** 一個網頁格狀介面 (Grid)，外觀和體驗盡可能貼近使用者熟悉的電子表格體驗
- **邏輯 (Load)：** API 會抓取 `TimeLogs` 和 `Holidays` 資料，動態生成該月份的工時表

#### 4.9. 加權工時

- **UI：** 員工填寫完工時，按下「儲存本月變更」
- **邏輯 (Save)：** API 接收到前端傳來的「原始工時」，根據 `OvertimeRates` 規則**自動計算** `weighted_hours`（加權時數），並將原始時數與加權時數一併存入 `TimeLogs`

#### 4.10. 報表中心

- **UI：** 點擊按鈕產生報表
- **邏輯 (Report)：** Worker API 會直接查詢 D1（例如：`SUM(weighted_hours) ... GROUP BY client_name, business_type`），並回傳 JSON 格式的報表資料，前端再將其渲染為表格

---

### 模塊四：假期管理 (Leave Management)

此模塊基於「無審批、全自動」原則設計。

#### 4.11. 假期登記（日常）

- **UI：** 日曆介面，登記即生效，寫入 `TimeLogs`
- **`gender` 連動：** API 根據 `Users.gender` 決定是否提供「生理假」選項

#### 4.12. 登記生活事件（員工自主）

- **UI：** 獨立表單，員工自主登記婚假、喪假等，寫入 `LeaveEvents`

#### 4.13. 假期總覽（自動計算）

- **UI：** 顯示「應有 / 已用 / 剩餘」時數
- **邏輯 (Calculation)：** API 將即時查詢 `AnnualLeaveRules`, `OtherLeaveRules`, `LeaveEvents` 和 `TimeLogs`，回傳計算結果

---

### 模塊五：任務追蹤系統 (Multi-Stage Task Management)

**此為本系統的關鍵創新模塊：多階段任務管理系統**

#### 4.14. 任務模板管理（管理員專用）

- **UI：** 任務模板編輯介面
- **功能：** 管理員可建立任務模板（例如：'記帳標準流程', '公司設立流程'）
- **階段設定：** 為每個模板定義多個階段（from `TaskStageTemplates`）：
  - 階段名稱（例如：'資料收集', '營業稅申報', '提列折舊', '報表產出'）
  - 階段順序（1, 2, 3, 4...）
  - **預計天數**（例如：第一階段需 3 天，第二階段需 5 天）
- **範例模板：**
  ```
  記帳標準流程（雙月）：
  階段 1：資料收集與核對（3天）
  階段 2：營業稅過帳（2天）
  階段 3：提列折舊（1天）
  階段 4：財務報表產出（2天）
  總計：8天
  ```

#### 4.15. 客戶服務設定（管理員專用）

- **UI：** 在客戶管理頁面，為每個客戶設定訂閱的服務
- **邏輯：** 管理員為客戶新增服務（寫入 `ClientServices`）：
  1. 選擇服務模板（from `ServiceTemplates`，例如：'記帳服務'）
  2. 設定頻率（'每月', '雙月', '單次'）
  3. 設定費用和觸發月份
  4. **關聯任務模板**：選擇該服務要使用的任務模板
- **自動化：** Cron Job 會根據觸發月份，自動為客戶建立任務實例（寫入 `ActiveTasks`）

#### 4.16. 任務進度追蹤（所有員工）

- **UI：** 任務看板介面（看板式或列表式）
- **功能：**
  - 查看指派給自己的所有任務（from `ActiveTasks`）
  - 每個任務顯示：客戶名稱、任務標題、開始日期、到期日期、整體狀態
  - 點擊任務進入詳細頁面
- **篩選器：** 依客戶、服務類型、狀態、時間範圍篩選

#### 4.17. 階段進度更新（所有員工）

- **UI：** 任務詳細頁面，顯示所有階段（from `ActiveTaskStages`）
- **功能：**
  - 以時間軸或步驟條 (Stepper) 方式顯示各階段
  - 每個階段顯示：階段名稱、預計天數、開始日期、到期日、狀態
  - **到期提醒：** 快到期（剩 1 天）的階段以黃色標示，逾期的階段以紅色標示
  - 員工可更新階段狀態：'未開始' → '進行中' → '已完成'
  - 可為每個階段添加備註

#### 4.18. 自動到期計算邏輯

- **開始任務時：** 系統根據所有階段的 `estimated_days` 加總，自動計算整個任務的 `due_date`
- **階段到期：** 當某階段標記為「進行中」，系統自動設定該階段的 `start_date` 和 `due_date`（start_date + estimated_days）
- **逾期偵測：** 每日 Cron Job 檢查所有階段，自動更新逾期狀態

#### 4.19. 客戶管理（子模塊）

- **UI：** 功能完整的客戶關係管理 (CRUD) 介面
- **「負責」員工指派：** 管理員可透過下拉選單將 `Clients.assignee_user_id` 指派給特定員工
- **服務查看：** 可查看該客戶訂閱的所有服務和執行中的任務

---

### 模塊六：SOP 知識庫 (SOP Knowledge Base)

**此模塊與任務追蹤系統分離，專門用於儲存和連結標準作業流程文件**

#### 4.20. SOP 文件管理

- **UI：** 一個所見即所得 (WYSIWYG) 編輯器，支援表格和圖片上傳
- **功能：** 建立和編輯 SOP 文件（寫入 `SOPDocuments`）
- **分類：** 可將 SOP 與特定服務模板關聯（例如：'記帳服務 SOP'）
- **版本控制：** 每次編輯會更新版本號
- **邏輯：** 內容儲存在 D1，圖片上傳至 R2
- **權限：** 此模塊是否可見，取決於「模塊一」中的 `module_visibility_sop` 勾選狀態

#### 4.21. 客戶專屬 SOP 連結

- **UI：** 在客戶服務設定頁面，可為特定客戶的特定服務連結 SOP 文件
- **邏輯：** 建立 `ClientSOPLinks` 記錄，將客戶、服務、SOP 三者關聯
- **應用場景：** 某些客戶的記帳流程可能有特殊要求，可以為該客戶單獨連結一份客製化的 SOP
- **快速存取：** 員工在執行任務時，可直接查看該客戶該服務的專屬 SOP

---

### 模塊七：通用知識庫 (General Knowledge Base)

#### 4.22. 內部知識庫

- **UI：** 類似維基百科的文件管理介面
- **功能：** 儲存內部 FAQ、教學文件、公司政策等
- **分類：** 依類別組織（FAQ、教學、政策）
- **搜尋：** 全文搜尋功能

---

### 模塊八：外部網站內容 (Public CMS)

#### 4.23. 外部網站文章管理

- **UI：** WYSIWYG 編輯器，用於編輯 `PublicContent`（公開文章、FAQ）
- **功能：** 建立、編輯、刪除外部網站的內容
- **權限：** 此模塊是否可見，取決於「模塊一」中的 `module_visibility_cms` 勾選狀態

#### 4.24. 資源中心管理

- **UI：** 檔案管理器介面
- **功能：** 上傳/刪除 `PublicResources`（例如：PDF, DOCX），檔案儲存於 R2
- **應用：** 提供給客戶下載的表單、指南等

---

## 5. 權限模型：「能看見，就能編輯」

本系統的權限設計極度簡化，以符合小型團隊的需求。

### 5.1. 管理員 (Admin)

- `is_admin = true` 的使用者（登入後檢查 `Users` 表確認）
- **永遠**可以看到所有模塊
- **唯一**能看到「模塊一：系統設定」的人

### 5.2. 員工 (Employee)

- `is_admin = false` 的使用者（登入後檢查 `Users` 表確認）
- 登入時，前端 API 會檢查 `SystemSettings` 表中的 `module_visibility_...` 設置
- 前端根據 API 回傳的 `true/false` 列表，動態生成導航欄菜單
- **API 強制執行：** 如果員工試圖透過 URL 直接存取一個「不可見」的模塊（例如：`/sop`），後端 Worker API 會再次檢查設定，並回傳 403 Forbidden 錯誤，確保資料安全
- **編輯權限：** 只要一個模塊對員工可見，他/她就擁有該模塊的完整編輯權限（例如：修改 SOP、更新檢查表進度）

---

## 6. 自動化流程：週期性任務 (Cron Trigger)

本系統使用 Cloudflare Workers Cron Triggers 實現任務自動化。

### 6.1. Cron Job #1：自動建立任務

**觸發器：** 每天凌晨 1 點執行（`cron = "0 1 * * *"`）

**執行邏輯：**

1. 檢查今天是否為 1 號（每月的第一天）
2. 如果是，獲取當前月份（例如：`currentMonth = 4`）
3. `SELECT * FROM ClientServices WHERE is_active = 1`
4. **迴圈遍歷**所有客戶服務：
   - `trigger_months_array = JSON.parse(service.trigger_months)`
   - 如果 `trigger_months_array.includes(currentMonth)`（觸發月份包含本月）：
     
     **(A) 建立任務實例：**
     - 從 `ClientServices` 取得 `task_template_id`
     - `SELECT assignee_user_id FROM Clients WHERE client_id = service.client_id`（獲取負責員工）
     - `INSERT` 一筆新資料到 `ActiveTasks` 表
     - 獲取新生成的 `new_active_task_id`
     
     **(B) 產生所有階段實例：**
     - `SELECT * FROM TaskStageTemplates WHERE task_template_id = service.task_template_id ORDER BY stage_order`
     - **批次 `INSERT`** 多筆資料到 `ActiveTaskStages` 表
     - 設定第一個階段的狀態為「未開始」

**結果：** 員工登入時，儀表板的「我的任務」看板將自動顯示新任務

### 6.2. Cron Job #2：自動更新逾期狀態

**觸發器：** 每天凌晨 2 點執行（`cron = "0 2 * * *"`）

**執行邏輯：**

1. 查詢所有進行中的階段：`SELECT * FROM ActiveTaskStages WHERE status IN ('未開始', '進行中')`
2. 檢查每個階段的 `due_date`
3. 如果 `due_date < TODAY`，更新狀態為「逾期」
4. 記錄逾期任務列表（可選：發送通知給管理員）

### 6.3. Cron Job #3：資料庫備份（可選）

**觸發器：** 每天凌晨 3 點執行（`cron = "0 3 * * *"`）

**執行邏輯：**

1. 匯出 D1 資料庫為 SQL 檔案
2. 上傳至 R2 儲存桶（路徑：`/backups/db_YYYY-MM-DD.sql`）
3. 刪除 30 天前的舊備份

---

## 7. 系統初始化與資料導入

### 7.1. 客戶資料 (`Clients`)

透過「模塊一」中建置的「CSV 導入」功能進行批次上傳

### 7.2. 業務規則（所有設定表）

- **系統初始化設定：** 系統上線時，管理員必須進入「模塊一：系統設定」介面，將事務所的所有業務規則（加班費率、假期規則、假別列表等）輸入網頁表單，以完成系統初始化
- **服務項目**與**週期性任務**也需要透過此介面手動建立
- **SOP 檢查表建立：** 管理員需要將事務所的標準作業流程（如記帳、工商登記）的檢查項目，建立為 `ChecklistTemplates` 和 `ChecklistTemplateItems`

### 7.3. 歷史工時 (`TimeLogs`)

- **歷史資料：** 系統將從啟用日開始記錄新資料。歷史工時資料預設不導入

---

## 8. 介面原型概念 (UI/UX)

### 8.1. 設計風格

- **風格：** 簡潔、現代、響應式設計 (RWD)，專注於易用性
- **導航：** 固定的左側導航欄，菜單項根據「模塊一」的權限設置動態顯示

### 8.2. 核心介面

#### 核心介面 1：SOP 檢查表進度

高度客製化的網頁格狀 (Grid) 組件，用於顯示和更新 `ActiveChecklistProgress`，提供直觀、高效的進度追蹤體驗

#### 核心介面 2：工時表

一個易於填寫的格狀 (Grid) 介面，用於填寫 `TimeLogs`

#### 核心介面 3：儀表板

基於卡片 (Cards) 的小工具 (Widgets) 介面，清晰展示關鍵資訊

#### 核心介面 4：設定

乾淨的表單 (Forms) 和表格 (Data Tables)，用於管理所有業務規則

---

## 9. 開發指南 (Developer Guide)

本指南旨在確保未來所有的新功能開發，都能**嚴格遵守**本文件定義的「模塊化」與「標準化」原則，以保持代碼庫的精簡、可維護性與一致性。

### 9.1. 核心原則

#### 原則一：標準化 (Standardization) - 邏輯存入D1，而非代碼

- **禁止硬編碼 (Hard-coding)：** 任何業務規則（例如：一個新的假期類型、一個新的檢查表項目）**嚴禁**寫死在前端或後端代碼中
- **規則資料庫化：** 所有規則**必須**被設計為 D1 資料庫中的一個新表（或擴展現有表）。管理員必須能在「模塊一：系統設定」中透過網頁介面管理這些規則

#### 原則二：模塊化 (Modularity) - 功能獨立，介面清晰

- **後端 (API)：** 每個核心功能都**必須**有其獨立的 Hono 路由檔案（例如：`tasks.ts`, `timesheet.ts`）
- **前端 (UI)：** 每個模塊都**必須**是獨立的頁面或組件集

---

### 9.2. 後端開發指南 (Cloudflare Workers)

#### API 規範

- **Hono 路由：** 新增功能模塊時，**必須**在後端 API 中建立一個新的路由檔案（例如：`new_feature_api.ts`）並在主入口點中掛載
- **權限檢查：** **每個** API 端點（除了登入）都**必須**首先檢查使用者的身份驗證 Cookie
- **可見性檢查：** 如果該功能受「模塊一」的可見性控制，API **必須**檢查 `SystemSettings` 表中的 `module_visibility_...` 參數，拒絕非管理員的非法存取

#### 資料庫 (D1)

- 嚴格遵守「第 3 節」的 Schema 設計
- 複雜查詢應盡可能使用 SQL `JOIN`，避免在 Worker 中進行多次 `SELECT` 後再組合資料，以保持 API 的高效能

---

### 9.3. 前端開發指南 (Cloudflare Pages)

為實現「代碼精簡」與「組件共用」的要求，前端開發**必須**遵循以下規範：

#### CSS 標準化（推薦使用 Tailwind CSS）

**原則：**
- 為了最大限度地提高代碼重用性並保持 HTML 的精簡，**強烈建議**使用像 **Tailwind CSS** 這樣的 Utility-First（功能優先）框架

**規範：**
- **禁止**編寫獨立的、冗長的 `.css` 檔案（例如：`style.css`）
- 所有樣式**應**直接在 HTML（或 Vue/React 組件）中使用 utility classes（例如：`class="bg-blue-500 text-white font-bold py-2 px-4 rounded"`）

**優勢：**
- 確保所有按鈕、表格、卡片的外觀高度一致（標準化）
- 極大地減少了 CSS 代碼的總量（精簡）

#### HTML 精簡化

- **語意化：** **必須**使用語意化的 HTML 標籤（例如：`<nav>`, `<main>`, `<button>`, `<table>`）
- **避免 `<div>` 濫用：** 僅在佈局需要時使用 `<div>`，避免不必要的層層嵌套

#### 共用組件 (Component Reusability)

**識別共用元素：**

開發者**必須**識別在多個模塊中重複出現的 UI 元素，例如：
- `Button`（標準按鈕）
- `Modal`（彈出視窗）
- `DataGrid`（核心的格狀介面，用於工時表和SOP進度）
- `TextInput`, `SelectDropdown`（表單輸入框）

**建立共用庫：**

- **必須**將這些元素建立為可重用的組件（例如：`<StyledButton>`, `<SopGrid>`）
- 存放在一個共用的資料夾（例如：`/components/common/`）中

**規範：**

未來在開發新功能頁面時，**必須**優先使用這些已存在的共用組件，**禁止**重新打造外觀相似但代碼不同的「一次性」組件

---

### 9.4. 新增功能模塊的標準流程

未來若要新增一個「模塊八」（例如：資產管理），**必須**遵循以下標準流程：

#### 步驟一：定義 Schema (D1)

在「第 3 節」中新增 `Assets`（資產）和 `AssetRules`（資產規則）等 D1 資料庫表定義

#### 步驟二：建立 API (Worker)

- 建立一個新的 `assets.ts` Hono 路由檔案
- 提供 `GET /api/assets`, `POST /api/assets` 等 CRUD 端點
- 確保 API 端點已加入權限檢查

#### 步驟三：建立 UI (Pages)

- 建立一個新的 `Assets.vue`（或 `.jsx`）頁面組件
- 在此頁面中，**大量共用**「9.3節」中定義的 `<StyledButton>`, `<DataGrid>` 等組件來建構介面

#### 步驟四：整合至系統 (Admin)

- 在 `SystemSettings` (D1) 資料表中新增一筆記錄：`{"key": "module_visibility_assets", "value": "false"}`
- 在「模塊一：系統設定」的網頁介面上，新增一個勾選框 `[ ] 資產管理`，使其與該 `SystemSettings` 記錄連動

---

## 附錄

### 技術堆疊總覽

| 層級 | 技術 | 用途 |
|------|------|------|
| 前端 | Vue.js / React + Tailwind CSS | 單頁應用 (SPA) |
| 後端 | Cloudflare Workers + Hono | RESTful API |
| 資料庫 | Cloudflare D1 | SQL 資料儲存 |
| 檔案儲存 | Cloudflare R2 | 物件儲存 (圖片、文件) |
| 部署 | Cloudflare Pages | 靜態網站託管 |
| 自動化 | Cloudflare Workers Cron | 定時任務 |
| 身份驗證 | 自訂 JWT + HttpOnly Cookie | 使用者登入與會話管理 |


---

## 10. 系統優化功能清單 (System Enhancement Checklist)

> **核心原則：** 所有優化功能都遵循「標準化與模塊化」設計哲學  
> **使用方式：** 請告訴我您需要的功能編號（例如：F001, F003, F010），我會保留這些功能並刪除其他不需要的

---

### 🔒 安全標準化

**F001** - 密碼雜湊標準：明確使用 Argon2 算法，建立 `PasswordService` 模塊

**F002** - 密碼強度規則：在 `SystemSettings` 中配置（最小長度、複雜度要求）

**F003** - API 驗證標準：建立統一的 `AuthMiddleware.ts` 中間件

**F004** - 錯誤回應標準：定義統一的錯誤格式 JSON Schema

**F005** - Rate Limiting 標準：建立 `RateLimiter` 模塊（所有 API 統一套用）

**F006** - CSRF Token 標準：建立 `CsrfService` 模塊（所有表單提交統一驗證）

**F007** - 登入失敗鎖定機制：在 `Users` 表新增 `failed_login_attempts` 和 `locked_until` 欄位

**F008** - 雙因素驗證（2FA）：支援 TOTP 或 Email OTP

---

### 📊 資料庫標準化

**F009** - 時間戳標準：在所有主表加入 `created_at` 和 `updated_at` 欄位

**F010** - 軟刪除標準：在重要表加入 `is_deleted`, `deleted_at`, `deleted_by` 欄位

**F011** - 審計日誌系統：建立 `AuditLogs` 表，自動記錄所有 CUD 操作

**F012** - 資料庫索引優化：為所有外鍵和常查詢欄位建立索引

**F013** - 資料驗證約束：在 D1 Schema 中加入 CHECK 約束（性別、工時範圍等）

**F014** - 資料庫備份機制：每日自動備份 D1 到 R2（保留 30 天）

**F015** - 一鍵復原功能：管理員可選擇特定日期的備份復原

---

### 🔌 API 標準化

**F016** - API 版本控制：所有端點加入 `/api/v1/` 前綴

**F017** - API 回應標準：統一成功回應格式（success, data, meta）

**F018** - HTTP 狀態碼標準：建立狀態碼使用規範文件

**F019** - API 參數標準：統一查詢參數命名（page, limit, sort, order, search, filter）

**F020** - API 健康檢查：建立 `/api/health` 端點

---

### 🎨 前端標準化

**F021** - Tailwind CSS 標準：統一使用 Tailwind CSS，移除所有自訂 .css 檔案

**F022** - Tailwind 配置檔：建立 `tailwind.config.js` 統一配置（色彩、間距、字體）

**F023** - 共用組件：`<StyledButton>` 統一按鈕樣式

**F024** - 共用組件：`<StyledInput>` 統一輸入框樣式

**F025** - 共用組件：`<StyledSelect>` 統一下拉選單樣式

**F026** - 共用組件：`<StyledModal>` 統一彈出視窗

**F027** - 共用組件：`<StyledTable>` 統一表格樣式

**F028** - 共用組件：`<DataGrid>` 核心格狀介面（用於工時表和任務進度）

**F029** - 共用組件：`<PageHeader>` 統一頁面標題區塊

**F030** - 共用組件：`<Card>` 統一卡片容器

**F031** - 共用組件：`<EmptyState>` 統一空狀態提示

**F032** - 共用組件：`<LoadingSpinner>` 統一載入動畫

**F033** - 共用組件：`<Pagination>` 統一分頁組件

**F034** - 共用組件：`<Toast>` 統一提示訊息

**F035** - 共用組件：`<NotificationBanner>` 頂部橫幅通知

**F036** - 表單驗證標準：建立統一的驗證模塊（required, email, minLength 等）

**F037** - 日期格式標準：建立統一的日期處理模塊

**F038** - HTTP 請求標準：建立統一的 API 呼叫模塊（處理認證、錯誤、loading）

---

### 🧩 後端模塊化

**F039** - 服務層模塊：建立 `/services/` 目錄，將業務邏輯從路由中分離

**F040** - 服務模塊：`auth.service.ts` 身份驗證邏輯

**F041** - 服務模塊：`timesheet.service.ts` 工時計算邏輯

**F042** - 服務模塊：`leave.service.ts` 假期計算邏輯

**F043** - 服務模塊：`task.service.ts` 任務管理邏輯

**F044** - 服務模塊：`permission.service.ts` 權限檢查邏輯

**F045** - 服務模塊：`automation.service.ts` 自動化任務邏輯

**F046** - 資料庫查詢模塊：建立 `/repositories/` 目錄封裝 SQL 查詢

**F047** - Repository：`base.repository.ts` 通用 CRUD 方法

**F048** - Repository：`user.repository.ts` 使用者資料存取

**F049** - Repository：`timelog.repository.ts` 工時資料存取

**F050** - Repository：`client.repository.ts` 客戶資料存取

**F051** - Repository：`task.repository.ts` 任務資料存取

**F052** - 中間件模塊：建立 `/middlewares/` 目錄

**F053** - Middleware：`auth.middleware.ts` 驗證登入狀態

**F054** - Middleware：`permission.middleware.ts` 檢查模塊可見性

**F055** - Middleware：`validation.middleware.ts` 請求參數驗證

**F056** - Middleware：`ratelimit.middleware.ts` 流量限制

**F057** - Middleware：`audit.middleware.ts` 審計日誌記錄

**F058** - 工具函數模塊：建立 `/utils/` 目錄

**F059** - Util：`password.util.ts` 密碼雜湊/驗證

**F060** - Util：`token.util.ts` JWT 產生/驗證

**F061** - Util：`date.util.ts` 日期計算

**F062** - Util：`validation.util.ts` 資料驗證

**F063** - Util：`response.util.ts` 統一回應格式化

**F064** - 設定模塊：建立 `/config/` 目錄集中管理配置

**F065** - Config：`database.config.ts` D1 連線設定

**F066** - Config：`auth.config.ts` JWT 密鑰、過期時間

**F067** - Config：`ratelimit.config.ts` API 速率限制規則

**F068** - Config：`constants.ts` 系統常數

---

### 🎨 前端模塊化

**F069** - 頁面模塊：建立 `/pages/` 目錄，按功能劃分獨立頁面

**F070** - 頁面：`Dashboard.vue` 儀表板

**F071** - 頁面：`Timesheet.vue` 工時表

**F072** - 頁面：`Tasks.vue` 任務追蹤

**F073** - 頁面：`Clients.vue` 客戶管理

**F074** - 頁面：`Leave.vue` 假期管理

**F075** - 頁面：`SOPDocuments.vue` SOP 知識庫

**F076** - 頁面：`KnowledgeBase.vue` 通用知識庫

**F077** - 頁面：`CMS.vue` 外部網站編輯

**F078** - 頁面：`Settings.vue` 系統設定

**F079** - 功能組件模塊：建立 `/components/features/` 目錄

**F080** - Feature 組件：`timesheet/TimesheetGrid.vue` 工時表格

**F081** - Feature 組件：`timesheet/OvertimeCalculator.vue` 加班計算器

**F082** - Feature 組件：`timesheet/MonthSelector.vue` 月份選擇器

**F083** - Feature 組件：`tasks/TaskBoard.vue` 任務看板

**F084** - Feature 組件：`tasks/TaskStageProgress.vue` 階段進度顯示

**F085** - Feature 組件：`tasks/TaskTemplateEditor.vue` 任務模板編輯器

**F086** - Feature 組件：`leave/LeaveCalendar.vue` 假期日曆

**F087** - Feature 組件：`leave/LeaveBalanceWidget.vue` 假期餘額小工具

**F088** - Feature 組件：`leave/LeaveEventForm.vue` 假期事件表單

**F089** - 狀態管理模塊：建立 `/stores/` 目錄（Pinia）

**F090** - Store：`auth.store.ts` 使用者認證狀態

**F091** - Store：`timesheet.store.ts` 工時表資料

**F092** - Store：`task.store.ts` 任務資料

**F093** - Store：`client.store.ts` 客戶資料

**F094** - Store：`settings.store.ts` 系統設定（含模塊可見性）

**F095** - Store：`ui.store.ts` UI 狀態（loading, modal 等）

**F096** - API 呼叫模塊：建立 `/api/` 目錄

**F097** - API Service：`auth.api.ts` 認證 API 呼叫

**F098** - API Service：`timesheet.api.ts` 工時 API 呼叫

**F099** - API Service：`task.api.ts` 任務 API 呼叫

**F100** - API Service：`client.api.ts` 客戶 API 呼叫

**F101** - API Service：`leave.api.ts` 假期 API 呼叫

**F102** - API Service：`settings.api.ts` 設定 API 呼叫

**F103** - 路由模塊：建立 `/router/` 目錄模塊化路由配置

**F104** - Route Guard：`auth.guard.ts` 登入驗證守衛

**F105** - Route Guard：`permission.guard.ts` 權限檢查守衛

**F106** - 組合式函數模塊：建立 `/composables/` 目錄

**F107** - Composable：`useAuth.ts` 認證相關邏輯

**F108** - Composable：`usePermission.ts` 權限檢查邏輯

**F109** - Composable：`usePagination.ts` 分頁邏輯

**F110** - Composable：`useSearch.ts` 搜尋邏輯

**F111** - Composable：`useForm.ts` 表單處理邏輯

**F112** - Composable：`useDataTable.ts` 表格通用邏輯

---

### 🔄 自動化模塊化

**F113** - Cron Job 模塊化：建立 `/cron/` 目錄，每個定時任務獨立檔案

**F114** - Cron：`task-generator.ts` 自動生成任務（每月 1 號執行）

**F115** - Cron：`overdue-detector.ts` 自動更新逾期狀態（每日執行）

**F116** - Cron：`backup.ts` 資料庫備份（每日執行）

**F117** - Cron：`cleanup.ts` 清理過期資料（每週執行）

**F118** - Cron：`notifications.ts` 定期通知任務（可選）

---

### 🔍 功能增強

**F119** - 全域搜尋功能：客戶搜尋（公司名稱、統編、聯絡人）

**F120** - 全域搜尋功能：知識庫全文搜尋

**F121** - 全域搜尋功能：工時記錄搜尋（業務類型、日期範圍）

**F122** - 快捷鍵支援：`Ctrl + K` 開啟搜尋框

**F123** - 快捷鍵支援：`Ctrl + S` 儲存工時表

**F124** - 快捷鍵支援：`Esc` 關閉彈出視窗

**F125** - 進階篩選器組件：支援日期範圍、多選下拉、狀態篩選

**F126** - 工時表匯出：Excel 格式

**F127** - 工時表匯出：CSV 格式

**F128** - 任務進度匯出：Excel 格式（含進度百分比）

**F129** - 客戶資料匯出：CSV 格式

**F130** - 報表匯出：PDF 格式（含圖表）

**F131** - 批量操作：批量更新任務階段狀態

**F132** - 批量操作：批量指派客戶給員工

**F133** - 批量操作：批量刪除/復原資料

**F134** - 快取服務模塊：使用 Cloudflare Cache API 快取系統設定、業務規則

**F135** - 分頁功能：統一的分頁組件（用於客戶列表、工時記錄等）

**F136** - 虛擬滾動：用於長列表（客戶列表、工時記錄）

---

### 📊 資料視覺化

**F137** - 圖表組件庫：整合 Chart.js 或 ECharts

**F138** - 圖表組件：`PieChart.vue` 圓餅圖

**F139** - 圖表組件：`LineChart.vue` 折線圖

**F140** - 圖表組件：`BarChart.vue` 長條圖

**F141** - 圖表組件：`ProgressChart.vue` 進度圖

**F142** - 儀表板視覺化：工時分佈圓餅圖（各業務類型占比）

**F143** - 儀表板視覺化：假期使用趨勢折線圖

**F144** - 儀表板視覺化：任務完成率進度條

**F145** - 儀表板視覺化：月度工時統計長條圖

---

### 📝 知識庫增強

**F146** - SOP 版本控制：建立 `SOPDocumentVersions` 表

**F147** - SOP 版本比對：Diff View 功能

**F148** - SOP 一鍵回復：回復到歷史版本

**F149** - 通用知識庫版本控制：建立 `KnowledgeBaseVersions` 表

---

### 🏖️ 假期系統增強

**F150** - 假期衝突檢測：防止重複請假

**F151** - 假期預警系統：餘額不足 3 天時提示

**F152** - 假期統計報表：年度使用分析

**F153** - 假期審核流程（可選）：彈性啟用審核機制

---

### ✅ 任務系統增強

**F154** - 任務階段依賴關係：定義階段執行順序（某階段必須在另一階段完成後才能開始）

**F155** - 預計完成時間預測：根據歷史資料預測各階段完成時間

**F156** - 任務範本複製：從已有任務快速建立新任務

**F157** - 任務委派功能：將任務重新指派給其他員工

---

### ⏰ 工時表增強

**F158** - 工時模板功能：儲存常用工時組合（建立 `TimesheetTemplates` 表）

**F159** - 複製上週工時：一鍵複製功能

**F160** - 工時異常檢測：單日超過 12 小時時提示

**F161** - 自動計算加班時數：超過 8 小時自動標記

---

### 📊 報表系統增強

**F162** - 報表模塊化：建立 `/services/reports/` 目錄

**F163** - 報表：`timesheet.report.ts` 工時報表

**F164** - 報表：`client.report.ts` 客戶分析報表

**F165** - 報表：`efficiency.report.ts` 效率分析報表

**F166** - 報表：`financial.report.ts` 財務報表

**F167** - 標準報表：員工工時統計（按業務類型）

**F168** - 標準報表：客戶服務分析（投入工時 vs 收費）

**F169** - 標準報表：月度/季度/年度業務報告

**F170** - 標準報表：假期使用率統計

---

### 📱 行動裝置優化

**F171** - 響應式設計標準：Tailwind 斷點規範（sm, md, lg, xl）

**F172** - 行動專用組件：`<MobileNavbar>` 底部導航欄

**F173** - 行動專用組件：`<MobileTimesheetInput>` 觸控友好的工時輸入

**F174** - 行動專用組件：`<MobileTaskCard>` 卡片式任務顯示

**F175** - 行動專用組件：`<SwipeActions>` 滑動操作組件

---

### 🧪 測試與監控

**F176** - 測試基礎設施：建立 `/tests/` 目錄（unit, integration, e2e）

**F177** - 測試工具配置：Vitest（單元測試）

**F178** - 測試工具配置：Miniflare（模擬 Cloudflare 環境）

**F179** - 測試工具配置：Playwright（E2E 測試）

**F180** - 日誌服務模塊：建立 `logger.service.ts`（info, warn, error）

**F181** - 監控整合：Cloudflare Analytics（效能監控）

**F182** - 監控整合：Sentry（錯誤追蹤）

**F183** - 系統健康檢查 Cron：每小時檢查系統狀態，異常時通知

---

### 📚 文件與部署

**F184** - API 文件自動生成：使用 OpenAPI 3.0 規範

**F185** - API 文件 UI：整合 Swagger UI（訪問 `/api-docs`）

**F186** - 資料庫 ER 圖：使用 Mermaid 或 dbdiagram.io 產生

**F187** - 程式碼文件自動生成：使用 TypeDoc 產生 API 文件

**F188** - 更新日誌規範：維護 `CHANGELOG.md`

**F189** - 環境變數管理：建立 `.env.example`, `.env.development`, `.env.production`

**F190** - 部署檢查清單：建立標準部署前檢查項目

---

### 🔐 進階安全功能

**F191** - 員工角色系統擴展：建立 `Roles` 表，精細化權限控制

**F192** - IP 白名單功能：限制管理員登入 IP 範圍

**F193** - 會話管理：顯示當前登入裝置列表，可遠端登出

**F194** - 敏感資料加密：客戶電話、Email 加密儲存

**F195** - 操作確認機制：刪除客戶等敏感操作需二次確認

---

### 📈 進階分析功能

**F196** - 員工績效追蹤：加權工時排行

**F197** - 員工績效追蹤：任務完成效率

**F198** - 客戶獲利分析：投入工時 vs 收費分析

**F199** - 服務類型分佈趨勢：季度/年度趨勢圖

**F200** - 預測分析：預測下月工時需求

---

## 11. 優先級建議

根據您選擇的功能編號，我會協助您：

1. **建立實施計畫**：依功能依賴關係排序
2. **提供詳細設計**：包含程式碼架構、資料庫 Schema、API 端點設計
3. **產生標準範本**：提供可直接使用的程式碼模板

---

**請告訴我您需要哪些功能編號（例如：F001, F003, F009, F016, F021-F038, F039-F068），我將保留這些功能並刪除其他不需要的內容。**

---

## 12. 文檔模塊化建議

當前 `專案.md` 文件過長（1900+ 行），建議按照功能模塊拆分成以下文檔結構：

```
/docs/
├── README.md                          # 專案概述與快速導覽
├── 架構設計.md                         # 系統架構與技術堆疊
├── 資料庫設計.md                       # 完整 D1 Schema 定義
├── 權限系統設計.md                     # 權限模型詳細說明
├── 自動化流程.md                       # Cron Jobs 設計
├── 開發規範.md                         # 標準化與模塊化規範
├── 優化功能清單.md                     # 可選功能列表（F001-F200）
├── 功能模塊/
│   ├── 01-系統設定模塊.md              # 模塊一
│   ├── 02-個人中心模塊.md              # 模塊二
│   ├── 03-工時表與報表模塊.md          # 模塊三
│   ├── 04-假期管理模塊.md              # 模塊四
│   ├── 05-任務追蹤系統模塊.md          # 模塊五（核心）
│   ├── 06-SOP知識庫模塊.md            # 模塊六
│   ├── 07-通用知識庫模塊.md            # 模塊七
│   └── 08-外部網站CMS模塊.md          # 模塊八
├── API設計/
│   ├── 認證API.md                     # /api/v1/auth/*
│   ├── 工時API.md                     # /api/v1/timesheets/*
│   ├── 任務API.md                     # /api/v1/tasks/*
│   ├── 客戶API.md                     # /api/v1/clients/*
│   ├── 假期API.md                     # /api/v1/leave/*
│   └── 設定API.md                     # /api/v1/settings/*
└── 部署指南/
    ├── 環境設定.md                     # Cloudflare 環境配置
    ├── 初始化流程.md                   # 系統初始化步驟
    └── 部署檢查清單.md                 # 上線前檢查事項
```

### 12.1. 模塊化文檔優勢

1. **易於維護**：每個文檔專注於單一功能模塊
2. **便於查找**：開發者可快速定位所需文檔
3. **協作友好**：多人可同時編輯不同模塊文檔
4. **版本控制**：Git diff 更清晰，避免合併衝突
5. **按需閱讀**：只需閱讀相關模塊文檔

### 12.2. 核心文檔內容規劃

#### `README.md` (專案概述)
- 專案目的與核心目標
- 技術堆疊一覽表
- 快速導覽（連結到各模塊文檔）
- 使用者角色說明

#### `架構設計.md`
- Cloudflare 架構圖
- 前端、後端、資料庫、檔案儲存架構
- 身份驗證流程
- 資料流向圖

#### `資料庫設計.md`
- 完整 D1 Schema（所有表格定義）
- ER 圖（實體關係圖）
- 索引策略
- 資料驗證約束

#### `功能模塊/05-任務追蹤系統模塊.md` (範例)
- 功能概述
- 使用者故事
- 資料表關聯（TaskTemplates, TaskStageTemplates, ActiveTasks, ActiveTaskStages）
- UI 原型說明
- API 端點列表
- 業務邏輯說明（階段依賴、到期計算）
- 自動化流程（Cron Job）

#### `API設計/任務API.md` (範例)
```markdown
## 任務 API 端點

### GET /api/v1/tasks
**功能：** 獲取任務列表
**權限：** 需登入
**查詢參數：**
- `status`: 任務狀態篩選
- `client_id`: 客戶 ID 篩選
- `page`, `limit`: 分頁參數

**回應範例：**
```json
{
  "success": true,
  "data": [
    {
      "active_task_id": 1,
      "title": "仟鑽-記帳-114年9-10月",
      "client_name": "仟鑽企業",
      "status": "進行中",
      "due_date": "2025-11-15",
      "progress": "50%"
    }
  ],
  "meta": {
    "page": 1,
    "total": 10
  }
}
```

### POST /api/v1/tasks
**功能：** 建立新任務
**權限：** 管理員
...
```

---

## 13. 下一步行動

請告訴我：

1. **您需要哪些功能編號？**（從 F001-F200 中選擇）
   - 例如：`F001-F020, F039-F068, F119, F126-F130`

2. **是否要我立即拆分文檔？**
   - 我會將當前 `專案.md` 拆分成上述模塊化結構
   - 為每個模塊建立獨立的 Markdown 文檔

3. **文檔結構是否需要調整？**
   - 如果您有其他文檔組織偏好，請告訴我

---

**文件結束**
    ├── timesheet.service.ts     # 工時計算邏輯
    ├── leave.service.ts         # 假期計算邏輯
    ├── checklist.service.ts     # SOP 檢查表邏輯
    ├── permission.service.ts    # 權限檢查邏輯
    └── automation.service.ts    # 自動化任務邏輯
  ```

- [ ] **資料庫查詢模塊 (Repositories)：** 將 SQL 查詢封裝
  ```
  /repositories/
    ├── user.repository.ts
    ├── timelog.repository.ts
    ├── client.repository.ts
    ├── checklist.repository.ts
    └── base.repository.ts       # 通用 CRUD 方法
  ```

- [ ] **中間件模塊 (Middlewares)：** 可重用的請求處理邏輯
  ```
  /middlewares/
    ├── auth.middleware.ts       # 驗證登入狀態
    ├── permission.middleware.ts # 檢查模塊可見性
    ├── validation.middleware.ts # 請求參數驗證
    ├── ratelimit.middleware.ts  # 流量限制
    └── audit.middleware.ts      # 審計日誌記錄
  ```

- [ ] **工具函數模塊 (Utils)：** 可重用的純函數
  ```
  /utils/
    ├── password.util.ts         # 密碼雜湊/驗證
    ├── token.util.ts            # JWT 產生/驗證
    ├── date.util.ts             # 日期計算
    ├── validation.util.ts       # 資料驗證
    └── response.util.ts         # 統一回應格式化
  ```

- [ ] **設定模塊 (Config)：** 集中管理所有配置
  ```
  /config/
    ├── database.config.ts       # D1 連線設定
    ├── auth.config.ts           # JWT 密鑰、過期時間
    ├── ratelimit.config.ts      # API 速率限制規則
    └── constants.ts             # 系統常數
  ```

#### 🎨 前端模塊化

- [ ] **頁面模塊 (Pages)：** 按功能劃分獨立頁面
  ```
  /pages/
    ├── Dashboard.vue            # 儀表板
    ├── Timesheet.vue            # 工時表
    ├── Checklist.vue            # SOP 進度管理
    ├── Clients.vue              # 客戶管理
    ├── Leave.vue                # 假期管理
    ├── Knowledge.vue            # 知識庫
    ├── CMS.vue                  # 外部網站編輯
    └── Settings.vue             # 系統設定
  ```

- [ ] **功能組件模塊 (Feature Components)：** 頁面專用的複雜組件
  ```
  /components/features/
    ├── timesheet/
    │   ├── TimesheetGrid.vue
    │   ├── OvertimeCalculator.vue
    │   └── MonthSelector.vue
    ├── checklist/
    │   ├── ChecklistProgressGrid.vue
    │   ├── ChecklistFilter.vue
    │   └── ChecklistItemEditor.vue
    └── leave/
        ├── LeaveCalendar.vue
        ├── LeaveBalanceWidget.vue
        └── LeaveEventForm.vue
  ```

- [ ] **狀態管理模塊 (Store/Pinia)：** 按功能領域分割狀態
  ```
  /stores/
    ├── auth.store.ts            # 使用者認證狀態
    ├── timesheet.store.ts       # 工時表資料
    ├── checklist.store.ts       # 檢查表資料
    ├── client.store.ts          # 客戶資料
    ├── settings.store.ts        # 系統設定（含模塊可見性）
    └── ui.store.ts              # UI 狀態（loading, modal 等）
  ```

- [ ] **API 呼叫模塊 (API Services)：** 將 API 請求邏輯獨立
  ```
  /api/
    ├── auth.api.ts
    ├── timesheet.api.ts
    ├── checklist.api.ts
    ├── client.api.ts
    ├── leave.api.ts
    └── settings.api.ts
  ```

- [ ] **路由模塊 (Router)：** 模塊化路由配置
  ```
  /router/
    ├── index.ts                 # 主路由入口
    ├── routes/
    │   ├── dashboard.routes.ts
    │   ├── timesheet.routes.ts
    │   ├── checklist.routes.ts
    │   └── settings.routes.ts
    └── guards/
        ├── auth.guard.ts        # 登入驗證守衛
        └── permission.guard.ts  # 權限檢查守衛
  ```

- [ ] **組合式函數模塊 (Composables)：** 可重用的邏輯鉤子
  ```
  /composables/
    ├── useAuth.ts               # 認證相關邏輯
    ├── usePermission.ts         # 權限檢查邏輯
    ├── usePagination.ts         # 分頁邏輯
    ├── useSearch.ts             # 搜尋邏輯
    ├── useForm.ts               # 表單處理邏輯
    └── useDataTable.ts          # 表格通用邏輯
  ```

#### 🔄 自動化模塊化

- [ ] **Cron Job 模塊化：** 每個定時任務獨立檔案
  ```
  /cron/
    ├── index.ts                 # Cron 路由註冊
    ├── checklist-generator.ts   # 自動生成檢查表
    ├── backup.ts                # 資料庫備份
    ├── cleanup.ts               # 清理過期資料
    └── notifications.ts         # 定期通知任務
  ```

---

### 10.3. 功能增強模塊 (Feature Enhancements)

#### 🔍 搜尋與篩選模塊

- [ ] **全域搜尋功能：** 建立獨立的搜尋模塊
  - [ ] 客戶搜尋（公司名稱、統編、聯絡人）
  - [ ] 知識庫全文搜尋
  - [ ] 工時記錄搜尋（業務類型、日期範圍）
  - [ ] 快捷鍵支援：`Ctrl + K` 開啟搜尋框

- [ ] **進階篩選器組件：** 可重用的篩選器
  ```typescript
  // <AdvancedFilter> 組件
  支援：日期範圍、多選下拉、狀態篩選、員工篩選
  ```

#### 📤 資料匯出模塊

- [ ] **匯出服務模塊：** 建立統一的匯出引擎
  ```
  /services/export/
    ├── excel.exporter.ts        # Excel 匯出
    ├── csv.exporter.ts          # CSV 匯出
    ├── pdf.exporter.ts          # PDF 匯出
    └── base.exporter.ts         # 匯出基礎類別
  ```

- [ ] **工時表匯出：** Excel/CSV 格式
- [ ] **SOP 進度匯出：** Excel 格式（含進度百分比）
- [ ] **客戶資料匯出：** CSV 格式
- [ ] **報表匯出：** PDF 格式（含圖表）

#### 📊 資料視覺化模塊

- [ ] **圖表組件庫：** 使用 Chart.js 或 ECharts
  ```
  /components/charts/
    ├── PieChart.vue             # 圓餅圖
    ├── LineChart.vue            # 折線圖
    ├── BarChart.vue             # 長條圖
    └── ProgressChart.vue        # 進度圖
  ```

- [ ] **儀表板視覺化：**
  - [ ] 工時分佈圓餅圖（各業務類型占比）
  - [ ] 假期使用趨勢折線圖
  - [ ] SOP 完成率進度條
  - [ ] 月度工時統計長條圖

#### 🔄 批量操作模塊

- [ ] **批量操作服務：** 建立通用批量處理邏輯
  ```typescript
  // /services/batch.service.ts
  export class BatchService {
    async batchUpdate(table: string, ids: number[], updates: object) {
      // 統一批量更新邏輯
    }
  }
  ```

- [ ] **具體批量功能：**
  - [ ] 批量更新 SOP 檢查表狀態
  - [ ] 批量指派客戶給員工
  - [ ] 批量刪除/復原資料
  - [ ] 批量匯入/匯出

#### 💾 備份與復原模塊

- [ ] **備份服務模塊：**
  ```
  /services/backup/
    ├── database.backup.ts       # D1 備份邏輯
    ├── file.backup.ts           # R2 檔案備份邏輯
    └── restore.service.ts       # 復原邏輯
  ```

- [ ] **自動備份 Cron Job：** 每日凌晨 2 點執行
- [ ] **備份管理介面：** 管理員可查看/下載/復原備份
- [ ] **備份保留策略：** 保留最近 30 天的備份

#### 📝 版本控制模塊

- [ ] **知識庫版本控制：**
  - [ ] 建立 `KnowledgeBaseVersions` 表
  - [ ] 每次編輯自動建立版本快照
  - [ ] 版本比對功能（Diff View）
  - [ ] 一鍵回復到歷史版本

#### 🔔 智能提示模塊

- [ ] **提示系統模塊：** 非侵入式的通知系統
  ```
  /components/notifications/
    ├── NotificationBanner.vue   # 頂部橫幅
    ├── Toast.vue                # 彈出提示
    └── AlertCard.vue            # 警告卡片
  ```

- [ ] **智能提示場景：**
  - [ ] 假期餘額不足提示
  - [ ] SOP 檢查表逾期提醒
  - [ ] 系統維護公告
  - [ ] 資料儲存成功/失敗提示

#### 📱 行動裝置優化模塊

- [ ] **響應式設計標準：** Tailwind 斷點規範
  ```
  sm: 640px   - 手機橫向
  md: 768px   - 平板直向
  lg: 1024px  - 平板橫向
  xl: 1280px  - 桌面
  ```

- [ ] **行動專用組件：**
  - [ ] `<MobileNavbar>` - 底部導航欄
  - [ ] `<MobileTimesheetInput>` - 觸控友好的工時輸入
  - [ ] `<MobileChecklistCard>` - 卡片式檢查表（取代格狀介面）
  - [ ] `<SwipeActions>` - 滑動操作組件

#### ⚡ 效能優化模塊

- [ ] **快取服務模塊：**
  ```typescript
  // /services/cache.service.ts
  export class CacheService {
    async get(key: string) { /* 從 Cache API 取得 */ }
    async set(key: string, data: any, ttl: number) { /* 寫入快取 */ }
    async invalidate(pattern: string) { /* 清除快取 */ }
  }
  ```

- [ ] **快取策略：**
  - [ ] 系統設定（TTL: 1 小時）
  - [ ] 業務規則（TTL: 1 小時）
  - [ ] 客戶列表（TTL: 5 分鐘）
  - [ ] 使用者權限（TTL: 15 分鐘）

- [ ] **分頁模塊：** 統一的分頁組件
  ```vue
  <Pagination 
    :total="1000" 
    :perPage="50" 
    @change="handlePageChange" 
  />
  ```

- [ ] **虛擬滾動：** 用於長列表（如客戶列表、工時記錄）

#### 🧪 測試模塊

- [ ] **測試基礎設施：**
  ```
  /tests/
    ├── unit/                    # 單元測試
    │   ├── services/
    │   ├── utils/
    │   └── components/
    ├── integration/             # 整合測試
    │   └── api/
    └── e2e/                     # 端到端測試
        └── scenarios/
  ```

- [ ] **測試工具配置：**
  - [ ] Vitest（單元測試）
  - [ ] Miniflare（模擬 Cloudflare 環境）
  - [ ] Playwright（E2E 測試）

#### 📈 監控與日誌模塊

- [ ] **日誌服務模塊：**
  ```typescript
  // /services/logger.service.ts
  export const logger = {
    info: (message, meta?) => { /* 記錄資訊 */ },
    warn: (message, meta?) => { /* 記錄警告 */ },
    error: (message, error, meta?) => { /* 記錄錯誤 */ }
  }
  ```

- [ ] **監控整合：**
  - [ ] Cloudflare Analytics（效能監控）
  - [ ] Sentry（錯誤追蹤）
  - [ ] 自訂儀表板（API 回應時間、錯誤率）

---

### 10.4. 業務邏輯增強 (Business Logic Enhancements)

#### 🏖️ 假期系統增強

- [ ] **假期衝突檢測：** 防止重複請假
- [ ] **假期預警系統：** 餘額不足 3 天時提示
- [ ] **假期統計報表：** 年度使用分析
- [ ] **假期審核流程（可選）：** 彈性啟用審核機制

#### ✅ SOP 檢查表智能化

- [ ] **檢查項目依賴關係：** 定義項目執行順序
  ```sql
  -- ChecklistTemplateItems 新增欄位
  ALTER TABLE ChecklistTemplateItems 
    ADD COLUMN depends_on INTEGER;  -- 依賴的項目 ID
  ```

- [ ] **預計完成時間：** 根據歷史資料預測
- [ ] **逾期提醒：** 紅色標記超時任務
- [ ] **檢查表範本複製：** 從已有檢查表快速建立新的

#### ⏰ 工時表智能化

- [ ] **工時模板功能：** 儲存常用工時組合
  ```sql
  CREATE TABLE TimesheetTemplates (
    template_id INTEGER PRIMARY KEY,
    user_id INTEGER,
    name TEXT,
    template_data TEXT  -- JSON 格式
  );
  ```

- [ ] **複製上週工時：** 一鍵複製功能
- [ ] **工時異常檢測：** 單日超過 12 小時時提示
- [ ] **自動計算加班時數：** 超過 8 小時自動標記

#### 📊 報表系統增強

- [ ] **報表模塊化：**
  ```
  /services/reports/
    ├── timesheet.report.ts      # 工時報表
    ├── client.report.ts         # 客戶分析報表
    ├── efficiency.report.ts     # 效率分析報表
    └── financial.report.ts      # 財務報表
  ```

- [ ] **標準報表：**
  - [ ] 員工工時統計（按業務類型）
  - [ ] 客戶服務分析（投入工時 vs 收費）
  - [ ] 月度/季度/年度業務報告
  - [ ] 假期使用率統計

---

### 10.5. 系統管理增強 (System Management Enhancements)

#### 🔐 雙因素驗證模塊（可選）

- [ ] **2FA 服務模塊：**
  ```sql
  -- Users 表新增欄位
  ALTER TABLE Users ADD COLUMN two_factor_secret TEXT;
  ALTER TABLE Users ADD COLUMN two_factor_enabled BOOLEAN DEFAULT 0;
  ```

- [ ] **支援驗證方式：**
  - [ ] TOTP（Google Authenticator）
  - [ ] Email OTP

#### 👥 員工管理增強

- [ ] **員工角色系統（擴展）：**
  ```sql
  CREATE TABLE Roles (
    role_id INTEGER PRIMARY KEY,
    name TEXT,
    permissions TEXT  -- JSON 格式，精細化權限
  );
  
  -- Users 表新增
  ALTER TABLE Users ADD COLUMN role_id INTEGER;
  ```

- [ ] **員工績效追蹤（可選）：**
  - [ ] 加權工時排行
  - [ ] SOP 完成效率
  - [ ] 客戶滿意度評分

#### 📋 系統健康檢查模塊

- [ ] **健康檢查端點：** `/api/health`
  ```json
  {
    "status": "healthy",
    "checks": {
      "database": "ok",
      "r2": "ok",
      "cron": "ok"
    },
    "timestamp": "2025-10-27T12:00:00Z"
  }
  ```

- [ ] **定期健康檢查 Cron：** 每小時執行，異常時發送通知

---

### 10.6. 部署與維護標準化

#### 🚀 部署檢查清單

- [ ] **環境變數管理：** 建立標準環境變數文件
  ```
  /.env.example        # 環境變數範本
  /.env.development    # 開發環境
  /.env.production     # 正式環境
  ```

- [ ] **部署前檢查清單（新增章節）：**
  - [ ] 修改所有預設密碼
  - [ ] 設定 D1 資料庫備份
  - [ ] 啟用 Cloudflare WAF 規則
  - [ ] 配置 CSP Header
  - [ ] 設定 SSL/TLS 為 Full (strict)
  - [ ] 測試 Cron Job 執行
  - [ ] 驗證 Rate Limiting 運作
  - [ ] 檢查所有 API 端點權限設定

#### 📚 文件維護標準

- [ ] **程式碼文件自動生成：** 使用 TypeDoc 產生 API 文件
- [ ] **更新日誌規範：** 維護 `CHANGELOG.md`
  ```markdown
  ## [1.1.0] - 2025-11-15
  ### Added
  - 新增批量操作功能
  - 新增資料匯出模塊
  
  ### Changed
  - 優化工時表載入效能
  
  ### Fixed
  - 修正假期計算錯誤
  ```

---

## 11. 實施優先級建議

### 🔴 第一階段（階段一擴展）：核心標準化

**預估時間：** 3 週

- [ ] 密碼雜湊標準（Argon2）
- [ ] 時間戳標準（所有表加入 created_at/updated_at）
- [ ] API 版本控制（/api/v1/）
- [ ] 錯誤回應標準
- [ ] 資料庫索引優化
- [ ] 後端服務層模塊化（Services）
- [ ] 資料庫查詢模塊化（Repositories）
- [ ] 前端共用組件庫（基礎組件）
- [ ] API 呼叫模塊化
- [ ] CSS 標準化（Tailwind 設定）

### 🟡 第二階段（階段二～三擴展）：進階標準化與功能增強

**預估時間：** 4 週

- [ ] 審計日誌系統
- [ ] 軟刪除機制
- [ ] 中間件模塊化
- [ ] 前端狀態管理模塊化
- [ ] 路由模塊化與守衛
- [ ] 組合式函數模塊
- [ ] 搜尋與篩選功能
- [ ] 資料匯出模塊
- [ ] 批量操作功能
- [ ] 快取服務模塊
- [ ] 分頁與虛擬滾動

### 🟢 第三階段（階段四～五擴展）：進階功能與優化

**預估時間：** 3 週

- [ ] 資料視覺化模塊
- [ ] 備份與復原系統
- [ ] 版本控制（知識庫）
- [ ] 智能提示系統
- [ ] 行動裝置優化
- [ ] SOP 依賴關係
- [ ] 工時模板功能
- [ ] 報表系統增強
- [ ] 監控與日誌模塊
- [ ] 測試基礎設施

### ⚪ 第四階段（可選）：高級功能

**預估時間：** 2 週

- [ ] 雙因素驗證
- [ ] 進階角色系統
- [ ] WebSocket 即時更新
- [ ] 員工績效追蹤
- [ ] 系統健康檢查

---

## 12. 模塊依賴關係圖

```
┌─────────────────────────────────────────────────────────┐
│                     前端應用層 (Pages)                    │
│  Dashboard │ Timesheet │ Checklist │ Clients │ Settings  │
└──────────────────────────┬──────────────────────────────┘
                           │
┌──────────────────────────┴──────────────────────────────┐
│              前端組件層 (Components & Composables)         │
│  Common Components │ Feature Components │ Composables    │
└──────────────────────────┬──────────────────────────────┘
                           │
┌──────────────────────────┴──────────────────────────────┐
│               前端服務層 (API Services & Store)           │
│      API Clients │ State Management │ Router Guards      │
└──────────────────────────┬──────────────────────────────┘
                           │
                      HTTP/HTTPS
                           │
┌──────────────────────────┴──────────────────────────────┐
│                  後端 API 層 (Workers/Hono)               │
│         Routes │ Middlewares │ Validation                │
└──────────────────────────┬──────────────────────────────┘
                           │
┌──────────────────────────┴──────────────────────────────┐
│                後端服務層 (Services)                       │
│  Auth │ Timesheet │ Leave │ Checklist │ Permission      │
└──────────────────────────┬──────────────────────────────┘
                           │
┌──────────────────────────┴──────────────────────────────┐
│              資料存取層 (Repositories)                     │
│        User │ TimeLog │ Client │ Checklist Repos        │
└──────────────────────────┬──────────────────────────────┘
                           │
┌──────────────────────────┴──────────────────────────────┐
│                   資料層 (D1 & R2)                        │
│              SQL Database │ Object Storage                │
└─────────────────────────────────────────────────────────┘
```

---

**勾選完成後，請告知您優先想實施的模塊，我將協助您建立詳細的實施計畫！**

---

**文件結束**
