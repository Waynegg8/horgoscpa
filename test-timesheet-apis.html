<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å·¥æ™‚è¡¨ API å…¨é¢æ¸¬è©¦</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { color: #333; margin-bottom: 20px; }
    .section { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    h2 { color: #0066cc; margin-bottom: 15px; font-size: 18px; }
    button { background: #0066cc; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px; margin-bottom: 10px; }
    button:hover { background: #0052a3; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 13px; line-height: 1.5; }
    .success { color: #28a745; font-weight: bold; }
    .error { color: #dc3545; font-weight: bold; }
    .warning { color: #ffc107; font-weight: bold; }
    .info { color: #17a2b8; margin-bottom: 10px; }
    input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” å·¥æ™‚è¡¨ API å…¨é¢æ¸¬è©¦</h1>
    <p class="info">è«‹ç¢ºä¿å·²ç™»å…¥ <a href="https://horgoscpa.com/login" target="_blank">horgoscpa.com/login</a></p>

    <!-- 1. å‡æœŸ API -->
    <div class="section">
      <h2>1ï¸âƒ£ å‡æœŸ API (Holidays)</h2>
      <button onclick="testHolidaysAPI()">æ¸¬è©¦å‡æœŸ API (10/27-11/2)</button>
      <pre id="holidaysResult">ç­‰å¾…æ¸¬è©¦...</pre>
    </div>

    <!-- 2. å®¢æˆ¶åˆ—è¡¨ API -->
    <div class="section">
      <h2>2ï¸âƒ£ å®¢æˆ¶åˆ—è¡¨ API (Clients)</h2>
      <button onclick="testClientsAPI()">æ¸¬è©¦å®¢æˆ¶åˆ—è¡¨ API</button>
      <pre id="clientsResult">ç­‰å¾…æ¸¬è©¦...</pre>
    </div>

    <!-- 3. å®¢æˆ¶æœå‹™ API -->
    <div class="section">
      <h2>3ï¸âƒ£ å®¢æˆ¶æœå‹™ API (Client Services)</h2>
      <input type="text" id="clientIdForServices" value="c_002" placeholder="å®¢æˆ¶ ID">
      <button onclick="testClientServicesAPI()">æ¸¬è©¦å®¢æˆ¶æœå‹™ API</button>
      <pre id="clientServicesResult">ç­‰å¾…æ¸¬è©¦...</pre>
    </div>

    <!-- 4. æœå‹™å­é …ç›® API -->
    <div class="section">
      <h2>4ï¸âƒ£ æœå‹™å­é …ç›® API (Service Items)</h2>
      <input type="text" id="clientIdForItems" value="c_002" placeholder="å®¢æˆ¶ ID">
      <input type="text" id="serviceIdForItems" value="1" placeholder="æœå‹™ ID">
      <button onclick="testServiceItemsAPI()">æ¸¬è©¦æœå‹™å­é …ç›® API</button>
      <pre id="serviceItemsResult">ç­‰å¾…æ¸¬è©¦...</pre>
    </div>

    <!-- 5. å·¥æ™‚è¨˜éŒ„ API -->
    <div class="section">
      <h2>5ï¸âƒ£ å·¥æ™‚è¨˜éŒ„ API (Timelogs)</h2>
      <button onclick="testTimelogsAPI()">æ¸¬è©¦å·¥æ™‚è¨˜éŒ„ API (10/27-11/2)</button>
      <pre id="timelogsResult">ç­‰å¾…æ¸¬è©¦...</pre>
    </div>

    <!-- 6. æœˆçµ±è¨ˆ API -->
    <div class="section">
      <h2>6ï¸âƒ£ æœˆçµ±è¨ˆ API (Monthly Summary)</h2>
      <input type="text" id="monthForSummary" value="2025-10" placeholder="æœˆä»½ (YYYY-MM)">
      <button onclick="testMonthlySummaryAPI()">æ¸¬è©¦æœˆçµ±è¨ˆ API</button>
      <pre id="monthlySummaryResult">ç­‰å¾…æ¸¬è©¦...</pre>
    </div>

    <!-- 7. è«‹å‡è¨˜éŒ„ API -->
    <div class="section">
      <h2>7ï¸âƒ£ è«‹å‡è¨˜éŒ„ API (Leaves)</h2>
      <button onclick="testLeavesAPI()">æ¸¬è©¦è«‹å‡è¨˜éŒ„ API (10/27-11/2)</button>
      <pre id="leavesResult">ç­‰å¾…æ¸¬è©¦...</pre>
    </div>

    <!-- å…¨éƒ¨æ¸¬è©¦ -->
    <div class="section">
      <h2>ğŸš€ ä¸€éµæ¸¬è©¦å…¨éƒ¨ API</h2>
      <button onclick="testAllAPIs()" style="background: #28a745;">åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦</button>
      <pre id="allTestsResult">ç­‰å¾…æ¸¬è©¦...</pre>
    </div>
  </div>

  <script>
    async function apiCall(url) {
      const response = await fetch(url, { credentials: 'include' });
      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 200)}`);
      }
      return response.json();
    }

    function displayResult(elementId, data, testName) {
      const element = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString('zh-TW');
      
      if (data.error) {
        element.innerHTML = `<span class="error">âŒ ${testName} å¤±æ•—</span> [${timestamp}]\n\néŒ¯èª¤ï¼š${data.error}`;
      } else {
        const dataCount = Array.isArray(data.data) ? data.data.length : (data.data ? 1 : 0);
        element.innerHTML = `<span class="success">âœ… ${testName} æˆåŠŸ</span> [${timestamp}]\n\n` +
          `æ•¸æ“šç­†æ•¸ï¼š${dataCount}\n\n` +
          `å®Œæ•´éŸ¿æ‡‰ï¼š\n${JSON.stringify(data, null, 2)}`;
      }
    }

    async function testHolidaysAPI() {
      try {
        const data = await apiCall('/internal/api/v1/holidays?start_date=2025-10-27&end_date=2025-11-02');
        displayResult('holidaysResult', data, 'å‡æœŸ API');
        
        // ç‰¹åˆ¥æª¢æŸ¥ 10/10 åœ‹æ…¶æ—¥
        const hasHolidayDate = data.data && data.data.some(h => h.holiday_date);
        if (!hasHolidayDate) {
          document.getElementById('holidaysResult').innerHTML += '\n\n<span class="warning">âš ï¸ è­¦å‘Šï¼šè¿”å›çš„å‡æœŸæ•¸æ“šæ²’æœ‰ holiday_date æ¬„ä½ï¼</span>';
        }
      } catch (error) {
        displayResult('holidaysResult', { error: error.message }, 'å‡æœŸ API');
      }
    }

    async function testClientsAPI() {
      try {
        const data = await apiCall('/internal/api/v1/clients?perPage=100');
        displayResult('clientsResult', data, 'å®¢æˆ¶åˆ—è¡¨ API');
      } catch (error) {
        displayResult('clientsResult', { error: error.message }, 'å®¢æˆ¶åˆ—è¡¨ API');
      }
    }

    async function testClientServicesAPI() {
      try {
        const clientId = document.getElementById('clientIdForServices').value;
        const data = await apiCall(`/internal/api/v1/clients/${clientId}/services`);
        displayResult('clientServicesResult', data, 'å®¢æˆ¶æœå‹™ API');
      } catch (error) {
        displayResult('clientServicesResult', { error: error.message }, 'å®¢æˆ¶æœå‹™ API');
      }
    }

    async function testServiceItemsAPI() {
      try {
        const clientId = document.getElementById('clientIdForItems').value;
        const serviceId = document.getElementById('serviceIdForItems').value;
        const data = await apiCall(`/internal/api/v1/clients/${clientId}/services/${serviceId}/items`);
        displayResult('serviceItemsResult', data, 'æœå‹™å­é …ç›® API');
      } catch (error) {
        displayResult('serviceItemsResult', { error: error.message }, 'æœå‹™å­é …ç›® API');
      }
    }

    async function testTimelogsAPI() {
      try {
        const data = await apiCall('/internal/api/v1/timelogs?start_date=2025-10-27&end_date=2025-11-02');
        displayResult('timelogsResult', data, 'å·¥æ™‚è¨˜éŒ„ API');
      } catch (error) {
        displayResult('timelogsResult', { error: error.message }, 'å·¥æ™‚è¨˜éŒ„ API');
      }
    }

    async function testMonthlySummaryAPI() {
      try {
        const month = document.getElementById('monthForSummary').value;
        const data = await apiCall(`/internal/api/v1/timelogs/summary?month=${month}`);
        displayResult('monthlySummaryResult', data, 'æœˆçµ±è¨ˆ API');
      } catch (error) {
        displayResult('monthlySummaryResult', { error: error.message }, 'æœˆçµ±è¨ˆ API');
      }
    }

    async function testLeavesAPI() {
      try {
        const data = await apiCall('/internal/api/v1/leaves?start_date=2025-10-27&end_date=2025-11-02');
        displayResult('leavesResult', data, 'è«‹å‡è¨˜éŒ„ API');
      } catch (error) {
        displayResult('leavesResult', { error: error.message }, 'è«‹å‡è¨˜éŒ„ API');
      }
    }

    async function testAllAPIs() {
      const result = document.getElementById('allTestsResult');
      result.innerHTML = '<span class="info">â³ æ­£åœ¨åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦...</span>';
      
      const tests = [
        { name: 'å‡æœŸ API', fn: testHolidaysAPI },
        { name: 'å®¢æˆ¶åˆ—è¡¨ API', fn: testClientsAPI },
        { name: 'å®¢æˆ¶æœå‹™ API', fn: testClientServicesAPI },
        { name: 'æœå‹™å­é …ç›® API', fn: testServiceItemsAPI },
        { name: 'å·¥æ™‚è¨˜éŒ„ API', fn: testTimelogsAPI },
        { name: 'æœˆçµ±è¨ˆ API', fn: testMonthlySummaryAPI },
        { name: 'è«‹å‡è¨˜éŒ„ API', fn: testLeavesAPI }
      ];

      let summary = [];
      for (const test of tests) {
        try {
          await test.fn();
          summary.push(`âœ… ${test.name} - æˆåŠŸ`);
        } catch (error) {
          summary.push(`âŒ ${test.name} - å¤±æ•—: ${error.message}`);
        }
      }

      const timestamp = new Date().toLocaleTimeString('zh-TW');
      result.innerHTML = `<span class="success">ğŸ‰ å…¨éƒ¨æ¸¬è©¦å®Œæˆï¼</span> [${timestamp}]\n\n` +
        `æ¸¬è©¦æ‘˜è¦ï¼š\n` + summary.join('\n');
    }
  </script>
</body>
</html>

