{
  "version": 3,
  "sources": ["../../../src/utils.js", "../../../src/auth.js", "../../../src/api/clients.js", "../../../src/api/tasks.js", "../../../src/api/timesheets.js", "../../../src/api/receipts.js", "../../../src/api/payroll.js", "../../../src/api/leaves.js", "../../../src/api/dev.js", "../../../src/api/overhead.js", "../../../src/index.js", "../../../../../../../AppData/Local/npm-cache/_npx/d77349f55c2be1c0/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../AppData/Local/npm-cache/_npx/d77349f55c2be1c0/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-baIFTX/middleware-insertion-facade.js", "../../../../../../../AppData/Local/npm-cache/_npx/d77349f55c2be1c0/node_modules/wrangler/templates/middleware/common.ts", "../bundle-baIFTX/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\Users\\miama\\Desktop\\horgoscpa\\cloudflare\\worker-router\\.wrangler\\tmp\\dev-Qc8CuR",
  "sourcesContent": ["// \u5DE5\u5177\uFF1AJSON \u56DE\u61C9\uFF08\u7B26\u5408 Envelope\uFF09\r\nexport function jsonResponse(status, body, extraHeaders = {}) {\r\n\treturn new Response(JSON.stringify(body), {\r\n\t\tstatus,\r\n\t\theaders: {\r\n\t\t\t\"Content-Type\": \"application/json; charset=utf-8\",\r\n\t\t\t...extraHeaders,\r\n\t\t},\r\n\t});\r\n}\r\n\r\n// \u5DE5\u5177\uFF1A\u751F\u6210 Request Id\uFF08\u7C21\u6613\uFF09\r\nexport function generateRequestId() {\r\n\tconst random = crypto.getRandomValues(new Uint8Array(8));\r\n\treturn (\r\n\t\t\"req_\" + Array.from(random).map((b) => b.toString(16).padStart(2, \"0\")).join(\"\")\r\n\t);\r\n}\r\n\r\n// \u5DE5\u5177\uFF1APBKDF2-SHA256 \u9A57\u8B49\uFF08\u5132\u5B58\u683C\u5F0F\uFF1Apbkdf2$<iterations>$<saltBase64>$<hashBase64>\uFF09\r\nexport async function verifyPasswordPBKDF2(password, stored) {\r\n\tif (!stored || typeof stored !== \"string\") return false;\r\n\tconst parts = stored.split(\"$\");\r\n\tif (parts.length !== 4 || parts[0] !== \"pbkdf2\") return false;\r\n\tconst iterations = parseInt(parts[1], 10);\r\n\t// Cloudflare Workers \u9650\u5236\uFF1A\u8FED\u4EE3\u4E0A\u9650\u8F03\u4F4E\uFF1B\u653E\u5BEC\u4E0B\u9650\u81F3 100k\r\n\tif (!Number.isFinite(iterations) || iterations < 100000) return false;\r\n\tconst salt = Uint8Array.from(atob(parts[2]), (c) => c.charCodeAt(0));\r\n\tconst expected = Uint8Array.from(atob(parts[3]), (c) => c.charCodeAt(0));\r\n\r\n\tconst enc = new TextEncoder();\r\n\tconst keyMaterial = await crypto.subtle.importKey(\r\n\t\t\"raw\",\r\n\t\tenc.encode(password),\r\n\t\t{ name: \"PBKDF2\" },\r\n\t\tfalse,\r\n\t\t[\"deriveBits\"]\r\n\t);\r\n\tconst derivedBits = await crypto.subtle.deriveBits(\r\n\t\t{\r\n\t\t\tname: \"PBKDF2\",\r\n\t\t\thash: \"SHA-256\",\r\n\t\t\tsalt,\r\n\t\t\titerations,\r\n\t\t},\r\n\t\tkeyMaterial,\r\n\t\texpected.byteLength * 8\r\n\t);\r\n\tconst derived = new Uint8Array(derivedBits);\r\n\tif (derived.byteLength !== expected.byteLength) return false;\r\n\tlet diff = 0;\r\n\tfor (let i = 0; i < derived.byteLength; i++) diff |= derived[i] ^ expected[i];\r\n\treturn diff === 0;\r\n}\r\n\r\n// \u5DE5\u5177\uFF1APBKDF2-SHA256 \u7522\u751F\u96DC\u6E4A\uFF08\u5132\u5B58\u683C\u5F0F\uFF1Apbkdf2$<iterations>$<saltBase64>$<hashBase64>\uFF09\r\nexport async function hashPasswordPBKDF2(password, iterations = 100000, keyLen = 32) {\r\n\tconst salt = crypto.getRandomValues(new Uint8Array(16));\r\n\tconst enc = new TextEncoder();\r\n\tconst keyMaterial = await crypto.subtle.importKey(\r\n\t\t\"raw\",\r\n\t\tenc.encode(password),\r\n\t\t{ name: \"PBKDF2\" },\r\n\t\tfalse,\r\n\t\t[\"deriveBits\"]\r\n\t);\r\n\tconst derivedBits = await crypto.subtle.deriveBits(\r\n\t\t{ name: \"PBKDF2\", hash: \"SHA-256\", salt, iterations },\r\n\t\tkeyMaterial,\r\n\t\tkeyLen * 8\r\n\t);\r\n\tconst derived = new Uint8Array(derivedBits);\r\n\tconst b64 = (u8) => btoa(String.fromCharCode(...u8));\r\n\treturn `pbkdf2${\"$\"}${iterations}${\"$\"}${b64(salt)}${\"$\"}${b64(derived)}`;\r\n}\r\n\r\n// \u5DE5\u5177\uFF1A\u96A8\u6A5F Session Id\uFF0832 bytes base64\uFF09\r\nexport function generateSessionId() {\r\n\tconst bytes = crypto.getRandomValues(new Uint8Array(32));\r\n\treturn btoa(String.fromCharCode(...bytes)).replaceAll(\"=\", \"\").replaceAll(\"+\", \"-\").replaceAll(\"/\", \"_\");\r\n}\r\n\r\n// CORS\uFF1A\u5141\u8A31\u7279\u5B9A\u4F86\u6E90\uFF08pages.dev \u8207\u4E3B\u7AD9\uFF09\uFF0C\u56DE\u50B3\u6A19\u982D\r\nexport function getCorsHeadersForRequest(request, env) {\r\n\tconst origin = request.headers.get(\"Origin\") || \"\";\r\n\tif (!origin) return {};\r\n\ttry {\r\n\t\tconst o = new URL(origin);\r\n\t\tconst host = o.hostname || \"\";\r\n\t\tif (host.endsWith(\".pages.dev\") || host.endsWith(\"horgoscpa.com\")) {\r\n\t\t\treturn {\r\n\t\t\t\t\"Access-Control-Allow-Origin\": origin,\r\n\t\t\t\t\"Access-Control-Allow-Credentials\": \"true\",\r\n\t\t\t\t\"Vary\": \"Origin\",\r\n\t\t\t};\r\n\t\t}\r\n\t} catch (_) {}\r\n\treturn {};\r\n}\r\n\r\nexport function corsPreflightResponse(request, env) {\r\n\tconst headers = {\r\n\t\t...getCorsHeadersForRequest(request, env),\r\n\t\t\"Access-Control-Allow-Methods\": \"GET,POST,OPTIONS\",\r\n\t\t\"Access-Control-Allow-Headers\": request.headers.get(\"Access-Control-Request-Headers\") || \"Content-Type, X-Request-Id\",\r\n\t\t\"Access-Control-Max-Age\": \"600\",\r\n\t};\r\n\treturn new Response(null, { status: 204, headers });\r\n}\r\n\r\n// Cookie \u8B80\u53D6\r\nexport function getCookie(request, name) {\r\n\tconst raw = request.headers.get(\"Cookie\") || \"\";\r\n\tconst parts = raw.split(\";\");\r\n\tfor (const p of parts) {\r\n\t\tconst [k, ...v] = p.trim().split(\"=\");\r\n\t\tif (k === name) return v.join(\"=\");\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n// \u53D6\u5F97\u76EE\u524D\u6703\u8A71\u7684\u4F7F\u7528\u8005\uFF08\u82E5\u7121\u6216\u904E\u671F\uFF0C\u56DE null\uFF09\r\nexport async function getSessionUser(request, env) {\r\n\tconst cookieName = String(env.SESSION_COOKIE_NAME || \"session\");\r\n\tconst sessionId = getCookie(request, cookieName);\r\n\tif (!sessionId || !env.DATABASE) return null;\r\n\tconst row = await env.DATABASE.prepare(\r\n\t\t\"SELECT s.id as session_id, s.user_id, s.expires_at, u.username, u.name, u.email, u.is_admin FROM sessions s JOIN Users u ON u.user_id = s.user_id WHERE s.id = ? LIMIT 1\"\r\n\t).bind(sessionId).first();\r\n\tif (!row) return null;\r\n\tconst exp = Date.parse(row.expires_at);\r\n\tif (Number.isNaN(exp) || exp <= Date.now()) return null;\r\n\treturn row;\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest, verifyPasswordPBKDF2, generateSessionId, getSessionUser } from \"./utils.js\";\r\n\r\nexport async function handleLogin(request, env, requestId) {\r\n\tif (request.method.toUpperCase() !== \"POST\") {\r\n\t\treturn jsonResponse(405, { ok: false, code: \"METHOD_NOT_ALLOWED\", message: \"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta: { requestId } }, getCorsHeadersForRequest(request, env));\r\n\t}\r\n\tlet payload;\r\n\ttry {\r\n\t\tpayload = await request.json();\r\n\t} catch (_) {\r\n\t\treturn jsonResponse(400, { ok: false, code: \"BAD_REQUEST\", message: \"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta: { requestId } }, getCorsHeadersForRequest(request, env));\r\n\t}\r\n\tconst username = (payload?.username || \"\").trim().toLowerCase();\r\n\tconst password = payload?.password || \"\";\r\n\tconst errors = [];\r\n\tif (!username) errors.push({ field: \"username\", message: \"\u5FC5\u586B\" });\r\n\tif (!password) errors.push({ field: \"password\", message: \"\u5FC5\u586B\" });\r\n\tif (errors.length > 0) {\r\n\t\treturn jsonResponse(422, { ok: false, code: \"VALIDATION_ERROR\", message: \"\u8F38\u5165\u6709\u8AA4\", errors, meta: { requestId } }, getCorsHeadersForRequest(request, env));\r\n\t}\r\n\r\n\tif (!env.DATABASE) {\r\n\t\treturn jsonResponse(500, { ok: false, code: \"INTERNAL_ERROR\", message: \"\u8CC7\u6599\u5EAB\u672A\u7D81\u5B9A\", meta: { requestId } }, getCorsHeadersForRequest(request, env));\r\n\t}\r\n\r\n\ttry {\r\n\t\t// \u8B80\u53D6\u4F7F\u7528\u8005\r\n\t\tconst userRow = await env.DATABASE.prepare(\r\n\t\t\t\"SELECT user_id, username, password_hash, name, email, is_admin, login_attempts, last_failed_login, is_deleted FROM Users WHERE LOWER(username) = ? LIMIT 1\"\r\n\t\t).bind(username).first();\r\n\r\n\t\t// \u907F\u514D\u6D29\u6F0F\u5E33\u865F\u5B58\u5728\u8207\u5426\r\n\t\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\t\tconst unauthorized = () => jsonResponse(401, { ok: false, code: \"UNAUTHORIZED\", message: \"\u5E33\u865F\u6216\u5BC6\u78BC\u932F\u8AA4\", meta: { requestId } }, corsHeaders);\r\n\r\n\t\tif (!userRow || userRow.is_deleted === 1) {\r\n\t\t\treturn unauthorized();\r\n\t\t}\r\n\r\n\t\t// \u9396\u5B9A\u6AA2\u67E5\uFF08\u9023\u7E8C\u5931\u6557 >=5 \u4E14 15 \u5206\u9418\u5167\uFF09\r\n\t\tconst attempts = Number(userRow.login_attempts || 0);\r\n\t\tif (attempts >= 5 && userRow.last_failed_login) {\r\n\t\t\tconst lastFailedAt = Date.parse(userRow.last_failed_login);\r\n\t\t\tif (!Number.isNaN(lastFailedAt)) {\r\n\t\t\t\tconst fifteenMinAgo = Date.now() - 15 * 60 * 1000;\r\n\t\t\t\tif (lastFailedAt > fifteenMinAgo) {\r\n\t\t\t\t\treturn jsonResponse(401, { ok: false, code: \"ACCOUNT_LOCKED\", message: \"\u5617\u8A66\u904E\u591A\uFF0C\u7A0D\u5F8C\u518D\u8A66\", meta: { requestId } }, corsHeaders);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// \u5BC6\u78BC\u9A57\u8B49\r\n\t\tconst hash = userRow.password_hash || \"\";\r\n\t\tconst passOk = await verifyPasswordPBKDF2(password, hash);\r\n\t\tif (!passOk) {\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"UPDATE Users SET login_attempts = COALESCE(login_attempts,0) + 1, last_failed_login = ? WHERE user_id = ?\"\r\n\t\t\t).bind(new Date().toISOString(), userRow.user_id).run();\r\n\t\t\treturn unauthorized();\r\n\t\t}\r\n\r\n\t\t// \u6210\u529F\uFF1A\u91CD\u7F6E\u5617\u8A66\u6B21\u6578\u3001\u66F4\u65B0 last_login\r\n\t\tawait env.DATABASE.prepare(\r\n\t\t\t\"UPDATE Users SET login_attempts = 0, last_login = ? WHERE user_id = ?\"\r\n\t\t).bind(new Date().toISOString(), userRow.user_id).run();\r\n\r\n\t\t// \u5EFA\u7ACB\u6703\u8A71\r\n\t\tconst sessionId = generateSessionId();\r\n\t\tconst ttlSec = parseInt(env.SESSION_TTL_SECONDS || \"2592000\", 10);\r\n\t\tconst createdAt = new Date();\r\n\t\tconst expiresAt = new Date(createdAt.getTime() + ttlSec * 1000);\r\n\t\tawait env.DATABASE.prepare(\r\n\t\t\t\"INSERT INTO sessions (id, user_id, created_at, expires_at, meta_json) VALUES (?, ?, ?, ?, ?)\"\r\n\t\t).bind(sessionId, String(userRow.user_id), createdAt.toISOString(), expiresAt.toISOString(), JSON.stringify({ ua: request.headers.get(\"User-Agent\") || \"\" })).run();\r\n\r\n\t\t// \u8A2D\u5B9A Cookie\r\n\t\tconst cookieName = String(env.SESSION_COOKIE_NAME || \"session\");\r\n\t\tconst cookie = [\r\n\t\t\t`${cookieName}=${sessionId}`,\r\n\t\t\t\"Path=/\",\r\n\t\t\t\"HttpOnly\",\r\n\t\t\t\"Secure\",\r\n\t\t\t\"SameSite=Lax\",\r\n\t\t\t`Max-Age=${ttlSec}`,\r\n\t\t].join(\"; \");\r\n\r\n\t\tconst data = {\r\n\t\t\tuserId: String(userRow.user_id),\r\n\t\t\tusername: userRow.username,\r\n\t\t\tname: userRow.name,\r\n\t\t\temail: userRow.email,\r\n\t\t\tisAdmin: userRow.is_admin === 1,\r\n\t\t};\r\n\t\treturn jsonResponse(200, { ok: true, code: \"OK\", message: \"\u6210\u529F\", data, meta: { requestId } }, { \"Set-Cookie\": cookie, ...corsHeaders });\r\n\t} catch (err) {\r\n\t\tconsole.error(JSON.stringify({ level: \"error\", requestId, path: \"/internal/api/v1/auth/login\", err: String(err) }));\r\n\t\tconst body = { ok: false, code: \"INTERNAL_ERROR\", message: \"\u4F3A\u670D\u5668\u932F\u8AA4\", meta: { requestId } };\r\n\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\treturn jsonResponse(500, body, getCorsHeadersForRequest(request, env));\r\n\t}\r\n}\r\n\r\nexport async function handleAuthMe(request, env, requestId) {\r\n\tif (request.method.toUpperCase() !== \"GET\") {\r\n\t\treturn jsonResponse(405, { ok: false, code: \"METHOD_NOT_ALLOWED\", message: \"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta: { requestId } }, getCorsHeadersForRequest(request, env));\r\n\t}\r\n\ttry {\r\n\t\tconst row = await getSessionUser(request, env);\r\n\t\tif (!row) {\r\n\t\t\treturn jsonResponse(401, { ok: false, code: \"UNAUTHORIZED\", message: \"\u672A\u767B\u5165\", meta: { requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t}\r\n\t\tconst data = {\r\n\t\t\tuserId: String(row.user_id),\r\n\t\t\tusername: row.username,\r\n\t\t\tname: row.name,\r\n\t\t\temail: row.email,\r\n\t\t\tisAdmin: row.is_admin === 1,\r\n\t\t};\r\n\t\treturn jsonResponse(200, { ok: true, code: \"OK\", message: \"\u6210\u529F\", data, meta: { requestId } }, getCorsHeadersForRequest(request, env));\r\n\t} catch (err) {\r\n\t\tconsole.error(JSON.stringify({ level: \"error\", requestId, path: \"/internal/api/v1/auth/me\", err: String(err) }));\r\n\t\tconst body = { ok: false, code: \"INTERNAL_ERROR\", message: \"\u4F3A\u670D\u5668\u932F\u8AA4\", meta: { requestId } };\r\n\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\treturn jsonResponse(500, body, getCorsHeadersForRequest(request, env));\r\n\t}\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest } from \"../utils.js\";\r\n\r\nexport async function handleClients(request, env, me, requestId, url) {\r\n\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\tconst method = request.method.toUpperCase();\r\n\tif (method === \"GET\") {\r\n\t\tconst params = url.searchParams;\r\n\t\tconst page = Math.max(1, parseInt(params.get(\"page\") || \"1\", 10));\r\n\t\tconst perPage = Math.min(100, Math.max(1, parseInt(params.get(\"perPage\") || \"50\", 10)));\r\n\t\tconst offset = (page - 1) * perPage;\r\n\t\tconst companyName = (params.get(\"company_name\") || params.get(\"q\") || \"\").trim();\r\n\t\ttry {\r\n\t\t\tconst where = [\"c.is_deleted = 0\"];\r\n\t\t\tconst binds = [];\r\n\t\t\tif (companyName) {\r\n\t\t\t\twhere.push(\"c.company_name LIKE ?\");\r\n\t\t\t\tbinds.push(`%${companyName}%`);\r\n\t\t\t}\r\n\t\t\tconst whereSql = where.length ? `WHERE ${where.join(\" AND \")}` : \"\";\r\n\t\t\tconst countRow = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT COUNT(1) as total FROM Clients c ${whereSql}`\r\n\t\t\t).bind(...binds).first();\r\n\t\t\tconst total = Number(countRow?.total || 0);\r\n\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT c.client_id, c.company_name, c.tax_registration_number, c.phone, c.email, c.created_at, \r\n\t\t\t\t        u.name as assignee_name,\r\n\t\t\t\t        GROUP_CONCAT(t.tag_name, ',') as tags\r\n\t\t\t\t FROM Clients c\r\n\t\t\t\t LEFT JOIN Users u ON u.user_id = c.assignee_user_id\r\n\t\t\t\t LEFT JOIN ClientTagAssignments a ON a.client_id = c.client_id\r\n\t\t\t\t LEFT JOIN CustomerTags t ON t.tag_id = a.tag_id\r\n\t\t\t\t ${whereSql}\r\n\t\t\t\t GROUP BY c.client_id\r\n\t\t\t\t ORDER BY c.created_at DESC\r\n\t\t\t\t LIMIT ? OFFSET ?`\r\n\t\t\t).bind(...binds, perPage, offset).all();\r\n\t\t\tconst data = (rows?.results || []).map((r) => ({\r\n\t\t\t\tclientId: r.client_id,\r\n\t\t\t\tcompanyName: r.company_name,\r\n\t\t\t\ttaxId: r.tax_registration_number,\r\n\t\t\t\tassigneeName: r.assignee_name || \"\",\r\n\t\t\t\ttags: (r.tags ? String(r.tags).split(\",\").filter(Boolean) : []),\r\n\t\t\t\tphone: r.phone || \"\",\r\n\t\t\t\temail: r.email || \"\",\r\n\t\t\t\tcreatedAt: r.created_at,\r\n\t\t\t}));\r\n\t\t\tconst meta = { requestId, page, perPage, total, hasNext: offset + perPage < total };\r\n\t\t\treturn jsonResponse(200, { ok: true, code: \"OK\", message: \"\u6210\u529F\", data, meta }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level: \"error\", requestId, path: url.pathname, err: String(err) }));\r\n\t\t\tconst body = { ok: false, code: \"INTERNAL_ERROR\", message: \"\u4F3A\u670D\u5668\u932F\u8AA4\", meta: { requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\tif (method === \"POST\") {\r\n\t\tlet body;\r\n\t\ttry {\r\n\t\t\tbody = await request.json();\r\n\t\t} catch (_) {\r\n\t\t\treturn jsonResponse(400, { ok: false, code: \"BAD_REQUEST\", message: \"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta: { requestId } }, corsHeaders);\r\n\t\t}\r\n\t\tconst errors = [];\r\n\t\tconst clientId = String(body?.client_id || \"\").trim();\r\n\t\tconst companyName = String(body?.company_name || \"\").trim();\r\n\t\tconst assigneeUserId = Number(body?.assignee_user_id || 0);\r\n\t\tconst phone = (body?.phone || \"\").trim();\r\n\t\tconst email = (body?.email || \"\").trim();\r\n\t\tconst clientNotes = (body?.client_notes || \"\").trim();\r\n\t\tconst paymentNotes = (body?.payment_notes || \"\").trim();\r\n\t\tconst tagIds = Array.isArray(body?.tag_ids) ? body.tag_ids.map((x) => Number(x)).filter((n) => Number.isFinite(n)) : [];\r\n\r\n\t\tif (!/^\\d{8}$/.test(clientId)) errors.push({ field: \"client_id\", message: \"\u5FC5\u586B\u4E14\u9808\u70BA8\u4F4D\u6578\u5B57\" });\r\n\t\tif (companyName.length < 1 || companyName.length > 100) errors.push({ field: \"company_name\", message: \"\u9577\u5EA6\u9700 1\u2013100\" });\r\n\t\tif (!Number.isInteger(assigneeUserId) || assigneeUserId <= 0) errors.push({ field: \"assignee_user_id\", message: \"\u5FC5\u586B\" });\r\n\t\tif (email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) errors.push({ field: \"email\", message: \"Email \u683C\u5F0F\u932F\u8AA4\" });\r\n\t\tif (phone && !/^[-+()\\s0-9]{6,}$/.test(phone)) errors.push({ field: \"phone\", message: \"\u96FB\u8A71\u683C\u5F0F\u932F\u8AA4\" });\r\n\t\tif (errors.length) {\r\n\t\t\treturn jsonResponse(422, { ok: false, code: \"VALIDATION_ERROR\", message: \"\u8F38\u5165\u6709\u8AA4\", errors, meta: { requestId } }, corsHeaders);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\t// \u6AA2\u67E5\u552F\u4E00/\u5B58\u5728\r\n\t\t\tconst dup = await env.DATABASE.prepare(\"SELECT 1 FROM Clients WHERE client_id = ? AND is_deleted = 0 LIMIT 1\").bind(clientId).first();\r\n\t\t\tif (dup) {\r\n\t\t\t\treturn jsonResponse(409, { ok: false, code: \"CONFLICT\", message: \"\u5BA2\u6236\u5DF2\u5B58\u5728\", meta: { requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tconst assExist = await env.DATABASE.prepare(\"SELECT 1 FROM Users WHERE user_id = ? AND is_deleted = 0 LIMIT 1\").bind(assigneeUserId).first();\r\n\t\t\tif (!assExist) {\r\n\t\t\t\treturn jsonResponse(422, { ok: false, code: \"VALIDATION_ERROR\", message: \"\u8CA0\u8CAC\u4EBA\u4E0D\u5B58\u5728\", errors: [{ field: \"assignee_user_id\", message: \"\u4E0D\u5B58\u5728\" }], meta: { requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tif (tagIds.length > 0) {\r\n\t\t\t\tconst placeholders = tagIds.map(() => \"?\").join(\",\");\r\n\t\t\t\tconst row = await env.DATABASE.prepare(`SELECT COUNT(1) as cnt FROM CustomerTags WHERE tag_id IN (${placeholders})`).bind(...tagIds).first();\r\n\t\t\t\tif (Number(row?.cnt || 0) !== tagIds.length) {\r\n\t\t\t\t\treturn jsonResponse(422, { ok: false, code: \"VALIDATION_ERROR\", message: \"\u6A19\u7C64\u4E0D\u5B58\u5728\", meta: { requestId } }, corsHeaders);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst now = new Date().toISOString();\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"INSERT INTO Clients (client_id, company_name, assignee_user_id, phone, email, client_notes, payment_notes, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\"\r\n\t\t\t).bind(clientId, companyName, assigneeUserId, phone, email, clientNotes, paymentNotes, now, now).run();\r\n\t\t\tfor (const tagId of tagIds) {\r\n\t\t\t\tawait env.DATABASE.prepare(\"INSERT OR IGNORE INTO ClientTagAssignments (client_id, tag_id, assigned_at) VALUES (?, ?, ?)\").bind(clientId, tagId, now).run();\r\n\t\t\t}\r\n\t\t\tconst data = { clientId, companyName, assigneeUserId, phone, email, clientNotes, paymentNotes, tags: tagIds };\r\n\t\t\treturn jsonResponse(201, { ok: true, code: \"CREATED\", message: \"\u5DF2\u5EFA\u7ACB\", data, meta: { requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level: \"error\", requestId, path: url.pathname, err: String(err) }));\r\n\t\t\tconst body = { ok: false, code: \"INTERNAL_ERROR\", message: \"\u4F3A\u670D\u5668\u932F\u8AA4\", meta: { requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest } from \"../utils.js\";\r\n\r\nexport async function handleTasks(request, env, me, requestId, url) {\r\n\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\tconst method = request.method.toUpperCase();\r\n\tif (method === \"GET\") {\r\n\t\ttry {\r\n\t\t\tconst params = url.searchParams;\r\n\t\t\tconst page = Math.max(1, parseInt(params.get(\"page\") || \"1\", 10));\r\n\t\t\tconst perPage = Math.min(100, Math.max(1, parseInt(params.get(\"perPage\") || \"20\", 10)));\r\n\t\t\tconst offset = (page - 1) * perPage;\r\n\t\t\tconst q = (params.get(\"q\") || \"\").trim();\r\n\t\t\tconst status = (params.get(\"status\") || \"\").trim();\r\n\t\t\tconst due = (params.get(\"due\") || \"\").trim();\r\n\t\t\tconst where = [\"t.is_deleted = 0\"];\r\n\t\t\tconst binds = [];\r\n\t\t\tif (!me.is_admin) {\r\n\t\t\t\twhere.push(\"t.assignee_user_id = ?\");\r\n\t\t\t\tbinds.push(String(me.user_id));\r\n\t\t\t}\r\n\t\t\tif (q) {\r\n\t\t\t\twhere.push(\"(t.task_name LIKE ? OR c.company_name LIKE ?)\");\r\n\t\t\t\tbinds.push(`%${q}%`, `%${q}%`);\r\n\t\t\t}\r\n\t\t\tif (status && [\"pending\",\"in_progress\",\"completed\",\"cancelled\"].includes(status)) {\r\n\t\t\t\twhere.push(\"t.status = ?\");\r\n\t\t\t\tbinds.push(status);\r\n\t\t\t}\r\n\t\t\tif (due === \"overdue\") {\r\n\t\t\t\twhere.push(\"date(t.due_date) < date('now') AND t.status != 'completed'\");\r\n\t\t\t}\r\n\t\t\tif (due === \"soon\") {\r\n\t\t\t\twhere.push(\"date(t.due_date) BETWEEN date('now') AND date('now','+3 days')\");\r\n\t\t\t}\r\n\t\t\tconst whereSql = where.length ? `WHERE ${where.join(\" AND \")}` : \"\";\r\n\t\t\tconst countRow = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT COUNT(1) as total\r\n\t\t\t\t FROM ActiveTasks t\r\n\t\t\t\t LEFT JOIN ClientServices cs ON cs.client_service_id = t.client_service_id\r\n\t\t\t\t LEFT JOIN Clients c ON c.client_id = cs.client_id\r\n\t\t\t\t ${whereSql}`\r\n\t\t\t).bind(...binds).first();\r\n\t\t\tconst total = Number(countRow?.total || 0);\r\n\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT t.task_id, t.task_name, t.due_date, t.status, t.assignee_user_id,\r\n\t\t\t\t        c.company_name AS client_name,\r\n\t\t\t\t        (SELECT COUNT(1) FROM ActiveTaskStages s WHERE s.task_id = t.task_id) AS total_stages,\r\n\t\t\t\t        (SELECT COUNT(1) FROM ActiveTaskStages s WHERE s.task_id = t.task_id AND s.status = 'completed') AS completed_stages,\r\n\t\t\t\t        (CASE WHEN t.related_sop_id IS NOT NULL OR t.client_specific_sop_id IS NOT NULL THEN 1 ELSE 0 END) AS has_sop,\r\n\t\t\t\t        u.name AS assignee_name\r\n\t\t\t\t FROM ActiveTasks t\r\n\t\t\t\t LEFT JOIN ClientServices cs ON cs.client_service_id = t.client_service_id\r\n\t\t\t\t LEFT JOIN Clients c ON c.client_id = cs.client_id\r\n\t\t\t\t LEFT JOIN Users u ON u.user_id = t.assignee_user_id\r\n\t\t\t\t ${whereSql}\r\n\t\t\t\t ORDER BY date(t.due_date) ASC NULLS LAST, t.task_id DESC\r\n\t\t\t\t LIMIT ? OFFSET ?`\r\n\t\t\t).bind(...binds, perPage, offset).all();\r\n\t\t\tconst data = (rows?.results || []).map((r) => ({\r\n\t\t\t\ttaskId: String(r.task_id),\r\n\t\t\t\ttaskName: r.task_name,\r\n\t\t\t\tclientName: r.client_name || \"\",\r\n\t\t\t\tassigneeName: r.assignee_name || \"\",\r\n\t\t\t\tprogress: { completed: Number(r.completed_stages || 0), total: Number(r.total_stages || 0) },\r\n\t\t\t\tdueDate: r.due_date || null,\r\n\t\t\t\tstatus: r.status,\r\n\t\t\t\thasSop: Number(r.has_sop || 0) === 1,\r\n\t\t\t}));\r\n\t\t\tconst meta = { requestId, page, perPage, total, hasNext: offset + perPage < total };\r\n\t\t\treturn jsonResponse(200, { ok: true, code: \"OK\", message: \"\u6210\u529F\", data, meta }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level: \"error\", requestId, path: url.pathname, err: String(err) }));\r\n\t\t\tconst body = { ok: false, code: \"INTERNAL_ERROR\", message: \"\u4F3A\u670D\u5668\u932F\u8AA4\", meta: { requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, getCorsHeadersForRequest(request, env));\r\n\t\t}\r\n\t}\r\n\r\n\tif (method === \"POST\") {\r\n\t\tlet body;\r\n\t\ttry { body = await request.json(); } catch (_) {\r\n\t\t\treturn jsonResponse(400, { ok:false, code:\"BAD_REQUEST\", message:\"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\tconst clientServiceId = Number(body?.client_service_id || 0);\r\n\t\tconst taskName = String(body?.task_name || \"\").trim();\r\n\t\tconst dueDate = body?.due_date ? String(body.due_date) : null;\r\n\t\tconst assigneeUserId = body?.assignee_user_id ? Number(body.assignee_user_id) : null;\r\n\t\tconst stageNames = Array.isArray(body?.stage_names) ? body.stage_names.filter(s => typeof s === 'string' && s.trim().length > 0).map(s => s.trim()) : [];\r\n\t\tconst errors = [];\r\n\t\tif (!Number.isInteger(clientServiceId) || clientServiceId <= 0) errors.push({ field:\"client_service_id\", message:\"\u5FC5\u586B\" });\r\n\t\tif (taskName.length < 1 || taskName.length > 200) errors.push({ field:\"task_name\", message:\"\u9577\u5EA6\u9700 1\u2013200\" });\r\n\t\tif (dueDate && !/^\\d{4}-\\d{2}-\\d{2}$/.test(dueDate)) errors.push({ field:\"due_date\", message:\"\u65E5\u671F\u683C\u5F0F YYYY-MM-DD\" });\r\n\t\tif (assigneeUserId !== null && (!Number.isInteger(assigneeUserId) || assigneeUserId <= 0)) errors.push({ field:\"assignee_user_id\", message:\"\u683C\u5F0F\u932F\u8AA4\" });\r\n\t\tif (errors.length) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u8F38\u5165\u6709\u8AA4\", errors, meta:{ requestId } }, corsHeaders);\r\n\r\n\t\ttry {\r\n\t\t\tconst cs = await env.DATABASE.prepare(\"SELECT client_service_id FROM ClientServices WHERE client_service_id = ? LIMIT 1\").bind(clientServiceId).first();\r\n\t\t\tif (!cs) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u5BA2\u6236\u670D\u52D9\u4E0D\u5B58\u5728\", errors:[{ field:\"client_service_id\", message:\"\u4E0D\u5B58\u5728\" }], meta:{ requestId } }, corsHeaders);\r\n\t\t\tif (assigneeUserId) {\r\n\t\t\t\tconst u = await env.DATABASE.prepare(\"SELECT 1 FROM Users WHERE user_id = ? AND is_deleted = 0 LIMIT 1\").bind(assigneeUserId).first();\r\n\t\t\t\tif (!u) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u8CA0\u8CAC\u4EBA\u4E0D\u5B58\u5728\", errors:[{ field:\"assignee_user_id\", message:\"\u4E0D\u5B58\u5728\" }], meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tconst now = new Date().toISOString();\r\n\t\t\tawait env.DATABASE.prepare(\"INSERT INTO ActiveTasks (client_service_id, template_id, task_name, start_date, due_date, status, assignee_user_id, created_at) VALUES (?, NULL, ?, NULL, ?, 'pending', ?, ?)\").bind(clientServiceId, taskName, dueDate, assigneeUserId, now).run();\r\n\t\t\tconst idRow = await env.DATABASE.prepare(\"SELECT last_insert_rowid() AS id\").first();\r\n\t\t\tconst taskId = String(idRow?.id);\r\n\t\t\tif (stageNames.length > 0) {\r\n\t\t\t\tlet order = 1;\r\n\t\t\t\tfor (const s of stageNames) {\r\n\t\t\t\t\tawait env.DATABASE.prepare(\"INSERT INTO ActiveTaskStages (task_id, stage_name, stage_order, status) VALUES (?, ?, ?, 'pending')\").bind(taskId, s, order++).run();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn jsonResponse(201, { ok:true, code:\"CREATED\", message:\"\u5DF2\u5EFA\u7ACB\", data:{ taskId, taskName, clientServiceId, dueDate, assigneeUserId }, meta:{ requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path: url.pathname, err:String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest } from \"../utils.js\";\r\n\r\nexport async function handleTimesheets(request, env, me, requestId, url) {\r\n\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\tconst method = request.method.toUpperCase();\r\n\tif (method === \"GET\") {\r\n\t\ttry {\r\n\t\t\tconst params = url.searchParams;\r\n\t\t\tconst page = Math.max(1, parseInt(params.get(\"page\") || \"1\", 10));\r\n\t\t\tconst perPage = Math.min(100, Math.max(1, parseInt(params.get(\"perPage\") || \"50\", 10)));\r\n\t\t\tconst offset = (page - 1) * perPage;\r\n\t\t\tconst dateFrom = (params.get(\"dateFrom\") || \"\").trim();\r\n\t\t\tconst dateTo = (params.get(\"dateTo\") || \"\").trim();\r\n\t\t\tconst q = (params.get(\"q\") || \"\").trim();\r\n\t\t\tconst type = (params.get(\"type\") || \"\").trim();\r\n\t\t\tconst where = [\"t.is_deleted = 0\"];\r\n\t\t\tconst binds = [];\r\n\t\t\tif (!me.is_admin) { where.push(\"t.user_id = ?\"); binds.push(String(me.user_id)); }\r\n\t\t\tif (dateFrom) { where.push(\"t.work_date >= ?\"); binds.push(dateFrom); }\r\n\t\t\tif (dateTo) { where.push(\"t.work_date <= ?\"); binds.push(dateTo); }\r\n\t\t\tif (q) { where.push(\"(c.company_name LIKE ? OR t.service_name LIKE ? OR t.note LIKE ?)\"); binds.push(`%${q}%`, `%${q}%`, `%${q}%`); }\r\n\t\t\tif (type) { where.push(\"t.work_type = ?\"); binds.push(type); }\r\n\t\t\tconst whereSql = where.length ? `WHERE ${where.join(\" AND \")}` : \"\";\r\n\t\t\tconst countRow = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT COUNT(1) AS total FROM Timesheets t LEFT JOIN Clients c ON c.client_id = t.client_id ${whereSql}`\r\n\t\t\t).bind(...binds).first();\r\n\t\t\tconst total = Number(countRow?.total || 0);\r\n\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT t.timesheet_id, t.work_date, t.client_id, c.company_name AS client_name, t.service_name, t.work_type, t.hours, t.note\r\n\t\t\t\t FROM Timesheets t LEFT JOIN Clients c ON c.client_id = t.client_id\r\n\t\t\t\t ${whereSql}\r\n\t\t\t\t ORDER BY t.work_date DESC, t.timesheet_id DESC\r\n\t\t\t\t LIMIT ? OFFSET ?`\r\n\t\t\t).bind(...binds, perPage, offset).all();\r\n\t\t\tconst data = (rows?.results || []).map(r => ({\r\n\t\t\t\tid: String(r.timesheet_id),\r\n\t\t\t\tdate: r.work_date,\r\n\t\t\t\tclientId: r.client_id || null,\r\n\t\t\t\tclientName: r.client_name || \"\",\r\n\t\t\t\tservice: r.service_name || \"\",\r\n\t\t\t\ttype: r.work_type,\r\n\t\t\t\thours: Number(r.hours || 0),\r\n\t\t\t\tnote: r.note || \"\",\r\n\t\t\t}));\r\n\t\t\tconst meta = { requestId, page, perPage, total, hasNext: offset + perPage < total };\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data, meta }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path: url.pathname, err:String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, getCorsHeadersForRequest(request, env));\r\n\t\t}\r\n\t}\r\n\r\n\tif (method === \"POST\") {\r\n\t\tlet body;\r\n\t\ttry { body = await request.json(); } catch (_) {\r\n\t\t\treturn jsonResponse(400, { ok:false, code:\"BAD_REQUEST\", message:\"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\tconst work_date = String(body?.work_date || \"\").trim();\r\n\t\tconst client_id = (body?.client_id || \"\").trim();\r\n\t\tconst service_name = String(body?.service_name || \"\").trim();\r\n\t\tconst work_type = String(body?.work_type || \"\").trim();\r\n\t\tconst hours = Number(body?.hours);\r\n\t\tconst note = (body?.note || \"\").trim();\r\n\t\tconst errors = [];\r\n\t\tif (!/^\\d{4}-\\d{2}-\\d{2}$/.test(work_date)) errors.push({ field:\"work_date\", message:\"\u65E5\u671F\u683C\u5F0F YYYY-MM-DD\" });\r\n\t\tif (!client_id) errors.push({ field:\"client_id\", message:\"\u5FC5\u586B\" });\r\n\t\tif (!service_name) errors.push({ field:\"service_name\", message:\"\u5FC5\u586B\" });\r\n\t\tif (!work_type) errors.push({ field:\"work_type\", message:\"\u5FC5\u586B\" });\r\n\t\tif (!Number.isFinite(hours) || hours <= 0) errors.push({ field:\"hours\", message:\"\u5FC5\u9808\u5927\u65BC 0\" });\r\n\t\tif (Math.abs(hours * 2 - Math.round(hours * 2)) > 1e-9) errors.push({ field:\"hours\", message:\"\u5FC5\u9808\u662F 0.5 \u7684\u500D\u6578\" });\r\n\t\tif (hours > 12) errors.push({ field:\"hours\", message:\"\u4E0D\u53EF\u8D85\u904E 12 \u5C0F\u6642\" });\r\n\t\tif (errors.length) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u8F38\u5165\u6709\u8AA4\", errors, meta:{ requestId } }, corsHeaders);\r\n\r\n\t\ttry {\r\n\t\t\t// \u55AE\u65E5\u5408\u8A08\u4E0D\u5F97\u8D85\u904E 12\r\n\t\t\tconst sumRow = await env.DATABASE.prepare(\"SELECT COALESCE(SUM(hours),0) AS s FROM Timesheets WHERE user_id = ? AND work_date = ? AND is_deleted = 0\").bind(String(me.user_id), work_date).first();\r\n\t\t\tconst current = Number(sumRow?.s || 0);\r\n\t\t\tif (current + hours > 12 + 1e-9) {\r\n\t\t\t\treturn jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u6BCF\u65E5\u5DE5\u6642\u5408\u8A08\u4E0D\u53EF\u8D85\u904E 12 \u5C0F\u6642\", errors:[{ field:\"hours\", message:\"\u8D85\u904E\u4E0A\u9650\" }], meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"INSERT INTO Timesheets (user_id, work_date, client_id, service_name, work_type, hours, note, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\"\r\n\t\t\t).bind(String(me.user_id), work_date, client_id, service_name, work_type, hours, note, new Date().toISOString(), new Date().toISOString()).run();\r\n\t\t\tconst idRow = await env.DATABASE.prepare(\"SELECT last_insert_rowid() AS id\").first();\r\n\t\t\tconst data = { id:String(idRow?.id), date:work_date, clientId:client_id, service:service_name, type:work_type, hours, note };\r\n\t\t\treturn jsonResponse(201, { ok:true, code:\"CREATED\", message:\"\u5DF2\u5EFA\u7ACB\", data, meta:{ requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path: url.pathname, err:String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest } from \"../utils.js\";\r\n\r\nexport async function handleReceipts(request, env, me, requestId, url) {\r\n\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\tconst method = request.method.toUpperCase();\r\n\tif (method === \"GET\") {\r\n\t\ttry {\r\n\t\t\tconst params = url.searchParams;\r\n\t\t\tconst page = Math.max(1, parseInt(params.get(\"page\") || \"1\", 10));\r\n\t\t\tconst perPage = Math.min(100, Math.max(1, parseInt(params.get(\"perPage\") || \"20\", 10)));\r\n\t\t\tconst offset = (page - 1) * perPage;\r\n\t\t\tconst q = (params.get(\"q\") || \"\").trim();\r\n\t\t\tconst status = (params.get(\"status\") || \"\").trim();\r\n\t\t\tconst dateFrom = (params.get(\"dateFrom\") || \"\").trim();\r\n\t\t\tconst dateTo = (params.get(\"dateTo\") || \"\").trim();\r\n\t\t\tconst where = [\"r.is_deleted = 0\"];\r\n\t\t\tconst binds = [];\r\n\t\t\tif (q) { where.push(\"(r.receipt_id LIKE ? OR c.company_name LIKE ?)\"); binds.push(`%${q}%`, `%${q}%`); }\r\n\t\t\tif (status && [\"unpaid\",\"partial\",\"paid\",\"cancelled\"].includes(status)) { where.push(\"r.status = ?\"); binds.push(status); }\r\n\t\t\tif (dateFrom) { where.push(\"r.receipt_date >= ?\"); binds.push(dateFrom); }\r\n\t\t\tif (dateTo) { where.push(\"r.receipt_date <= ?\"); binds.push(dateTo); }\r\n\t\t\tconst whereSql = where.length ? `WHERE ${where.join(\" AND \")}` : \"\";\r\n\t\t\tconst countRow = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT COUNT(1) AS total FROM Receipts r LEFT JOIN Clients c ON c.client_id = r.client_id ${whereSql}`\r\n\t\t\t).bind(...binds).first();\r\n\t\t\tconst total = Number(countRow?.total || 0);\r\n\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT r.receipt_id, r.client_id, c.company_name AS client_name, r.total_amount, r.receipt_date, r.due_date, r.status\r\n\t\t\t\t FROM Receipts r LEFT JOIN Clients c ON c.client_id = r.client_id\r\n\t\t\t\t ${whereSql}\r\n\t\t\t\t ORDER BY r.receipt_date DESC, r.receipt_id DESC\r\n\t\t\t\t LIMIT ? OFFSET ?`\r\n\t\t\t).bind(...binds, perPage, offset).all();\r\n\t\t\tconst data = (rows?.results || []).map(r => ({\r\n\t\t\t\treceiptId: r.receipt_id,\r\n\t\t\t\tclientId: r.client_id,\r\n\t\t\t\tclientName: r.client_name || \"\",\r\n\t\t\t\ttotalAmount: Number(r.total_amount || 0),\r\n\t\t\t\treceiptDate: r.receipt_date,\r\n\t\t\t\tdueDate: r.due_date || null,\r\n\t\t\t\tstatus: r.status,\r\n\t\t\t}));\r\n\t\t\tconst meta = { requestId, page, perPage, total, hasNext: offset + perPage < total };\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data, meta }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path: url.pathname, err:String(err) }));\r\n\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t}\r\n\t}\r\n\r\n\tif (method === \"POST\") {\r\n\t\tlet body;\r\n\t\ttry { body = await request.json(); } catch (_) {\r\n\t\t\treturn jsonResponse(400, { ok:false, code:\"BAD_REQUEST\", message:\"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\tconst client_id = String(body?.client_id || \"\").trim();\r\n\t\tconst receipt_date = String(body?.receipt_date || \"\").trim();\r\n\t\tconst due_date_raw = String(body?.due_date || \"\").trim();\r\n\t\tconst total_amount = Number(body?.total_amount);\r\n\t\tlet statusVal = String(body?.status || \"unpaid\").trim();\r\n\t\tconst notes = (body?.notes || \"\").trim();\r\n\t\tconst errors = [];\r\n\t\tif (!client_id) errors.push({ field:\"client_id\", message:\"\u5FC5\u586B\" });\r\n\t\tif (!/^\\d{4}-\\d{2}-\\d{2}$/.test(receipt_date)) errors.push({ field:\"receipt_date\", message:\"\u65E5\u671F\u683C\u5F0F YYYY-MM-DD\" });\r\n\t\tif (!Number.isFinite(total_amount) || total_amount <= 0) errors.push({ field:\"total_amount\", message:\"\u5FC5\u9808\u5927\u65BC 0\" });\r\n\t\tif (!statusVal) statusVal = \"unpaid\";\r\n\t\tif (![\"unpaid\",\"partial\",\"paid\",\"cancelled\"].includes(statusVal)) errors.push({ field:\"status\", message:\"\u72C0\u614B\u4E0D\u5408\u6CD5\" });\r\n\t\tif (errors.length) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u8F38\u5165\u6709\u8AA4\", errors, meta:{ requestId } }, corsHeaders);\r\n\r\n\t\ttry {\r\n\t\t\t// \u9A57\u8B49\u5BA2\u6236\u5B58\u5728\r\n\t\t\tconst c = await env.DATABASE.prepare(\"SELECT 1 FROM Clients WHERE client_id = ? AND is_deleted = 0 LIMIT 1\").bind(client_id).first();\r\n\t\t\tif (!c) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u5BA2\u6236\u4E0D\u5B58\u5728\", errors:[{ field:\"client_id\", message:\"\u4E0D\u5B58\u5728\" }], meta:{ requestId } }, corsHeaders);\r\n\r\n\t\t\t// \u7522\u751F\u6536\u64DA\u865F\uFF1AYYYYMM-XXX\r\n\t\t\tconst [yyyy, mm] = receipt_date.split(\"-\");\r\n\t\t\tconst prefix = `${yyyy}${mm}`;\r\n\t\t\tconst maxRow = await env.DATABASE.prepare(\"SELECT receipt_id FROM Receipts WHERE receipt_id LIKE ? ORDER BY receipt_id DESC LIMIT 1\").bind(`${prefix}-%`).first();\r\n\t\t\tlet seq = 1;\r\n\t\t\tif (maxRow && typeof maxRow.receipt_id === \"string\") {\r\n\t\t\t\tconst m = maxRow.receipt_id.match(/^(\\d{6})-(\\d{3})$/);\r\n\t\t\t\tif (m) seq = Math.max(seq, parseInt(m[2], 10) + 1);\r\n\t\t\t}\r\n\t\t\tconst receipt_id = `${prefix}-${String(seq).padStart(3, \"0\")}`;\r\n\r\n\t\t\t// \u5230\u671F\u65E5\uFF1A\u672A\u63D0\u4F9B\u5247 +30 \u5929\r\n\t\t\tlet due_date = due_date_raw;\r\n\t\t\tif (!due_date) {\r\n\t\t\t\tconst d = new Date(receipt_date + \"T00:00:00Z\");\r\n\t\t\t\td.setUTCDate(d.getUTCDate() + 30);\r\n\t\t\t\tconst y = d.getUTCFullYear();\r\n\t\t\t\tconst m2 = String(d.getUTCMonth() + 1).padStart(2, \"0\");\r\n\t\t\t\tconst day = String(d.getUTCDate()).padStart(2, \"0\");\r\n\t\t\t\tdue_date = `${y}-${m2}-${day}`;\r\n\t\t\t}\r\n\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"INSERT INTO Receipts (receipt_id, client_id, receipt_date, due_date, total_amount, status, is_auto_generated, notes, created_by, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, 0, ?, ?, ?, ?)\"\r\n\t\t\t).bind(\r\n\t\t\t\treceipt_id, client_id, receipt_date, due_date, total_amount, statusVal, notes, String(me.user_id), new Date().toISOString(), new Date().toISOString()\r\n\t\t\t).run();\r\n\t\t\tconst data = { receiptId: receipt_id, clientId: client_id, totalAmount: total_amount, receiptDate: receipt_date, dueDate: due_date, status: statusVal };\r\n\t\t\treturn jsonResponse(201, { ok:true, code:\"CREATED\", message:\"\u5DF2\u5EFA\u7ACB\", data, meta:{ requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path: url.pathname, err:String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest } from \"../utils.js\";\r\n\r\nexport async function handlePayroll(request, env, me, requestId, url, path) {\r\n\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\tconst method = request.method.toUpperCase();\r\n\r\n\tif (path === \"/internal/api/v1/admin/payroll/preview\") {\r\n\t\tif (method !== \"GET\") {\r\n\t\t\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst params = url.searchParams;\r\n\t\t\tconst month = String(params.get(\"month\") || \"\").trim();\r\n\t\t\tconst userIdFilter = String(params.get(\"user_id\") || \"\").trim();\r\n\t\t\tif (!/^\\d{4}-\\d{2}$/.test(month)) {\r\n\t\t\t\treturn jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"month \u683C\u5F0F\u9700\u70BA YYYY-MM\", errors:[{ field:\"month\", message:\"YYYY-MM\" }], meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tconst [yStr, mStr] = month.split(\"-\");\r\n\t\t\tconst y = parseInt(yStr, 10); const m = parseInt(mStr, 10);\r\n\t\t\tconst monthStart = `${yStr}-${mStr}-01`;\r\n\t\t\tconst endDate = new Date(Date.UTC(y, m, 0));\r\n\t\t\tconst monthEnd = `${endDate.getUTCFullYear()}-${String(endDate.getUTCMonth()+1).padStart(2,\"0\")}-${String(endDate.getUTCDate()).padStart(2,\"0\")}`;\r\n\r\n\t\t\tlet usersRows;\r\n\t\t\tif (userIdFilter) {\r\n\t\t\t\tusersRows = await env.DATABASE.prepare(\"SELECT user_id, name, username FROM Users WHERE user_id = ? AND is_deleted = 0\").bind(userIdFilter).all();\r\n\t\t\t} else {\r\n\t\t\t\tusersRows = await env.DATABASE.prepare(\"SELECT user_id, name, username FROM Users WHERE is_deleted = 0\").all();\r\n\t\t\t}\r\n\t\t\tconst users = usersRows?.results || [];\r\n\t\t\tconst results = [];\r\n\r\n\t\t\tlet hasBaseSalary = true;\r\n\t\t\ttry { await env.DATABASE.prepare(\"SELECT base_salary FROM Users LIMIT 1\").first(); }\r\n\t\t\tcatch (_) { hasBaseSalary = false; }\r\n\r\n\t\t\tfor (const u of users) {\r\n\t\t\t\tlet baseSalary = 40000; // fallback \u9810\u8A2D\r\n\t\t\t\tif (hasBaseSalary) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst r = await env.DATABASE.prepare(\"SELECT base_salary FROM Users WHERE user_id = ?\").bind(String(u.user_id)).first();\r\n\t\t\t\t\t\tif (r && r.base_salary != null) baseSalary = Number(r.base_salary);\r\n\t\t\t\t\t} catch (_) {}\r\n\t\t\t\t}\r\n\t\t\t\tconst regularAllowance = 0; // \u7C21\u5316\r\n\t\t\t\tconst hourlyBase = (baseSalary + regularAllowance) / 240.0;\r\n\t\t\t\tconst ts = await env.DATABASE.prepare(\r\n\t\t\t\t\t`SELECT work_type, COALESCE(SUM(hours),0) AS h FROM Timesheets WHERE user_id = ? AND is_deleted = 0 AND work_date >= ? AND work_date <= ? GROUP BY work_type`\r\n\t\t\t\t).bind(String(u.user_id), monthStart, monthEnd).all();\r\n\t\t\t\tconst sums = { normal:0, weekday:0, rest:0, holiday:0 };\r\n\t\t\t\tfor (const row of (ts?.results || [])) {\r\n\t\t\t\t\tconst t = String(row.work_type || \"\");\r\n\t\t\t\t\tif (t === \"normal\") sums.normal += Number(row.h || 0);\r\n\t\t\t\t\telse if (t === \"ot-weekday\") sums.weekday += Number(row.h || 0);\r\n\t\t\t\t\telse if (t === \"ot-rest\") sums.rest += Number(row.h || 0);\r\n\t\t\t\t\telse if (t === \"holiday\") sums.holiday += Number(row.h || 0);\r\n\t\t\t\t}\r\n\t\t\t\tconst otPay = hourlyBase * (1.34 * sums.weekday + 1.67 * sums.rest + 2.0 * sums.holiday);\r\n\t\t\t\tconst leaveRow = await env.DATABASE.prepare(\r\n\t\t\t\t\t`SELECT 1 FROM LeaveRequests WHERE user_id = ? AND status = 'approved' AND is_deleted = 0 AND (start_date <= ? AND end_date >= ?) AND leave_type IN ('sick','personal') LIMIT 1`\r\n\t\t\t\t).bind(String(u.user_id), monthEnd, monthStart).first();\r\n\t\t\t\tconst isFullAttendance = !leaveRow;\r\n\t\t\t\tconst baseSalaryCents = Math.round(baseSalary * 100);\r\n\t\t\t\tconst regularAllowanceCents = Math.round(regularAllowance * 100);\r\n\t\t\t\tconst overtimeCents = Math.round(otPay * 100);\r\n\t\t\t\tconst bonusCents = 0;\r\n\t\t\t\tconst totalCents = baseSalaryCents + regularAllowanceCents + overtimeCents + bonusCents;\r\n\t\t\t\tresults.push({ userId: String(u.user_id), name: u.name, baseSalaryCents, regularAllowanceCents, bonusCents, overtimeCents, totalCents, isFullAttendance });\r\n\t\t\t}\r\n\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data:{ month, users: results }, meta:{ requestId, count: results.length } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\tif (path === \"/internal/api/v1/admin/payroll\") {\r\n\t\tif (method !== \"GET\") {\r\n\t\t\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst month = String(url.searchParams.get(\"month\") || \"\").trim();\r\n\t\t\tif (!/^\\d{4}-\\d{2}$/.test(month)) {\r\n\t\t\t\treturn jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"month \u683C\u5F0F\u9700\u70BA YYYY-MM\", errors:[{ field:\"month\", message:\"YYYY-MM\" }], meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tconst run = await env.DATABASE.prepare(\"SELECT run_id, month, created_by, created_at FROM PayrollRuns WHERE month = ? LIMIT 1\").bind(month).first();\r\n\t\t\tif (!run) return jsonResponse(404, { ok:false, code:\"NOT_FOUND\", message:\"\u5C1A\u672A\u7522\u88FD\", meta:{ requestId } }, corsHeaders);\r\n\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT user_id, base_salary_cents, regular_allowance_cents, bonus_cents, overtime_cents, total_cents, is_full_attendance\r\n\t\t\t\t FROM MonthlyPayroll WHERE run_id = ? ORDER BY user_id`\r\n\t\t\t).bind(run.run_id).all();\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data:{ runId: run.run_id, month: run.month, items: rows?.results || [] }, meta:{ requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\tif (path === \"/internal/api/v1/admin/payroll/finalize\") {\r\n\t\tif (method !== \"POST\") {\r\n\t\t\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\tlet body;\r\n\t\ttry { body = await request.json(); } catch (_) {\r\n\t\t\treturn jsonResponse(400, { ok:false, code:\"BAD_REQUEST\", message:\"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\tconst month = String(body?.month || \"\").trim();\r\n\t\tconst idk = (body?.idempotency_key || \"\").trim() || null;\r\n\t\tif (!/^\\d{4}-\\d{2}$/.test(month)) {\r\n\t\t\treturn jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"month \u683C\u5F0F\u9700\u70BA YYYY-MM\", errors:[{ field:\"month\", message:\"YYYY-MM\" }], meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tif (idk) {\r\n\t\t\t\tconst existed = await env.DATABASE.prepare(\"SELECT run_id, month FROM PayrollRuns WHERE idempotency_key = ? LIMIT 1\").bind(idk).first();\r\n\t\t\t\tif (existed) {\r\n\t\t\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u5DF2\u5B58\u5728\", data:{ runId: existed.run_id, month: existed.month }, meta:{ requestId } }, corsHeaders);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst dup = await env.DATABASE.prepare(\"SELECT run_id FROM PayrollRuns WHERE month = ? LIMIT 1\").bind(month).first();\r\n\t\t\tif (dup) {\r\n\t\t\t\treturn jsonResponse(409, { ok:false, code:\"ALREADY_FINALIZED\", message:\"\u8A72\u6708\u4EFD\u5DF2\u7522\u88FD\", data:{ runId: dup.run_id, month }, meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tconst [yStr, mStr] = month.split(\"-\");\r\n\t\t\tconst y = parseInt(yStr, 10); const m = parseInt(mStr, 10);\r\n\t\t\tconst monthStart = `${yStr}-${mStr}-01`;\r\n\t\t\tconst endDate = new Date(Date.UTC(y, m, 0));\r\n\t\t\tconst monthEnd = `${endDate.getUTCFullYear()}-${String(endDate.getUTCMonth()+1).padStart(2,\"0\")}-${String(endDate.getUTCDate()).padStart(2,\"0\")}`;\r\n\r\n\t\t\tconst usersRows = await env.DATABASE.prepare(\"SELECT user_id, name FROM Users WHERE is_deleted = 0\").all();\r\n\t\t\tconst users = usersRows?.results || [];\r\n\t\t\tlet hasBaseSalary = true;\r\n\t\t\ttry { await env.DATABASE.prepare(\"SELECT base_salary FROM Users LIMIT 1\").first(); } catch (_) { hasBaseSalary = false; }\r\n\r\n\t\t\tconst computed = [];\r\n\t\t\tfor (const u of users) {\r\n\t\t\t\tlet baseSalary = 40000;\r\n\t\t\t\tif (hasBaseSalary) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst r = await env.DATABASE.prepare(\"SELECT base_salary FROM Users WHERE user_id = ?\").bind(String(u.user_id)).first();\r\n\t\t\t\t\t\tif (r && r.base_salary != null) baseSalary = Number(r.base_salary);\r\n\t\t\t\t\t} catch (_) {}\r\n\t\t\t\t}\r\n\t\t\t\tconst regularAllowance = 0;\r\n\t\t\t\tconst hourlyBase = (baseSalary + regularAllowance) / 240.0;\r\n\t\t\t\tconst ts = await env.DATABASE.prepare(\r\n\t\t\t\t\t`SELECT work_type, COALESCE(SUM(hours),0) AS h FROM Timesheets WHERE user_id = ? AND is_deleted = 0 AND work_date >= ? AND work_date <= ? GROUP BY work_type`\r\n\t\t\t\t).bind(String(u.user_id), monthStart, monthEnd).all();\r\n\t\t\t\tconst sums = { normal:0, weekday:0, rest:0, holiday:0 };\r\n\t\t\t\tfor (const row of (ts?.results || [])) {\r\n\t\t\t\t\tconst t = String(row.work_type || \"\");\r\n\t\t\t\t\tif (t === \"normal\") sums.normal += Number(row.h || 0);\r\n\t\t\t\t\telse if (t === \"ot-weekday\") sums.weekday += Number(row.h || 0);\r\n\t\t\t\t\telse if (t === \"ot-rest\") sums.rest += Number(row.h || 0);\r\n\t\t\t\t\telse if (t === \"holiday\") sums.holiday += Number(row.h || 0);\r\n\t\t\t\t}\r\n\t\t\t\tconst otPay = hourlyBase * (1.34 * sums.weekday + 1.67 * sums.rest + 2.0 * sums.holiday);\r\n\t\t\t\tconst leaveRow = await env.DATABASE.prepare(\r\n\t\t\t\t\t`SELECT 1 FROM LeaveRequests WHERE user_id = ? AND status = 'approved' AND is_deleted = 0 AND (start_date <= ? AND end_date >= ?) AND leave_type IN ('sick','personal') LIMIT 1`\r\n\t\t\t\t).bind(String(u.user_id), monthEnd, monthStart).first();\r\n\t\t\t\tconst isFullAttendance = !leaveRow;\r\n\t\t\t\tconst baseSalaryCents = Math.round(baseSalary * 100);\r\n\t\t\t\tconst regularAllowanceCents = Math.round(regularAllowance * 100);\r\n\t\t\t\tconst overtimeCents = Math.round(otPay * 100);\r\n\t\t\t\tconst bonusCents = 0;\r\n\t\t\t\tconst totalCents = baseSalaryCents + regularAllowanceCents + overtimeCents + bonusCents;\r\n\t\t\t\tcomputed.push({ userId:String(u.user_id), baseSalaryCents, regularAllowanceCents, overtimeCents, bonusCents, totalCents, isFullAttendance });\r\n\t\t\t}\r\n\r\n\t\t\tconst runId = `${yStr}${mStr}-${Date.now().toString().slice(-6)}`;\r\n\t\t\tawait env.DATABASE.prepare(\"INSERT INTO PayrollRuns (run_id, month, idempotency_key, created_by) VALUES (?, ?, ?, ?)\").bind(runId, month, idk, String(me.user_id)).run();\r\n\t\t\tfor (const r of computed) {\r\n\t\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\t\"INSERT INTO MonthlyPayroll (run_id, user_id, base_salary_cents, regular_allowance_cents, bonus_cents, overtime_cents, total_cents, is_full_attendance) VALUES (?, ?, ?, ?, ?, ?, ?, ?)\"\r\n\t\t\t\t).bind(runId, r.userId, r.baseSalaryCents, r.regularAllowanceCents, r.bonusCents, r.overtimeCents, r.totalCents, r.isFullAttendance ? 1 : 0).run();\r\n\t\t\t}\r\n\r\n\t\t\treturn jsonResponse(201, { ok:true, code:\"CREATED\", message:\"\u5DF2\u7522\u88FD\", data:{ runId, month, count: computed.length }, meta:{ requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest } from \"../utils.js\";\r\n\r\nexport async function handleLeaves(request, env, me, requestId, url, path) {\r\n\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\tconst method = request.method.toUpperCase();\r\n\r\n\tif (path === \"/internal/api/v1/leaves/balances\") {\r\n\t\tif (method !== \"GET\") {\r\n\t\t\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst params = url.searchParams; const year = parseInt(params.get(\"year\") || String(new Date().getFullYear()), 10);\r\n\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t\"SELECT leave_type, year, total, used, remain FROM LeaveBalances WHERE user_id = ? AND year = ?\"\r\n\t\t\t).bind(String(me.user_id), year).all();\r\n\t\t\tconst data = (rows?.results || []).map(r => ({ type: r.leave_type, year: Number(r.year), total: Number(r.total), used: Number(r.used), remain: Number(r.remain) }));\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data, meta:{ requestId, year } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\tif (path === \"/internal/api/v1/leaves\") {\r\n\t\tif (method === \"GET\") {\r\n\t\t\ttry {\r\n\t\t\t\tconst params = url.searchParams;\r\n\t\t\t\tconst page = Math.max(1, parseInt(params.get(\"page\") || \"1\", 10));\r\n\t\t\t\tconst perPage = Math.min(100, Math.max(1, parseInt(params.get(\"perPage\") || \"20\", 10)));\r\n\t\t\t\tconst offset = (page - 1) * perPage;\r\n\t\t\t\tconst q = (params.get(\"q\") || \"\").trim();\r\n\t\t\t\tconst status = (params.get(\"status\") || \"\").trim();\r\n\t\t\t\tconst type = (params.get(\"type\") || \"\").trim();\r\n\t\t\t\tconst dateFrom = (params.get(\"dateFrom\") || \"\").trim();\r\n\t\t\t\tconst dateTo = (params.get(\"dateTo\") || \"\").trim();\r\n\t\t\t\tconst where = [\"l.is_deleted = 0\"];\r\n\t\t\t\tconst binds = [];\r\n\t\t\t\tif (!me.is_admin) { where.push(\"l.user_id = ?\"); binds.push(String(me.user_id)); }\r\n\t\t\t\tif (q) { where.push(\"(l.reason LIKE ? OR l.leave_type LIKE ?)\"); binds.push(`%${q}%`, `%${q}%`); }\r\n\t\t\t\tif (status && [\"pending\",\"approved\",\"rejected\"].includes(status)) { where.push(\"l.status = ?\"); binds.push(status); }\r\n\t\t\t\tif (type) { where.push(\"l.leave_type = ?\"); binds.push(type); }\r\n\t\t\t\tif (dateFrom) { where.push(\"l.start_date >= ?\"); binds.push(dateFrom); }\r\n\t\t\t\tif (dateTo) { where.push(\"l.end_date <= ?\"); binds.push(dateTo); }\r\n\t\t\t\tconst whereSql = where.length ? `WHERE ${where.join(\" AND \")}` : \"\";\r\n\t\t\t\tconst countRow = await env.DATABASE.prepare(`SELECT COUNT(1) AS total FROM LeaveRequests l ${whereSql}`).bind(...binds).first();\r\n\t\t\t\tconst total = Number(countRow?.total || 0);\r\n\t\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t\t`SELECT l.leave_id, l.leave_type, l.start_date, l.end_date, l.unit, l.amount, l.reason, l.status, l.submitted_at\r\n\t\t\t\t\t FROM LeaveRequests l\r\n\t\t\t\t\t ${whereSql}\r\n\t\t\t\t\t ORDER BY l.submitted_at DESC, l.leave_id DESC\r\n\t\t\t\t\t LIMIT ? OFFSET ?`\r\n\t\t\t\t).bind(...binds, perPage, offset).all();\r\n\t\t\t\tconst data = (rows?.results || []).map(r => ({\r\n\t\t\t\t\tleaveId: String(r.leave_id),\r\n\t\t\t\t\ttype: r.leave_type,\r\n\t\t\t\t\tstart: r.start_date,\r\n\t\t\t\t\tend: r.end_date,\r\n\t\t\t\t\tunit: r.unit,\r\n\t\t\t\t\tamount: Number(r.amount || 0),\r\n\t\t\t\t\treason: r.reason || \"\",\r\n\t\t\t\t\tstatus: r.status,\r\n\t\t\t\t\tsubmittedAt: r.submitted_at,\r\n\t\t\t\t}));\r\n\t\t\t\tconst meta = { requestId, page, perPage, total, hasNext: offset + perPage < total };\r\n\t\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data, meta }, corsHeaders);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\t\treturn jsonResponse(500, body, getCorsHeadersForRequest(request, env));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (method === \"POST\") {\r\n\t\t\tlet body;\r\n\t\t\ttry { body = await request.json(); } catch (_) {\r\n\t\t\t\treturn jsonResponse(400, { ok:false, code:\"BAD_REQUEST\", message:\"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tconst leave_type = String(body?.leave_type || \"\").trim();\r\n\t\t\tconst start_date = String(body?.start_date || \"\").trim();\r\n\t\t\tconst end_date = String(body?.end_date || \"\").trim();\r\n\t\t\tconst unit = String(body?.unit || \"day\").trim();\r\n\t\t\tconst amount = Number(body?.amount);\r\n\t\t\tconst reason = (body?.reason || \"\").trim();\r\n\t\t\tconst errors = [];\r\n\t\t\tif (!leave_type) errors.push({ field:\"leave_type\", message:\"\u5FC5\u9078\u5047\u5225\" });\r\n\t\t\tif (!/^\\d{4}-\\d{2}-\\d{2}$/.test(start_date)) errors.push({ field:\"start_date\", message:\"\u65E5\u671F\u683C\u5F0F YYYY-MM-DD\" });\r\n\t\t\tif (!/^\\d{4}-\\d{2}-\\d{2}$/.test(end_date)) errors.push({ field:\"end_date\", message:\"\u65E5\u671F\u683C\u5F0F YYYY-MM-DD\" });\r\n\t\t\tif (start_date && end_date && end_date < start_date) errors.push({ field:\"end_date\", message:\"\u7D50\u675F\u65E5\u671F\u4E0D\u53EF\u65E9\u65BC\u958B\u59CB\u65E5\u671F\" });\r\n\t\t\tif (![\"day\",\"half\",\"hour\"].includes(unit)) errors.push({ field:\"unit\", message:\"\u55AE\u4F4D\u932F\u8AA4\" });\r\n\t\t\tif (!Number.isFinite(amount) || amount <= 0) errors.push({ field:\"amount\", message:\"\u9700\u5927\u65BC 0\" });\r\n\t\t\tif (reason.length > 200) errors.push({ field:\"reason\", message:\"\u8ACB\u52FF\u8D85\u904E 200 \u5B57\" });\r\n\t\t\tif ([\"maternity\",\"menstrual\"].includes(leave_type) && me.gender === 'M') errors.push({ field:\"leave_type\", message:\"\u6B64\u5047\u5225\u50C5\u9650\u5973\u6027\" });\r\n\t\t\tif (leave_type === 'paternity' && me.gender === 'F') errors.push({ field:\"leave_type\", message:\"\u6B64\u5047\u5225\u50C5\u9650\u7537\u6027\" });\r\n\t\t\tif (errors.length) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u8F38\u5165\u6709\u8AA4\", errors, meta:{ requestId } }, corsHeaders);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\t\"INSERT INTO LeaveRequests (user_id, leave_type, start_date, end_date, unit, amount, reason, status, submitted_at) VALUES (?, ?, ?, ?, ?, ?, ?, 'pending', datetime('now'))\"\r\n\t\t\t\t).bind(String(me.user_id), leave_type, start_date, end_date, unit, amount, reason).run();\r\n\t\t\t\tconst idRow = await env.DATABASE.prepare(\"SELECT last_insert_rowid() AS id\").first();\r\n\t\t\t\treturn jsonResponse(201, { ok:true, code:\"CREATED\", message:\"\u5DF2\u9001\u51FA\u5BE9\u6838\", data:{ leaveId:String(idRow?.id) }, meta:{ requestId } }, corsHeaders);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest, getCookie, hashPasswordPBKDF2 } from \"../utils.js\";\r\n\r\nexport async function handleDevSeeding(request, env, requestId, path) {\r\n\t// \u50C5\u975E prod \u53EF\u7528\r\n\tif (env.APP_ENV === \"prod\") {\r\n\t\treturn jsonResponse(404, { ok:false, code:\"NOT_FOUND\", message:\"\u4E0D\u5B58\u5728\", meta:{ requestId } });\r\n\t}\r\n\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\r\n\t// /internal/api/v1/admin/dev-debug-cookie\r\n\tif (path === \"/internal/api/v1/admin/dev-debug-cookie\") {\r\n\t\tconst cookieName = String(env.SESSION_COOKIE_NAME || \"session\");\r\n\t\tconst sid = getCookie(request, cookieName);\r\n\t\tlet exists = null; let exp = null;\r\n\t\tif (sid && env.DATABASE) {\r\n\t\t\tconst row = await env.DATABASE.prepare(\"SELECT id, expires_at FROM sessions WHERE id = ? LIMIT 1\").bind(sid).first();\r\n\t\t\texists = !!row;\r\n\t\t\texp = row?.expires_at || null;\r\n\t\t}\r\n\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data:{ cookieName, sid, exists, exp }, meta:{ requestId } }, corsHeaders);\r\n\t}\r\n\r\n\tif (request.method.toUpperCase() !== \"POST\") {\r\n\t\treturn jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n\t}\r\n\r\n\t// /internal/api/v1/admin/dev-seed-user\r\n\tif (path === \"/internal/api/v1/admin/dev-seed-user\") {\r\n\t\tlet body; try { body = await request.json(); } catch (_) { return jsonResponse(400, { ok:false, code:\"BAD_REQUEST\", message:\"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta:{ requestId } }, corsHeaders); }\r\n\t\tconst username = (body?.username || \"\").trim().toLowerCase();\r\n\t\tconst name = (body?.name || \"\u6E2C\u8A66\u7528\u6236\").trim();\r\n\t\tconst password = body?.password || \"changeme\";\r\n\t\tlet email = (body?.email || \"\").trim();\r\n\t\tif (!username || !password) {\r\n\t\t\treturn jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"username/password \u5FC5\u586B\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst exists = await env.DATABASE.prepare(\"SELECT user_id FROM Users WHERE LOWER(username) = ? LIMIT 1\").bind(username).first();\r\n\t\t\tif (!email) email = `${username}@example.com`;\r\n\t\t\tconst passwordHash = await hashPasswordPBKDF2(password);\r\n\t\t\tif (exists) {\r\n\t\t\t\tawait env.DATABASE.prepare(\"UPDATE Users SET username = ?, name = ?, email = ?, password_hash = ?, updated_at = ? WHERE user_id = ?\").bind(username, name, email, passwordHash, new Date().toISOString(), exists.user_id).run();\r\n\t\t\t} else {\r\n\t\t\t\tawait env.DATABASE.prepare(\"INSERT INTO Users (username, password_hash, name, email, gender, start_date, created_at, updated_at) VALUES (?, ?, ?, ?, 'M', date('now'), datetime('now'), datetime('now'))\").bind(username, passwordHash, name, email).run();\r\n\t\t\t}\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u5DF2\u5EFA\u7ACB/\u66F4\u65B0\u6E2C\u8A66\u7528\u6236\", data:{ username, email }, meta:{ requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\t// /internal/api/v1/admin/dev-seed-clients\r\n\tif (path === \"/internal/api/v1/admin/dev-seed-clients\") {\r\n\t\ttry {\r\n\t\t\tawait env.DATABASE.prepare(\"INSERT OR IGNORE INTO CustomerTags(tag_id, tag_name, tag_color) VALUES (1,'\u4E00\u822C','#3b5bdb'),(2,'VIP','#ef4444')\").run();\r\n\t\t\tconst now = new Date().toISOString();\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"INSERT OR IGNORE INTO Clients(client_id, company_name, tax_registration_number, assignee_user_id, phone, email, created_at, updated_at) VALUES \" +\r\n\t\t\t\t\"('c_001','\u661F\u6CB3\u8CC7\u8A0A\u80A1\u4EFD\u6709\u9650\u516C\u53F8','12345678',1,'02-1234-5678','contact@galaxy.com',?,?),\" +\r\n\t\t\t\t\"('c_002','\u677E\u67CF\u6709\u9650\u516C\u53F8','87654321',1,'02-8765-4321','service@pine.com',?,?),\" +\r\n\t\t\t\t\"('c_003','\u5B89\u548C\u9867\u554F\u80A1\u4EFD\u6709\u9650\u516C\u53F8','11223344',1,'02-5566-7788','info@anhe.com',?,?)\"\r\n\t\t\t).bind(now, now, now, now, now, now).run();\r\n\t\t\tawait env.DATABASE.prepare(\"INSERT OR IGNORE INTO ClientTagAssignments(client_id, tag_id) VALUES ('c_001',1),('c_001',2),('c_002',2),('c_003',1)\").run();\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u5DF2\u5EFA\u7ACB\u6E2C\u8A66\u5BA2\u6236/\u6A19\u7C64\", meta:{ requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level: \"error\", requestId, path, err: String(err) }));\r\n\t\t\tconst body = { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body);\r\n\t\t}\r\n\t}\r\n\r\n\t// /internal/api/v1/admin/dev-seed-tasks\r\n\tif (path === \"/internal/api/v1/admin/dev-seed-tasks\") {\r\n\t\ttry {\r\n\t\t\tawait env.DATABASE.prepare(\"INSERT OR IGNORE INTO ClientServices(client_id, service_id, status) VALUES ('c_001',1,'active'),('c_002',1,'active'),('c_003',1,'active')\").run();\r\n\t\t\tconst cs1 = await env.DATABASE.prepare(\"SELECT client_service_id FROM ClientServices WHERE client_id='c_001' LIMIT 1\").first();\r\n\t\t\tconst cs2 = await env.DATABASE.prepare(\"SELECT client_service_id FROM ClientServices WHERE client_id='c_002' LIMIT 1\").first();\r\n\t\t\tconst cs3 = await env.DATABASE.prepare(\"SELECT client_service_id FROM ClientServices WHERE client_id='c_003' LIMIT 1\").first();\r\n\t\t\tconst today = new Date();\r\n\t\t\tconst fmt = (d)=> new Date(today.getTime()+d*86400000).toISOString().slice(0,10);\r\n\t\t\tawait env.DATABASE.prepare(\"INSERT INTO ActiveTasks (client_service_id, task_name, due_date, status, assignee_user_id, created_at) VALUES (?,?,?,?,?,datetime('now'))\").bind(cs1.client_service_id, '\u661F\u6CB3\u8CC7\u8A0A \u2212 12 \u6708\u8A18\u5E33', fmt(2), 'pending', 1).run();\r\n\t\t\tawait env.DATABASE.prepare(\"INSERT INTO ActiveTasks (client_service_id, task_name, due_date, status, assignee_user_id, created_at) VALUES (?,?,?,?,?,datetime('now'))\").bind(cs2.client_service_id, '\u677E\u67CF \u2212 12 \u6708\u71DF\u696D\u7A05', fmt(-1), 'in_progress', 1).run();\r\n\t\t\tawait env.DATABASE.prepare(\"INSERT INTO ActiveTasks (client_service_id, task_name, due_date, status, assignee_user_id, created_at) VALUES (?,?,?,?,?,datetime('now'))\").bind(cs3.client_service_id, '\u5B89\u548C \u2212 \u5E74\u5EA6\u7D50\u7B97', fmt(10), 'completed', 1).run();\r\n\t\t\treturn jsonResponse(200, { ok: true, code: \"OK\", message: \"\u5DF2\u5EFA\u7ACB\u6E2C\u8A66\u4EFB\u52D9\", meta: { requestId } });\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level: \"error\", requestId, path, err: String(err) }));\r\n\t\t\tconst body = { ok: false, code: \"INTERNAL_ERROR\", message: \"\u4F3A\u670D\u5668\u932F\u8AA4\", meta: { requestId } };\r\n\t\t\tif (env.APP_ENV && env.APP_ENV !== \"prod\") body.error = String(err);\r\n\t\t\treturn jsonResponse(500, body);\r\n\t\t}\r\n\t}\r\n\r\n\t// /internal/api/v1/admin/dev-seed-timesheets\r\n\tif (path === \"/internal/api/v1/admin/dev-seed-timesheets\") {\r\n\t\ttry {\r\n\t\t\tconst today = new Date();\r\n\t\t\tconst d = (off)=> new Date(today.getTime()+off*86400000).toISOString().slice(0,10);\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"INSERT INTO Timesheets (user_id, work_date, client_id, service_name, work_type, hours, note) VALUES \"+\r\n\t\t\t\t\"(1, ?, 'c_001', '\u8A18\u5E33', 'normal', 2.5, ''),\"+\r\n\t\t\t\t\"(1, ?, 'c_002', '\u71DF\u696D\u7A05', 'ot-weekday', 1.0, '\u52A0\u73ED'),\"+\r\n\t\t\t\t\"(1, ?, 'c_003', '\u7D50\u7B97', 'normal', 3.0, '\u6574\u7406')\"\r\n\t\t\t).bind(d(-2), d(-1), d(0)).run();\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u5DF2\u5EFA\u7ACB\u6E2C\u8A66\u5DE5\u6642\", meta:{ requestId } });\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } });\r\n\t\t}\r\n\t}\r\n\r\n\t// /internal/api/v1/admin/dev-seed-leaves\r\n\tif (path === \"/internal/api/v1/admin/dev-seed-leaves\") {\r\n\t\ttry {\r\n\t\t\tconst y = new Date().getFullYear();\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"INSERT OR REPLACE INTO LeaveBalances(user_id, leave_type, year, total, used, remain, updated_at) VALUES \"+\r\n\t\t\t\t\"(1,'annual',?,30,3,27,datetime('now')),\"+\r\n\t\t\t\t\"(1,'sick',?,30,1,29,datetime('now')),\"+\r\n\t\t\t\t\"(1,'comp',?,24,16,8,datetime('now'))\"\r\n\t\t\t).bind(y, y, y).run();\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"INSERT INTO LeaveRequests (user_id, leave_type, start_date, end_date, unit, amount, reason, status, submitted_at) VALUES \"+\r\n\t\t\t\t\"(1,'annual',date('now','-10 day'),date('now','-10 day'),'day',1,'', 'approved', datetime('now','-10 day')),\"+\r\n\t\t\t\t\"(1,'sick',date('now','-25 day'),date('now','-25 day'),'half',0.5,'\u770B\u91AB\u751F','approved', datetime('now','-25 day')),\"+\r\n\t\t\t\t\"(1,'comp',date('now','-5 day'),date('now','-5 day'),'hour',2,'\u52A0\u73ED\u88DC\u4F11','pending', datetime('now','-5 day'))\"\r\n\t\t\t).run();\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u5DF2\u5EFA\u7ACB\u5047\u671F\u9918\u984D\u8207\u7533\u8ACB\u8CC7\u6599\", meta:{ requestId, year:y } });\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } });\r\n\t\t}\r\n\t}\r\n\r\n\t// /internal/api/v1/admin/dev-seed-receipts\r\n\tif (path === \"/internal/api/v1/admin/dev-seed-receipts\") {\r\n\t\ttry {\r\n\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\"INSERT OR IGNORE INTO Receipts (receipt_id, client_id, receipt_date, due_date, total_amount, status, is_auto_generated, created_by) VALUES \"+\r\n\t\t\t\t\"('202510-001','c_001','2025-10-01','2025-10-31',12000,'paid',1,1),\"+\r\n\t\t\t\t\"('202510-002','c_002','2025-10-10','2025-10-30',8000,'unpaid',1,1),\"+\r\n\t\t\t\t\"('202509-003','c_003','2025-09-20','2025-10-05',5000,'unpaid',1,1)\"\r\n\t\t\t).run();\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u5DF2\u5EFA\u7ACB\u6E2C\u8A66\u6536\u64DA\", meta:{ requestId } });\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } });\r\n\t\t}\r\n\t}\r\n\r\n\treturn jsonResponse(404, { ok:false, code:\"NOT_FOUND\", message:\"\u4E0D\u5B58\u5728\", meta:{ requestId } }, corsHeaders);\r\n}\r\n\r\n\r\n", "import { jsonResponse, getCorsHeadersForRequest } from \"../utils.js\";\r\n\r\nexport async function handleOverhead(request, env, me, requestId, url, path) {\r\n\tconst corsHeaders = getCorsHeadersForRequest(request, env);\r\n\tconst method = request.method.toUpperCase();\r\n\r\n\tif (path === \"/internal/api/v1/admin/overhead-types\") {\r\n\t\tif (method === \"GET\") {\r\n\t\t\ttry {\r\n\t\t\t\tconst params = url.searchParams;\r\n\t\t\t\tconst page = Math.max(1, parseInt(params.get(\"page\") || \"1\", 10));\r\n\t\t\t\tconst perPage = Math.min(100, Math.max(1, parseInt(params.get(\"perPage\") || \"50\", 10)));\r\n\t\t\t\tconst offset = (page - 1) * perPage;\r\n\t\t\t\tconst q = (params.get(\"q\") || \"\").trim();\r\n\t\t\t\tconst category = (params.get(\"category\") || \"\").trim();\r\n\t\t\t\tconst isActive = params.get(\"is_active\");\r\n\t\t\t\tconst where = [];\r\n\t\t\t\tconst binds = [];\r\n\t\t\t\tif (q) { where.push(\"(cost_code LIKE ? OR cost_name LIKE ?)\"); binds.push(`%${q}%`, `%${q}%`); }\r\n\t\t\t\tif (category && [\"fixed\",\"variable\"].includes(category)) { where.push(\"category = ?\"); binds.push(category); }\r\n\t\t\t\tif (isActive === \"0\" || isActive === \"1\") { where.push(\"is_active = ?\"); binds.push(parseInt(isActive,10)); }\r\n\t\t\t\tconst whereSql = where.length ? `WHERE ${where.join(\" AND \")}` : \"\";\r\n\t\t\t\tconst countRow = await env.DATABASE.prepare(`SELECT COUNT(1) AS total FROM OverheadCostTypes ${whereSql}`).bind(...binds).first();\r\n\t\t\t\tconst total = Number(countRow?.total || 0);\r\n\t\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t\t`SELECT cost_type_id, cost_code, cost_name, category, allocation_method, description, is_active, display_order, created_at, updated_at\r\n\t\t\t\t\t FROM OverheadCostTypes\r\n\t\t\t\t\t ${whereSql}\r\n\t\t\t\t\t ORDER BY display_order ASC, cost_code ASC\r\n\t\t\t\t\t LIMIT ? OFFSET ?`\r\n\t\t\t\t).bind(...binds, perPage, offset).all();\r\n\t\t\t\tconst data = (rows?.results || []).map(r => ({\r\n\t\t\t\t\tid: r.cost_type_id,\r\n\t\t\t\t\tcode: r.cost_code,\r\n\t\t\t\t\tname: r.cost_name,\r\n\t\t\t\t\tcategory: r.category,\r\n\t\t\t\t\tallocationMethod: r.allocation_method,\r\n\t\t\t\t\tdescription: r.description || \"\",\r\n\t\t\t\t\tisActive: r.is_active === 1,\r\n\t\t\t\t\tdisplayOrder: Number(r.display_order || 0),\r\n\t\t\t\t\tcreatedAt: r.created_at,\r\n\t\t\t\t\tupdatedAt: r.updated_at,\r\n\t\t\t\t}));\r\n\t\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data, meta:{ requestId, page, perPage, total } }, corsHeaders);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (method === \"POST\") {\r\n\t\t\tlet body; try { body = await request.json(); } catch (_) { return jsonResponse(400, { ok:false, code:\"BAD_REQUEST\", message:\"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta:{ requestId } }, corsHeaders); }\r\n\t\t\tconst code = String(body?.cost_code || body?.code || \"\").trim();\r\n\t\t\tconst name = String(body?.cost_name || body?.name || \"\").trim();\r\n\t\t\tconst category = String(body?.category || \"\").trim();\r\n\t\t\tconst methodVal = String(body?.allocation_method || body?.allocationMethod || \"\").trim();\r\n\t\t\tconst description = (body?.description || \"\").trim();\r\n\t\t\tconst errors = [];\r\n\t\t\tif (!/^[A-Z0-9_]{1,20}$/.test(code)) errors.push({ field:\"cost_code\", message:\"\u683C\u5F0F\u9700\u70BA A-Z0-9_\uFF0C\u226420\" });\r\n\t\t\tif (!name || name.length > 50) errors.push({ field:\"cost_name\", message:\"\u5FC5\u586B\u4E14 \u2264 50\" });\r\n\t\t\tif (![\"fixed\",\"variable\"].includes(category)) errors.push({ field:\"category\", message:\"\u4E0D\u5408\u6CD5\" });\r\n\t\t\tif (![\"per_employee\",\"per_hour\",\"per_revenue\"].includes(methodVal)) errors.push({ field:\"allocation_method\", message:\"\u4E0D\u5408\u6CD5\" });\r\n\t\t\tif (errors.length) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u8F38\u5165\u6709\u8AA4\", errors, meta:{ requestId } }, corsHeaders);\r\n\t\t\ttry {\r\n\t\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\t\"INSERT INTO OverheadCostTypes (cost_code, cost_name, category, allocation_method, description, is_active) VALUES (?, ?, ?, ?, ?, 1)\"\r\n\t\t\t\t).bind(code, name, category, methodVal, description).run();\r\n\t\t\t\tconst row = await env.DATABASE.prepare(\"SELECT cost_type_id FROM OverheadCostTypes WHERE cost_code = ?\").bind(code).first();\r\n\t\t\t\treturn jsonResponse(201, { ok:true, code:\"CREATED\", message:\"\u5DF2\u5EFA\u7ACB\", data:{ id: row?.cost_type_id, code, name, category, allocationMethod: methodVal }, meta:{ requestId } }, corsHeaders);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst msg = String(err || \"\");\r\n\t\t\t\tif (msg.includes(\"UNIQUE\") && msg.includes(\"cost_code\")) {\r\n\t\t\t\t\treturn jsonResponse(409, { ok:false, code:\"CONFLICT\", message:\"\u4EE3\u78BC\u5DF2\u5B58\u5728\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (path === \"/internal/api/v1/admin/overhead-costs\") {\r\n\t\tif (method === \"GET\") {\r\n\t\t\ttry {\r\n\t\t\t\tconst params = url.searchParams;\r\n\t\t\t\tconst year = parseInt(params.get(\"year\") || \"0\", 10);\r\n\t\t\t\tconst month = parseInt(params.get(\"month\") || \"0\", 10);\r\n\t\t\t\tif (!Number.isFinite(year) || year < 2000 || month < 1 || month > 12) {\r\n\t\t\t\t\treturn jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"year/month \u4E0D\u5408\u6CD5\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t\t}\r\n\t\t\t\tconst q = (params.get(\"q\") || \"\").trim();\r\n\t\t\t\tconst where = [\"m.is_deleted = 0\", \"m.year = ?\", \"m.month = ?\"];\r\n\t\t\t\tconst binds = [year, month];\r\n\t\t\t\tif (q) { where.push(\"(t.cost_code LIKE ? OR t.cost_name LIKE ? OR m.notes LIKE ?)\"); binds.push(`%${q}%`, `%${q}%`, `%${q}%`); }\r\n\t\t\t\tconst whereSql = `WHERE ${where.join(\" AND \")}`;\r\n\t\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t\t`SELECT m.overhead_id, m.cost_type_id, t.cost_name, t.cost_code, t.category, t.allocation_method, m.amount, m.notes, m.recorded_by, m.recorded_at, m.updated_at\r\n\t\t\t\t\t FROM MonthlyOverheadCosts m\r\n\t\t\t\t\t JOIN OverheadCostTypes t ON t.cost_type_id = m.cost_type_id\r\n\t\t\t\t\t ${whereSql}\r\n\t\t\t\t\t ORDER BY t.display_order ASC, t.cost_code ASC`\r\n\t\t\t\t).bind(...binds).all();\r\n\t\t\t\tconst items = (rows?.results || []).map(r => ({\r\n\t\t\t\t\tid: r.overhead_id,\r\n\t\t\t\t\tcostTypeId: r.cost_type_id,\r\n\t\t\t\t\tcostName: r.cost_name,\r\n\t\t\t\t\tcostCode: r.cost_code,\r\n\t\t\t\t\tcategory: r.category,\r\n\t\t\t\t\tallocationMethod: r.allocation_method,\r\n\t\t\t\t\tamount: Number(r.amount || 0),\r\n\t\t\t\t\tnotes: r.notes || \"\",\r\n\t\t\t\t\trecordedBy: r.recorded_by,\r\n\t\t\t\t\trecordedAt: r.recorded_at,\r\n\t\t\t\t\tupdatedAt: r.updated_at,\r\n\t\t\t\t}));\r\n\t\t\t\tconst total = items.reduce((s, x) => s + x.amount, 0);\r\n\t\t\t\tconst totalFixed = items.filter(x => x.category === 'fixed').reduce((s, x) => s + x.amount, 0);\r\n\t\t\t\tconst totalVariable = total - totalFixed;\r\n\t\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data:{ year, month, items, total, totalFixed, totalVariable }, meta:{ requestId, count: items.length } }, corsHeaders);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (method === \"POST\") {\r\n\t\t\tlet body; try { body = await request.json(); } catch (_) { return jsonResponse(400, { ok:false, code:\"BAD_REQUEST\", message:\"\u8ACB\u6C42\u683C\u5F0F\u932F\u8AA4\", meta:{ requestId } }, corsHeaders); }\r\n\t\t\tconst cost_type_id = parseInt(body?.cost_type_id, 10);\r\n\t\t\tconst year = parseInt(body?.year, 10);\r\n\t\t\tconst month = parseInt(body?.month, 10);\r\n\t\t\tconst amount = Number(body?.amount);\r\n\t\t\tconst notes = (body?.notes || \"\").trim();\r\n\t\t\tconst errors = [];\r\n\t\t\tif (!Number.isFinite(cost_type_id)) errors.push({ field:\"cost_type_id\", message:\"\u5FC5\u586B\" });\r\n\t\t\tif (!Number.isFinite(year) || year < 2000) errors.push({ field:\"year\", message:\"\u4E0D\u5408\u6CD5\" });\r\n\t\t\tif (!Number.isFinite(month) || month < 1 || month > 12) errors.push({ field:\"month\", message:\"\u4E0D\u5408\u6CD5\" });\r\n\t\t\tif (!Number.isFinite(amount) || amount <= 0 || amount > 1e9) errors.push({ field:\"amount\", message:\"\u9700\u4ECB\u65BC 0 ~ 1e9\" });\r\n\t\t\tif (errors.length) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u8F38\u5165\u6709\u8AA4\", errors, meta:{ requestId } }, corsHeaders);\r\n\t\t\ttry {\r\n\t\t\t\tconst t = await env.DATABASE.prepare(\"SELECT cost_type_id FROM OverheadCostTypes WHERE cost_type_id = ? AND is_active = 1 LIMIT 1\").bind(cost_type_id).first();\r\n\t\t\t\tif (!t) return jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"\u6210\u672C\u9805\u76EE\u4E0D\u5B58\u5728\u6216\u672A\u555F\u7528\", errors:[{ field:\"cost_type_id\", message:\"\u4E0D\u5B58\u5728\u6216\u672A\u555F\u7528\" }], meta:{ requestId } }, corsHeaders);\r\n\t\t\t\tawait env.DATABASE.prepare(\r\n\t\t\t\t\t\"INSERT INTO MonthlyOverheadCosts (cost_type_id, year, month, amount, notes, recorded_by) VALUES (?, ?, ?, ?, ?, ?)\"\r\n\t\t\t\t).bind(cost_type_id, year, month, amount, notes, String(me.user_id)).run();\r\n\t\t\t\tconst idRow = await env.DATABASE.prepare(\"SELECT last_insert_rowid() AS id\").first();\r\n\t\t\t\treturn jsonResponse(201, { ok:true, code:\"CREATED\", message:\"\u5DF2\u5EFA\u7ACB\", data:{ id:String(idRow?.id) }, meta:{ requestId } }, corsHeaders);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst msg = String(err || \"\");\r\n\t\t\t\tif (msg.includes(\"UNIQUE\") && msg.includes(\"MonthlyOverheadCosts\")) {\r\n\t\t\t\t\treturn jsonResponse(409, { ok:false, code:\"CONFLICT\", message:\"\u8A72\u6708\u4EFD\u5DF2\u6709\u6B64\u9805\u76EE\u8A18\u9304\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (path === \"/internal/api/v1/admin/overhead-summary\" || path === \"/internal/api/v1/admin/overhead-analysis\") {\r\n\t\tif (method !== \"GET\") return jsonResponse(405, { ok:false, code:\"METHOD_NOT_ALLOWED\", message:\"\u65B9\u6CD5\u4E0D\u5141\u8A31\", meta:{ requestId } }, corsHeaders);\r\n\t\ttry {\r\n\t\t\tconst params = url.searchParams;\r\n\t\t\tconst year = parseInt(params.get(\"year\") || \"0\", 10);\r\n\t\t\tconst month = parseInt(params.get(\"month\") || \"0\", 10);\r\n\t\t\tif (!Number.isFinite(year) || year < 2000 || month < 1 || month > 12) {\r\n\t\t\t\treturn jsonResponse(422, { ok:false, code:\"VALIDATION_ERROR\", message:\"year/month \u4E0D\u5408\u6CD5\", meta:{ requestId } }, corsHeaders);\r\n\t\t\t}\r\n\t\t\tconst rows = await env.DATABASE.prepare(\r\n\t\t\t\t`SELECT t.category, t.cost_type_id, t.cost_name, SUM(m.amount) AS amt\r\n\t\t\t\t FROM MonthlyOverheadCosts m JOIN OverheadCostTypes t ON t.cost_type_id = m.cost_type_id\r\n\t\t\t\t WHERE m.is_deleted = 0 AND m.year = ? AND m.month = ?\r\n\t\t\t\t GROUP BY t.category, t.cost_type_id, t.cost_name`\r\n\t\t\t).bind(year, month).all();\r\n\t\t\tconst list = rows?.results || [];\r\n\t\t\tconst total = list.reduce((s, r) => s + Number(r.amt || 0), 0);\r\n\t\t\tconst byCategory = { fixed: 0, variable: 0 };\r\n\t\t\tfor (const r of list) { byCategory[r.category] = (byCategory[r.category] || 0) + Number(r.amt || 0); }\r\n\t\t\tconst typeBreakdown = list.map(r => ({ costTypeId: r.cost_type_id, costName: r.cost_name, amount: Number(r.amt || 0), percentage: total ? Number((Number(r.amt||0)/total*100).toFixed(1)) : 0 }));\r\n\t\t\tconst empRow = await env.DATABASE.prepare(\"SELECT COUNT(1) AS c FROM Users WHERE is_deleted = 0\").first();\r\n\t\t\tconst employeeCount = Number(empRow?.c || 0);\r\n\t\t\tconst overheadPerEmployee = employeeCount ? Math.round(total / employeeCount) : 0;\r\n\t\t\tconst data = { year, month, total_overhead: total, employee_count: employeeCount, overhead_per_employee: overheadPerEmployee, breakdown_by_category: byCategory, breakdown_by_type: typeBreakdown };\r\n\t\t\treturn jsonResponse(200, { ok:true, code:\"OK\", message:\"\u6210\u529F\", data, meta:{ requestId } }, corsHeaders);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(JSON.stringify({ level:\"error\", requestId, path, err:String(err) }));\r\n\t\t\treturn jsonResponse(500, { ok:false, code:\"INTERNAL_ERROR\", message:\"\u4F3A\u670D\u5668\u932F\u8AA4\", meta:{ requestId } }, corsHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\treturn jsonResponse(404, { ok:false, code:\"NOT_FOUND\", message:\"\u4E0D\u5B58\u5728\", meta:{ requestId } }, corsHeaders);\r\n}\r\n\r\n\r\n", "import { jsonResponse, generateRequestId, corsPreflightResponse, getSessionUser, getCorsHeadersForRequest } from \"./utils.js\";\r\nimport { handleLogin, handleAuthMe } from \"./auth.js\";\r\nimport { handleClients } from \"./api/clients.js\";\r\nimport { handleTasks } from \"./api/tasks.js\";\r\nimport { handleTimesheets } from \"./api/timesheets.js\";\r\nimport { handleReceipts } from \"./api/receipts.js\";\r\nimport { handlePayroll } from \"./api/payroll.js\";\r\nimport { handleLeaves } from \"./api/leaves.js\";\r\nimport { handleDevSeeding } from \"./api/dev.js\";\r\nimport { handleOverhead } from \"./api/overhead.js\";\r\n\r\nexport default {\r\n\tasync fetch(request, env) {\r\n\t\tconst url = new URL(request.url);\r\n\t\tconst path = url.pathname;\r\n\t\tconst method = request.method.toUpperCase();\r\n\t\tconst requestId = request.headers.get(\"X-Request-Id\") || generateRequestId();\r\n\r\n\t\tconst proxy = (host, newPath) => {\r\n\t\t\tconst target = new URL(request.url);\r\n\t\t\ttarget.protocol = \"https:\";\r\n\t\t\ttarget.hostname = host;\r\n\t\t\ttarget.pathname = newPath;\r\n\t\t\treturn fetch(new Request(target.toString(), request));\r\n\t\t};\r\n\r\n\t\t// CORS Preflight\uFF1A\u8655\u7406 /internal/api/* \u7684 OPTIONS\r\n\t\tif (path.startsWith(\"/internal/api/\") && method === \"OPTIONS\") {\r\n\t\t\treturn corsPreflightResponse(request, env);\r\n\t\t}\r\n\r\n\t\t// Auth routes\r\n\t\tif (path === \"/internal/api/v1/auth/login\") {\r\n\t\t\treturn handleLogin(request, env, requestId);\r\n\t\t}\r\n\t\tif (path === \"/internal/api/v1/auth/me\") {\r\n\t\t\treturn handleAuthMe(request, env, requestId);\r\n\t\t}\r\n\r\n\t\t// DEV routes (no session required, but env must not be prod)\r\n\t\tif (path.startsWith(\"/internal/api/v1/admin/dev-\")) {\r\n\t\t\treturn handleDevSeeding(request, env, requestId, path);\r\n\t\t}\r\n\r\n\t\t// Protected API routes we implement here\r\n\t\tif (path === \"/internal/api/v1/clients\") {\r\n\t\t\tconst me = await getSessionUser(request, env);\r\n\t\t\tif (!me) return jsonResponse(401, { ok:false, code:\"UNAUTHORIZED\", message:\"\u672A\u767B\u5165\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\treturn handleClients(request, env, me, requestId, url);\r\n\t\t}\r\n\t\tif (path === \"/internal/api/v1/tasks\") {\r\n\t\t\tconst me = await getSessionUser(request, env);\r\n\t\t\tif (!me) return jsonResponse(401, { ok:false, code:\"UNAUTHORIZED\", message:\"\u672A\u767B\u5165\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\treturn handleTasks(request, env, me, requestId, url);\r\n\t\t}\r\n\t\tif (path === \"/internal/api/v1/timesheets\") {\r\n\t\t\tconst me = await getSessionUser(request, env);\r\n\t\t\tif (!me) return jsonResponse(401, { ok:false, code:\"UNAUTHORIZED\", message:\"\u672A\u767B\u5165\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\treturn handleTimesheets(request, env, me, requestId, url);\r\n\t\t}\r\n\t\tif (path === \"/internal/api/v1/receipts\") {\r\n\t\t\tconst me = await getSessionUser(request, env);\r\n\t\t\tif (!me) return jsonResponse(401, { ok:false, code:\"UNAUTHORIZED\", message:\"\u672A\u767B\u5165\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\treturn handleReceipts(request, env, me, requestId, url);\r\n\t\t}\r\n\t\tif (path === \"/internal/api/v1/leaves\" || path === \"/internal/api/v1/leaves/balances\") {\r\n\t\t\tconst me = await getSessionUser(request, env);\r\n\t\t\tif (!me) return jsonResponse(401, { ok:false, code:\"UNAUTHORIZED\", message:\"\u672A\u767B\u5165\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\treturn handleLeaves(request, env, me, requestId, url, path);\r\n\t\t}\r\n\t\tif (path.startsWith(\"/internal/api/v1/admin/payroll\")) {\r\n\t\t\tconst me = await getSessionUser(request, env);\r\n\t\t\tif (!me) return jsonResponse(401, { ok:false, code:\"UNAUTHORIZED\", message:\"\u672A\u767B\u5165\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\tif (!me.is_admin) return jsonResponse(403, { ok:false, code:\"FORBIDDEN\", message:\"\u6C92\u6709\u6B0A\u9650\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\treturn handlePayroll(request, env, me, requestId, url, path);\r\n\t\t}\r\n\t\tif (path.startsWith(\"/internal/api/v1/admin/overhead\")) {\r\n\t\t\tconst me = await getSessionUser(request, env);\r\n\t\t\tif (!me) return jsonResponse(401, { ok:false, code:\"UNAUTHORIZED\", message:\"\u672A\u767B\u5165\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\tif (!me.is_admin) return jsonResponse(403, { ok:false, code:\"FORBIDDEN\", message:\"\u6C92\u6709\u6B0A\u9650\", meta:{ requestId } }, getCorsHeadersForRequest(request, env));\r\n\t\t\treturn handleOverhead(request, env, me, requestId, url, path);\r\n\t\t}\r\n\r\n\t\t// API \u4EE3\u7406\uFF1A/internal/api/* \u2192 <INTERNAL_API_HOST>/api/*\r\n\t\tif (path.startsWith(\"/internal/api/\")) {\r\n\t\t\treturn proxy(env.INTERNAL_API_HOST, path.replace(\"/internal\", \"\"));\r\n\t\t}\r\n\r\n\t\t// \u767B\u5165\u9801\uFF1A/login \u2192 <INTERNAL_BASE_HOST>/login\r\n\t\tif (path === \"/login\" || path.startsWith(\"/login/\")) {\r\n\t\t\treturn proxy(env.INTERNAL_BASE_HOST, \"/login\");\r\n\t\t}\r\n\r\n\t\t// \u5176\u4ED6\u5167\u90E8\u9801\u9762\uFF1A/internal/* \u2192 \u9700\u8981\u767B\u5165\uFF0C\u5426\u5247\u5C0E\u5411 /login\r\n\t\tif (path.startsWith(\"/internal/\")) {\r\n\t\t\tconst row = await getSessionUser(request, env);\r\n\t\t\tif (!row) {\r\n\t\t\t\tconst location = `/login?redirect=${encodeURIComponent(path)}`;\r\n\t\t\t\treturn new Response(null, { status: 302, headers: { Location: location } });\r\n\t\t\t}\r\n\t\t\treturn proxy(env.INTERNAL_BASE_HOST, path.replace(\"/internal\", \"\"));\r\n\t\t}\r\n\r\n\t\t// \u672A\u5339\u914D\u8DEF\u5F91\uFF08\u7406\u8AD6\u4E0A\u4E0D\u6703\u56E0\u70BA routes \u53EA\u7D81\u5B9A\u7279\u5B9A\u8DEF\u5F91\uFF09\r\n\t\treturn fetch(request);\r\n\t},\r\n};\r\n\r\n\r\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\miama\\\\Desktop\\\\horgoscpa\\\\cloudflare\\\\worker-router\\\\src\\\\index.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\miama\\\\AppData\\\\Local\\\\npm-cache\\\\_npx\\\\d77349f55c2be1c0\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\miama\\\\AppData\\\\Local\\\\npm-cache\\\\_npx\\\\d77349f55c2be1c0\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\miama\\\\Desktop\\\\horgoscpa\\\\cloudflare\\\\worker-router\\\\src\\\\index.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\miama\\\\Desktop\\\\horgoscpa\\\\cloudflare\\\\worker-router\\\\.wrangler\\\\tmp\\\\bundle-baIFTX\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\miama\\\\AppData\\\\Local\\\\npm-cache\\\\_npx\\\\d77349f55c2be1c0\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\miama\\\\Desktop\\\\horgoscpa\\\\cloudflare\\\\worker-router\\\\.wrangler\\\\tmp\\\\bundle-baIFTX\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\miama\\\\Desktop\\\\horgoscpa\\\\cloudflare\\\\worker-router\\\\.wrangler\\\\tmp\\\\bundle-baIFTX\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["body", "body", "body", "body", "body", "body"]
}
