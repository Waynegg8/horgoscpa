# 霍爾果斯會計師事務所 - 完整工時管理系統

## 系統概述

這是一個完整的工時管理系統，包含前端網站、後端 API（Cloudflare Workers）和資料庫（Cloudflare D1）。

## 🎉 已實現功能

### ✅ 核心功能
- **使用者認證與權限管理**
  - 登入/登出功能
  - Session 管理
  - 角色權限控制（管理員/員工）
  - 密碼修改

- **工時表管理（timesheet.html）**
  - 月曆式橫向佈局顯示
  - 即時儲存格編輯
  - 新增工時記錄
  - 新增請假記錄
  - 刪除記錄
  - 儲存變更到資料庫
  - 自動計算總工時
  - 週末和國定假日標示
  - 權限控制（員工只能看自己，管理員可看全部）

- **報表分析（reports.html）**
  - 工時分析報表
    - 按客戶和業務類型統計
    - 正常工時/加班工時分析
    - 加權工時計算
  - 請假總覽報表
    - 年度請假統計
    - 各假別使用情況
  - 樞紐分析報表
    - 多維度分析（員工/客戶/業務類型）
    - 彈性時間區間選擇
  - CSV 匯出功能

- **系統設定（settings.html）**
  
  **所有員工可用：**
  - 客戶管理（CRUD）
  - 客戶指派管理（CRUD）
  - 業務類型管理（CRUD）
  - 假期事件管理（CRUD）
  - 國定假日管理（CRUD）
  - 帳號設定（查看資訊、修改密碼）
  
  **管理員專用：**
  - 用戶管理（CRUD）
    - 新增/編輯/刪除使用者
    - 角色設定（管理員/員工）
    - 帳號啟用/停用
    - 綁定員工資料
  - 假別設定（CRUD）
  - 系統參數設定

## 📁 檔案結構

```
horgoscpa/
├── index.html                  # 首頁
├── login.html                  # 登入頁面
├── timesheet.html             # 工時表（完整實現）
├── reports.html               # 報表分析（完整實現）
├── settings.html              # 系統設定（完整實現）
├── change-password.html       # 修改密碼頁面
│
├── assets/
│   ├── css/
│   │   ├── common.css
│   │   ├── internal-system.css
│   │   └── ...
│   ├── js/
│   │   ├── reports.js         # 報表功能（完整實現）
│   │   ├── settings.js        # 設定功能（完整實現）
│   │   └── ...
│   └── images/
│
├── timesheet-api/
│   ├── src/
│   │   ├── index.js           # 主要 API（完整實現）
│   │   └── auth.js            # 認證功能（完整實現）
│   ├── schema.sql             # 資料庫結構
│   ├── init_db.sql            # 初始化腳本
│   ├── wrangler.jsonc         # Cloudflare Workers 設定
│   └── package.json
│
└── README.md
```

## 🔐 使用者權限

### 管理員（admin）
- 查看所有員工的工時表
- 編輯所有員工的工時記錄
- 存取完整的報表功能
- 管理所有系統設定
- 用戶管理
- 假別設定
- 系統參數設定

### 員工（employee）
- 查看和編輯自己的工時表
- 查看自己的報表
- 管理客戶、業務類型、假期事件、國定假日
- 修改自己的密碼

## 🚀 快速開始

### 1. 登入系統
訪問 `login.html`，使用管理員或員工帳號登入。

預設管理員帳號（需在資料庫中設定）：
- 使用者名稱：admin
- 密碼：（請自行設定）

### 2. 工時表操作

#### 查看工時表
1. 進入「工時表」頁面
2. 選擇員工（管理員可選擇任何員工，員工只能看自己）
3. 選擇年份和月份
4. 系統自動載入並顯示工時記錄

#### 新增工時記錄
1. 點選「增加工時記錄」按鈕
2. 選擇客戶名稱、業務類型、工時類型
3. 點選「確定」
4. 在表格中輸入各日期的工時

#### 新增請假記錄
1. 點選「增加請假記錄」按鈕
2. 選擇假別
3. 點選「確定」
4. 在表格中輸入各日期的請假時數

#### 編輯工時
- 直接點選表格中的儲存格
- 輸入或修改工時數值
- 系統自動更新總計

#### 刪除記錄
- 點選每列左側的刪除按鈕（🗑️）
- 確認刪除

#### 儲存變更
- 完成編輯後點選「儲存本月變更」按鈕
- 確認後資料將儲存到資料庫

### 3. 報表分析

#### 工時分析報表
1. 進入「報表」頁面
2. 選擇「工時分析」標籤
3. 選擇員工、年度、月份
4. 點選「生成報表」
5. 可匯出 CSV 檔案

#### 請假總覽報表
1. 選擇「請假總覽」標籤
2. 選擇員工和年度
3. 點選「生成報表」
4. 查看各假別使用情況

#### 樞紐分析報表
1. 選擇「樞紐分析」標籤
2. 選擇年度、月份（選填）、分組方式
3. 點選「生成報表」
4. 查看多維度統計結果

### 4. 系統設定

#### 客戶管理
- 新增客戶：點選「新增客戶」，填寫客戶名稱
- 編輯客戶：點選編輯按鈕，修改客戶資訊
- 刪除客戶：點選刪除按鈕（需確認無關聯記錄）

#### 客戶指派
- 新增指派：選擇員工和客戶，建立關聯
- 刪除指派：移除員工與客戶的關聯

#### 業務類型管理
- 新增業務類型（如：記帳、稅務、審計等）
- 編輯和刪除業務類型

#### 假期事件管理
- 記錄特殊假期事件（婚假、喪假、產假等）
- 編輯和刪除假期事件

#### 國定假日管理
- 新增國定假日
- 設定假日名稱和日期
- 編輯和刪除國定假日

#### 用戶管理（管理員）
- 新增使用者帳號
- 設定角色（管理員/員工）
- 綁定員工資料
- 啟用/停用帳號
- 編輯使用者資訊
- 刪除使用者

#### 假別設定（管理員）
- 新增假別類型
- 編輯和刪除假別

#### 系統參數（管理員）
- 設定系統運作參數
- 儲存參數設定

## 🌐 API 端點

### 認證相關
- `POST /api/login` - 使用者登入
- `POST /api/logout` - 使用者登出
- `GET /api/verify` - 驗證 session
- `POST /api/change-password` - 修改密碼

### 工時表相關
- `GET /api/employees` - 取得員工列表
- `GET /api/clients?employee={員工}` - 取得客戶列表
- `GET /api/business-types` - 取得業務類型
- `GET /api/leave-types` - 取得請假類型
- `GET /api/work-types` - 取得工時類型
- `GET /api/holidays?year={年份}` - 取得國定假日
- `GET /api/timesheet-data?employee={員工}&year={年}&month={月}` - 取得工時資料
- `POST /api/save-timesheet` - 儲存工時資料

### 設定相關（所有員工可用）
- `GET/POST /api/clients` - 客戶管理
- `PUT/DELETE /api/clients/:id` - 更新/刪除客戶
- `GET/POST /api/assignments` - 客戶指派管理
- `DELETE /api/assignments/:id` - 刪除指派
- `GET/POST /api/business-types` - 業務類型管理
- `PUT/DELETE /api/business-types/:id` - 更新/刪除業務類型
- `GET/POST /api/leave-events` - 假期事件管理
- `PUT/DELETE /api/leave-events/:id` - 更新/刪除假期事件
- `GET/POST /api/holidays` - 國定假日管理
- `PUT/DELETE /api/holidays/:id` - 更新/刪除國定假日

### 管理員專用
- `GET/POST /api/admin/users` - 用戶管理
- `PUT/DELETE /api/admin/users/:id` - 更新/刪除使用者
- `POST/PUT/DELETE /api/admin/leave-types/:id` - 假別設定
- `GET/PUT /api/admin/system-params` - 系統參數

## 💾 資料庫結構

### 主要資料表
1. **users** - 使用者帳號
   - 認證資訊（帳號、密碼）
   - 角色權限（admin/employee）
   - 綁定員工資料

2. **employees** - 員工資料
   - 員工基本資料
   - 到職日期

3. **clients** - 客戶資料
   - 客戶基本資料

4. **client_assignments** - 客戶指派
   - 員工與客戶的對應關係

5. **business_types** - 業務類型
   - 業務類型定義

6. **leave_types** - 請假類型
   - 假別定義

7. **timesheets** - 工時記錄（核心表）
   - 工時明細
   - 請假記錄
   - 加權工時計算

8. **holidays** - 國定假日
   - 假日日期和名稱

9. **leave_events** - 假期事件
   - 特殊假期記錄

10. **sessions** - Session 管理
    - 使用者登入狀態

11. **system_parameters** - 系統參數
    - 系統設定參數

## 🔧 技術架構

### 前端
- HTML5 + CSS3
- 原生 JavaScript（ES6+）
- Material Symbols 圖示庫
- 響應式設計

### 後端
- Cloudflare Workers
- D1 Database（SQLite）
- RESTful API

### 安全性
- Session-based 認證
- bcrypt 密碼雜湊
- CSRF 保護
- 角色權限控制

## 📱 響應式設計

系統支援各種螢幕尺寸：
- 桌面電腦（>1600px）：完整顯示
- 筆記型電腦（1400-1600px）：優化顯示
- 平板（768-1400px）：水平滾動
- 手機（<768px）：移動端優化

## 🎨 UI/UX 特色

- 現代化扁平設計
- 直覺的使用者介面
- 即時資料更新
- 視覺化回饋
- 錯誤提示與驗證
- 載入狀態指示
- 空狀態提示
- 確認對話框

## 📊 報表功能

### 工時分析
- 按客戶統計
- 按業務類型統計
- 正常工時 vs 加班工時
- 加權工時計算

### 請假統計
- 年度請假總覽
- 各假別使用情況
- 時數/天數轉換

### 樞紐分析
- 多維度交叉分析
- 彈性分組方式
- 時間區間選擇

## 🔐 權限控制

### 資料存取
- 員工只能存取自己的資料
- 管理員可存取所有資料

### 功能限制
- 一般員工：基本設定功能
- 管理員：完整系統管理

## 📝 最近更新

### 2025-10-25
- ✅ **完整實現所有功能**
- ✅ 工時表完整編輯功能
- ✅ 報表分析功能（三種報表）
- ✅ 系統設定完整功能（9 個模組）
- ✅ 用戶管理（管理員）
- ✅ 假別設定（管理員）
- ✅ 系統參數（管理員）
- ✅ CSV 匯出功能
- ✅ 完整的認證與權限控制

## 🚧 未來規劃

- [ ] Excel 批次匯入/匯出
- [ ] 圖表視覺化
- [ ] 行動應用程式
- [ ] 電子郵件通知
- [ ] 工時審批流程
- [ ] 進階報表（多維度分析）
- [ ] API 文件

## 📞 技術支援

如有問題或建議，請聯繫系統管理員。

## 📄 授權

版權所有 © 2024-2025 霍爾果斯會計師事務所

---

**系統版本**: 1.0.0  
**最後更新**: 2025-10-25  
**狀態**: ✅ 生產就緒

