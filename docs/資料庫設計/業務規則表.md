# 業務規則表

**包含表格：** Holidays, LeaveTypes, OvertimeRates, AnnualLeaveRules, OtherLeaveRules, ServiceFrequencyTypes, WorkTypes, Services (8個)  
**最後更新：** 2025年10月27日

---

## 📋 目錄
- [Holidays - 國定假日](#holidays---國定假日)
- [LeaveTypes - 假別類型](#leavetypes---假別類型)
- [OvertimeRates - 加班費率](#overtimerates---加班費率)
- [AnnualLeaveRules - 特休規則](#annualleaverules---特休規則)
- [OtherLeaveRules - 其他假期規則](#otherleaverules---其他假期規則)
- [ServiceFrequencyTypes - 週期類型](#servicefrequencytypes---週期類型)
- [WorkTypes - 工作類型](#worktypes---工作類型)
- [Services - 服務項目](#services---服務項目)

---

## Holidays - 國定假日

### 表格定義
```sql
CREATE TABLE Holidays (
  holiday_id INTEGER PRIMARY KEY AUTOINCREMENT,
  holiday_date TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  is_compensatory_day_off BOOLEAN DEFAULT 0,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0
);
```

### 索引
```sql
CREATE UNIQUE INDEX idx_holidays_date ON Holidays(holiday_date);
CREATE INDEX idx_holidays_year ON Holidays(substr(holiday_date, 1, 4));
```

### 說明
- 影響加權工時計算（國定假日加班 2.0 倍）
- 可批量導入/匯出 CSV
- 每年需更新

---

## LeaveTypes - 假別類型

### 表格定義
```sql
CREATE TABLE LeaveTypes (
  leave_type_id INTEGER PRIMARY KEY AUTOINCREMENT,
  type_name TEXT UNIQUE NOT NULL,
  deduct_leave BOOLEAN DEFAULT 1,
  is_paid BOOLEAN DEFAULT 1,
  annual_quota REAL,
  description TEXT,
  is_enabled BOOLEAN DEFAULT 1,
  sort_order INTEGER DEFAULT 0,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0
);
```

### 索引
```sql
CREATE UNIQUE INDEX idx_leave_types_name ON LeaveTypes(type_name);
CREATE INDEX idx_leave_types_enabled ON LeaveTypes(is_enabled);
```

### 預設假別類型
| 假別 | 扣假 | 有薪 | 年度額度 |
|------|------|------|---------|
| 特休 | ✅ | ✅ | 依年資計算 |
| 病假 | ✅ | ✅ | 30天/年 |
| 事假 | ✅ | ❌ | 14天/年 |
| 婚假 | ✅ | ✅ | 8天（事件觸發）|
| 喪假 | ✅ | ✅ | 依關係 3-8天 |
| 產假 | ✅ | ✅ | 56天（事件觸發）|
| 陪產假 | ✅ | ✅ | 7天（事件觸發）|
| 產檢假 | ✅ | ✅ | 7天（事件觸發）|

---

## OvertimeRates - 加班費率

### 表格定義
```sql
CREATE TABLE OvertimeRates (
  rate_id INTEGER PRIMARY KEY AUTOINCREMENT,
  work_type_id INTEGER NOT NULL,
  rate_multiplier REAL NOT NULL,
  effective_date TEXT NOT NULL,
  is_current BOOLEAN DEFAULT 1,
  created_at TEXT DEFAULT (datetime('now')),
  
  FOREIGN KEY (work_type_id) REFERENCES WorkTypes(work_type_id)
);
```

### 索引
```sql
CREATE INDEX idx_overtime_rates_type ON OvertimeRates(work_type_id);
CREATE INDEX idx_overtime_rates_current ON OvertimeRates(is_current);
```

### 法定費率
| 工作類型 | 費率 |
|---------|------|
| 正常工時 | 1.00 |
| 平日加班 | 1.34 |
| 休息日加班（前2小時）| 1.34 |
| 休息日加班（第3小時起）| 1.67 |
| 國定假日加班 | 2.00 |

---

## AnnualLeaveRules - 特休規則

### 表格定義
```sql
CREATE TABLE AnnualLeaveRules (
  rule_id INTEGER PRIMARY KEY AUTOINCREMENT,
  min_months INTEGER NOT NULL,
  max_months INTEGER NOT NULL,
  days INTEGER NOT NULL,
  description TEXT,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0
);
```

### 法定特休規則
| 年資 | 最小月數 | 最大月數 | 天數 |
|------|---------|---------|------|
| 6個月以上未滿1年 | 6 | 12 | 3 |
| 1年以上未滿2年 | 12 | 24 | 7 |
| 2年以上未滿3年 | 24 | 36 | 10 |
| 3年以上未滿5年 | 36 | 60 | 14 |
| 5年以上未滿10年 | 60 | 120 | 15 |
| 10年以上 | 120 | 999 | 15+ (每年+1, 最高30) |

---

## OtherLeaveRules - 其他假期規則

### 表格定義
```sql
CREATE TABLE OtherLeaveRules (
  rule_id INTEGER PRIMARY KEY AUTOINCREMENT,
  leave_type_id INTEGER NOT NULL,
  event_type TEXT NOT NULL,
  days REAL NOT NULL,
  validity_days INTEGER DEFAULT 365,
  description TEXT,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0,
  
  FOREIGN KEY (leave_type_id) REFERENCES LeaveTypes(leave_type_id)
);
```

### 法定規則
| 事件類型 | 假別 | 天數 | 有效期 |
|---------|------|------|--------|
| 結婚 | 婚假 | 8 | 1年 |
| 生育（女性）| 產假 | 56 | 即時 |
| 配偶生育 | 陪產假 | 7 | 前後15天 |
| 父母/配偶/子女過世 | 喪假 | 8 | 1年 |
| 祖父母/配偶父母過世 | 喪假 | 6 | 1年 |
| 曾祖父母/兄弟姊妹/配偶祖父母過世 | 喪假 | 3 | 1年 |

---

## ServiceFrequencyTypes - 週期類型

### 表格定義
```sql
CREATE TABLE ServiceFrequencyTypes (
  frequency_id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT UNIQUE NOT NULL,
  days_interval INTEGER,
  months_interval INTEGER,
  is_recurring BOOLEAN DEFAULT 1,
  is_enabled BOOLEAN DEFAULT 1,
  sort_order INTEGER DEFAULT 0,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0
);
```

### 預設週期類型
| 名稱 | 天數間隔 | 月數間隔 | 是否週期性 |
|------|---------|---------|-----------|
| 單次 | NULL | NULL | ❌ |
| 每月 | 30 | 1 | ✅ |
| 雙月 | 60 | 2 | ✅ |
| 每季 | 90 | 3 | ✅ |
| 半年 | 180 | 6 | ✅ |
| 每年 | 365 | 12 | ✅ |

---

## WorkTypes - 工作類型

### 表格定義
```sql
CREATE TABLE WorkTypes (
  work_type_id INTEGER PRIMARY KEY AUTOINCREMENT,
  type_name TEXT UNIQUE NOT NULL,
  is_overtime BOOLEAN DEFAULT 0,
  description TEXT,
  sort_order INTEGER DEFAULT 0,
  created_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0
);
```

### 預設工作類型
| 類型 | 是否加班 | 費率倍數 |
|------|---------|---------|
| 正常工時 | ❌ | 1.00 |
| 平日加班 | ✅ | 1.34 |
| 休息日加班（前2h）| ✅ | 1.34 |
| 休息日加班（2h後）| ✅ | 1.67 |
| 國定假日加班 | ✅ | 2.00 |

---

## Services - 服務項目

### 表格定義
```sql
CREATE TABLE Services (
  service_id INTEGER PRIMARY KEY AUTOINCREMENT,
  parent_service_id INTEGER,
  service_name TEXT NOT NULL,
  description TEXT,
  sort_order INTEGER DEFAULT 0,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  created_by INTEGER,
  is_deleted BOOLEAN DEFAULT 0,
  
  FOREIGN KEY (parent_service_id) REFERENCES Services(service_id),
  FOREIGN KEY (created_by) REFERENCES Users(user_id)
);
```

### 索引
```sql
CREATE INDEX idx_services_parent ON Services(parent_service_id);
CREATE INDEX idx_services_name ON Services(service_name);
```

### 層級結構
- **主項目**: `parent_service_id = NULL`
- **子項目**: `parent_service_id` 指向主項目
- **限制**: 不允許三層結構

### 唯一性規則
- 主項目名稱全局唯一
- 同一主項目下子項目名稱唯一

---

## 表格關聯圖

```
Holidays (國定假日) ──► 影響加權工時計算

LeaveTypes (假別類型)
  │
  ├──► LeaveBalances (假期餘額)
  ├──► LeaveApplications (假期申請)
  └──► OtherLeaveRules (其他假期規則)

WorkTypes (工作類型)
  │
  ├──► OvertimeRates (加班費率)
  └──► TimeLogs (工時記錄)

AnnualLeaveRules (特休規則) ──► 自動計算特休餘額

ServiceFrequencyTypes (週期類型) ──► ClientServices (客戶服務)

Services (服務項目)
  │
  ├──► ClientServices (客戶服務)
  └──► TaskTemplates (任務模板)
```

---

## 業務規則說明

### 1. 所有規則可配置
- 管理員可透過網頁介面調整
- 提供「恢復法定預設值」功能
- 規則變更立即生效

### 2. 禁止硬編碼
- 所有業務規則存入資料庫
- 不在程式碼中寫死數值
- 方便未來調整

### 3. 歷史記錄保留
- 加班費率使用 `is_current` 標記
- 保留歷史費率供查詢
- 新費率不影響歷史計算

---

## 🔗 相關文檔

- **API 規格：** [業務規則API](../API規格/業務規則API.md)
- **功能模塊：** [業務規則管理](../功能模塊/02-業務規則管理.md)
- **技術規格：** [業務規則技術規格](../技術規格/業務規則/)

---

**最後更新：** 2025年10月27日  
**本文檔合併了 8 個資料表文檔**

