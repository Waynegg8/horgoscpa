# çŸ¥è­˜èˆ‡å…§å®¹ç®¡ç†è¡¨

**åŒ…å«è¡¨æ ¼ï¼š** SOPDocuments, ClientSOPLinks, KnowledgeArticles, ExternalArticles, ResourceCenter, ModulePermissions (6å€‹)  
**æœ€å¾Œæ›´æ–°ï¼š** 2025å¹´10æœˆ27æ—¥

---

## ğŸ“‹ ç›®éŒ„
- [SOPDocuments - SOPæ–‡ä»¶](#sopdocuments---sopæ–‡ä»¶)
- [ClientSOPLinks - å®¢æˆ¶å°ˆå±¬SOP](#clientsoplinks---å®¢æˆ¶å°ˆå±¬sop)
- [KnowledgeArticles - çŸ¥è­˜åº«æ–‡ç« ](#knowledgearticles---çŸ¥è­˜åº«æ–‡ç« )
- [ExternalArticles - å¤–éƒ¨æ–‡ç« ](#externalarticles---å¤–éƒ¨æ–‡ç« )
- [ResourceCenter - è³‡æºä¸­å¿ƒ](#resourcecenter---è³‡æºä¸­å¿ƒ)
- [ModulePermissions - æ¨¡å¡Šæ¬Šé™](#modulepermissions---æ¨¡å¡Šæ¬Šé™)

---

## SOPDocuments - SOPæ–‡ä»¶

### è¡¨æ ¼å®šç¾©
```sql
CREATE TABLE SOPDocuments (
  sop_id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  category TEXT,
  tags TEXT,                           -- JSONé™£åˆ—
  version INTEGER DEFAULT 1,
  is_published BOOLEAN DEFAULT 0,
  created_by INTEGER NOT NULL,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0,
  
  FOREIGN KEY (created_by) REFERENCES Users(user_id)
);
```

### ç´¢å¼•
```sql
CREATE INDEX idx_sop_category ON SOPDocuments(category);
CREATE INDEX idx_sop_published ON SOPDocuments(is_published);
CREATE INDEX idx_sop_creator ON SOPDocuments(created_by);
```

### èªªæ˜
- SOPï¼ˆStandard Operating Procedureï¼‰æ¨™æº–ä½œæ¥­æµç¨‹
- æ”¯æŒç‰ˆæœ¬æ§åˆ¶
- å¯è¨­å®šç‚ºè‰ç¨¿æˆ–å·²ç™¼å¸ƒ

---

## ClientSOPLinks - å®¢æˆ¶å°ˆå±¬SOP

### è¡¨æ ¼å®šç¾©
```sql
CREATE TABLE ClientSOPLinks (
  link_id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id TEXT NOT NULL,
  sop_id INTEGER NOT NULL,
  assigned_by INTEGER NOT NULL,
  assigned_at TEXT DEFAULT (datetime('now')),
  notes TEXT,
  
  FOREIGN KEY (client_id) REFERENCES Clients(client_id),
  FOREIGN KEY (sop_id) REFERENCES SOPDocuments(sop_id),
  FOREIGN KEY (assigned_by) REFERENCES Users(user_id),
  UNIQUE(client_id, sop_id)
);
```

### ç´¢å¼•
```sql
CREATE INDEX idx_client_sop_client ON ClientSOPLinks(client_id);
CREATE INDEX idx_client_sop_sop ON ClientSOPLinks(sop_id);
CREATE UNIQUE INDEX idx_client_sop_unique ON ClientSOPLinks(client_id, sop_id);
```

### èªªæ˜
- å°‡ç‰¹å®š SOP é—œè¯åˆ°ç‰¹å®šå®¢æˆ¶
- åŒä¸€å®¢æˆ¶ä¸èƒ½é‡è¤‡é—œè¯åŒä¸€ SOP
- å®¢æˆ¶ç™»å…¥å¾Œå¯æŸ¥çœ‹å°ˆå±¬ SOP

---

## KnowledgeArticles - çŸ¥è­˜åº«æ–‡ç« 

### è¡¨æ ¼å®šç¾©
```sql
CREATE TABLE KnowledgeArticles (
  article_id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  category TEXT,
  tags TEXT,                           -- JSONé™£åˆ—
  is_published BOOLEAN DEFAULT 0,
  view_count INTEGER DEFAULT 0,
  created_by INTEGER NOT NULL,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0,
  
  FOREIGN KEY (created_by) REFERENCES Users(user_id)
);
```

### ç´¢å¼•
```sql
CREATE INDEX idx_knowledge_category ON KnowledgeArticles(category);
CREATE INDEX idx_knowledge_published ON KnowledgeArticles(is_published);
```

### èªªæ˜
- å…§éƒ¨çŸ¥è­˜åº«ï¼ˆåƒ…å“¡å·¥å¯è¦‹ï¼‰
- å¸¸è¦‹å•é¡Œã€æ“ä½œæŒ‡å—ã€æŠ€è¡“æ–‡ä»¶
- æ”¯æŒåˆ†é¡å’Œæ¨™ç±¤

---

## ExternalArticles - å¤–éƒ¨æ–‡ç« 

### è¡¨æ ¼å®šç¾©
```sql
CREATE TABLE ExternalArticles (
  external_id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  summary TEXT,
  content TEXT NOT NULL,
  featured_image TEXT,
  category TEXT,
  tags TEXT,                           -- JSONé™£åˆ—
  is_published BOOLEAN DEFAULT 0,
  published_at TEXT,
  view_count INTEGER DEFAULT 0,
  seo_title TEXT,
  seo_description TEXT,
  seo_keywords TEXT,
  created_by INTEGER NOT NULL,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0,
  
  FOREIGN KEY (created_by) REFERENCES Users(user_id)
);
```

### ç´¢å¼•
```sql
CREATE UNIQUE INDEX idx_external_slug ON ExternalArticles(slug);
CREATE INDEX idx_external_category ON ExternalArticles(category);
CREATE INDEX idx_external_published ON ExternalArticles(is_published);
```

### èªªæ˜
- å…¬é–‹ç¶²ç«™çš„æ–‡ç« ï¼ˆblogï¼‰
- æ”¯æŒ SEO å„ªåŒ–
- `slug`: URL å‹å–„çš„æ¨™è­˜ç¬¦

---

## ResourceCenter - è³‡æºä¸­å¿ƒ

### è¡¨æ ¼å®šç¾©
```sql
CREATE TABLE ResourceCenter (
  resource_id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  description TEXT,
  file_url TEXT NOT NULL,
  file_type TEXT,
  file_size INTEGER,
  category TEXT,
  is_published BOOLEAN DEFAULT 0,
  download_count INTEGER DEFAULT 0,
  created_by INTEGER NOT NULL,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  is_deleted BOOLEAN DEFAULT 0,
  
  FOREIGN KEY (created_by) REFERENCES Users(user_id)
);
```

### ç´¢å¼•
```sql
CREATE INDEX idx_resources_category ON ResourceCenter(category);
CREATE INDEX idx_resources_published ON ResourceCenter(is_published);
CREATE INDEX idx_resources_type ON ResourceCenter(file_type);
```

### èªªæ˜
- å¯ä¸‹è¼‰çš„æ–‡ä»¶è³‡æº
- æ”¯æŒ PDFã€Excelã€Word ç­‰æ ¼å¼
- è¨˜éŒ„ä¸‹è¼‰æ¬¡æ•¸

---

## ~~ModulePermissions - æ¨¡å¡Šæ¬Šé™~~ âš ï¸ å·²ç§»é™¤

**å·²å„ªåŒ–ç‚ºï¼š** ä½¿ç”¨ `Users.is_admin` æ§åˆ¶æ¬Šé™

### å„ªåŒ–èªªæ˜

**ç§»é™¤åŸå› ï¼š**
- æ¨¡å¡Šæ¬Šé™æ§åˆ¶éæ–¼è¤‡é›œï¼ˆ14å€‹å¸ƒæ—æ¬„ä½ï¼‰
- é è¨­æ¨¡æ¿æ©Ÿåˆ¶å¢åŠ è¤‡é›œåº¦
- å€‹åˆ¥æ¬Šé™è¦†è“‹é‚è¼¯é›£ä»¥ç¶­è­·
- å°æ–¼å°å‹äº‹å‹™æ‰€ï¼Œå…©ç´šæ¬Šé™å·²è¶³å¤ 

**å„ªåŒ–å¾Œè¨­è¨ˆï¼š**
```typescript
// ç°¡å–®çš„æ¬Šé™åˆ¤æ–·
if (user.is_admin) {
  // ç®¡ç†å“¡ï¼šæ‰€æœ‰åŠŸèƒ½
  return true;
} else {
  // å“¡å·¥ï¼šåŸºæœ¬åŠŸèƒ½
  // - å¯ä»¥ï¼šå„€è¡¨æ¿ã€å·¥æ™‚è¡¨ã€å‡æœŸã€ä»»å‹™ã€çŸ¥è­˜åº«ï¼ˆæŸ¥çœ‹ï¼‰
  // - ä¸å¯ä»¥ï¼šç³»çµ±è¨­å®šã€æ¥­å‹™è¦å‰‡ã€å“¡å·¥ç®¡ç†ã€å¤–éƒ¨å…§å®¹ç®¡ç†
  return !route.requireAdmin;
}
```

**åŠŸèƒ½æ¬Šé™è¡¨ï¼š**

| åŠŸèƒ½ | ç®¡ç†å“¡ | å“¡å·¥ |
|------|--------|------|
| å„€è¡¨æ¿ | âœ… | âœ… |
| å€‹äººè³‡æ–™ | âœ… | âœ… |
| å·¥æ™‚è¡¨å¡«å¯« | âœ… | âœ… |
| å‡æœŸç®¡ç† | âœ… | âœ… |
| ä»»å‹™ç®¡ç† | âœ… | âœ… |
| å ±è¡¨ä¸­å¿ƒ | âœ… | âœ…ï¼ˆåƒ…çœ‹è‡ªå·±ï¼‰|
| å®¢æˆ¶ç®¡ç† | âœ… | âœ…ï¼ˆåƒ…çœ‹è² è²¬çš„ï¼‰|
| çŸ¥è­˜åº«æŸ¥çœ‹ | âœ… | âœ… |
| SOPæŸ¥çœ‹ | âœ… | âœ… |
| **ç³»çµ±è¨­å®š** | âœ… | âŒ |
| **æ¥­å‹™è¦å‰‡** | âœ… | âŒ |
| **å“¡å·¥ç®¡ç†** | âœ… | âŒ |
| **å¤–éƒ¨å…§å®¹** | âœ… | âŒ |
| **CSVå°å…¥** | âœ… | âŒ |
| **çŸ¥è­˜åº«ç·¨è¼¯** | âœ… | âŒ |

**è³‡æ–™ç¯„åœæ§åˆ¶ï¼š**
- å“¡å·¥åªèƒ½çœ‹/æ”¹è‡ªå·±çš„å·¥æ™‚ã€å‡æœŸã€ä»»å‹™
- å“¡å·¥åªèƒ½çœ‹è‡ªå·±è² è²¬çš„å®¢æˆ¶
- ç®¡ç†å“¡å¯ä»¥çœ‹/æ”¹æ‰€æœ‰è³‡æ–™

---

## è¡¨æ ¼é—œè¯åœ–

```
SOPDocuments (SOPæ–‡ä»¶)
  â”‚
  â””â”€â”€â–º ClientSOPLinks (é—œè¯åˆ°å®¢æˆ¶)
         â”‚
         â””â”€â”€â–º Clients (å®¢æˆ¶)

KnowledgeArticles (çŸ¥è­˜åº«) â”€â”€â–º å…§éƒ¨å“¡å·¥æŸ¥çœ‹

ExternalArticles (å¤–éƒ¨æ–‡ç« ) â”€â”€â–º å…¬é–‹ç¶²ç«™é¡¯ç¤º

ResourceCenter (è³‡æºä¸­å¿ƒ) â”€â”€â–º å…¬é–‹ç¶²ç«™ä¸‹è¼‰

ModulePermissions (æ¨¡å¡Šæ¬Šé™)
  â”‚
  â””â”€â”€â–º Users (å“¡å·¥)
```

---

## å…§å®¹åˆ†é¡èªªæ˜

### SOP æ–‡ä»¶åˆ†é¡
- è¨˜å¸³æµç¨‹
- å ±ç¨…æµç¨‹
- å·¥å•†ç™»è¨˜æµç¨‹
- å…§éƒ¨ä½œæ¥­è¦ç¯„

### çŸ¥è­˜åº«åˆ†é¡
- æ“ä½œæŒ‡å—
- å¸¸è¦‹å•é¡Œ
- æŠ€è¡“æ–‡ä»¶
- æœ€ä½³å¯¦è¸

### å¤–éƒ¨æ–‡ç« åˆ†é¡
- ç¨…å‹™è³‡è¨Š
- å…¬å¸è¨­ç«‹
- æœƒè¨ˆçŸ¥è­˜
- æ³•è¦æ›´æ–°

### è³‡æºæª”æ¡ˆåˆ†é¡
- è¡¨æ ¼ç¯„æœ¬
- æ“ä½œæ‰‹å†Š
- æ³•è¦æ–‡ä»¶
- å…¶ä»–è³‡æº

---

## å¸¸ç”¨æŸ¥è©¢ç¯„ä¾‹

### æŸ¥è©¢å®¢æˆ¶çš„å°ˆå±¬SOP
```sql
SELECT 
  s.*,
  csl.assigned_at,
  csl.notes
FROM ClientSOPLinks csl
JOIN SOPDocuments s ON csl.sop_id = s.sop_id
WHERE csl.client_id = ? 
  AND s.is_published = 1 
  AND s.is_deleted = 0
ORDER BY s.title;
```

### æŸ¥è©¢å·²ç™¼å¸ƒçš„çŸ¥è­˜åº«æ–‡ç« 
```sql
SELECT * FROM KnowledgeArticles
WHERE is_published = 1 AND is_deleted = 0
ORDER BY created_at DESC;
```

### æŸ¥è©¢å“¡å·¥æ¬Šé™
```sql
SELECT * FROM ModulePermissions
WHERE user_id = ?
UNION
SELECT * FROM ModulePermissions
WHERE user_id IS NULL
LIMIT 1;
```

### æŸ¥è©¢ç†±é–€è³‡æº
```sql
SELECT * FROM ResourceCenter
WHERE is_published = 1 AND is_deleted = 0
ORDER BY download_count DESC
LIMIT 10;
```

---

## ğŸ”— ç›¸é—œæ–‡æª”

- **API è¦æ ¼ï¼š** [SOPç®¡ç†API](../APIè¦æ ¼/SOPç®¡ç†API.md), [å“¡å·¥æ¬Šé™API](../APIè¦æ ¼/å“¡å·¥æ¬Šé™API.md)
- **åŠŸèƒ½æ¨¡å¡Šï¼š** [SOPæ–‡ä»¶ç®¡ç†](../åŠŸèƒ½æ¨¡å¡Š/18-SOPæ–‡ä»¶ç®¡ç†.md), [çŸ¥è­˜åº«](../åŠŸèƒ½æ¨¡å¡Š/20-é€šç”¨çŸ¥è­˜åº«.md), [å“¡å·¥æ¬Šé™è¨­å®š](../åŠŸèƒ½æ¨¡å¡Š/01-å“¡å·¥æ¬Šé™è¨­å®š.md)

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025å¹´10æœˆ27æ—¥  
**æœ¬æ–‡æª”åˆä½µäº† 6 å€‹è³‡æ–™è¡¨æ–‡æª”**

