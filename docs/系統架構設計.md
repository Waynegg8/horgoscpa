# éœçˆ¾æœæ–¯æœƒè¨ˆå¸«äº‹å‹™æ‰€ - ç³»çµ±æ¶æ§‹è¨­è¨ˆ

**ç‰ˆæœ¬**: 2.0  
**æœ€å¾Œæ›´æ–°**: 2025-10-26

---

## ğŸ“‹ ç³»çµ±æ¦‚è¿°

### ç³»çµ±å®šä½
å…§éƒ¨ç®¡ç†ç³»çµ±ï¼Œæä¾›æœƒè¨ˆå¸«äº‹å‹™æ‰€æ—¥å¸¸ç‡Ÿé‹æ‰€éœ€çš„å„é …åŠŸèƒ½ï¼ŒåŒ…å«å·¥æ™‚ç®¡ç†ã€å®¢æˆ¶ç®¡ç†ã€ä»»å‹™ç®¡ç†ã€çŸ¥è­˜ç®¡ç†ç­‰ã€‚

### æŠ€è¡“æ¶æ§‹
```
å‰ç«¯: HTML + CSS + JavaScript (Vanilla JS)
å¾Œç«¯: Cloudflare Workers (JavaScript)
è³‡æ–™åº«: Cloudflare D1 (SQLite)
éƒ¨ç½²: Cloudflare Pages + Workers
```

### ç³»çµ±ç‰¹é»
- ğŸŒ å®Œå…¨é›²ç«¯åŒ–ï¼Œç„¡éœ€è‡ªå»ºä¼ºæœå™¨
- ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´æ¡Œé¢èˆ‡è¡Œå‹•è£ç½®
- ğŸ” åŸºæ–¼ Token çš„èº«ä»½é©—è­‰
- ğŸ“Š å³æ™‚è³‡æ–™åŒæ­¥
- ğŸš€ è‡ªå‹•åŒ–ä»»å‹™ç”Ÿæˆ

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±¤ (HTML/CSS/JS)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·¥ä½œå°  â”‚ ä»»å‹™ç®¡ç† â”‚ å·¥æ™‚è¨˜éŒ„ â”‚ å°ˆæ¡ˆç®¡ç† â”‚ çŸ¥è­˜åº«  â”‚
â”‚  å ±è¡¨    â”‚ å®¢æˆ¶ç®¡ç† â”‚ SOPç®¡ç†  â”‚ å…§å®¹ç·¨è¼¯ â”‚ è¨­å®š    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†• HTTPS/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¾Œç«¯å±¤ (Cloudflare Workers)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èªè­‰æˆæ¬Š  â”‚  æ¥­å‹™é‚è¼¯   â”‚  è³‡æ–™é©—è­‰  â”‚  éŒ¯èª¤è™•ç†   â”‚
â”‚  APIè·¯ç”±   â”‚  è‡ªå‹•åŒ–ä»»å‹™ â”‚  å ±è¡¨ç”Ÿæˆ  â”‚  æª”æ¡ˆè™•ç†   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†• SQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è³‡æ–™åº«å±¤ (Cloudflare D1)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä½¿ç”¨è€…  â”‚  å®¢æˆ¶    â”‚  ä»»å‹™    â”‚  å·¥æ™‚    â”‚  å°ˆæ¡ˆ   â”‚
â”‚  SOP    â”‚  å ±è¡¨å¿«å– â”‚  åª’é«”åº«  â”‚  CMS     â”‚  æ’ç¨‹   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

### 1. ä½¿ç”¨è€…èˆ‡æ¬Šé™ç®¡ç†
**é é¢**: `login.html`, `change-password.html`  
**æ¨¡çµ„**: `src/auth.js`  
**åŠŸèƒ½**: ç™»å…¥/ç™»å‡ºã€Session ç®¡ç†ã€è§’è‰²æ¬Šé™æ§åˆ¶  
**è³‡æ–™è¡¨**: `users`, `sessions`  
**è¨­è¨ˆæ–‡æª”**: [é–‹ç™¼èˆ‡éƒ¨ç½²æŒ‡å—.md](./é–‹ç™¼èˆ‡éƒ¨ç½²æŒ‡å—.md) (å®‰å…¨è¦ç¯„ç« ç¯€)

### 2. çµ±ä¸€ä»»å‹™ç®¡ç†ç³»çµ± â­
**é é¢**: `tasks.html` (7å€‹æ¨™ç±¤çµ±ä¸€ç®¡ç†)  
**æ¨¡çµ„**: `src/multi-stage-tasks.js`, `src/recurring-tasks.js`, `src/automated-tasks.js`  
**åŠŸèƒ½**: 
- å…¨éƒ¨ä»»å‹™ã€æˆ‘çš„ä»»å‹™
- å‘¨æœŸä»»å‹™è‡ªå‹•ç”Ÿæˆ
- å·¥å•†ç™»è¨˜ä»»å‹™ã€è²¡ç¨…ç°½è­‰ä»»å‹™
- å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ä»»å‹™
- æœå‹™é…ç½®ç®¡ç†

**è³‡æ–™è¡¨**: `tasks`, `multi_stage_tasks`, `task_stages`, `multi_stage_templates`, `template_stages`, `recurring_task_templates`, `recurring_task_instances`, `client_services`, `service_checklist_templates`, `task_execution_log`, `task_generation_log`

**è¨­è¨ˆæ–‡æª”**: [ä»»å‹™ç®¡ç†ç³»çµ±è¨­è¨ˆ.md](./ä»»å‹™ç®¡ç†ç³»çµ±è¨­è¨ˆ.md) + [å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md](./å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md)

**å»¢æ£„é é¢**: ~~multi-stage-tasks.html~~, ~~recurring-tasks.html~~, ~~service-config.html~~ (å·²æ•´åˆåˆ° tasks.html)

### 3. å·¥æ™‚ç®¡ç†ç³»çµ±
**é é¢**: `timesheet.html`  
**æ¨¡çµ„**: API ç«¯é»å…§å»ºæ–¼ `src/index.js`  
**åŠŸèƒ½**: å·¥æ™‚è¨˜éŒ„ã€åŠ ç­ç®¡ç†ã€è«‹å‡ç”³è«‹ã€å¹´å‡è©¦ç®—  
**è³‡æ–™è¡¨**: `employees`, `timesheets`, `leave_events`, `annual_leave_rules`, `annual_leave_carryover`, `overtime_rates`, `holidays`, `leave_types`  
**è¨­è¨ˆæ–‡æª”**: [å·¥æ™‚ç®¡ç†ç³»çµ±è¨­è¨ˆ.md](./å·¥æ™‚ç®¡ç†ç³»çµ±è¨­è¨ˆ.md)

### 4. å®¢æˆ¶ç®¡ç†ç³»çµ±
**é é¢**: `settings.html` (å®¢æˆ¶ç®¡ç†æ¨™ç±¤)  
**æ¨¡çµ„**: `src/clients.js`  
**åŠŸèƒ½**: å®¢æˆ¶è³‡æ–™ CRUDã€æœå‹™é…ç½®ã€äº’å‹•è¨˜éŒ„  
**è³‡æ–™è¡¨**: `clients`, `client_services`, `client_interactions`, `client_assignments`  
**è¨­è¨ˆæ–‡æª”**: [å®¢æˆ¶ç®¡ç†ç³»çµ±è¨­è¨ˆ.md](./å®¢æˆ¶ç®¡ç†ç³»çµ±è¨­è¨ˆ.md)

### 5. çŸ¥è­˜åº«ç³»çµ±
**é é¢**: `knowledge.html` (SOP+å…§éƒ¨æ–‡æª”+FAQ ä¸‰å€‹æ¨™ç±¤)  
**æ¨¡çµ„**: `src/sop.js`  
**åŠŸèƒ½**: SOP ç®¡ç†ã€å…§éƒ¨æ–‡æª”ã€FAQã€ç‰ˆæœ¬æ§åˆ¶ã€æœå°‹  
**è³‡æ–™è¡¨**: `sop_categories`, `sops`, `sop_versions`  
**è¨­è¨ˆæ–‡æª”**: [çŸ¥è­˜åº«ç³»çµ±è¨­è¨ˆ.md](./çŸ¥è­˜åº«ç³»çµ±è¨­è¨ˆ.md)  
**å»¢æ£„é é¢**: ~~sop.html~~ (å¦‚èˆ‡ knowledge.html é‡è¤‡)

### 6. å ±è¡¨ç³»çµ±
**é é¢**: `reports.html`  
**æ¨¡çµ„**: `src/reports.js`  
**åŠŸèƒ½**: å¹´å‡å ±è¡¨ã€å·¥æ™‚åˆ†æã€æ¨ç´åˆ†æã€å ±è¡¨å¿«å–  
**è³‡æ–™è¡¨**: `report_cache`  
**è¨­è¨ˆæ–‡æª”**: [å ±è¡¨ç³»çµ±è¨­è¨ˆ.md](./å ±è¡¨ç³»çµ±è¨­è¨ˆ.md)

### 7. å…§å®¹ç®¡ç†ç³»çµ± (CMS)
**é é¢**: `content-editor.html`, `blog.html`, `resources.html`  
**æ¨¡çµ„**: `src/cms.js`, `src/media.js`  
**åŠŸèƒ½**: éƒ¨è½æ ¼ç®¡ç†ã€è³‡æºç®¡ç†ã€åª’é«”åº«  
**è³‡æ–™è¡¨**: `posts`, `media_library`  
**è¨­è¨ˆæ–‡æª”**: [å…§å®¹ç®¡ç†ç³»çµ±è¨­è¨ˆ.md](./å…§å®¹ç®¡ç†ç³»çµ±è¨­è¨ˆ.md)

### 8. ç³»çµ±è¨­å®šèˆ‡å·¥ä½œå°
**é é¢**: `settings.html` (å“¡å·¥/ç³»çµ±åƒæ•¸/ç¯„æœ¬æ¨™ç±¤), `dashboard.html`  
**æ¨¡çµ„**: `src/index.js`  
**åŠŸèƒ½**: å“¡å·¥ç®¡ç†ã€ç³»çµ±åƒæ•¸ã€å·¥ä½œå°å„€è¡¨æ¿ã€é€šçŸ¥  
**è³‡æ–™è¡¨**: `employees`, `system_parameters`, `task_reminders`  
**è¨­è¨ˆæ–‡æª”**: [ç³»çµ±è¨­å®šèˆ‡å·¥ä½œå°è¨­è¨ˆ.md](./ç³»çµ±è¨­å®šèˆ‡å·¥ä½œå°è¨­è¨ˆ.md)

---

### âš ï¸ è³‡æ–™è¡¨æ•´åˆèªªæ˜

**å°ˆæ¡ˆç®¡ç†ç›¸é—œè³‡æ–™è¡¨**ï¼š
- `projects`, `project_tasks`, `project_checklist` è³‡æ–™è¡¨ç›®å‰å­˜åœ¨æ–¼è³‡æ–™åº«ä¸­
- ä½†åŠŸèƒ½å·²æ•´åˆåˆ°çµ±ä¸€ä»»å‹™ç³»çµ±ï¼ˆcategory = 'project'ï¼‰
- é€™äº›è³‡æ–™è¡¨å¯èƒ½ï¼š
  - é¸é … 1ï¼šæœªä¾†é·ç§»è³‡æ–™å¾Œå»¢æ£„
  - é¸é … 2ï¼šä½œç‚ºå¤§å‹å°ˆæ¡ˆçš„è¼”åŠ©è³‡è¨Šï¼ˆé ç®—ã€æˆæœ¬è¿½è¹¤ç­‰ï¼‰
  - é¸é … 3ï¼šå®Œå…¨å»¢æ£„ï¼Œä½¿ç”¨ tasks è¡¨çš„æ“´å±•æ¬„ä½

**é é¢ç‹€æ…‹**ï¼š
- `projects.html` ç›®å‰ä»å­˜åœ¨ä½†æ‡‰è©²å»¢æ£„æˆ–æ•´åˆåˆ° `tasks.html`

---

## ğŸ—„ï¸ è³‡æ–™åº«å®Œæ•´æ¶æ§‹

### æ ¸å¿ƒè³‡æ–™è¡¨

#### users (ä½¿ç”¨è€…)
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT NOT NULL UNIQUE,
  password_hash TEXT NOT NULL,
  role TEXT NOT NULL,                -- 'admin' æˆ– 'employee'
  employee_name TEXT,
  is_active INTEGER DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### clients (å®¢æˆ¶)
```sql
CREATE TABLE clients (
  name TEXT PRIMARY KEY              -- ç›®å‰ä½¿ç”¨å®¢æˆ¶åç¨±ç‚ºä¸»éµ
);
```
**æ³¨æ„**: ç°¡åŒ–çµæ§‹ï¼Œæœªä¾†å¯èƒ½éœ€è¦æ“´å±•ç‚ºå®Œæ•´çš„å®¢æˆ¶è³‡æ–™è¡¨ã€‚

#### tasks (ä»»å‹™)
```sql
CREATE TABLE tasks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'pending',     -- pending, in_progress, completed, cancelled
  priority TEXT DEFAULT 'medium',    -- low, medium, high
  due_date DATETIME,
  assigned_user TEXT,
  created_by TEXT,
  category TEXT,                     -- client_service, recurring, business, finance
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### å¤šéšæ®µä»»å‹™ç›¸é—œ

#### multi_stage_tasks (å¤šéšæ®µä»»å‹™)
```sql
CREATE TABLE multi_stage_tasks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  task_id INTEGER NOT NULL UNIQUE,
  total_stages INTEGER NOT NULL,
  completed_stages INTEGER DEFAULT 0,
  overall_progress INTEGER DEFAULT 0,
  current_stage INTEGER DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE
);
```

#### task_stages (ä»»å‹™éšæ®µ)
```sql
CREATE TABLE task_stages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  multi_stage_task_id INTEGER NOT NULL,
  stage_order INTEGER NOT NULL,
  stage_name TEXT NOT NULL,
  stage_description TEXT,
  status TEXT DEFAULT 'pending',
  checklist TEXT,                    -- JSON æ ¼å¼
  estimated_hours DECIMAL(5,2),
  actual_hours DECIMAL(5,2),
  assigned_to TEXT,
  completed_by TEXT,
  completed_at DATETIME,
  notes TEXT,
  requires_approval BOOLEAN DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (multi_stage_task_id) REFERENCES multi_stage_tasks(id) ON DELETE CASCADE
);
```

### å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç›¸é—œ

#### client_services (å®¢æˆ¶æœå‹™é…ç½®)
```sql
CREATE TABLE client_services (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id INTEGER NOT NULL,
  service_type TEXT NOT NULL,        -- accounting, vat, income_tax, etc.
  frequency TEXT NOT NULL,           -- monthly, bimonthly, quarterly, etc.
  fee DECIMAL(10,2) DEFAULT 0,
  estimated_hours DECIMAL(5,2) DEFAULT 0,
  assigned_to INTEGER,
  backup_assignee INTEGER,
  start_month INTEGER,               -- é–‹å§‹æœˆä»½
  execution_day INTEGER,             -- æ¯æœˆåŸ·è¡Œæ—¥
  advance_days INTEGER DEFAULT 7,   -- æå‰ç”Ÿæˆå¤©æ•¸
  due_days INTEGER DEFAULT 15,      -- ä»»å‹™æœŸé™å¤©æ•¸
  invoice_count INTEGER DEFAULT 0,
  difficulty_level INTEGER,          -- 1-5
  is_active BOOLEAN DEFAULT 1,
  notes TEXT,
  special_requirements TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_generated_at DATETIME,
  FOREIGN KEY (assigned_to) REFERENCES users(id)
);
```

#### service_checklist_templates (æœå‹™æª¢æŸ¥æ¸…å–®ç¯„æœ¬)
```sql
CREATE TABLE service_checklist_templates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  service_type TEXT NOT NULL,
  template_name TEXT NOT NULL,
  version INTEGER DEFAULT 1,
  checklist_data TEXT NOT NULL,     -- JSON æ ¼å¼
  is_active BOOLEAN DEFAULT 1,
  is_default BOOLEAN DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  created_by INTEGER,
  FOREIGN KEY (created_by) REFERENCES users(id)
);
```

#### task_execution_log (ä»»å‹™åŸ·è¡Œè¨˜éŒ„)
```sql
CREATE TABLE task_execution_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  task_id INTEGER NOT NULL,
  multi_stage_task_id INTEGER,
  client_service_id INTEGER,
  execution_period TEXT,             -- '2025-10', '2025-Q1'
  status TEXT DEFAULT 'pending',
  executor_id INTEGER,
  approver_id INTEGER,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  started_at DATETIME,
  completed_at DATETIME,
  approved_at DATETIME,
  actual_hours DECIMAL(5,2),
  billed_amount DECIMAL(10,2),
  notes TEXT,
  attachments TEXT,
  FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE,
  FOREIGN KEY (client_service_id) REFERENCES client_services(id)
);
```

#### task_generation_log (ä»»å‹™ç”Ÿæˆè¨˜éŒ„ - é˜²é‡è¤‡)
```sql
CREATE TABLE task_generation_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_service_id INTEGER NOT NULL,
  execution_period TEXT NOT NULL,    -- '2025-10'
  generated_task_id INTEGER,
  generated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  generation_method TEXT,            -- 'auto' æˆ– 'manual'
  FOREIGN KEY (client_service_id) REFERENCES client_services(id),
  FOREIGN KEY (generated_task_id) REFERENCES tasks(id),
  UNIQUE(client_service_id, execution_period)
);
```

### å·¥æ™‚ç®¡ç†ç›¸é—œ

#### timesheets (å·¥æ™‚è¨˜éŒ„)
```sql
CREATE TABLE timesheets (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  employee_id INTEGER NOT NULL,
  date DATE NOT NULL,
  regular_hours REAL DEFAULT 0,
  overtime_hours REAL DEFAULT 0,
  status TEXT DEFAULT 'draft',
  notes TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(employee_id, date)
);
```

### å…¶ä»–é‡è¦è³‡æ–™è¡¨

#### å®Œæ•´é·ç§»æª”æ¡ˆåˆ—è¡¨

æ‰€æœ‰è³‡æ–™è¡¨çµæ§‹å®šç¾©æ–¼ä»¥ä¸‹é·ç§»æª”æ¡ˆï¼š

| æª”æ¡ˆ | èªªæ˜ | å»ºç«‹çš„è³‡æ–™è¡¨ |
|------|------|-------------|
| 001_complete_schema.sql | åŸºç¤æ¶æ§‹ | users, sessions, employees, timesheets, leave_events, holidays, overtime_rates, annual_leave_rules, annual_leave_carryover, other_leave_rules, clients, client_assignments, business_types, system_parameters, task_reminders |
| 002_seed_data.sql | åˆå§‹è³‡æ–™ | æ’å…¥é è¨­çš„æ¥­å‹™é¡å‹ã€å‡åˆ¥é¡å‹ã€ç³»çµ±åƒæ•¸ç­‰ |
| 003_clients_expansion.sql | å®¢æˆ¶æ“´å±• | client_service_schedules, client_interactions |
| 004_sop_system.sql | SOPç³»çµ± | sop_categories, sops, sop_versions |
| 004a_sop_business_integration.sql | SOPæ•´åˆ | ç‚º sops è¡¨æ·»åŠ  business_type æ¬„ä½ |
| 005_media_library.sql | åª’é«”åº« | media_library |
| 006_project_management.sql | å°ˆæ¡ˆç®¡ç† | projects, project_tasks, project_checklist |
| 007_add_timestamps.sql | æ™‚é–“æˆ³ | ç‚ºå¤šå€‹è¡¨æ·»åŠ  created_at, updated_at |
| 007a_report_cache.sql | å ±è¡¨å¿«å– | report_cache |
| 008_cms.sql | å…§å®¹ç®¡ç† | posts |
| 010_multi_stage_tasks.sql | å¤šéšæ®µä»»å‹™ | tasks, multi_stage_tasks, task_stages, multi_stage_templates, template_stages |
| 011_recurring_tasks.sql | å‘¨æœŸä»»å‹™ | recurring_task_templates, recurring_task_instances, recurring_task_generation_log |
| 012_add_project_category.sql | å°ˆæ¡ˆåˆ†é¡ | ç‚º projects è¡¨æ·»åŠ  category æ¬„ä½ |
| 013_client_services_integration_è¡¥å…….sql | å®¢æˆ¶æœå‹™è‡ªå‹•åŒ– | service_checklist_templates, task_execution_log, task_generation_log, v_client_services_overview |
| 015_rebuild_client_services.sql | é‡å»ºå®¢æˆ¶æœå‹™è¡¨ | é‡å»º client_services è¡¨çµæ§‹ |

#### é·ç§»æª”æ¡ˆåŸ·è¡Œé †åº

**é‡è¦**ï¼šé·ç§»æª”æ¡ˆå¿…é ˆæŒ‰ç·¨è™Ÿé †åºåŸ·è¡Œã€‚

```bash
# æœ¬åœ°ç’°å¢ƒ
cd timesheet-api
npx wrangler d1 execute timesheet-db --local --file=migrations/001_complete_schema.sql
npx wrangler d1 execute timesheet-db --local --file=migrations/002_seed_data.sql
# ... ä¾åºåŸ·è¡Œ

# ç”Ÿç”¢ç’°å¢ƒ
npx wrangler d1 execute timesheet-db --remote --file=migrations/001_complete_schema.sql
# ... ä¾åºåŸ·è¡Œ
```

**æ³¨æ„**ï¼š
- 004a å’Œ 007a æ˜¯å› ç‚ºç·¨è™Ÿé‡è¤‡æš«æ™‚ä½¿ç”¨çš„å‘½å
- å·²åˆªé™¤çš„é·ç§»ï¼š009ï¼ˆå¤§é‡CSVæ•¸æ“šï¼‰ã€016ï¼ˆæ¸¬è©¦æ•¸æ“šï¼‰
- å·²åˆªé™¤çš„é·ç§»ï¼š013åŸå§‹ç‰ˆæœ¬ã€014æ¸¬è©¦æ•¸æ“š

---

## ğŸ”„ è³‡æ–™æµç¨‹

### ä»»å‹™è‡ªå‹•ç”Ÿæˆæµç¨‹
```
1. GitHub Actions æ¯æ—¥åŸ·è¡Œ (æˆ–æ‰‹å‹•è§¸ç™¼)
   â†“
2. å‘¼å« API: POST /api/automated-tasks/generate
   â†“
3. æŸ¥è©¢ client_services è¡¨ï¼Œæ‰¾å‡ºéœ€è¦ç”Ÿæˆçš„æœå‹™
   â†“
4. æª¢æŸ¥ task_generation_logï¼Œé¿å…é‡è¤‡ç”Ÿæˆ
   â†“
5. è¼‰å…¥ service_checklist_templates ç¯„æœ¬
   â†“
6. å‰µå»º task, multi_stage_task, task_stages
   â†“
7. è¨˜éŒ„åˆ° task_execution_log å’Œ task_generation_log
```

### ä½¿ç”¨è€…èªè­‰æµç¨‹
```
1. ä½¿ç”¨è€…è¼¸å…¥å¸³è™Ÿå¯†ç¢¼
   â†“
2. POST /api/login
   â†“
3. é©—è­‰å¯†ç¢¼ (bcrypt)
   â†“
4. å‰µå»º sessionï¼Œè¿”å› token
   â†“
5. å‰ç«¯å„²å­˜ token åˆ° localStorage
   â†“
6. å¾ŒçºŒè«‹æ±‚å¸¶ Authorization header
```

---

## ğŸ“ å°ˆæ¡ˆç›®éŒ„çµæ§‹

```
horgoscpa/
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ css/                    # æ¨£å¼æª”æ¡ˆ
â”‚   â”œâ”€â”€ js/                     # å‰ç«¯ JavaScript
â”‚   â”‚   â”œâ”€â”€ unified-tasks.js   # çµ±ä¸€ä»»å‹™ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ navbar.js          # å°èˆªåˆ—
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ images/                # åœ–ç‰‡è³‡æº
â”œâ”€â”€ timesheet-api/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.js           # API ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ auth.js            # èªè­‰æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ automated-tasks.js # è‡ªå‹•ä»»å‹™
â”‚   â”‚   â”œâ”€â”€ clients.js         # å®¢æˆ¶ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ multi-stage-tasks.js
â”‚   â”‚   â”œâ”€â”€ recurring-tasks.js
â”‚   â”‚   â”œâ”€â”€ projects.js
â”‚   â”‚   â”œâ”€â”€ sop.js
â”‚   â”‚   â”œâ”€â”€ cms.js
â”‚   â”‚   â”œâ”€â”€ media.js
â”‚   â”‚   â”œâ”€â”€ reports.js
â”‚   â”‚   â””â”€â”€ utils.js
â”‚   â”œâ”€â”€ migrations/            # è³‡æ–™åº«é·ç§»
â”‚   â”œâ”€â”€ scripts/               # å·¥å…·è…³æœ¬
â”‚   â”œâ”€â”€ test/                  # æ¸¬è©¦æª”æ¡ˆ
â”‚   â””â”€â”€ wrangler.jsonc         # Cloudflare é…ç½®
â”œâ”€â”€ docs/                      # æ–‡æª”
â”œâ”€â”€ .github/workflows/         # GitHub Actions
â”œâ”€â”€ *.html                     # å‰ç«¯é é¢
â””â”€â”€ README.md
```

---

## ğŸ”Œ API è¨­è¨ˆåŸå‰‡

### è·¯ç”±çµæ§‹
```
/api/login                          # ç™»å…¥
/api/logout                         # ç™»å‡º
/api/verify                         # é©—è­‰ session
/api/è³‡æºè¤‡æ•¸/:id                    # RESTful è³‡æºæ“ä½œ
/api/multi-stage-tasks              # å¤šéšæ®µä»»å‹™
/api/automated-tasks/generate       # è‡ªå‹•ç”Ÿæˆä»»å‹™
```

### å›æ‡‰æ ¼å¼
```javascript
// æˆåŠŸ
{ "success": true, "data": {...} }

// å¤±æ•—
{ "success": false, "error": "éŒ¯èª¤è¨Šæ¯" }
```

---

## ğŸš€ éƒ¨ç½²æ¶æ§‹

```
Cloudflare Pages (å‰ç«¯éœæ…‹æª”æ¡ˆ)
         â†“
Cloudflare Workers (API)
         â†“
Cloudflare D1 (è³‡æ–™åº«)
```

### ç’°å¢ƒå€åˆ†
- **æœ¬åœ°é–‹ç™¼**: `npx wrangler dev --local`
- **é è¦½ç’°å¢ƒ**: `--env preview`
- **ç”Ÿç”¢ç’°å¢ƒ**: é è¨­

---

## ğŸ“ é–‹ç™¼æµç¨‹åŸå‰‡

### âš ï¸ é‡è¦ï¼šå…ˆæ”¹è¨­è¨ˆï¼Œå†æ”¹ä»£ç¢¼

1. **ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹è¨­è¨ˆæ–‡æª”**
   - åœ¨ `docs/` ç›®éŒ„æ‰¾åˆ°å°æ‡‰çš„è¨­è¨ˆæ–‡æª”
   - æ›´æ–°åŠŸèƒ½æè¿°ã€è³‡æ–™è¡¨çµæ§‹ã€API è¨­è¨ˆ
   - ç¢ºä¿è¨­è¨ˆæ–‡æª”å®Œæ•´æ¸…æ™°

2. **ç¬¬äºŒæ­¥ï¼šæŒ‰ç…§è¨­è¨ˆå¯¦æ–½**
   - æ ¹æ“šæ›´æ–°å¾Œçš„è¨­è¨ˆæ–‡æª”é€²è¡Œé–‹ç™¼
   - è³‡æ–™åº«é·ç§»ã€å¾Œç«¯ APIã€å‰ç«¯ä»‹é¢

3. **ç¬¬ä¸‰æ­¥ï¼šæ¸¬è©¦é©—è­‰**
   - æ¸¬è©¦åŠŸèƒ½æ˜¯å¦ç¬¦åˆè¨­è¨ˆ
   - æ¸¬è©¦é€šéå¾Œåˆªé™¤æ¸¬è©¦è…³æœ¬

4. **ç¬¬å››æ­¥ï¼šæ›´æ–°æ–‡æª”**
   - å¦‚æœ‰è¨­è¨ˆè®Šæ›´ï¼Œå›é ­æ›´æ–°è¨­è¨ˆæ–‡æª”
   - ä¿æŒæ–‡æª”èˆ‡ä»£ç¢¼åŒæ­¥

### ç¦æ­¢äº‹é …
- âŒ ä¸ç”Ÿæˆå®Œæˆå ±å‘Š
- âŒ ä¸ç”Ÿæˆç¸½çµæ–‡ä»¶
- âŒ ä¸ä¿ç•™æ¸¬è©¦è…³æœ¬
- âŒ ä¸å‰µå»ºè‡¨æ™‚æ–‡æª”
- âŒ ä¸åœ¨æœªæ›´æ–°è¨­è¨ˆçš„æƒ…æ³ä¸‹ä¿®æ”¹ä»£ç¢¼

---

## ğŸ“š ç›¸é—œæ–‡æª”

è©³ç´°çš„åŠŸèƒ½è¨­è¨ˆè«‹åƒè€ƒï¼š
- [å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md](./å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md)
- [APIç«¯é»æ–‡æª”.md](./APIç«¯é»æ–‡æª”.md)
- [é–‹ç™¼èˆ‡éƒ¨ç½²æŒ‡å—.md](./é–‹ç™¼èˆ‡éƒ¨ç½²æŒ‡å—.md)

---

**æœ¬æ–‡æª”ä½œç‚ºæ•´å€‹ç³»çµ±çš„ç¸½è¦½ï¼Œä¿®æ”¹ä»»ä½•åŠŸèƒ½å‰è«‹å…ˆç¢ºèªä¸¦æ›´æ–°ç›¸é—œè¨­è¨ˆæ–‡æª”ã€‚**

