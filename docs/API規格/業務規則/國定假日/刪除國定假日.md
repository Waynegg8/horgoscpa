# 刪除國定假日

**端點：** `DELETE /api/v1/settings/holidays/:date`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

刪除特定日期的國定假日。刪除前會檢查是否有工時記錄使用該國定假日。

---

## 請求

### 路徑參數

- `date` (必填, string): 要刪除的國定假日日期，格式 `YYYY-MM-DD`

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "message": "國定假日已刪除",
  "data": {
    "deleted_date": "2025-01-01"
  }
}
```

---

### 錯誤回應

**404 Not Found - 找不到國定假日：**
```json
{
  "success": false,
  "error": {
    "code": "HOLIDAY_NOT_FOUND",
    "message": "找不到該日期的國定假日"
  }
}
```

**409 Conflict - 已被使用：**
```json
{
  "success": false,
  "error": {
    "code": "HOLIDAY_IN_USE",
    "message": "該國定假日已被 5 筆工時記錄使用，無法刪除",
    "data": {
      "usage_count": 5
    }
  }
}
```

---

## 刪除前檢查邏輯

```typescript
async function deleteHoliday(date: string) {
  // 1. 檢查是否有工時記錄使用此日期
  const usageCount = await db.get(`
    SELECT COUNT(*) AS count
    FROM TimeLogs
    WHERE work_date = ?
  `, [date]);
  
  if (usageCount.count > 0) {
    throw new Error('HOLIDAY_IN_USE');
  }
  
  // 2. 可安全刪除
  await db.run(`
    DELETE FROM Holidays WHERE date = ?
  `, [date]);
}
```

---

## 使用範例

### 範例：刪除未使用的國定假日

**請求：**
```bash
DELETE /api/v1/settings/holidays/2025-01-26
```

**回應：**
```json
{
  "success": true,
  "message": "國定假日已刪除"
}
```

---

### 範例：嘗試刪除已使用的國定假日

**請求：**
```bash
DELETE /api/v1/settings/holidays/2025-01-01
```

**回應：**
```json
{
  "success": false,
  "error": {
    "code": "HOLIDAY_IN_USE",
    "message": "該國定假日已被 5 筆工時記錄使用，無法刪除",
    "data": {
      "usage_count": 5
    }
  }
}
```

---

## 相關端點

- [查詢使用情況](./查詢使用情況.md)
- [獲取特定國定假日](./獲取特定國定假日.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



**端點：** `DELETE /api/v1/settings/holidays/:date`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

刪除特定日期的國定假日。刪除前會檢查是否有工時記錄使用該國定假日。

---

## 請求

### 路徑參數

- `date` (必填, string): 要刪除的國定假日日期，格式 `YYYY-MM-DD`

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "message": "國定假日已刪除",
  "data": {
    "deleted_date": "2025-01-01"
  }
}
```

---

### 錯誤回應

**404 Not Found - 找不到國定假日：**
```json
{
  "success": false,
  "error": {
    "code": "HOLIDAY_NOT_FOUND",
    "message": "找不到該日期的國定假日"
  }
}
```

**409 Conflict - 已被使用：**
```json
{
  "success": false,
  "error": {
    "code": "HOLIDAY_IN_USE",
    "message": "該國定假日已被 5 筆工時記錄使用，無法刪除",
    "data": {
      "usage_count": 5
    }
  }
}
```

---

## 刪除前檢查邏輯

```typescript
async function deleteHoliday(date: string) {
  // 1. 檢查是否有工時記錄使用此日期
  const usageCount = await db.get(`
    SELECT COUNT(*) AS count
    FROM TimeLogs
    WHERE work_date = ?
  `, [date]);
  
  if (usageCount.count > 0) {
    throw new Error('HOLIDAY_IN_USE');
  }
  
  // 2. 可安全刪除
  await db.run(`
    DELETE FROM Holidays WHERE date = ?
  `, [date]);
}
```

---

## 使用範例

### 範例：刪除未使用的國定假日

**請求：**
```bash
DELETE /api/v1/settings/holidays/2025-01-26
```

**回應：**
```json
{
  "success": true,
  "message": "國定假日已刪除"
}
```

---

### 範例：嘗試刪除已使用的國定假日

**請求：**
```bash
DELETE /api/v1/settings/holidays/2025-01-01
```

**回應：**
```json
{
  "success": false,
  "error": {
    "code": "HOLIDAY_IN_USE",
    "message": "該國定假日已被 5 筆工時記錄使用，無法刪除",
    "data": {
      "usage_count": 5
    }
  }
}
```

---

## 相關端點

- [查詢使用情況](./查詢使用情況.md)
- [獲取特定國定假日](./獲取特定國定假日.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



