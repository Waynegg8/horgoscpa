# 查詢使用情況

**端點：** `GET /api/v1/settings/service-frequency-types/:id/usage`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

查詢特定服務週期類型的使用情況，包含使用次數、使用的客戶服務等。

---

## 請求

### 路徑參數

- `id` (必填, integer): 週期類型 ID

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "data": {
    "frequency_type_id": 1,
    "code": "monthly",
    "name": "月結",
    "is_in_use": true,
    "statistics": {
      "total_usage_count": 45,
      "total_clients": 30,
      "client_services": [
        {
          "client_id": 101,
          "client_name": "客戶A",
          "service_name": "記帳服務",
          "execution_day": 5,
          "created_at": "2025-01-15T00:00:00Z"
        },
        {
          "client_id": 102,
          "client_name": "客戶B",
          "service_name": "稅務申報",
          "execution_day": 10,
          "created_at": "2025-02-20T00:00:00Z"
        }
      ]
    }
  }
}
```

---

### 未使用的週期類型

```json
{
  "success": true,
  "data": {
    "frequency_type_id": 6,
    "code": "half_yearly",
    "name": "半年結",
    "is_in_use": false,
    "statistics": {
      "total_usage_count": 0,
      "total_clients": 0,
      "client_services": []
    }
  }
}
```

---

### 錯誤回應

**404 Not Found：**
```json
{
  "success": false,
  "error": {
    "code": "FREQUENCY_TYPE_NOT_FOUND",
    "message": "找不到指定的週期類型"
  }
}
```

---

## 使用場景

### 場景：停用前檢查

管理員想停用某週期類型前，先查看使用情況：

```typescript
async function deactivateFrequencyTypeWithCheck(typeId: number) {
  // 1. 查詢使用情況
  const usage = await api.get(`/api/v1/settings/service-frequency-types/${typeId}/usage`);
  
  if (usage.data.is_in_use) {
    // 2. 顯示警告
    const confirmed = await showConfirmDialog(
      `該週期類型已被 ${usage.data.statistics.total_clients} 個客戶使用，` +
      `共 ${usage.data.statistics.total_usage_count} 個服務，` +
      `確定要停用嗎？`
    );
    
    if (!confirmed) return;
  }
  
  // 3. 執行停用
  await api.delete(`/api/v1/settings/service-frequency-types/${typeId}`);
}
```

---

## 相關端點

- [停用週期類型](./停用週期類型.md)
- [獲取特定週期類型](./獲取特定週期類型.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



**端點：** `GET /api/v1/settings/service-frequency-types/:id/usage`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

查詢特定服務週期類型的使用情況，包含使用次數、使用的客戶服務等。

---

## 請求

### 路徑參數

- `id` (必填, integer): 週期類型 ID

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "data": {
    "frequency_type_id": 1,
    "code": "monthly",
    "name": "月結",
    "is_in_use": true,
    "statistics": {
      "total_usage_count": 45,
      "total_clients": 30,
      "client_services": [
        {
          "client_id": 101,
          "client_name": "客戶A",
          "service_name": "記帳服務",
          "execution_day": 5,
          "created_at": "2025-01-15T00:00:00Z"
        },
        {
          "client_id": 102,
          "client_name": "客戶B",
          "service_name": "稅務申報",
          "execution_day": 10,
          "created_at": "2025-02-20T00:00:00Z"
        }
      ]
    }
  }
}
```

---

### 未使用的週期類型

```json
{
  "success": true,
  "data": {
    "frequency_type_id": 6,
    "code": "half_yearly",
    "name": "半年結",
    "is_in_use": false,
    "statistics": {
      "total_usage_count": 0,
      "total_clients": 0,
      "client_services": []
    }
  }
}
```

---

### 錯誤回應

**404 Not Found：**
```json
{
  "success": false,
  "error": {
    "code": "FREQUENCY_TYPE_NOT_FOUND",
    "message": "找不到指定的週期類型"
  }
}
```

---

## 使用場景

### 場景：停用前檢查

管理員想停用某週期類型前，先查看使用情況：

```typescript
async function deactivateFrequencyTypeWithCheck(typeId: number) {
  // 1. 查詢使用情況
  const usage = await api.get(`/api/v1/settings/service-frequency-types/${typeId}/usage`);
  
  if (usage.data.is_in_use) {
    // 2. 顯示警告
    const confirmed = await showConfirmDialog(
      `該週期類型已被 ${usage.data.statistics.total_clients} 個客戶使用，` +
      `共 ${usage.data.statistics.total_usage_count} 個服務，` +
      `確定要停用嗎？`
    );
    
    if (!confirmed) return;
  }
  
  // 3. 執行停用
  await api.delete(`/api/v1/settings/service-frequency-types/${typeId}`);
}
```

---

## 相關端點

- [停用週期類型](./停用週期類型.md)
- [獲取特定週期類型](./獲取特定週期類型.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



