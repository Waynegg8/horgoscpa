# 恢復法定預設值

**端點：** `POST /api/v1/settings/overtime-rates/reset-defaults`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

將所有加班費率恢復為台灣勞基法規定的法定預設值。會將現有費率標記為歷史，並插入新的法定費率。

---

## 請求

無需參數。

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "message": "已恢復為法定預設值",
  "data": {
    "deactivated_count": 5,
    "created_count": 10,
    "rates": [
      {
        "work_day_type": "weekday",
        "hour_range": "9-10H",
        "rate_multiplier": 1.34
      },
      {
        "work_day_type": "weekday",
        "hour_range": "11-12H",
        "rate_multiplier": 1.67
      },
      {
        "work_day_type": "rest_day",
        "hour_range": "1-2H",
        "rate_multiplier": 1.34
      },
      {
        "work_day_type": "rest_day",
        "hour_range": "3-8H",
        "rate_multiplier": 1.67
      },
      {
        "work_day_type": "rest_day",
        "hour_range": "9-12H",
        "rate_multiplier": 2.67
      },
      {
        "work_day_type": "national_holiday",
        "hour_range": "1-8H",
        "rate_multiplier": 1.0
      },
      {
        "work_day_type": "national_holiday",
        "hour_range": "9-10H",
        "rate_multiplier": 1.34
      },
      {
        "work_day_type": "national_holiday",
        "hour_range": "11-12H",
        "rate_multiplier": 1.67
      },
      {
        "work_day_type": "holiday",
        "hour_range": "1-8H",
        "rate_multiplier": 1.0,
        "requires_compensatory_leave": true
      },
      {
        "work_day_type": "holiday",
        "hour_range": "9-12H",
        "rate_multiplier": 2.0,
        "requires_compensatory_leave": true
      }
    ]
  }
}
```

---

## 操作邏輯

```typescript
async function resetToDefaults() {
  // 1. 將所有現有費率標記為歷史
  await db.run(`
    UPDATE OvertimeRates SET is_active = FALSE
  `);
  
  // 2. 插入法定預設費率（10條）
  const defaultRates = [
    // 平日加班
    { work_day_type: 'weekday', hour_range_start: 9, hour_range_end: 10, rate_multiplier: 1.34, ... },
    { work_day_type: 'weekday', hour_range_start: 11, hour_range_end: 12, rate_multiplier: 1.67, ... },
    
    // 休息日加班
    { work_day_type: 'rest_day', hour_range_start: 1, hour_range_end: 2, rate_multiplier: 1.34, ... },
    { work_day_type: 'rest_day', hour_range_start: 3, hour_range_end: 8, rate_multiplier: 1.67, ... },
    { work_day_type: 'rest_day', hour_range_start: 9, hour_range_end: 12, rate_multiplier: 2.67, ... },
    
    // 國定假日加班
    { work_day_type: 'national_holiday', hour_range_start: 1, hour_range_end: 8, rate_multiplier: 1.0, ... },
    { work_day_type: 'national_holiday', hour_range_start: 9, hour_range_end: 10, rate_multiplier: 1.34, ... },
    { work_day_type: 'national_holiday', hour_range_start: 11, hour_range_end: 12, rate_multiplier: 1.67, ... },
    
    // 例假日加班
    { work_day_type: 'holiday', hour_range_start: 1, hour_range_end: 8, rate_multiplier: 1.0, requires_compensatory_leave: true, ... },
    { work_day_type: 'holiday', hour_range_start: 9, hour_range_end: 12, rate_multiplier: 2.0, requires_compensatory_leave: true, ... }
  ];
  
  for (const rate of defaultRates) {
    await db.run(`INSERT INTO OvertimeRates (...) VALUES (...)`, rate);
  }
}
```

---

## 使用場景

### 場景 1：初始設定

新事務所首次設定系統時，恢復為法定預設值：
```
初始狀態：無任何費率
執行恢復：插入10條法定費率
結果：系統可正常計算加班費
```

---

### 場景 2：費率設定錯誤

管理員設定錯誤後，快速恢復為法定值：
```
錯誤設定：平日加班費率設為3.0（錯誤）
執行恢復：標記錯誤費率為歷史，插入正確法定費率
結果：系統恢復正常
```

---

### 場景 3：法規更新

勞基法修訂後，批量更新所有費率：
```
修訂前：使用舊法定費率
執行恢復：標記舊費率為歷史，插入新法定費率
結果：符合最新法規
```

---

## 注意事項

### ⚠️ 重要警告

執行此操作前應：
1. 確認所有員工的工時記錄已結算
2. 備份現有費率設定
3. 通知相關人員費率將變更

### 影響範圍

- ✅ 新的工時記錄使用新費率
- ✅ 歷史記錄保留舊費率資訊
- ⚠️ 未結算的工時可能受影響

---

## 相關端點

- [獲取加班費率列表](./獲取加班費率列表.md)
- [標記為歷史費率](./標記為歷史費率.md)
- [API 概覽](./_概覽.md)

---

## 勞基法對照

詳見：[2.3 加班費率 - 勞基法對照表](../../../../技術規格/業務規則/2.3-加班費率-勞基法對照表.md)

---

**最後更新：** 2025年10月27日



**端點：** `POST /api/v1/settings/overtime-rates/reset-defaults`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

將所有加班費率恢復為台灣勞基法規定的法定預設值。會將現有費率標記為歷史，並插入新的法定費率。

---

## 請求

無需參數。

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "message": "已恢復為法定預設值",
  "data": {
    "deactivated_count": 5,
    "created_count": 10,
    "rates": [
      {
        "work_day_type": "weekday",
        "hour_range": "9-10H",
        "rate_multiplier": 1.34
      },
      {
        "work_day_type": "weekday",
        "hour_range": "11-12H",
        "rate_multiplier": 1.67
      },
      {
        "work_day_type": "rest_day",
        "hour_range": "1-2H",
        "rate_multiplier": 1.34
      },
      {
        "work_day_type": "rest_day",
        "hour_range": "3-8H",
        "rate_multiplier": 1.67
      },
      {
        "work_day_type": "rest_day",
        "hour_range": "9-12H",
        "rate_multiplier": 2.67
      },
      {
        "work_day_type": "national_holiday",
        "hour_range": "1-8H",
        "rate_multiplier": 1.0
      },
      {
        "work_day_type": "national_holiday",
        "hour_range": "9-10H",
        "rate_multiplier": 1.34
      },
      {
        "work_day_type": "national_holiday",
        "hour_range": "11-12H",
        "rate_multiplier": 1.67
      },
      {
        "work_day_type": "holiday",
        "hour_range": "1-8H",
        "rate_multiplier": 1.0,
        "requires_compensatory_leave": true
      },
      {
        "work_day_type": "holiday",
        "hour_range": "9-12H",
        "rate_multiplier": 2.0,
        "requires_compensatory_leave": true
      }
    ]
  }
}
```

---

## 操作邏輯

```typescript
async function resetToDefaults() {
  // 1. 將所有現有費率標記為歷史
  await db.run(`
    UPDATE OvertimeRates SET is_active = FALSE
  `);
  
  // 2. 插入法定預設費率（10條）
  const defaultRates = [
    // 平日加班
    { work_day_type: 'weekday', hour_range_start: 9, hour_range_end: 10, rate_multiplier: 1.34, ... },
    { work_day_type: 'weekday', hour_range_start: 11, hour_range_end: 12, rate_multiplier: 1.67, ... },
    
    // 休息日加班
    { work_day_type: 'rest_day', hour_range_start: 1, hour_range_end: 2, rate_multiplier: 1.34, ... },
    { work_day_type: 'rest_day', hour_range_start: 3, hour_range_end: 8, rate_multiplier: 1.67, ... },
    { work_day_type: 'rest_day', hour_range_start: 9, hour_range_end: 12, rate_multiplier: 2.67, ... },
    
    // 國定假日加班
    { work_day_type: 'national_holiday', hour_range_start: 1, hour_range_end: 8, rate_multiplier: 1.0, ... },
    { work_day_type: 'national_holiday', hour_range_start: 9, hour_range_end: 10, rate_multiplier: 1.34, ... },
    { work_day_type: 'national_holiday', hour_range_start: 11, hour_range_end: 12, rate_multiplier: 1.67, ... },
    
    // 例假日加班
    { work_day_type: 'holiday', hour_range_start: 1, hour_range_end: 8, rate_multiplier: 1.0, requires_compensatory_leave: true, ... },
    { work_day_type: 'holiday', hour_range_start: 9, hour_range_end: 12, rate_multiplier: 2.0, requires_compensatory_leave: true, ... }
  ];
  
  for (const rate of defaultRates) {
    await db.run(`INSERT INTO OvertimeRates (...) VALUES (...)`, rate);
  }
}
```

---

## 使用場景

### 場景 1：初始設定

新事務所首次設定系統時，恢復為法定預設值：
```
初始狀態：無任何費率
執行恢復：插入10條法定費率
結果：系統可正常計算加班費
```

---

### 場景 2：費率設定錯誤

管理員設定錯誤後，快速恢復為法定值：
```
錯誤設定：平日加班費率設為3.0（錯誤）
執行恢復：標記錯誤費率為歷史，插入正確法定費率
結果：系統恢復正常
```

---

### 場景 3：法規更新

勞基法修訂後，批量更新所有費率：
```
修訂前：使用舊法定費率
執行恢復：標記舊費率為歷史，插入新法定費率
結果：符合最新法規
```

---

## 注意事項

### ⚠️ 重要警告

執行此操作前應：
1. 確認所有員工的工時記錄已結算
2. 備份現有費率設定
3. 通知相關人員費率將變更

### 影響範圍

- ✅ 新的工時記錄使用新費率
- ✅ 歷史記錄保留舊費率資訊
- ⚠️ 未結算的工時可能受影響

---

## 相關端點

- [獲取加班費率列表](./獲取加班費率列表.md)
- [標記為歷史費率](./標記為歷史費率.md)
- [API 概覽](./_概覽.md)

---

## 勞基法對照

詳見：[2.3 加班費率 - 勞基法對照表](../../../../技術規格/業務規則/2.3-加班費率-勞基法對照表.md)

---

**最後更新：** 2025年10月27日



