# 查詢使用情況

**端點：** `GET /api/v1/settings/overtime-rates/:id/usage`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

查詢特定加班費率的使用情況，包含使用次數、總時數、使用者統計等。

---

## 請求

### 路徑參數

- `id` (必填, integer): 費率 ID

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "data": {
    "rate_id": 1,
    "work_day_type": "weekday",
    "hour_range": "9-10H",
    "rate_multiplier": 1.34,
    "is_in_use": true,
    "statistics": {
      "total_usage_count": 250,
      "total_hours": 500,
      "total_users": 60,
      "total_overtime_pay": 670.0,
      "recent_usage": [
        {
          "log_id": 8001,
          "user_id": 123,
          "user_name": "王小明",
          "work_date": "2025-10-25",
          "hours": 2.0,
          "overtime_pay": 2.68,
          "created_at": "2025-10-26T09:00:00Z"
        }
      ],
      "monthly_trend": [
        {
          "year_month": "2025-08",
          "usage_count": 80,
          "total_hours": 160
        },
        {
          "year_month": "2025-09",
          "usage_count": 85,
          "total_hours": 170
        },
        {
          "year_month": "2025-10",
          "usage_count": 85,
          "total_hours": 170
        }
      ]
    }
  }
}
```

---

### 未使用的費率

```json
{
  "success": true,
  "data": {
    "rate_id": 10,
    "is_in_use": false,
    "statistics": {
      "total_usage_count": 0,
      "total_hours": 0,
      "total_users": 0,
      "recent_usage": [],
      "monthly_trend": []
    }
  }
}
```

---

### 錯誤回應

**404 Not Found：**
```json
{
  "success": false,
  "error": {
    "code": "OVERTIME_RATE_NOT_FOUND",
    "message": "找不到指定的加班費率"
  }
}
```

---

## 使用場景

### 場景：標記為歷史前檢查

```typescript
async function deactivateRateWithCheck(rateId: number) {
  // 1. 查詢使用情況
  const usage = await api.get(`/api/v1/settings/overtime-rates/${rateId}/usage`);
  
  if (usage.data.is_in_use) {
    // 2. 顯示警告
    const confirmed = await showConfirmDialog(
      `該費率已被 ${usage.data.statistics.total_users} 位員工使用，` +
      `共 ${usage.data.statistics.total_usage_count} 筆記錄，` +
      `總加班費倍數 ${usage.data.statistics.total_overtime_pay.toFixed(2)}，` +
      `確定要標記為歷史嗎？`
    );
    
    if (!confirmed) return;
  }
  
  // 3. 執行標記
  await api.delete(`/api/v1/settings/overtime-rates/${rateId}`);
}
```

---

## 相關端點

- [標記為歷史費率](./標記為歷史費率.md)
- [獲取特定費率](./獲取特定費率.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



**端點：** `GET /api/v1/settings/overtime-rates/:id/usage`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

查詢特定加班費率的使用情況，包含使用次數、總時數、使用者統計等。

---

## 請求

### 路徑參數

- `id` (必填, integer): 費率 ID

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "data": {
    "rate_id": 1,
    "work_day_type": "weekday",
    "hour_range": "9-10H",
    "rate_multiplier": 1.34,
    "is_in_use": true,
    "statistics": {
      "total_usage_count": 250,
      "total_hours": 500,
      "total_users": 60,
      "total_overtime_pay": 670.0,
      "recent_usage": [
        {
          "log_id": 8001,
          "user_id": 123,
          "user_name": "王小明",
          "work_date": "2025-10-25",
          "hours": 2.0,
          "overtime_pay": 2.68,
          "created_at": "2025-10-26T09:00:00Z"
        }
      ],
      "monthly_trend": [
        {
          "year_month": "2025-08",
          "usage_count": 80,
          "total_hours": 160
        },
        {
          "year_month": "2025-09",
          "usage_count": 85,
          "total_hours": 170
        },
        {
          "year_month": "2025-10",
          "usage_count": 85,
          "total_hours": 170
        }
      ]
    }
  }
}
```

---

### 未使用的費率

```json
{
  "success": true,
  "data": {
    "rate_id": 10,
    "is_in_use": false,
    "statistics": {
      "total_usage_count": 0,
      "total_hours": 0,
      "total_users": 0,
      "recent_usage": [],
      "monthly_trend": []
    }
  }
}
```

---

### 錯誤回應

**404 Not Found：**
```json
{
  "success": false,
  "error": {
    "code": "OVERTIME_RATE_NOT_FOUND",
    "message": "找不到指定的加班費率"
  }
}
```

---

## 使用場景

### 場景：標記為歷史前檢查

```typescript
async function deactivateRateWithCheck(rateId: number) {
  // 1. 查詢使用情況
  const usage = await api.get(`/api/v1/settings/overtime-rates/${rateId}/usage`);
  
  if (usage.data.is_in_use) {
    // 2. 顯示警告
    const confirmed = await showConfirmDialog(
      `該費率已被 ${usage.data.statistics.total_users} 位員工使用，` +
      `共 ${usage.data.statistics.total_usage_count} 筆記錄，` +
      `總加班費倍數 ${usage.data.statistics.total_overtime_pay.toFixed(2)}，` +
      `確定要標記為歷史嗎？`
    );
    
    if (!confirmed) return;
  }
  
  // 3. 執行標記
  await api.delete(`/api/v1/settings/overtime-rates/${rateId}`);
}
```

---

## 相關端點

- [標記為歷史費率](./標記為歷史費率.md)
- [獲取特定費率](./獲取特定費率.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



