# 新增任務模板

**端點：** `POST /api/v1/task-templates`  
**權限：** 管理員

---

## 請求

### Body
```json
{
  "name": "記帳標準流程（雙月）",
  "service_template_id": 3,
  "description": "雙月記帳服務的標準作業流程",
  "stages": [
    {
      "stage_name": "資料收集與核對",
      "estimated_days": 3,
      "description": "收集客戶提供的原始憑證並核對",
      "depends_on": null
    },
    {
      "stage_name": "營業稅過帳",
      "estimated_days": 2,
      "description": "處理營業稅相關帳務",
      "depends_on": 0
    }
  ]
}
```

### 欄位說明
| 欄位 | 類型 | 必填 | 說明 |
|-----|------|------|------|
| `name` | string | ✅ | 模板名稱 |
| `service_template_id` | integer | ❌ | 關聯服務ID |
| `description` | string | ❌ | 模板說明 |
| `stages` | array | ❌ | 階段列表 |
| `stages[].stage_name` | string | ✅ | 階段名稱 |
| `stages[].estimated_days` | integer | ✅ | 預計天數 |
| `stages[].description` | string | ❌ | 階段說明 |
| `stages[].depends_on` | integer | ❌ | 依賴階段索引（0-based）|

---

## 成功回應

**HTTP 狀態碼：** 201

```json
{
  "success": true,
  "data": {
    "task_template_id": 15,
    "message": "任務模板新增成功"
  }
}
```

---

## 錯誤回應

### 循環依賴
**HTTP 狀態碼：** 422
```json
{
  "success": false,
  "error": {
    "code": "CIRCULAR_DEPENDENCY",
    "message": "檢測到循環依賴"
  }
}
```

### 依賴順序錯誤
**HTTP 狀態碼：** 422
```json
{
  "success": false,
  "error": {
    "code": "INVALID_DEPENDENCY_ORDER",
    "message": "依賴階段必須在當前階段之前"
  }
}
```





