# 同步預設模板到員工

**端點：** `POST /api/v1/settings/module-permissions/sync`  
**權限：** 管理員

---

## 請求

### Body
```json
{
  "user_ids": [123, 456, 789]
}
```

### 驗證規則
- `user_ids`: 必填，整數陣列
- 至少包含 1 個員工 ID

---

## 成功回應

**HTTP 狀態碼：** 200

```json
{
  "success": true,
  "message": "已同步 3 位員工的權限",
  "data": {
    "synced_users": [123, 456, 789],
    "synced_count": 3
  }
}
```

---

## 業務邏輯

### 步驟
1. 驗證所有 `user_ids` 是否存在
2. 刪除這些員工的所有個別權限設定
3. 員工將自動使用預設模板

### 實際操作
```sql
DELETE FROM ModulePermissions 
WHERE user_id IN (123, 456, 789)
```

### 效果
- 清除員工的自訂權限
- 恢復為預設模板
- 員工的 `is_customized` 狀態變為 `false`

---

## 範例程式碼

```typescript
app.post('/api/v1/settings/module-permissions/sync', adminOnly, async (c) => {
  const { user_ids } = await c.req.json();
  
  if (!user_ids || user_ids.length === 0) {
    return c.json(errorResponse('INVALID_INPUT', '至少需要一個員工ID'), 422);
  }
  
  // 刪除這些員工的個別設定
  const placeholders = user_ids.map(() => '?').join(',');
  await c.env.DB.prepare(`
    DELETE FROM ModulePermissions 
    WHERE user_id IN (${placeholders})
  `).bind(...user_ids).run();
  
  return c.json(successResponse({
    message: `已同步 ${user_ids.length} 位員工的權限`,
    synced_users: user_ids,
    synced_count: user_ids.length
  }));
});
```

---

## 前端使用範例

```javascript
async function syncPermissions(userIds) {
  const response = await fetch('/api/v1/settings/module-permissions/sync', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    credentials: 'include',
    body: JSON.stringify({ user_ids: userIds })
  });
  
  const result = await response.json();
  alert(result.message);  // "已同步 3 位員工的權限"
}
```


