# 獲取所有員工的權限狀態列表

**端點：** `GET /api/v1/settings/module-permissions/users`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

獲取所有員工的權限狀態，標示哪些員工已個別調整、哪些使用預設模板。

---

## 請求

無需參數。

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "data": [
    {
      "user_id": 123,
      "name": "王小明",
      "is_customized": false
    },
    {
      "user_id": 456,
      "name": "李小華",
      "is_customized": true
    },
    {
      "user_id": 789,
      "name": "張小美",
      "is_customized": false
    }
  ]
}
```

**欄位說明：**
- `user_id`: 員工 ID
- `name`: 員工姓名
- `is_customized`: 是否已個別調整
  - `true` = 已個別調整
  - `false` = 使用預設模板

---

### 錯誤回應

**403 Forbidden - 無權限：**
```json
{
  "success": false,
  "error": {
    "code": "ADMIN_PERMISSION_REQUIRED",
    "message": "需要管理員權限"
  }
}
```

---

## 後端邏輯

```typescript
async function getUserPermissionsList() {
  // 查詢所有員工，並檢查是否有個別權限設定
  const users = await db.all(`
    SELECT 
      u.user_id,
      u.name,
      CASE 
        WHEN EXISTS (
          SELECT 1 FROM ModulePermissions 
          WHERE user_id = u.user_id
        )
        THEN 1 
        ELSE 0 
      END AS is_customized
    FROM Users u
    WHERE u.role = 'employee'
    ORDER BY u.name
  `);
  
  return users;
}
```

---

## 使用場景

### 場景：更新預設模板時顯示同步對話框

前端呼叫此 API 獲取員工列表，然後：
- 預設勾選 `is_customized = false` 的員工
- 預設不勾選 `is_customized = true` 的員工

---

## 相關端點

- [獲取特定員工的權限](./獲取特定員工的權限.md)
- [同步預設模板到員工](./同步預設模板到員工.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



**端點：** `GET /api/v1/settings/module-permissions/users`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

獲取所有員工的權限狀態，標示哪些員工已個別調整、哪些使用預設模板。

---

## 請求

無需參數。

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "data": [
    {
      "user_id": 123,
      "name": "王小明",
      "is_customized": false
    },
    {
      "user_id": 456,
      "name": "李小華",
      "is_customized": true
    },
    {
      "user_id": 789,
      "name": "張小美",
      "is_customized": false
    }
  ]
}
```

**欄位說明：**
- `user_id`: 員工 ID
- `name`: 員工姓名
- `is_customized`: 是否已個別調整
  - `true` = 已個別調整
  - `false` = 使用預設模板

---

### 錯誤回應

**403 Forbidden - 無權限：**
```json
{
  "success": false,
  "error": {
    "code": "ADMIN_PERMISSION_REQUIRED",
    "message": "需要管理員權限"
  }
}
```

---

## 後端邏輯

```typescript
async function getUserPermissionsList() {
  // 查詢所有員工，並檢查是否有個別權限設定
  const users = await db.all(`
    SELECT 
      u.user_id,
      u.name,
      CASE 
        WHEN EXISTS (
          SELECT 1 FROM ModulePermissions 
          WHERE user_id = u.user_id
        )
        THEN 1 
        ELSE 0 
      END AS is_customized
    FROM Users u
    WHERE u.role = 'employee'
    ORDER BY u.name
  `);
  
  return users;
}
```

---

## 使用場景

### 場景：更新預設模板時顯示同步對話框

前端呼叫此 API 獲取員工列表，然後：
- 預設勾選 `is_customized = false` 的員工
- 預設不勾選 `is_customized = true` 的員工

---

## 相關端點

- [獲取特定員工的權限](./獲取特定員工的權限.md)
- [同步預設模板到員工](./同步預設模板到員工.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



