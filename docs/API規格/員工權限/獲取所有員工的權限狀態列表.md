# 獲取所有員工的權限狀態列表

**端點：** `GET /api/v1/settings/module-permissions/users`  
**權限：** 管理員

---

## 請求

### 查詢參數
無

---

## 成功回應

**HTTP 狀態碼：** 200

```json
{
  "success": true,
  "data": [
    {
      "user_id": 123,
      "name": "王小明",
      "is_customized": false
    },
    {
      "user_id": 456,
      "name": "李小華",
      "is_customized": true
    }
  ]
}
```

### 欄位說明
- `is_customized`: `true` = 員工有自訂權限，`false` = 使用預設模板

---

## 業務邏輯

### 步驟
1. 查詢所有非管理員的員工
2. 檢查是否有個別權限設定（JOIN `ModulePermissions`）
3. 返回員工列表及自訂狀態

### SQL 查詢
```sql
SELECT 
  u.user_id, 
  u.name,
  CASE WHEN COUNT(mp.id) > 0 THEN 1 ELSE 0 END as is_customized
FROM Users u
LEFT JOIN ModulePermissions mp ON u.user_id = mp.user_id
WHERE u.is_admin = 0
GROUP BY u.user_id, u.name
```

---

## 範例程式碼

```typescript
app.get('/api/v1/settings/module-permissions/users', adminOnly, async (c) => {
  const users = await c.env.DB.prepare(`
    SELECT 
      u.user_id, 
      u.name,
      CASE WHEN COUNT(mp.id) > 0 THEN 1 ELSE 0 END as is_customized
    FROM Users u
    LEFT JOIN ModulePermissions mp ON u.user_id = mp.user_id
    WHERE u.is_admin = 0
    GROUP BY u.user_id, u.name
  `).all();
  
  return c.json(successResponse(users.results));
});
```

---

## 前端使用範例

```javascript
async function fetchUserPermissionsList() {
  const response = await fetch('/api/v1/settings/module-permissions/users', {
    credentials: 'include'
  });
  const { data } = await response.json();
  
  // 渲染員工列表，標示哪些有自訂權限
  data.forEach(user => {
    console.log(`${user.name} - ${user.is_customized ? '自訂' : '預設'}`);
  });
}
```


