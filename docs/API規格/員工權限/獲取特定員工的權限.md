# 獲取特定員工的權限

**端點：** `GET /api/v1/settings/module-permissions/users/:user_id`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

獲取特定員工的權限設定，包含實際權限和預設模板權限，用於顯示差異標示。

---

## 請求

### 路徑參數

- `user_id` (必填, integer): 員工 ID

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "data": {
    "user_id": 123,
    "name": "王小明",
    "is_customized": true,
    "permissions": {
      "dashboard": true,
      "reports": true,
      "tasks": false
    },
    "default_permissions": {
      "dashboard": true,
      "reports": false,
      "tasks": false
    }
  }
}
```

**欄位說明：**
- `permissions`: 員工的實際權限（合併預設+個別調整）
- `default_permissions`: 預設模板的權限
- `is_customized`: 是否已個別調整
- 前端可比對兩者差異，顯示 [預設] 或 [已調整] 標籤

---

### 錯誤回應

**404 Not Found - 員工不存在：**
```json
{
  "success": false,
  "error": {
    "code": "USER_NOT_FOUND",
    "message": "找不到員工"
  }
}
```

**403 Forbidden - 無權限：**
```json
{
  "success": false,
  "error": {
    "code": "ADMIN_PERMISSION_REQUIRED",
    "message": "需要管理員權限"
  }
}
```

---

## 後端邏輯

```typescript
async function getUserPermissions(userId: number) {
  // 1. 獲取員工資訊
  const user = await getUserById(userId);
  if (!user) {
    throw new Error('USER_NOT_FOUND');
  }
  
  // 2. 獲取預設模板
  const defaultPerms = await getDefaultPermissions();
  
  // 3. 獲取員工的個別設定
  const customPerms = await db.all(`
    SELECT module_name, is_enabled
    FROM ModulePermissions
    WHERE user_id = ?
  `, [userId]);
  
  // 4. 合併權限（個別設定覆蓋預設）
  const permissions = { ...defaultPerms };
  customPerms.forEach(p => {
    permissions[p.module_name] = p.is_enabled;
  });
  
  return {
    user_id: userId,
    name: user.name,
    is_customized: customPerms.length > 0,
    permissions,
    default_permissions: defaultPerms
  };
}
```

---

## 使用場景

### 場景：個別調整頁面顯示差異

前端使用 `permissions` 和 `default_permissions` 比對：
- 值相同 → 顯示 [預設] 標籤（灰色）
- 值不同 → 顯示 [已調整] 標籤（藍色）

---

## 相關端點

- [更新特定員工的權限](./更新特定員工的權限.md)
- [恢復員工為預設模板](./恢復員工為預設模板.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



**端點：** `GET /api/v1/settings/module-permissions/users/:user_id`  
**權限：** 管理員  
**最後更新：** 2025年10月27日

---

## 概述

獲取特定員工的權限設定，包含實際權限和預設模板權限，用於顯示差異標示。

---

## 請求

### 路徑參數

- `user_id` (必填, integer): 員工 ID

---

## 回應

### 成功回應（HTTP 200）

```json
{
  "success": true,
  "data": {
    "user_id": 123,
    "name": "王小明",
    "is_customized": true,
    "permissions": {
      "dashboard": true,
      "reports": true,
      "tasks": false
    },
    "default_permissions": {
      "dashboard": true,
      "reports": false,
      "tasks": false
    }
  }
}
```

**欄位說明：**
- `permissions`: 員工的實際權限（合併預設+個別調整）
- `default_permissions`: 預設模板的權限
- `is_customized`: 是否已個別調整
- 前端可比對兩者差異，顯示 [預設] 或 [已調整] 標籤

---

### 錯誤回應

**404 Not Found - 員工不存在：**
```json
{
  "success": false,
  "error": {
    "code": "USER_NOT_FOUND",
    "message": "找不到員工"
  }
}
```

**403 Forbidden - 無權限：**
```json
{
  "success": false,
  "error": {
    "code": "ADMIN_PERMISSION_REQUIRED",
    "message": "需要管理員權限"
  }
}
```

---

## 後端邏輯

```typescript
async function getUserPermissions(userId: number) {
  // 1. 獲取員工資訊
  const user = await getUserById(userId);
  if (!user) {
    throw new Error('USER_NOT_FOUND');
  }
  
  // 2. 獲取預設模板
  const defaultPerms = await getDefaultPermissions();
  
  // 3. 獲取員工的個別設定
  const customPerms = await db.all(`
    SELECT module_name, is_enabled
    FROM ModulePermissions
    WHERE user_id = ?
  `, [userId]);
  
  // 4. 合併權限（個別設定覆蓋預設）
  const permissions = { ...defaultPerms };
  customPerms.forEach(p => {
    permissions[p.module_name] = p.is_enabled;
  });
  
  return {
    user_id: userId,
    name: user.name,
    is_customized: customPerms.length > 0,
    permissions,
    default_permissions: defaultPerms
  };
}
```

---

## 使用場景

### 場景：個別調整頁面顯示差異

前端使用 `permissions` 和 `default_permissions` 比對：
- 值相同 → 顯示 [預設] 標籤（灰色）
- 值不同 → 顯示 [已調整] 標籤（藍色）

---

## 相關端點

- [更新特定員工的權限](./更新特定員工的權限.md)
- [恢復員工為預設模板](./恢復員工為預設模板.md)
- [API 概覽](./_概覽.md)

---

**最後更新：** 2025年10月27日



