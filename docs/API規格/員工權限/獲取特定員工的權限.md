# 獲取特定員工的權限

**端點：** `GET /api/v1/settings/module-permissions/users/:user_id`  
**權限：** 管理員

---

## 請求

### 路徑參數
- `user_id`: 員工ID（整數）

---

## 成功回應

**HTTP 狀態碼：** 200

```json
{
  "success": true,
  "data": {
    "user_id": 123,
    "name": "王小明",
    "is_customized": true,
    "permissions": {
      "dashboard": true,
      "reports": true,
      "tasks": false
    },
    "default_permissions": {
      "dashboard": true,
      "reports": false,
      "tasks": false
    }
  }
}
```

### 欄位說明
- `permissions`: 員工實際權限（自訂 + 預設合併）
- `default_permissions`: 預設模板（用於前端差異比較）
- `is_customized`: 是否有自訂權限

---

## 業務邏輯

### 步驟
1. 查詢預設權限模板
2. 查詢員工個別權限設定
3. 合併權限（員工設定覆蓋預設）
4. 同時返回兩者供前端比較

### 合併邏輯
```typescript
const permissions = { ...defaultPerms };
userPerms.forEach(perm => {
  permissions[perm.module_name] = perm.is_enabled;
});
```

---

## 範例程式碼

```typescript
app.get('/api/v1/settings/module-permissions/users/:user_id', adminOnly, async (c) => {
  const userId = parseInt(c.req.param('user_id'));
  
  // 1. 獲取預設模板
  const defaultPerms = await getDefaultPermissions(c.env.DB);
  
  // 2. 獲取員工個別設定
  const userPerms = await c.env.DB.prepare(`
    SELECT module_name, is_enabled 
    FROM ModulePermissions 
    WHERE user_id = ?
  `).bind(userId).all();
  
  // 3. 合併權限
  const permissions = { ...defaultPerms };
  userPerms.results.forEach(row => {
    permissions[row.module_name] = row.is_enabled === 1;
  });
  
  // 4. 查詢員工名稱
  const user = await c.env.DB.prepare(
    'SELECT name FROM Users WHERE user_id = ?'
  ).bind(userId).first();
  
  return c.json(successResponse({
    user_id: userId,
    name: user.name,
    is_customized: userPerms.results.length > 0,
    permissions,
    default_permissions: defaultPerms
  }));
});
```

---

## 前端使用範例

```javascript
async function fetchUserPermissions(userId) {
  const response = await fetch(`/api/v1/settings/module-permissions/users/${userId}`, {
    credentials: 'include'
  });
  const { data } = await response.json();
  
  // 比較差異，標示被修改的權限
  Object.keys(data.permissions).forEach(module => {
    if (data.permissions[module] !== data.default_permissions[module]) {
      console.log(`${module} 已自訂`);
    }
  });
}
```


