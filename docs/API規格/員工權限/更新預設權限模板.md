# 更新預設權限模板

**端點：** `PUT /api/v1/settings/module-permissions/default`  
**權限：** 管理員

---

## 請求

### Body
```json
{
  "permissions": {
    "dashboard": true,
    "reports": true,
    "tasks": false
  }
}
```

### 驗證規則
- `permissions`: 必填，物件
- 鍵名：必須是有效的模塊代號
- 值：必須是 `boolean`

---

## 成功回應

**HTTP 狀態碼：** 200

```json
{
  "success": true,
  "message": "預設權限模板已更新"
}
```

---

## 業務邏輯

### 步驟
1. 驗證所有模塊代號是否有效
2. 逐一更新 `ModulePermissions` 表
3. 使用 `UPSERT`（INSERT ... ON CONFLICT DO UPDATE）
4. 只更新預設模板（`user_id = NULL`）

### 注意事項
- **不影響已自訂權限的員工**
- **只影響使用預設模板的員工**

---

## 範例程式碼

```typescript
app.put('/api/v1/settings/module-permissions/default', adminOnly, async (c) => {
  const { permissions } = await c.req.json();
  
  for (const [moduleName, isEnabled] of Object.entries(permissions)) {
    await c.env.DB.prepare(`
      INSERT INTO ModulePermissions (user_id, module_name, is_enabled, updated_at)
      VALUES (NULL, ?, ?, datetime('now'))
      ON CONFLICT(user_id, module_name) 
      DO UPDATE SET 
        is_enabled = ?, 
        updated_at = datetime('now')
    `).bind(moduleName, isEnabled ? 1 : 0, isEnabled ? 1 : 0).run();
  }
  
  return c.json(successResponse({ message: '預設權限模板已更新' }));
});
```

---

## 前端使用範例

```javascript
async function updateDefaultPermissions(newPermissions) {
  const response = await fetch('/api/v1/settings/module-permissions/default', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    credentials: 'include',
    body: JSON.stringify({ permissions: newPermissions })
  });
  
  if (response.ok) {
    alert('預設權限模板已更新');
  }
}
```


