# 專案管理系統整合說明

**版本**: 1.0  
**最後更新**: 2025-10-26  
**狀態**: ✅ 已整合到統一任務系統

---

## 📋 整合策略

### 核心理念

專案管理功能已**完全整合到統一任務系統**（`tasks.html`），作為任務的一個分類（`category = 'project'`），而非獨立系統。

---

## 🏗️ 整合架構

```
統一任務系統 (tasks.html)
├── 全部任務 (包含專案任務)
├── 我的任務 (包含我的專案)
├── 週期任務
├── 工商登記
├── 財稅簽證
├── 客戶服務
└── 服務配置

專案任務透過以下方式查看：
✅ 在「全部任務」標籤中查看所有專案
✅ 在「我的任務」標籤中查看我負責的專案
✅ 使用搜尋功能查找特定專案
✅ 使用分類篩選器（如果實現）
```

---

## 🗄️ 資料表關係

### 專案相關資料表

#### projects 表（輔助資訊）
**遷移文件**: `006_project_management.sql`, `012_add_project_category.sql`

```sql
CREATE TABLE projects (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  client_name TEXT,
  category TEXT,                -- 專案分類（012新增）
  description TEXT,
  status TEXT DEFAULT 'planning',
  priority TEXT DEFAULT 'medium',
  start_date DATE,
  due_date DATE,
  completed_date DATE,
  budget DECIMAL(12,2),         -- 預算
  actual_cost DECIMAL(12,2),    -- 實際成本
  assigned_to TEXT,
  created_by TEXT,
  created_at DATETIME,
  updated_at DATETIME
);
```

**用途**: 
- ✅ 儲存專案的**額外管理資訊**（預算、成本等）
- ✅ 提供專案級別的統計和報表
- ⚠️ **非主要任務管理工具**

#### project_tasks 表（專案子任務）
```sql
CREATE TABLE project_tasks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  project_id INTEGER NOT NULL,
  task_name TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'pending',
  due_date DATE,
  assigned_to TEXT,
  completed_at DATETIME,
  estimated_hours DECIMAL(5,2),
  actual_hours DECIMAL(5,2),
  sort_order INTEGER DEFAULT 0,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);
```

**用途**:
- ✅ 儲存專案的細分子任務
- ⚠️ 與統一任務系統的關係：可選的補充資訊

### 與統一任務系統的關係

```
專案資訊（高階層）
  projects 表
  ├─ 專案名稱、預算、成本
  ├─ project_tasks（可選的細分任務）
  └─ project_checklist（檢查清單）
       ↓
       ↓ 整合為
       ↓
統一任務系統（執行層）
  tasks 表
  ├─ category = 'project'
  └─ multi_stage_tasks + task_stages
     （實際執行的多階段任務）
```

---

## 🔄 兩種使用方式

### 方式 1: 純統一任務系統 ⭐ 推薦

**適用**: 中小型專案、一般專案任務

**流程**:
```
1. 在 tasks.html 創建任務
2. 設定 category = 'project'
3. 使用多階段任務範本
4. 直接在統一任務系統中管理
```

**優點**:
- ✅ 簡單直觀
- ✅ 與其他任務統一管理
- ✅ 無需切換介面

**資料表使用**:
- ✅ tasks (category = 'project')
- ✅ multi_stage_tasks
- ✅ task_stages
- ❌ 不使用 projects 表

### 方式 2: 混合使用（統一任務 + 專案管理）

**適用**: 大型專案、需要預算/成本追蹤的專案

**流程**:
```
1. 在 projects 表創建專案記錄
   - 設定預算、開始日期等
   
2. 在 tasks.html 創建對應的執行任務
   - 設定 category = 'project'
   - 使用多階段任務管理進度
   
3. 用 projects 表追蹤預算和成本
4. 用統一任務系統追蹤執行進度
```

**優點**:
- ✅ 完整的專案資訊管理
- ✅ 預算與成本追蹤
- ✅ 靈活的報表分析

**資料表使用**:
- ✅ projects (專案資訊)
- ✅ tasks (category = 'project', 執行任務)
- ✅ multi_stage_tasks (執行進度)
- ⚠️ 需要手動關聯兩者（如 tasks.description 記錄 project_id）

---

## 💻 前端整合實現

### 在 tasks.html 中查看專案

#### 方法 1: 全部任務標籤
```javascript
// 顯示所有任務，包含專案
await fetchAllTasks();
// 專案任務會顯示 category = 'project' 的標記
```

#### 方法 2: 我的任務標籤
```javascript
// 顯示我負責的所有任務，包含專案
await fetchMyTasks();
// 自動包含我負責的專案任務
```

#### 方法 3: 搜尋功能
```javascript
// 搜尋特定專案名稱
searchTasks('併購案');
// 會找到所有相關的專案任務
```

#### 方法 4: 分類篩選（如果實現）
```html
<select id="categoryFilter">
  <option value="">全部分類</option>
  <option value="recurring">周期任務</option>
  <option value="business">工商登記</option>
  <option value="finance">財稅簽證</option>
  <option value="client_service">客戶服務</option>
  <option value="project">專案任務</option>  ← 專案分類
</select>
```

### 專案任務顯示樣式

```html
<!-- 專案任務卡片 -->
<div class="task-card project-task">
  <div class="task-header">
    <h3>ABC公司併購案</h3>
    <span class="status-badge in_progress">進行中</span>
    <span class="category-badge project">專案</span>  ← 專案標記
  </div>
  
  <!-- 多階段進度 -->
  <div class="progress-bar">
    <div class="progress-fill" style="width: 60%"></div>
    <span>階段 6/10 進行中</span>
  </div>
  
  <div class="task-meta">
    <span>負責：張紜蓁</span>
    <span>截止：2025-12-31</span>
    <!-- 如果有 projects 表記錄，可顯示額外資訊 -->
    <span>預算：$500,000</span>
  </div>
</div>
```

---

## 🔌 API 使用

### 查詢專案任務

```javascript
// 使用統一任務 API
GET /api/tasks/multi-stage?category=project

// 回應
{
  "success": true,
  "tasks": [
    {
      "id": 123,
      "title": "ABC公司併購案",
      "category": "project",
      "status": "in_progress",
      "total_stages": 10,
      "completed_stages": 6,
      ...
    }
  ]
}
```

### 查詢專案管理資訊（如果使用 projects 表）

```javascript
// 使用專案管理 API
GET /api/projects

// 回應
{
  "success": true,
  "projects": [
    {
      "id": 5,
      "name": "ABC公司併購案",
      "budget": 500000,
      "actual_cost": 320000,
      "category": "mergers",
      ...
    }
  ]
}
```

---

## 📊 使用建議

### 🟢 建議：使用統一任務系統

**適用**: 90% 的專案

**原因**:
- ✅ 簡單易用
- ✅ 與其他任務統一管理
- ✅ 已有完整的多階段任務功能
- ✅ 不需要維護額外的 projects 表

**做法**:
1. 在 tasks.html 創建任務
2. 選擇「專案」分類或設定 category = 'project'
3. 使用多階段任務範本
4. 在任務 description 中記錄預算等資訊（如需要）

### 🟡 可選：使用 projects 表

**適用**: 大型專案、需要詳細財務追蹤

**原因**:
- ✅ 專門的預算/成本欄位
- ✅ 可產生專案財務報表
- ✅ 可關聯多個 project_tasks

**做法**:
1. 在 projects 表創建專案記錄（透過 API 或資料庫）
2. 在 tasks.html 創建對應的執行任務
3. 在任務 description 或 notes 中記錄 project_id
4. 透過 API 查詢專案資訊

---

## 🚀 未來可能的整合方式

### 選項 1: 完全廢棄 projects 表

```
✅ 優點：系統更簡潔
❌ 缺點：無法追蹤預算/成本
```

**實施**: 
- 遷移所有 projects 資料到 tasks
- 刪除 projects 相關資料表
- 移除 projects.js 模塊

### 選項 2: 保留並加強整合

```
✅ 優點：功能更完整
❌ 缺點：需要維護兩套資料
```

**實施**:
- 在 tasks 表添加 project_id 欄位
- 創建關聯視圖
- 在任務詳情中顯示專案資訊

### 選項 3: 當前狀態（推薦）⭐

```
✅ 優點：靈活選擇
✅ 缺點：文檔清楚說明即可
```

**維持現狀**:
- projects 表保留，供需要時使用
- 統一任務系統作為主要工具
- 兩者可選擇性關聯

---

## 📝 開發規範

### 創建專案任務時

```javascript
// 簡單專案：只用統一任務系統
const task = {
  title: 'XYZ公司重組案',
  category: 'project',
  priority: 'high',
  template_id: 15  // 使用專案範本
};

await createMultiStageTask(task);
```

```javascript
// 複雜專案：同時創建 project 記錄
const project = {
  name: 'ABC併購案',
  budget: 500000,
  category: 'mergers'
};

const projectId = await createProject(project);

const task = {
  title: 'ABC併購案執行任務',
  category: 'project',
  description: `Project ID: ${projectId}`,  // 記錄關聯
  template_id: 16
};

await createMultiStageTask(task);
```

---

## 🎯 結論

### 當前實施狀態

| 項目 | 狀態 | 說明 |
|------|------|------|
| 專案資料表 | ✅ 已建立 | projects, project_tasks, project_checklist |
| 專案API | ✅ 已實現 | projects.js 模塊 |
| 統一任務整合 | ✅ 已實現 | category = 'project' |
| 專門專案頁面 | ❌ 不需要 | 已整合到 tasks.html |
| 專案報表 | ⚠️ 可擴展 | 可在 reports.html 添加專案報表 |

### 推薦使用方式

**一般專案**: ⭐ 使用統一任務系統（category = 'project'）
- 簡單直觀
- 無需額外維護

**大型專案**: 統一任務系統 + projects 表（可選）
- 完整的財務追蹤
- 多維度報表

### 關鍵要點

1. ✅ **專案即任務**：專案是任務的一種分類
2. ✅ **統一管理**：在 tasks.html 管理所有任務包含專案
3. ✅ **projects 表可選**：供需要時使用，非必須
4. ❌ **不需要獨立頁面**：projects.html 不需要建立

---

## 📚 相關文檔

- [任務管理系統設計.md](./任務管理系統設計.md) - 統一任務系統設計
- [系統架構設計.md](./系統架構設計.md) - 整體架構
- [資料表版本說明.md](./資料表版本說明.md) - 資料表關係

---

**總結**: 專案管理功能已成功整合到統一任務系統，透過分類機制實現，無需獨立頁面或複雜整合。

