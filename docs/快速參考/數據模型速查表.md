# æ•¸æ“šæ¨¡å‹é€ŸæŸ¥è¡¨

**æ‰€æœ‰è³‡æ–™è¡¨çµæ§‹ä¸€è¦½** | ER åœ–èˆ‡é—œè¯é—œä¿‚

---

## ğŸ“Š æ ¸å¿ƒ ER åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Users     â”‚ å“¡å·¥/ç”¨æˆ¶
â”‚  (27å€‹è¡¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                   â”‚
       â”‚                                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clients    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ClientServicesâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Services      â”‚
â”‚  å®¢æˆ¶è³‡æ–™    â”‚         â”‚  å®¢æˆ¶æœå‹™    â”‚         â”‚   æœå‹™é …ç›®      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚
       â”‚                       â”‚
       â”‚                â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚ActiveTasks  â”‚
       â”‚                â”‚  åŸ·è¡Œä¸­ä»»å‹™  â”‚
       â”‚                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚
       â”‚                â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚ActiveTaskStages     â”‚
       â”‚                â”‚  ä»»å‹™éšæ®µé€²åº¦        â”‚
       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  TimeLogs   â”‚ å·¥æ™‚è¨˜éŒ„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LeaveBalancesâ”‚ å‡æœŸé¤˜é¡
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LeaveApplications â”‚ å‡æœŸç”³è«‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ è³‡æ–™è¡¨åˆ†é¡

### æ ¸å¿ƒæ¥­å‹™ï¼ˆ5 å€‹è¡¨ï¼‰
| è¡¨å | èªªæ˜ | ä¸»éµ | é‡è¦æ¬„ä½ | é—œè¯ |
|------|------|------|---------|------|
| `Users` | å“¡å·¥/ç”¨æˆ¶ | `user_id` | username, name, is_admin | â†’ TimeLogs, Clients |
| `Clients` | å®¢æˆ¶è³‡æ–™ | `client_id` | company_name, assignee_user_id | â†’ ClientServices, TimeLogs |
| `TimeLogs` | å·¥æ™‚è¨˜éŒ„ | `log_id` | user_id, client_id, hours, log_date | Users â†, Clients â† |
| `CustomerTags` | å®¢æˆ¶æ¨™ç±¤ | `tag_id` | tag_name | â†’ ClientTagAssignments |
| `ClientTagAssignments` | æ¨™ç±¤é—œè¯ | `assignment_id` | client_id, tag_id | Clients â†, CustomerTags â† |

â†’ [è©³ç´°æ–‡æª”](../è³‡æ–™åº«è¨­è¨ˆ/æ ¸å¿ƒæ¥­å‹™è¡¨.md)

---

### æœå‹™é …ç›®ï¼ˆ2 å€‹è¡¨ï¼‰
| è¡¨å | èªªæ˜ | ä¸»éµ | é‡è¦æ¬„ä½ | é—œè¯ |
|------|------|------|------|------|
| `Services` | æœå‹™é …ç›®å®šç¾© | `service_id` | service_name, parent_service_id | è‡ªé—œè¯ï¼ˆæ¨¹ç‹€çµæ§‹ï¼‰|
| `ClientServices` | å®¢æˆ¶æœå‹™é…ç½® | `client_service_id` | client_id, service_id, frequency_id | Clients â†, Services â† |

â†’ [è©³ç´°æ–‡æª”](../è³‡æ–™åº«è¨­è¨ˆ/æœå‹™é …ç›®è¡¨.md)

---

### ä»»å‹™ç³»çµ±ï¼ˆ4 å€‹è¡¨ï¼‰
| è¡¨å | èªªæ˜ | ä¸»éµ | é‡è¦æ¬„ä½ | é—œè¯ |
|------|------|------|------|------|
| `TaskTemplates` | ä»»å‹™æ¨¡æ¿ | `template_id` | template_name, service_id | Services â† |
| `TaskStageTemplates` | éšæ®µæ¨¡æ¿ | `stage_template_id` | template_id, stage_name | TaskTemplates â† |
| `ActiveTasks` | åŸ·è¡Œä¸­ä»»å‹™ | `task_id` | client_service_id, template_id | ClientServices â†, TaskTemplates â† |
| `ActiveTaskStages` | ä»»å‹™éšæ®µé€²åº¦ | `active_stage_id` | task_id, stage_template_id, status | ActiveTasks â†, TaskStageTemplates â† |

â†’ [è©³ç´°æ–‡æª”](../è³‡æ–™åº«è¨­è¨ˆ/ä»»å‹™ç³»çµ±è¡¨.md)

---

### å‡æœŸç³»çµ±ï¼ˆ3 å€‹è¡¨ï¼‰
| è¡¨å | èªªæ˜ | ä¸»éµ | é‡è¦æ¬„ä½ | é—œè¯ |
|------|------|------|------|------|
| `LeaveBalances` | å‡æœŸé¤˜é¡ | `balance_id` | user_id, leave_type_id, balance | Users â†, LeaveTypes â† |
| `LeaveApplications` | å‡æœŸç”³è«‹ | `application_id` | user_id, leave_type_id, days | Users â†, LeaveTypes â† |
| `LeaveEvents` | ç”Ÿæ´»äº‹ä»¶ | `event_id` | user_id, event_type, event_date | Users â† |

â†’ [è©³ç´°æ–‡æª”](../è³‡æ–™åº«è¨­è¨ˆ/å‡æœŸç³»çµ±è¡¨.md)

---

### æ¥­å‹™è¦å‰‡ï¼ˆ7 å€‹è¡¨ï¼‰
| è¡¨å | èªªæ˜ | ä¸»éµ | é‡è¦æ¬„ä½ | å¯é…ç½® |
|------|------|------|------|-------|
| `Holidays` | åœ‹å®šå‡æ—¥ | `holiday_id` | holiday_date, name | âœ… ç®¡ç†å“¡ |
| `LeaveTypes` | å‡åˆ¥é¡å‹ | `leave_type_id` | type_name, deduct_leave | âœ… ç®¡ç†å“¡ |
| `OvertimeRates` | åŠ ç­è²»ç‡ | `rate_id` | work_type_id, rate_multiplier | âœ… ç®¡ç†å“¡ |
| `AnnualLeaveRules` | ç‰¹ä¼‘è¦å‰‡ | `rule_id` | min_months, max_months, days | âœ… ç®¡ç†å“¡ |
| `OtherLeaveRules` | å…¶ä»–å‡æœŸè¦å‰‡ | `rule_id` | leave_type_id, event_type, days | âœ… ç®¡ç†å“¡ |
| `ServiceFrequencyTypes` | é€±æœŸé¡å‹ | `frequency_id` | name, days_interval | âœ… ç®¡ç†å“¡ |
| `WorkTypes` | å·¥ä½œé¡å‹ | `work_type_id` | type_name, is_overtime | âœ… ç®¡ç†å“¡ |

â†’ [è©³ç´°æ–‡æª”](../è³‡æ–™åº«è¨­è¨ˆ/æ¥­å‹™è¦å‰‡è¡¨.md)

---

### è£œä¼‘ç³»çµ±ï¼ˆ3 å€‹è¡¨ï¼‰
| è¡¨å | èªªæ˜ | ä¸»éµ | é‡è¦æ¬„ä½ |
|------|------|------|---------|
| `CompensatoryLeaveBalance` | è£œä¼‘é¤˜é¡ | `balance_id` | user_id, balance_hours |
| `CompensatoryLeaveTransactions` | è£œä¼‘äº¤æ˜“ | `transaction_id` | user_id, hours, transaction_type |
| `CompensatoryLeaveUsage` | è£œä¼‘ä½¿ç”¨ | `usage_id` | user_id, hours_used, usage_date |

â†’ [è©³ç´°æ–‡æª”](../è³‡æ–™åº«è¨­è¨ˆ/è£œä¼‘ç³»çµ±è¡¨.md)

---

### çŸ¥è­˜ç®¡ç†ï¼ˆ5 å€‹è¡¨ï¼‰
| è¡¨å | èªªæ˜ | ä¸»éµ | é‡è¦æ¬„ä½ | ç”¨é€” |
|------|------|------|---------|------|
| `SOPDocuments` | SOP æ–‡ä»¶ | `sop_id` | title, content | æ¨™æº–ä½œæ¥­æµç¨‹ |
| `ClientSOPLinks` | å®¢æˆ¶å°ˆå±¬ SOP | `link_id` | client_id, sop_id | å®¢æˆ¶å°ˆç”¨ SOP |
| `KnowledgeArticles` | çŸ¥è­˜åº«æ–‡ç«  | `article_id` | title, content | å…§éƒ¨çŸ¥è­˜åº« |
| `ExternalArticles` | å¤–éƒ¨æ–‡ç«  | `external_id` | title, slug | å…¬é–‹ç¶²ç«™æ–‡ç«  |
| `ResourceCenter` | è³‡æºä¸­å¿ƒ | `resource_id` | title, file_url | ä¸‹è¼‰è³‡æº |

â†’ [è©³ç´°æ–‡æª”](../è³‡æ–™åº«è¨­è¨ˆ/çŸ¥è­˜ç®¡ç†è¡¨.md)

---

### ~~æ¬Šé™ç³»çµ±~~ â­ å·²å„ªåŒ–ç§»é™¤

**åŸè¨­è¨ˆï¼š** ModulePermissions è¡¨ï¼ˆ14å€‹å¸ƒæ—æ¬„ä½ï¼‰  
**å„ªåŒ–å¾Œï¼š** ä½¿ç”¨ `Users.is_admin` æ§åˆ¶æ‰€æœ‰æ¬Šé™

**ç§»é™¤åŸå› ï¼š**
- æ¨¡å¡Šæ¬Šé™éæ–¼è¤‡é›œ
- å°å°å‹äº‹å‹™æ‰€ï¼Œå…©ç´šæ¬Šé™å·²è¶³å¤ 
- æ¸›å°‘1å€‹è¡¨ï¼Œæ¸›å°‘8å€‹APIç«¯é»

â†’ [è©³ç´°èªªæ˜](../æ¶æ§‹è¨­è¨ˆ/æ¬Šé™ç³»çµ±è¨­è¨ˆ.md)

---

### ç³»çµ±è¨­å®šï¼ˆ2 å€‹è¡¨ï¼‰
| è¡¨å | èªªæ˜ | ä¸»éµ | é‡è¦æ¬„ä½ |
|------|------|------|---------|
| `SystemSettings` | ç³»çµ±è¨­å®š | `setting_id` | setting_key, setting_value |
| `AuditLogs` | å¯©è¨ˆæ—¥èªŒ | `log_id` | user_id, action, table_name |

â†’ [è©³ç´°æ–‡æª”](../è³‡æ–™åº«è¨­è¨ˆ/ç³»çµ±è¨­å®šè¡¨.md)

---

## ğŸ”— é—œè¯é—œä¿‚åœ–

### å®¢æˆ¶ç›¸é—œè³‡æ–™æµ
```
Users (å“¡å·¥)
  â”‚
  â”œâ”€â–º Clients (å®¢æˆ¶)
  â”‚     â”‚
  â”‚     â”œâ”€â–º ClientServices (å®¢æˆ¶æœå‹™)
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º ActiveTasks (åŸ·è¡Œä¸­ä»»å‹™)
  â”‚     â”‚           â”‚
  â”‚     â”‚           â””â”€â–º ActiveTaskStages (éšæ®µé€²åº¦)
  â”‚     â”‚
  â”‚     â””â”€â–º TimeLogs (å·¥æ™‚è¨˜éŒ„) â—„â”€â”€â”€ Users
  â”‚
  â””â”€â–º ClientTagAssignments (æ¨™ç±¤é—œè¯) â—„â”€â”€â”€ CustomerTags (æ¨™ç±¤)
```

### å‡æœŸç›¸é—œè³‡æ–™æµ
```
Users (å“¡å·¥)
  â”‚
  â”œâ”€â–º LeaveBalances (å‡æœŸé¤˜é¡) â—„â”€â”€â”€ LeaveTypes (å‡åˆ¥é¡å‹)
  â”‚
  â”œâ”€â–º LeaveApplications (å‡æœŸç”³è«‹) â—„â”€â”€â”€ LeaveTypes
  â”‚
  â”œâ”€â–º LeaveEvents (ç”Ÿæ´»äº‹ä»¶)
  â”‚
  â””â”€â–º CompensatoryLeaveBalance (è£œä¼‘é¤˜é¡)
        â”‚
        â”œâ”€â–º CompensatoryLeaveTransactions (è£œä¼‘äº¤æ˜“)
        â”‚
        â””â”€â–º CompensatoryLeaveUsage (è£œä¼‘ä½¿ç”¨)
```

### ä»»å‹™ç›¸é—œè³‡æ–™æµ
```
Services (æœå‹™é …ç›®)
  â”‚
  â”œâ”€â–º TaskTemplates (ä»»å‹™æ¨¡æ¿)
  â”‚     â”‚
  â”‚     â””â”€â–º TaskStageTemplates (éšæ®µæ¨¡æ¿)
  â”‚
  â””â”€â–º ClientServices (å®¢æˆ¶æœå‹™)
        â”‚
        â””â”€â–º ActiveTasks (åŸ·è¡Œä¸­ä»»å‹™)
              â”‚
              â””â”€â–º ActiveTaskStages (éšæ®µé€²åº¦)
```

---

## ğŸ¯ å¸¸è¦‹æŸ¥è©¢å ´æ™¯

### å ´æ™¯ 1ï¼šæŸ¥è©¢å®¢æˆ¶çš„æ‰€æœ‰æœå‹™
```sql
SELECT 
  c.company_name,
  s.service_name,
  cs.start_date,
  ft.name AS frequency
FROM Clients c
JOIN ClientServices cs ON c.client_id = cs.client_id
JOIN Services s ON cs.service_id = s.service_id
JOIN ServiceFrequencyTypes ft ON cs.frequency_id = ft.frequency_id
WHERE c.client_id = ?
```

### å ´æ™¯ 2ï¼šæŸ¥è©¢å“¡å·¥çš„å·¥æ™‚çµ±è¨ˆ
```sql
SELECT 
  u.name,
  SUM(t.hours) AS total_hours,
  COUNT(*) AS log_count
FROM Users u
JOIN TimeLogs t ON u.user_id = t.user_id
WHERE t.log_date BETWEEN ? AND ?
GROUP BY u.user_id
```

### å ´æ™¯ 3ï¼šæŸ¥è©¢ä»»å‹™é€²åº¦
```sql
SELECT 
  t.task_name,
  s.stage_name,
  ats.status,
  ats.started_at,
  ats.completed_at
FROM ActiveTasks t
JOIN ActiveTaskStages ats ON t.task_id = ats.task_id
JOIN TaskStageTemplates s ON ats.stage_template_id = s.stage_template_id
WHERE t.client_service_id = ?
ORDER BY s.stage_order
```

### å ´æ™¯ 4ï¼šæŸ¥è©¢å‡æœŸé¤˜é¡
```sql
SELECT 
  u.name,
  lt.type_name,
  lb.entitled_days,
  lb.used_days,
  (lb.entitled_days - lb.used_days) AS remaining_days
FROM Users u
JOIN LeaveBalances lb ON u.user_id = lb.user_id
JOIN LeaveTypes lt ON lb.leave_type_id = lt.leave_type_id
WHERE u.user_id = ?
```

---

## ğŸ“ è³‡æ–™è¡¨è¨­è¨ˆåŸå‰‡

### âœ… éµå¾ªçš„è¨­è¨ˆåŸå‰‡
1. **æ¨™æº–åŒ–æ¬„ä½**ï¼šæ‰€æœ‰è¡¨éƒ½æœ‰ `created_at`, `updated_at`
2. **è»Ÿåˆªé™¤**ï¼šä½¿ç”¨ `is_deleted` è€Œéå¯¦éš›åˆªé™¤
3. **å¯©è¨ˆè¿½è¹¤**ï¼šè¨˜éŒ„ `created_by`, `updated_by`
4. **å”¯ä¸€ç´„æŸ**ï¼šé‡è¦æ¬„ä½åŠ ä¸Šå”¯ä¸€ç´¢å¼•
5. **å¤–éµé—œè¯**ï¼šæ˜ç¢ºå®šç¾©è¡¨ä¹‹é–“é—œä¿‚

### ğŸ” å‘½åè¦ç¯„
- **è¡¨å**ï¼šPascalCaseï¼Œè¤‡æ•¸å½¢å¼ï¼ˆ`Users`, `Clients`ï¼‰
- **æ¬„ä½å**ï¼šsnake_caseï¼ˆ`user_id`, `company_name`ï¼‰
- **ä¸»éµ**ï¼šè¡¨åå–®æ•¸ + `_id`ï¼ˆ`user_id`, `client_id`ï¼‰
- **å¤–éµ**ï¼šé—œè¯è¡¨çš„ä¸»éµåï¼ˆ`user_id` é—œè¯åˆ° `Users.user_id`ï¼‰
- **å¸ƒæ—å€¼**ï¼š`is_` æˆ– `has_` é–‹é ­ï¼ˆ`is_admin`, `has_children`ï¼‰

---

## ğŸ”§ ç´¢å¼•ç­–ç•¥

### å¿…é ˆå»ºç«‹ç´¢å¼•çš„æ¬„ä½
1. **ä¸»éµ**ï¼šè‡ªå‹•å»ºç«‹
2. **å¤–éµ**ï¼šæå‡ JOIN æ•ˆèƒ½
3. **å”¯ä¸€æ¬„ä½**ï¼šclient_id, username, email
4. **å¸¸ç”¨æŸ¥è©¢æ¬„ä½**ï¼šlog_date, status, is_deleted

### è¤‡åˆç´¢å¼•
```sql
-- å·¥æ™‚æŸ¥è©¢å„ªåŒ–
CREATE INDEX idx_timelogs_user_date ON TimeLogs(user_id, log_date);

-- ä»»å‹™æŸ¥è©¢å„ªåŒ–
CREATE INDEX idx_tasks_client_status ON ActiveTasks(client_service_id, status);

-- å‡æœŸæŸ¥è©¢å„ªåŒ–
CREATE INDEX idx_leave_user_type ON LeaveBalances(user_id, leave_type_id);
```

---

## ğŸ“Š è³‡æ–™é‡é ä¼°

| è¡¨å | é ä¼°å¢é•·é€Ÿåº¦ | 1å¹´å¾Œé ä¼° | 5å¹´å¾Œé ä¼° |
|------|-------------|----------|----------|
| `Users` | æ…¢ | 50 | 100 |
| `Clients` | ä¸­ | 500 | 2,000 |
| `TimeLogs` | å¿« | 50,000 | 250,000 |
| `ActiveTasks` | ä¸­ | 5,000 | 25,000 |
| `LeaveApplications` | ä¸­ | 1,000 | 5,000 |
| `AuditLogs` | å¿« | 100,000 | 500,000 |

---

## ğŸ”— ç›¸é—œæ–‡æª”

- **[è³‡æ–™åº«è¨­è¨ˆç¸½è¦½](../è³‡æ–™åº«è¨­è¨ˆ/README.md)** - å®Œæ•´çš„ Schema å®šç¾©
- **[API é€ŸæŸ¥è¡¨](./APIé€ŸæŸ¥è¡¨.md)** - å¦‚ä½•é€é API è¨ªå•é€™äº›è³‡æ–™
- **[å¿«é€Ÿé–‹ç™¼æŒ‡å—](./å¿«é€Ÿé–‹ç™¼æŒ‡å—.md)** - é–‹ç™¼æµç¨‹æŒ‡å¼•

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025å¹´10æœˆ27æ—¥  
**è³‡æ–™è¡¨ç¸½æ•¸ï¼š** 27 å€‹

