# éŒ¯èª¤ç¢¼é€ŸæŸ¥è¡¨

**æ‰€æœ‰ API éŒ¯èª¤ç¢¼ä¸€è¦½** | å¿«é€Ÿè¨ºæ–·å•é¡Œ

---

## ğŸ” å¿«é€ŸæŸ¥æ‰¾

| HTTP | éŒ¯èª¤ç¢¼ | éŒ¯èª¤è¨Šæ¯ | å¸¸è¦‹åŸå›  | è§£æ±ºæ–¹æ¡ˆ |
|------|--------|---------|---------|---------|
| 400 | `INVALID_REQUEST` | è«‹æ±‚æ ¼å¼éŒ¯èª¤ | Body ä¸æ˜¯æœ‰æ•ˆ JSON | æª¢æŸ¥ JSON æ ¼å¼ |
| 400 | `INVALID_HIERARCHY` | ä¸å…è¨±ä¸‰å±¤çµæ§‹ | å­é …ç›®ä¸‹å†å»ºå­é …ç›® | åªå…è¨±å…©å±¤çµæ§‹ |
| 400 | `INVALID_DATE_RANGE` | æ—¥æœŸå€é–“éŒ¯èª¤ | çµæŸæ—¥æœŸæ—©æ–¼é–‹å§‹æ—¥æœŸ | èª¿æ•´æ—¥æœŸé †åº |
| 401 | `UNAUTHORIZED` | æœªç™»å…¥ | Token éæœŸæˆ–ç„¡æ•ˆ | é‡æ–°ç™»å…¥ |
| 401 | `INVALID_CREDENTIALS` | å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ | ç™»å…¥è³‡è¨ŠéŒ¯èª¤ | æª¢æŸ¥å¸³å¯† |
| 403 | `FORBIDDEN` | ç„¡æ¬Šé™ | éç®¡ç†å“¡å˜—è©¦ç®¡ç†åŠŸèƒ½ | è¯ç¹«ç®¡ç†å“¡ |
| 403 | `INSUFFICIENT_PERMISSIONS` | æ¬Šé™ä¸è¶³ | æ¨¡å¡Šæ¬Šé™æœªé–‹å•Ÿ | è«‹ç®¡ç†å“¡é–‹å•Ÿæ¬Šé™ |
| 404 | `CLIENT_NOT_FOUND` | å®¢æˆ¶ä¸å­˜åœ¨ | client_id ä¸å­˜åœ¨ | ç¢ºèªå®¢æˆ¶ ID |
| 404 | `USER_NOT_FOUND` | å“¡å·¥ä¸å­˜åœ¨ | user_id ä¸å­˜åœ¨ | ç¢ºèªå“¡å·¥ ID |
| 404 | `SERVICE_NOT_FOUND` | æœå‹™é …ç›®ä¸å­˜åœ¨ | service_id ä¸å­˜åœ¨ | ç¢ºèªæœå‹™ ID |
| 404 | `TASK_NOT_FOUND` | ä»»å‹™ä¸å­˜åœ¨ | task_id ä¸å­˜åœ¨ | ç¢ºèªä»»å‹™ ID |
| 404 | `TEMPLATE_NOT_FOUND` | æ¨¡æ¿ä¸å­˜åœ¨ | template_id ä¸å­˜åœ¨ | ç¢ºèªæ¨¡æ¿ ID |
| 409 | `DUPLICATE_CLIENT_ID` | çµ±ä¸€ç·¨è™Ÿå·²å­˜åœ¨ | æ–°å¢é‡è¤‡å®¢æˆ¶ | ä½¿ç”¨å…¶ä»–çµ±ä¸€ç·¨è™Ÿ |
| 409 | `DUPLICATE_USERNAME` | ä½¿ç”¨è€…åç¨±å·²å­˜åœ¨ | æ–°å¢é‡è¤‡å“¡å·¥ | ä½¿ç”¨å…¶ä»–ä½¿ç”¨è€…åç¨± |
| 409 | `DUPLICATE_SERVICE_NAME` | æœå‹™åç¨±å·²å­˜åœ¨ | æœå‹™åç¨±é‡è¤‡ | ä½¿ç”¨å…¶ä»–åç¨± |
| 409 | `DUPLICATE_TAG_NAME` | æ¨™ç±¤åç¨±å·²å­˜åœ¨ | æ¨™ç±¤åç¨±é‡è¤‡ | ä½¿ç”¨å…¶ä»–åç¨± |
| 422 | `VALIDATION_ERROR` | é©—è­‰éŒ¯èª¤ | æ¬„ä½æ ¼å¼éŒ¯èª¤ | æª¢æŸ¥æ¬„ä½æ ¼å¼ |
| 422 | `MISSING_REQUIRED_FIELD` | ç¼ºå°‘å¿…å¡«æ¬„ä½ | æœªæä¾›å¿…å¡«æ¬„ä½ | è£œå……å¿…å¡«æ¬„ä½ |
| 422 | `INVALID_EMAIL_FORMAT` | Email æ ¼å¼éŒ¯èª¤ | Email ä¸ç¬¦åˆæ ¼å¼ | ä½¿ç”¨æ­£ç¢º Email |
| 422 | `INVALID_PHONE_FORMAT` | é›»è©±æ ¼å¼éŒ¯èª¤ | é›»è©±è™Ÿç¢¼ä¸ç¬¦åˆæ ¼å¼ | ä½¿ç”¨æ­£ç¢ºé›»è©±è™Ÿç¢¼ |
| 422 | `INVALID_CLIENT_ID_FORMAT` | çµ±ä¸€ç·¨è™Ÿæ ¼å¼éŒ¯èª¤ | ä¸æ˜¯ 8 ä½æ•¸å­— | ä½¿ç”¨ 8 ä½æ•¸å­— |
| 500 | `INTERNAL_ERROR` | ä¼ºæœå™¨éŒ¯èª¤ | è³‡æ–™åº«æˆ–ç³»çµ±éŒ¯èª¤ | è¯ç¹«æŠ€è¡“äººå“¡ |
| 500 | `DATABASE_ERROR` | è³‡æ–™åº«éŒ¯èª¤ | SQL åŸ·è¡Œå¤±æ•— | è¯ç¹«æŠ€è¡“äººå“¡ |

---

## ğŸ“‹ æŒ‰ HTTP ç‹€æ…‹ç¢¼åˆ†é¡

### 4xx å®¢æˆ¶ç«¯éŒ¯èª¤

#### 400 Bad Requestï¼ˆè«‹æ±‚æ ¼å¼éŒ¯èª¤ï¼‰
```json
{
  "success": false,
  "error": {
    "code": "INVALID_REQUEST",
    "message": "è«‹æ±‚æ ¼å¼éŒ¯èª¤"
  }
}
```

**å¸¸è¦‹åŸå› ï¼š**
- JSON æ ¼å¼éŒ¯èª¤ï¼ˆç¼ºå°‘å¼•è™Ÿã€é€—è™Ÿç­‰ï¼‰
- Content-Type ä¸æ˜¯ `application/json`
- Body ç‚ºç©ºä½† API éœ€è¦ Body

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. ä½¿ç”¨ JSON é©—è­‰å·¥å…·æª¢æŸ¥æ ¼å¼
2. ç¢ºèª Content-Type header
3. ç¢ºèª Body ä¸ç‚ºç©º

---

#### 401 Unauthorizedï¼ˆæœªç™»å…¥ï¼‰
```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "è«‹å…ˆç™»å…¥"
  }
}
```

**å¸¸è¦‹åŸå› ï¼š**
- Token å·²éæœŸ
- Token ç„¡æ•ˆæˆ–è¢«ç¯¡æ”¹
- Cookie å·²æ¸…é™¤

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. é‡æ–°ç™»å…¥
2. æª¢æŸ¥ Cookie æ˜¯å¦å­˜åœ¨
3. ç¢ºèª Token æœªéæœŸ

---

#### 403 Forbiddenï¼ˆç„¡æ¬Šé™ï¼‰
```json
{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "æ‚¨æ²’æœ‰æ¬Šé™åŸ·è¡Œæ­¤æ“ä½œ"
  }
}
```

**å¸¸è¦‹åŸå› ï¼š**
- éç®¡ç†å“¡å˜—è©¦ç®¡ç†åŠŸèƒ½
- å“¡å·¥å˜—è©¦è¨ªå•æœªé–‹å•Ÿçš„æ¨¡å¡Š
- å“¡å·¥å˜—è©¦æŸ¥çœ‹å…¶ä»–äººçš„è³‡æ–™

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. ç¢ºèªè‡ªå·±çš„è§’è‰²ï¼ˆç®¡ç†å“¡/å“¡å·¥ï¼‰
2. è«‹ç®¡ç†å“¡é–‹å•Ÿæ¨¡å¡Šæ¬Šé™
3. åªè¨ªå•è‡ªå·±æœ‰æ¬Šé™çš„è³‡æº

---

#### 404 Not Foundï¼ˆè³‡æºä¸å­˜åœ¨ï¼‰
```json
{
  "success": false,
  "error": {
    "code": "CLIENT_NOT_FOUND",
    "message": "å®¢æˆ¶ä¸å­˜åœ¨"
  }
}
```

**å¸¸è¦‹åŸå› ï¼š**
- ID éŒ¯èª¤
- è³‡æºå·²è¢«åˆªé™¤
- URL è·¯å¾‘éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. ç¢ºèª ID æ­£ç¢º
2. æª¢æŸ¥è³‡æºæ˜¯å¦å·²åˆªé™¤
3. ç¢ºèª API è·¯å¾‘æ­£ç¢º

---

#### 409 Conflictï¼ˆè³‡æºè¡çªï¼‰
```json
{
  "success": false,
  "error": {
    "code": "DUPLICATE_CLIENT_ID",
    "message": "çµ±ä¸€ç·¨è™Ÿå·²å­˜åœ¨"
  }
}
```

**å¸¸è¦‹åŸå› ï¼š**
- å”¯ä¸€æ€§æ¬„ä½é‡è¤‡ï¼ˆçµ±ä¸€ç·¨è™Ÿã€ä½¿ç”¨è€…åç¨±ç­‰ï¼‰
- è³‡æºå·²å­˜åœ¨

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. ä½¿ç”¨å…¶ä»–å”¯ä¸€å€¼
2. ç¢ºèªè³‡æºæ˜¯å¦å·²å­˜åœ¨
3. è‹¥éœ€æ›´æ–°ï¼Œä½¿ç”¨ PUT è€Œé POST

---

#### 422 Unprocessable Entityï¼ˆé©—è­‰éŒ¯èª¤ï¼‰
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "client_id å¿…é ˆç‚º 8 ä½æ•¸å­—"
  }
}
```

**å¸¸è¦‹åŸå› ï¼š**
- æ¬„ä½æ ¼å¼éŒ¯èª¤
- ç¼ºå°‘å¿…å¡«æ¬„ä½
- æ•¸å€¼è¶…å‡ºç¯„åœ

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥æ¬„ä½æ ¼å¼
2. è£œå……å¿…å¡«æ¬„ä½
3. ç¢ºèªæ•¸å€¼ç¯„åœ

---

### 5xx ä¼ºæœå™¨éŒ¯èª¤

#### 500 Internal Server Errorï¼ˆä¼ºæœå™¨éŒ¯èª¤ï¼‰
```json
{
  "success": false,
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤"
  }
}
```

**å¸¸è¦‹åŸå› ï¼š**
- è³‡æ–™åº«é€£ç·šå¤±æ•—
- SQL èªæ³•éŒ¯èª¤
- ç¨‹å¼é‚è¼¯éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. è¯ç¹«æŠ€è¡“äººå“¡
2. æä¾›å®Œæ•´çš„éŒ¯èª¤è¨Šæ¯
3. æä¾›é‡ç¾æ­¥é©Ÿ

---

## ğŸ¯ æŒ‰åŠŸèƒ½æ¨¡å¡Šåˆ†é¡

### èªè­‰ç›¸é—œ
| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP |
|--------|------|------|
| `UNAUTHORIZED` | æœªç™»å…¥ | 401 |
| `INVALID_CREDENTIALS` | å¸³å¯†éŒ¯èª¤ | 401 |
| `WEAK_PASSWORD` | å¯†ç¢¼å¼·åº¦ä¸è¶³ | 422 |
| `PASSWORD_MISMATCH` | å¯†ç¢¼ä¸åŒ¹é… | 422 |

### æ¬Šé™ç›¸é—œ
| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP |
|--------|------|------|
| `FORBIDDEN` | ç„¡æ¬Šé™ | 403 |
| `INSUFFICIENT_PERMISSIONS` | æ¬Šé™ä¸è¶³ | 403 |
| `MODULE_DISABLED` | æ¨¡å¡Šæœªå•Ÿç”¨ | 403 |

### å®¢æˆ¶ç®¡ç†ç›¸é—œ
| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP |
|--------|------|------|
| `CLIENT_NOT_FOUND` | å®¢æˆ¶ä¸å­˜åœ¨ | 404 |
| `DUPLICATE_CLIENT_ID` | çµ±ä¸€ç·¨è™Ÿå·²å­˜åœ¨ | 409 |
| `INVALID_CLIENT_ID_FORMAT` | çµ±ä¸€ç·¨è™Ÿæ ¼å¼éŒ¯èª¤ | 422 |
| `CLIENT_HAS_ACTIVE_SERVICES` | å®¢æˆ¶æœ‰é€²è¡Œä¸­æœå‹™ | 409 |

### æœå‹™é …ç›®ç›¸é—œ
| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP |
|--------|------|------|
| `SERVICE_NOT_FOUND` | æœå‹™é …ç›®ä¸å­˜åœ¨ | 404 |
| `DUPLICATE_SERVICE_NAME` | æœå‹™åç¨±å·²å­˜åœ¨ | 409 |
| `INVALID_HIERARCHY` | ä¸å…è¨±ä¸‰å±¤çµæ§‹ | 400 |
| `SERVICE_IN_USE` | æœå‹™é …ç›®ä½¿ç”¨ä¸­ | 409 |

### ä»»å‹™ç®¡ç†ç›¸é—œ
| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP |
|--------|------|------|
| `TASK_NOT_FOUND` | ä»»å‹™ä¸å­˜åœ¨ | 404 |
| `TEMPLATE_NOT_FOUND` | æ¨¡æ¿ä¸å­˜åœ¨ | 404 |
| `STAGE_NOT_FOUND` | éšæ®µä¸å­˜åœ¨ | 404 |
| `INVALID_STAGE_TRANSITION` | éšæ®µç‹€æ…‹è½‰æ›éŒ¯èª¤ | 400 |
| `TEMPLATE_IN_USE` | æ¨¡æ¿ä½¿ç”¨ä¸­ | 409 |

### å·¥æ™‚ç®¡ç†ç›¸é—œ
| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP |
|--------|------|------|
| `TIMELOG_NOT_FOUND` | å·¥æ™‚è¨˜éŒ„ä¸å­˜åœ¨ | 404 |
| `INVALID_DATE_RANGE` | æ—¥æœŸå€é–“éŒ¯èª¤ | 400 |
| `DUPLICATE_TIMELOG` | å·¥æ™‚è¨˜éŒ„é‡è¤‡ | 409 |
| `HOURS_EXCEED_LIMIT` | å·¥æ™‚è¶…éä¸Šé™ | 422 |

### å‡æœŸç®¡ç†ç›¸é—œ
| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP |
|--------|------|------|
| `INSUFFICIENT_LEAVE_BALANCE` | å‡æœŸé¤˜é¡ä¸è¶³ | 422 |
| `LEAVE_TYPE_NOT_FOUND` | å‡åˆ¥é¡å‹ä¸å­˜åœ¨ | 404 |
| `INVALID_LEAVE_DATE` | å‡æœŸæ—¥æœŸéŒ¯èª¤ | 400 |
| `LEAVE_OVERLAP` | å‡æœŸé‡ç–Š | 409 |

### å“¡å·¥ç®¡ç†ç›¸é—œ
| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP |
|--------|------|------|
| `USER_NOT_FOUND` | å“¡å·¥ä¸å­˜åœ¨ | 404 |
| `DUPLICATE_USERNAME` | ä½¿ç”¨è€…åç¨±å·²å­˜åœ¨ | 409 |
| `DUPLICATE_EMAIL` | Email å·²å­˜åœ¨ | 409 |
| `INVALID_EMAIL_FORMAT` | Email æ ¼å¼éŒ¯èª¤ | 422 |

---

## ğŸ”§ èª¿è©¦æŠ€å·§

### 1. ä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·
```
1. æ‰“é–‹ F12 é–‹ç™¼è€…å·¥å…·
2. åˆ‡æ›åˆ° Network æ¨™ç±¤
3. é‡ç¾éŒ¯èª¤
4. æŸ¥çœ‹ Response ä¸­çš„è©³ç´°éŒ¯èª¤è¨Šæ¯
```

### 2. æª¢æŸ¥è«‹æ±‚æ ¼å¼
```javascript
// æ­£ç¢ºçš„è«‹æ±‚æ ¼å¼
fetch('/api/v1/clients', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    client_id: '12345678',
    company_name: 'æ¸¬è©¦å…¬å¸'
  })
});
```

### 3. é©—è­‰ JSON æ ¼å¼
ä½¿ç”¨ç·šä¸Šå·¥å…·ï¼šhttps://jsonlint.com/

### 4. æª¢æŸ¥èªè­‰ç‹€æ…‹
```javascript
// æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
fetch('/api/v1/auth/verify')
  .then(res => res.json())
  .then(data => console.log(data));
```

---

## ğŸ“ éŒ¯èª¤è™•ç†æœ€ä½³å¯¦è¸

### å‰ç«¯éŒ¯èª¤è™•ç†ç¯„ä¾‹
```javascript
async function createClient(data) {
  try {
    const response = await fetch('/api/v1/clients', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    
    if (!result.success) {
      // æ ¹æ“šéŒ¯èª¤ç¢¼é¡¯ç¤ºå°æ‡‰è¨Šæ¯
      switch (result.error.code) {
        case 'DUPLICATE_CLIENT_ID':
          alert('çµ±ä¸€ç·¨è™Ÿå·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨å…¶ä»–ç·¨è™Ÿ');
          break;
        case 'VALIDATION_ERROR':
          alert(`é©—è­‰éŒ¯èª¤ï¼š${result.error.message}`);
          break;
        case 'UNAUTHORIZED':
          // é‡å®šå‘åˆ°ç™»å…¥é 
          window.location.href = '/login';
          break;
        default:
          alert(`éŒ¯èª¤ï¼š${result.error.message}`);
      }
      return null;
    }
    
    return result.data;
  } catch (error) {
    console.error('è«‹æ±‚å¤±æ•—ï¼š', error);
    alert('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
    return null;
  }
}
```

### çµ±ä¸€éŒ¯èª¤è™•ç†å‡½å¼
```javascript
function handleApiError(error) {
  const errorMessages = {
    'UNAUTHORIZED': 'è«‹é‡æ–°ç™»å…¥',
    'FORBIDDEN': 'æ‚¨æ²’æœ‰æ¬Šé™åŸ·è¡Œæ­¤æ“ä½œ',
    'VALIDATION_ERROR': 'è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥è¼¸å…¥',
    'DUPLICATE_CLIENT_ID': 'çµ±ä¸€ç·¨è™Ÿå·²å­˜åœ¨',
    'INTERNAL_ERROR': 'ç³»çµ±éŒ¯èª¤ï¼Œè«‹è¯ç¹«æŠ€è¡“äººå“¡'
  };
  
  const message = errorMessages[error.code] || error.message;
  return message;
}
```

---

## ğŸ”— ç›¸é—œæ–‡æª”

- **[API é€ŸæŸ¥è¡¨](./APIé€ŸæŸ¥è¡¨.md)** - æ‰€æœ‰ API ç«¯é»
- **[API å…±ç”¨è¦ç¯„](../APIè¦æ ¼/APIå…±ç”¨è¦ç¯„.md)** - éŸ¿æ‡‰æ ¼å¼ã€éŒ¯èª¤è™•ç†æ¨™æº–
- **[å¿«é€Ÿé–‹ç™¼æŒ‡å—](./å¿«é€Ÿé–‹ç™¼æŒ‡å—.md)** - é–‹ç™¼æµç¨‹æŒ‡å¼•

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025å¹´10æœˆ27æ—¥  
**éŒ¯èª¤ç¢¼ç¸½æ•¸ï¼š** 30+

