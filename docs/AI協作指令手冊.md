# AI 協作指令手冊

**版本**: 3.0  
**創建日期**: 2025-10-26  
**用途**: 指導如何與 AI 協作進行系統重構和開發

---

## 📋 重要說明

本文檔提供了與 AI 協作時的標準指令模板，確保 AI 能夠：
- ✅ 理解項目的架構和規範
- ✅ 遵循標準化開發流程
- ✅ 深度診斷問題而非表面修復
- ✅ 保持文檔與代碼同步
- ✅ 完全模組化思維

---

## 🎯 AI 工作前的初始化指令

### 指令模板 1: 首次協作（讓 AI 了解項目）

```
你好！我需要你幫我維護和開發「霍爾果斯會計師事務所內部管理系統」。

請先執行以下步驟：

1. 閱讀 @docs/README.md 了解文檔結構
2. 閱讀 @docs/系統重構總設計文檔.md 了解系統架構和開發規範
3. 閱讀 @docs/問題診斷與解決流程.md 了解問題處理方法
4. 閱讀 @docs/開發與部署指南.md 了解開發流程

重要規範：
- ✅ 任何修改必須先更新設計文檔
- ✅ 遇到問題必須深度診斷（五個為什麼），找根本原因
- ✅ 樣式問題優先考慮修改組件庫而非單一頁面
- ✅ 代碼重複必須提取到共用模組
- ✅ 所有資料庫欄位必須遵循命名規範（{table}_id, is_{name}, {action}_at）
- ✅ 所有 API 必須符合 RESTful 規範
- ✅ 前端必須使用模組化架構（Core-Components-Modules-Pages）
- ✅ 後端必須使用分層架構（Repository-Service-Handler-Routes）
- ❌ 絕對禁止表面修復問題
- ❌ 絕對禁止只修改單一文件而不考慮系統影響
- ❌ 絕對禁止生成任何形式的總結報告

準備好後，告訴我你已理解這些規範。
```

---

## 🔧 執行重構的完整指令

### 指令模板 2: 執行完整系統重構

```
請按照 @docs/系統重構總設計文檔.md 的設計，執行完整的系統重構。

重構範圍：
- 資料庫：執行 10 個 Migration，標準化所有表結構
- 後端：重構為 Repository-Service-Handler-Routes 架構
- 前端：重構為 Core-Components-Modules-Pages 架構
- 文檔：更新所有功能設計文檔

執行要求：
1. 嚴格遵循設計文檔，不要偏離
2. 按照實施計劃逐步執行（資料庫→後端→前端→測試→清理）
3. 每個階段完成後更新 TODO
4. 遇到問題使用「五個為什麼」診斷
5. 實施完成後刪除所有舊代碼和過時文檔
6. 完成後不要生成總結報告

參考文檔：
- @docs/系統重構總設計文檔.md（主要參考）
- @docs/問題診斷與解決流程.md（問題處理）
- @docs/開發與部署指南.md（部署流程）

開始執行。
```

---

## 🆕 開發新功能的指令

### 指令模板 3: 開發新功能

```
我需要開發一個新功能：[功能名稱]

需求描述：
[詳細描述功能需求]

請按照以下流程執行：

1. 閱讀 @docs/系統重構總設計文檔.md 第 6 章「標準化開發流程」
2. 檢查現有模組，確認可以重用哪些組件和模組
3. 創建功能設計文檔（docs/[功能名稱]系統設計.md）
4. 按照 9 步驟流程執行：
   - 設計階段：定義資料庫、API、前端模組
   - 實施階段：資料庫 → 後端 → 前端
   - 測試階段：單元 → 集成 → E2E
   - 文檔階段：更新所有相關文檔
   - 清理階段：刪除測試文件

要求：
- ✅ 資料庫命名必須符合規範（{table}s, {table}_id, is_{name}, {action}_at）
- ✅ API 必須 100% RESTful（GET /api/entities, POST /api/entities）
- ✅ 後端必須使用 Repository-Service-Handler-Routes 架構
- ✅ 前端必須使用 Core-Components-Modules-Pages 架構
- ✅ HTML 必須使用標準範本，禁止內嵌樣式/腳本
- ✅ CSS 優先使用組件庫，頁面特定樣式加前綴
- ✅ 每個模組文件 < 300行
- ✅ 通過所有檢查清單
- ❌ 禁止跳過任何步驟
- ❌ 禁止代碼重複
- ❌ 完成後禁止生成總結報告

參考現有模組：
- 後端範例：@timesheet-api/src/repositories/ClientRepository.js
- 前端範例：@assets/js/core/api/client.js

開始執行。
```

---

## 🐛 修復問題的指令

### 指令模板 4: 修復系統問題

```
系統出現以下問題：
[描述問題症狀]

請按照 @docs/問題診斷與解決流程.md 執行深度診斷：

1. 使用「五個為什麼」找出根本原因
2. 評估是單點問題還是系統性問題
3. 確定應該在哪個層次解決：
   - 如果是樣式問題：檢查是否應該修改組件庫
   - 如果是代碼重複：檢查是否應該提取共用模組
   - 如果是 API 問題：檢查是否缺乏統一中間件
   - 如果是資料庫問題：檢查是否命名不標準
4. 系統性解決（不只修復表面）
5. 建立預防機制（添加測試、更新規範、添加檢測工具）
6. 更新相關設計文檔

要求：
- ✅ 必須找到根本原因（問 5 次為什麼）
- ✅ 必須檢查影響範圍（全面搜索類似問題）
- ✅ 必須系統性解決（修改共用模組/組件庫/中間件）
- ✅ 必須建立預防機制
- ✅ 必須更新設計文檔
- ❌ 禁止只修復表面問題
- ❌ 禁止只修改單一文件
- ❌ 禁止不更新文檔
- ❌ 禁止生成問題列表或總結報告

參考：
- @docs/問題診斷與解決流程.md
- @docs/系統重構總設計文檔.md

開始診斷並解決。
```

### 指令模板 5: 修復樣式問題

```
頁面 [頁面名稱] 的樣式有問題：
[描述樣式問題]

請深度診斷：

1. 檢查是只有這個頁面有問題，還是多個頁面都有？
2. 如果多個頁面都有：
   - 這是組件庫的問題
   - 必須修改 assets/css/internal-components.css
   - 測試所有使用此組件的頁面
3. 如果只有單一頁面：
   - 檢查 HTML 結構是否符合組件庫標準
   - 檢查是否使用了正確的 class
   - 僅在必要時在頁面 CSS 中添加特定樣式（必須加頁面前綴）

要求：
- ✅ 必須檢查所有頁面是否有類似問題
- ✅ 如果是組件問題，必須修改組件庫
- ✅ 頁面特定樣式必須加前綴（{page-name}-）
- ✅ 必須使用 CSS 變量而非硬編碼顏色
- ✅ 修改後測試所有相關頁面
- ❌ 禁止只在單一頁面 CSS 中覆蓋
- ❌ 禁止使用 !important
- ❌ 禁止內嵌樣式

參考：
- @docs/系統重構總設計文檔.md 第 5 章
- @assets/css/internal-components.css

開始診斷並修復。
```

---

## 📝 代碼審查的指令

### 指令模板 6: 代碼審查

```
請對以下變更進行代碼審查：
[指定文件或提交]

審查標準（嚴格執行）：

架構檢查：
□ 是否遵循分層架構？
□ 是否遵循單一職責原則？
□ 是否有代碼重複？
□ 是否最大化重用現有模組？

命名檢查：
□ 資料庫欄位是否符合規範？（{table}_id, is_{name}, {action}_at）
□ API 端點是否 RESTful？
□ 變量和函數命名是否清晰？

代碼質量檢查：
□ 文件是否 < 300行？
□ 函數是否 < 50行？
□ 是否有適當的錯誤處理？
□ 是否有必要的註釋？

文檔檢查：
□ 設計文檔是否已更新？
□ API 文檔是否已更新？
□ 代碼與文檔是否一致？

測試檢查：
□ 是否有單元測試？
□ 測試覆蓋率是否 > 80%？
□ 是否通過所有測試？

發現問題請：
1. 明確指出問題
2. 說明為什麼這是問題（不符合哪個規範）
3. 提供正確的解決方案
4. 如果是系統性問題，說明影響範圍

❌ 不要只說「建議」，要明確指出「必須修改」的地方

參考：
- @docs/系統重構總設計文檔.md

開始審查。
```

---

## 🔄 持續維護的指令

### 指令模板 7: 定期代碼質量檢查

```
請執行系統代碼質量檢查：

檢查項目：
1. 代碼重複檢測
   - 搜索重複的代碼片段
   - 提取到共用模組
   - 全面替換

2. 架構合規檢查
   - 檢查是否有文件 > 300行
   - 檢查是否有函數 > 50行
   - 檢查是否違反分層架構

3. 命名規範檢查
   - 檢查資料庫欄位命名
   - 檢查 API 端點命名
   - 檢查變量命名

4. 文檔同步檢查
   - 比對代碼與設計文檔
   - 找出不一致的地方
   - 更新文檔

5. 死代碼檢查
   - 找出未使用的函數
   - 找出未使用的變量
   - 刪除死代碼

要求：
- ✅ 逐項檢查，不要偷懶
- ✅ 發現問題立即修復
- ✅ 更新相關文檔
- ❌ 不要只生成問題列表
- ❌ 不要生成總結報告

開始檢查。
```

---

## 🚀 快速參考：常用指令

### 開發新功能（簡化版）

```
開發新功能：[功能名稱]

要求：
- 遵循 @docs/系統重構總設計文檔.md 第 6 章流程
- 資料庫遵循命名規範
- API 100% RESTful
- 前後端使用分層架構
- 每個文件 < 300行
- 不要生成報告

開始。
```

### 修復問題（簡化版）

```
修復問題：[問題描述]

要求：
- 參考 @docs/問題診斷與解決流程.md
- 使用五個為什麼找根本原因
- 系統性解決，不做表面修復
- 如果是樣式問題，檢查是否應修改組件庫
- 如果是代碼重複，提取共用模組
- 更新設計文檔
- 不要生成報告

開始。
```

### 代碼審查（簡化版）

```
審查代碼：[文件或變更]

檢查：
- 架構、命名、質量、文檔、測試
- 參考 @docs/系統重構總設計文檔.md
- 明確指出必須修改的地方
- 不要只提建議

開始。
```

---

## 📚 AI 必須遵循的核心規範

### 設計先行
```
✅ 任何修改都必須先更新設計文檔
❌ 禁止先寫代碼後補文檔
```

### 深度診斷
```
✅ 使用「五個為什麼」找根本原因
❌ 禁止只修復表面問題
```

### 系統思考
```
✅ 檢查影響範圍，全面解決
❌ 禁止只修改單一文件
```

### 模組化思維
```
✅ 樣式問題 → 修改組件庫
✅ 代碼重複 → 提取共用模組
✅ API 問題 → 統一中間件
❌ 禁止在多個文件中分別修改
```

### 文檔同步
```
✅ 改代碼立即更新文檔
❌ 禁止代碼與文檔不一致
```

### 自動部署
```
✅ 所有變更通過 Git Push 觸發部署
❌ 禁止要求手動執行部署命令
```

### 清理習慣
```
✅ 完成後立即刪除測試文件
✅ 移動舊代碼到 deprecated
❌ 禁止生成任何總結報告
```

---

## 🎯 特殊情況的指令

### 指令模板 8: 只設計不實施

```
我只需要設計，不要實施。

請為 [功能名稱] 創建完整的設計文檔。

包含：
1. 功能概述
2. 資料庫設計（遵循命名規範）
3. API 設計（RESTful）
4. 前端模組設計（分層架構）
5. 測試計劃

不要：
- ❌ 不要創建任何代碼
- ❌ 不要執行任何 Migration
- ❌ 只創建設計文檔

參考：
- @docs/系統重構總設計文檔.md

開始設計。
```

### 指令模板 9: 只更新文檔

```
代碼已經完成，請更新所有相關文檔。

變更範圍：
[描述代碼變更]

需要更新的文檔：
- docs/API端點文檔.md
- docs/[功能]系統設計.md
- docs/系統架構設計.md（如有架構變更）

要求：
- ✅ 確保文檔與代碼 100% 一致
- ✅ 更新所有範例代碼
- ✅ 檢查沒有引用已刪除的內容
- ❌ 不要生成總結報告

開始更新。
```

---

## ⚠️ AI 常見錯誤與糾正

### 錯誤 1: 表面修復

```
❌ AI 說：「我在該文件中添加了 try-catch」
✅ 應該說：「我診斷發現缺乏統一錯誤處理，已建立錯誤中間件並應用到所有 API」

糾正指令：
「請不要只修復這一個 API，檢查是否所有 API 都缺乏錯誤處理，建立統一的錯誤處理機制。」
```

### 錯誤 2: 只改單一文件

```
❌ AI 說：「我修改了 tasks.css 中的按鈕樣式」
✅ 應該說：「我診斷發現所有頁面的按鈕樣式都不對，已修改組件庫的 .btn-primary」

糾正指令：
「請檢查其他頁面是否有相同問題，如果有，應該修改組件庫而非單一頁面。」
```

### 錯誤 3: 生成報告

```
❌ AI 說：「我已生成完成報告...」
✅ 應該說：「功能已完成，所有測試通過，文檔已更新。」

糾正指令：
「請刪除剛才生成的報告，我們不需要任何形式的總結報告。」
```

### 錯誤 4: 跳過設計

```
❌ AI 說：「我直接修改了代碼...」
✅ 應該說：「我已更新設計文檔，然後按照設計修改了代碼。」

糾正指令：
「請先更新設計文檔再修改代碼，這是強制要求。」
```

---

## 📖 完整協作流程示例

### 場景：開發「發票管理」功能

```
第 1 步：初始化 AI
─────────────────
「你好，請先閱讀 @docs/README.md、@docs/系統重構總設計文檔.md、@docs/問題診斷與解決流程.md 了解項目規範。」

第 2 步：開發需求
─────────────────
「開發新功能：發票管理

需求：
- 客戶可以上傳發票
- 系統自動辨識發票資訊
- 與記帳服務關聯

要求：
- 遵循 @docs/系統重構總設計文檔.md 第 6 章流程
- 資料庫命名遵循規範
- API 100% RESTful
- 使用分層架構
- 不要生成報告

開始。」

第 3 步：過程中發現問題
─────────────────────
「你在 API 中直接添加了 try-catch，這是表面修復。請使用五個為什麼診斷根本原因，建立統一的錯誤處理機制。」

第 4 步：代碼審查
─────────────────
「請審查剛才的變更，檢查是否符合所有規範，參考 @docs/系統重構總設計文檔.md。」

第 5 步：完成
─────────────
「請刪除所有測試文件，移動舊代碼到 deprecated，更新文檔。不要生成總結報告。」
```

---

## 🎓 讓 AI 記住的關鍵原則

### 每次對話開始時提醒 AI

```
重要提醒：

1. 深度診斷 - 用「五個為什麼」找根本原因
2. 系統思考 - 檢查影響範圍，全面解決
3. 模組化思維 - 修改共用模組，不重複修改
4. 文檔同步 - 改代碼立即更新文檔
5. 禁止表面修復 - 必須徹底解決問題
6. 禁止生成報告 - 完成即可，不需要總結

參考文檔：
- @docs/系統重構總設計文檔.md
- @docs/問題診斷與解決流程.md
```

---

## 📋 檢查清單：AI 是否正確執行

### 開發新功能時

```
✅ AI 先閱讀了相關設計文檔
✅ AI 創建/更新了設計文檔
✅ AI 按照 9 步驟流程執行
✅ AI 使用了分層架構
✅ AI 遵循了命名規範
✅ AI 重用了現有模組
✅ AI 更新了相關文檔
✅ AI 刪除了測試文件
❌ AI 沒有生成總結報告
```

### 修復問題時

```
✅ AI 使用了「五個為什麼」
✅ AI 找到了根本原因
✅ AI 檢查了影響範圍
✅ AI 進行了系統性解決
✅ AI 建立了預防機制
✅ AI 更新了設計文檔
❌ AI 沒有只修復表面
❌ AI 沒有只改單一文件
❌ AI 沒有生成問題列表
```

---

## 🎯 總結

### 核心指令公式

```
[操作類型] + [具體需求] + [要求和禁止項] + [參考文檔] + 開始執行
```

### 必備要素

1. **參考文檔**
   ```
   - @docs/系統重構總設計文檔.md（主要）
   - @docs/問題診斷與解決流程.md（問題）
   - @docs/開發與部署指南.md（流程）
   ```

2. **強制要求**
   ```
   - ✅ 深度診斷、系統解決
   - ✅ 遵循架構、遵循規範
   - ✅ 更新文檔、刪除舊代碼
   - ❌ 禁止表面修復
   - ❌ 禁止生成報告
   ```

3. **清晰的執行指令**
   ```
   - 「開始執行」
   - 「開始診斷」
   - 「開始審查」
   ```

---

## 💡 使用建議

### 新手使用

1. 第一次使用：複製「指令模板 1」
2. 開發功能：複製「指令模板 3」
3. 修復問題：複製「指令模板 4」

### 熟練使用

1. 使用簡化版指令
2. 只需要提醒核心規範
3. 直接開始執行

### 糾正 AI 錯誤

1. 發現表面修復 → 使用「錯誤 1」的糾正指令
2. 發現只改單一文件 → 使用「錯誤 2」的糾正指令
3. 發現生成報告 → 使用「錯誤 3」的糾正指令

---

**創建日期**: 2025-10-26  
**維護者**: 開發團隊  
**狀態**: 📘 協作指南

