# 專案管理系統設計

**版本**: 1.0  
**最後更新**: 2025-10-26

---

## 📋 功能概述

專案管理系統用於追蹤大型專案（如公司設立、併購案、特殊專案等）的進度與任務。

### 核心功能
- 專案建立與追蹤
- 專案任務管理
- 專案檢查清單
- 專案分類
- 專案進度視覺化
- 專案報表

---

## 🗄️ 資料表結構

### projects (專案)
```sql
CREATE TABLE projects (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,                -- 專案名稱
  client_name TEXT,                  -- 客戶名稱
  category TEXT,                     -- 專案分類
  description TEXT,                  -- 專案描述
  status TEXT DEFAULT 'planning',    -- planning, active, completed, on_hold, cancelled
  priority TEXT DEFAULT 'medium',    -- low, medium, high, urgent
  start_date DATE,                   -- 開始日期
  due_date DATE,                     -- 截止日期
  completed_date DATE,               -- 完成日期
  budget DECIMAL(12,2),              -- 預算
  actual_cost DECIMAL(12,2),         -- 實際成本
  assigned_to TEXT,                  -- 專案負責人
  created_by TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (client_name) REFERENCES clients(name)
);
```

### project_tasks (專案任務)
```sql
CREATE TABLE project_tasks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  project_id INTEGER NOT NULL,
  task_name TEXT NOT NULL,           -- 任務名稱
  description TEXT,
  status TEXT DEFAULT 'pending',     -- pending, in_progress, completed, blocked
  priority TEXT DEFAULT 'medium',
  assigned_to TEXT,
  due_date DATE,
  estimated_hours DECIMAL(5,2),
  actual_hours DECIMAL(5,2),
  dependencies TEXT,                 -- 依賴的任務 ID（JSON）
  completed_at DATETIME,
  completed_by TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);
```

### project_checklist (專案檢查清單)
```sql
CREATE TABLE project_checklist (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  project_id INTEGER NOT NULL,
  item_name TEXT NOT NULL,           -- 檢查項目名稱
  description TEXT,
  is_completed BOOLEAN DEFAULT 0,
  completed_by TEXT,
  completed_at DATETIME,
  sort_order INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);
```

---

## 🔄 業務流程

### 專案建立流程
```
1. 建立專案
   - 填寫專案名稱、客戶
   - 選擇專案分類
   - 設定開始與截止日期
   ↓
2. 拆分任務
   - 建立多個專案任務
   - 設定任務依賴關係
   - 指派負責人
   ↓
3. 建立檢查清單
   - 列出所有待辦事項
   - 設定排序順序
   ↓
4. 啟動專案
   - UPDATE status = 'active'
```

### 專案執行流程
```
1. 執行任務
   - 開始任務：UPDATE status = 'in_progress'
   - 記錄工時
   - 更新進度
   ↓
2. 完成檢查清單
   - 逐項勾選完成
   - 記錄完成人與時間
   ↓
3. 完成任務
   - UPDATE status = 'completed'
   - 記錄實際工時
   ↓
4. 完成專案
   - 所有任務完成
   - UPDATE status = 'completed'
   - 記錄完成日期
```

---

## 🔌 API 設計

### 取得專案列表
```
GET /api/projects?status=active&category=工商登記

Response:
{
  "success": true,
  "projects": [
    {
      "id": 1,
      "name": "ABC公司設立案",
      "client_name": "ABC科技公司",
      "category": "工商登記",
      "status": "active",
      "progress": 65,
      "due_date": "2025-11-30",
      "assigned_to": "user1"
    }
  ]
}
```

### 取得專案詳情
```
GET /api/projects/{id}

Response:
{
  "success": true,
  "project": {
    "id": 1,
    "name": "ABC公司設立案",
    "description": "...",
    "status": "active",
    "tasks": [
      {
        "id": 1,
        "task_name": "準備設立文件",
        "status": "completed",
        "assigned_to": "user1"
      }
    ],
    "checklist": [
      {
        "id": 1,
        "item_name": "收集股東證件",
        "is_completed": true
      }
    ]
  }
}
```

### 建立專案
```
POST /api/projects

Request:
{
  "name": "ABC公司設立案",
  "client_name": "ABC科技公司",
  "category": "工商登記",
  "description": "資本額500萬...",
  "start_date": "2025-10-01",
  "due_date": "2025-11-30",
  "budget": 50000,
  "assigned_to": "user1"
}

Response:
{
  "success": true,
  "project_id": 1
}
```

### 新增專案任務
```
POST /api/projects/{project_id}/tasks

Request:
{
  "task_name": "準備設立文件",
  "description": "...",
  "assigned_to": "user1",
  "due_date": "2025-10-15",
  "estimated_hours": 8
}

Response:
{
  "success": true,
  "task_id": 1
}
```

---

## 💻 前端設計

### 頁面：projects.html

#### 專案看板視圖
```
計劃中 (2)          進行中 (5)          已完成 (12)
┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│ ABC公司設立  │   │ XYZ併購案   │   │ DEF變更登記 │
│ 預算: 5萬    │   │ 預算: 20萬  │   │ 完成: 10/15 │
│ 截止: 11/30 │   │ 進度: 65%   │   │ 工時: 12h   │
└─────────────┘   └─────────────┘   └─────────────┘
```

#### 專案詳情視圖
```
ABC公司設立案
────────────────────────────────
客戶: ABC科技公司
分類: 工商登記
狀態: 進行中 (65%)
負責: user1
截止: 2025-11-30

[任務列表 (5/8 完成)]
✓ 準備設立文件
✓ 股東會議紀錄
✓ 公司章程
□ 政府登記
□ 稅籍登記

[檢查清單 (8/12 完成)]
✓ 收集股東證件
✓ 確認公司名稱
□ 營業登記
□ 開立銀行帳戶

[編輯專案] [新增任務] [檢視報表]
```

---

## 📊 統計與報表

### 專案統計
```sql
-- 專案狀態分布
SELECT 
  status,
  COUNT(*) as count,
  SUM(budget) as total_budget
FROM projects
GROUP BY status;
```

### 專案分類統計
```sql
-- 各分類專案數與預算
SELECT 
  category,
  COUNT(*) as project_count,
  SUM(budget) as total_budget,
  AVG(budget) as avg_budget
FROM projects
WHERE status != 'cancelled'
GROUP BY category
ORDER BY project_count DESC;
```

### 專案完成率
```sql
-- 專案任務完成率
SELECT 
  p.name,
  COUNT(pt.id) as total_tasks,
  SUM(CASE WHEN pt.status = 'completed' THEN 1 ELSE 0 END) as completed_tasks,
  ROUND(SUM(CASE WHEN pt.status = 'completed' THEN 1 ELSE 0 END) * 100.0 / COUNT(pt.id), 2) as completion_rate
FROM projects p
LEFT JOIN project_tasks pt ON p.id = pt.project_id
WHERE p.status = 'active'
GROUP BY p.id
ORDER BY completion_rate;
```

---

## 🚀 未來擴展

### 計劃功能
- [ ] 甘特圖視圖
- [ ] 任務依賴關係圖
- [ ] 專案範本（快速建立常見專案）
- [ ] 專案成本追蹤
- [ ] 專案文件管理
- [ ] 專案時間軸視圖
- [ ] 專案風險管理
- [ ] 專案協作（評論、附件）
- [ ] 專案複製功能

---

**相關文檔**：
- [系統架構設計.md](./系統架構設計.md) - 整體架構
- [多階段任務系統設計.md](./多階段任務系統設計.md) - 任務管理
- [API端點文檔.md](./API端點文檔.md) - API 參考

