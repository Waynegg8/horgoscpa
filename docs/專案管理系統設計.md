# 專案管理系統設計

**版本**: 1.0
**最後更新**: 2025-10-26

---

## 📋 功能概述

專案管理系統是一個獨立的功能模組，旨在追蹤和管理與標準、週期性客戶服務無關的、有明確開始和結束日期的大型或特殊任務。

### 核心功能
- **獨立專案追蹤**: 創建、更新、刪除獨立於日常客戶服務的專案。
- **關鍵資訊管理**: 管理專案的狀態、優先級、預算、成本、起訖日期等。
- **人員指派**: 將專案指派給特定使用者負責。
- **API支援**: 提供完整的 RESTful API 進行專案的增刪改查。

### 適用場景
- 公司設立或變更登記
- 財稅簽證專案
- 企業併購或重組顧問案
- 內部系統開發或流程改進專案

---

## 🗄️ 資料表結構

### projects (專案主表)
```sql
CREATE TABLE projects (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    client_id INTEGER,
    description TEXT,
    status TEXT DEFAULT 'planning' CHECK(status IN ('planning', 'in_progress', 'completed', 'on_hold', 'cancelled')),
    priority TEXT DEFAULT 'medium' CHECK(priority IN ('low', 'medium', 'high')),
    start_date DATE,
    due_date DATE,
    completed_date DATE,
    budget DECIMAL(12, 2),
    actual_cost DECIMAL(12, 2),
    assigned_to_user_id INTEGER,
    created_by_user_id INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (client_id) REFERENCES clients(id) ON DELETE SET NULL,
    FOREIGN KEY (assigned_to_user_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (created_by_user_id) REFERENCES users(id) ON DELETE SET NULL
);
```
**說明**:
- `client_id`: 關聯到 `clients` 表，表示此專案屬於哪個客戶 (可選)。
- `assigned_to_user_id`: 指派給的 `users` 表中的使用者 ID。
- `created_by_user_id`: 創建此專案的 `users` 表中的使用者 ID。
- **重要**: 專案任務的具體細項應使用統一任務系統 (`tasks` table) 進行管理，並透過 `tasks.category = 'project'` 和 `tasks.project_id` (需新增欄位) 進行關聯。目前 `projects.js` 中的任務管理功能是簡化的，應逐步淘汰。

---

## 🔌 API 設計 (`/api/projects`)

### `GET /api/projects`
獲取所有專案列表，支援篩選。
- **Query Params**:
  - `client_id` (integer)
  - `status` (string)
  - `assigned_to_user_id` (integer)
  - `category` (string)
- **權限**: 任何已登入使用者均可讀取，非管理員只能看到自己負責或創建的專案。

### `GET /api/projects/{id}`
獲取單一專案的詳細資訊。
- **權限**: 專案的負責人、創建人或管理員。

### `POST /api/projects`
創建一個新專案。
- **Request Body**: 包含專案 `name`, `client_id` 等資訊。
- **權限**: 任何已登入使用者。

### `PUT /api/projects/{id}`
更新一個已存在的專案。
- **Request Body**: 包含需要更新的欄位。
- **權限**: 專案的負責人、創建人或管理員。

### `DELETE /api/projects/{id}`
刪除一個專案。
- **權限**: 僅限管理員。

---

## 🔄 與統一任務系統的關係

雖然 `projects` 模組用於定義高層級的專案，但其下的具體執行任務、多階段流程、檢查清單等，都應回歸到**統一任務管理系統**中。

**建議的整合流程**:
1. 在 `tasks` 表中新增一個 `project_id` 欄位 (INTEGER, NULLABLE)，並建立外鍵關聯到 `projects(id)`。
2. 當使用者在專案詳情頁面新增任務時，應呼叫 `POST /api/tasks/multi-stage` API，並在請求中傳入 `project_id`。
3. 專案的進度 (`progress`) 應考慮從其關聯的 `tasks` 的完成狀態自動計算，而不是手動更新。
4. `projects.js` 中與任務 (`task`) 和檢查清單 (`checklist`) 相關的 API 端點應被標記為**待廢棄(deprecated)**，並在前端修改呼叫邏輯，統一使用 `multi-stage-tasks.js` 中的 API。

---

**相關文檔**:
- [系統架構設計.md](./系統架構設計.md)
- [任務管理系統設計.md](./任務管理系統設計.md)
- [API端點文檔.md](./API端點文檔.md)
