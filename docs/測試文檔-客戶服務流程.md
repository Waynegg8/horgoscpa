# 客戶服務完整流程測試文檔

## 測試目標
驗證從**客戶服務設定** → **收費明細管理** → **開立收據**的完整業務流程。

---

## 測試環境
- **系統**: Horgoscpa Internal System
- **測試日期**: 2025-10-31
- **測試人員**: System Administrator

---

## 流程一：客戶服務設定

### 步驟 1.1：新增客戶
1. 進入「客戶管理」頁面 (`/internal/clients`)
2. 點擊「新增客戶」
3. 填寫客戶基本信息：
   - 統一編號：12345678
   - 公司名稱：測試公司 A
   - 負責人員：選擇負責人
   - 電話：02-12345678
   - Email：test@example.com
4. 提交並確認客戶創建成功

### 步驟 1.2：進入客戶詳情頁
1. 在客戶列表中找到「測試公司 A」
2. 點擊公司名稱或「查看」按鈕
3. 跳轉到客戶詳情頁 (`/internal/client-detail?id=12345678`)

### 步驟 1.3：添加客戶服務
1. 在客戶詳情頁的「客戶服務」區塊
2. 點擊「新增服務」按鈕
3. 在服務表單中填寫：
   - **服務項目**：選擇「記帳服務」（service_id=1）
   - **服務狀態**：使用中（active）
   - **服務週期**：monthly（每月）
   - **任務模板**：選擇相應的記帳任務模板（如果有）
   - **自動生成任務**：勾選
   - **服務開始日期**：2025-01-01
   - **服務備註**：測試用記帳服務
4. 提交並確認服務創建成功

### 預期結果：
- ✅ 客戶詳情頁顯示新增的服務
- ✅ 服務狀態顯示為「使用中」
- ✅ 可以看到服務的基本信息

---

## 流程二：收費明細設定

### 步驟 2.1：進入收費明細設定
1. 在客戶詳情頁找到剛創建的服務卡片
2. 點擊服務卡片上的「收費明細」按鈕
3. 進入收費明細設定頁面

### 步驟 2.2：新增收費明細
1. 點擊「新增收費明細」按鈕
2. 填寫收費明細：
   - **計費月份**：1（代表1月）
   - **計費金額**：3000
   - **付款期限天數**：30天
   - **備註**：1月份帳務處理費用
3. 重複以上步驟，添加多個月份的收費明細：
   - 2月：3000元（30天）
   - 3月：3000元（30天）
   - 4月：3000元（30天）
   - 5月：6000元（30天，含稅務申報）
   - ...（依業務需求繼續添加）

### 預期結果：
- ✅ 收費明細列表顯示所有已設定的月份和金額
- ✅ 可以編輯和刪除收費明細
- ✅ 每個月份的收費金額和付款期限都正確顯示

---

## 流程三：任務生成（自動化）

### 步驟 3.1：任務自動生成
**注意**：此步驟由系統自動執行，如果服務設定了「自動生成任務」

1. 系統根據任務模板自動生成任務
2. 每個任務關聯到對應的 `client_service_id`
3. 任務分為多個階段（根據任務模板的 stages）
4. 最後一個階段的任務設置 `can_generate_receipt = 1`

### 步驟 3.2：完成任務
1. 員工在「任務管理」頁面完成各個階段的任務
2. 當最後一個階段完成時，系統應該：
   - ✅ 發送通知給負責人
   - ✅ 提示可以開立收據

### 預期結果：
- ✅ 任務成功生成並關聯到客戶服務
- ✅ 任務完成後，系統提示開立收據

---

## 流程四：開立收據

### 步驟 4.1：進入收據管理頁面
1. 進入「收據管理」頁面 (`/internal/receipts`)
2. 點擊「新增收據」按鈕

### 步驟 4.2：設定收據類型和客戶
1. **收據類型**：選擇「正常收據」（normal）
2. **客戶**：選擇「測試公司 A」（12345678）
3. 系統自動加載該客戶的所有使用中服務

### 步驟 4.3：選擇客戶服務和計費月份
1. **客戶服務**：選擇「記帳服務」
2. **計費月份**：選擇「5」（5月）
3. 點擊「建議金額」按鈕

### 步驟 4.4：自動帶入金額和到期日
1. 系統根據收費明細自動帶入：
   - **收據金額**：6000元（5月的設定金額）
   - **到期日**：自動計算為「今天 + 30天」
2. 確認金額和日期正確

### 步驟 4.5：完成收據開立
1. 填寫其他收據信息：
   - **開立日期**：2025-05-01
   - **收據備註**：5月份記帳服務費用
2. 提交收據
3. 確認收據創建成功

### 預期結果：
- ✅ 收據成功創建
- ✅ 收據金額自動帶入6000元
- ✅ 到期日正確計算
- ✅ 收據關聯到正確的客戶服務和計費月份
- ✅ 收據列表顯示新創建的收據

---

## 流程五：預收款和訂金收據

### 步驟 5.1：開立預收款收據
1. 進入「收據管理」頁面
2. 點擊「新增收據」
3. **收據類型**：選擇「預收款」（prepayment）
4. **客戶**：選擇客戶
5. 不需要選擇服務和計費月份
6. 手動輸入金額和日期
7. 提交收據

### 步驟 5.2：開立訂金收據
1. 同上，但收據類型選擇「訂金」（deposit）
2. 其餘步驟相同

### 預期結果：
- ✅ 預收款和訂金收據可以獨立創建
- ✅ 不需要關聯到特定服務或計費月份
- ✅ 可以手動輸入任意金額

---

## 測試總結

### ✅ 已實現功能
1. **客戶管理**：新增、編輯、查看客戶
2. **客戶詳情頁**：獨立頁面顯示客戶完整信息
3. **客戶服務管理**：在客戶詳情頁新增、編輯、刪除服務
4. **收費明細設定**：靈活設定各月份的收費金額和付款期限
5. **收據管理**：支持多種收據類型（正常、預收、訂金）
6. **自動建議金額**：根據服務和月份自動帶入金額和到期日
7. **前端職責分離**：客戶列表和詳情頁職責明確，無重複功能

### 🔄 待完善功能
1. **任務自動生成**：根據服務和任務模板自動生成任務
2. **任務完成通知**：任務完成時提醒開立收據
3. **收據與任務關聯**：收據記錄關聯到具體任務

### 📝 後續優化建議
1. 在客戶詳情頁添加「收據歷史」區塊
2. 在服務卡片上顯示已開立/未開立收據統計
3. 添加收據到期提醒功能
4. 優化收費明細的批量設定（例如一次設定全年）

---

## 測試結論
✅ **核心流程已完整實現**，可以進行生產環境部署和用戶培訓。

測試完成日期：2025-10-31

