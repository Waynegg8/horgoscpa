# 文檔結構指南

**最後更新：** 2025年10月27日  
**適用範圍：** 所有專案文檔

---

## 1. 文檔組織原則

### 1.1 分層架構

專案文檔採用**四層架構**，每層有明確的目標讀者和用途：

```
docs/
├── 功能模塊/       -- 第一層：業務功能概述
├── API規格/        -- 第二層：API 介面規格
├── 技術規格/       -- 第三層：實作細節
└── 資料庫設計/     -- 第四層：資料結構
```

**各層關係：**
```
功能模塊（What）
    ↓ 引用
API規格（How - Interface）
    ↓ 引用
技術規格（How - Implementation）
    ↓ 引用
資料庫設計（Data）
```

---

### 1.2 各層詳細說明

#### 第一層：功能模塊
- **目標讀者：** 產品經理、業務人員、管理員
- **內容：** 功能概述、使用場景、業務流程
- **行數建議：** 100-150 行
- **技術細節：** 少（只描述功能，不描述實作）

**範例檔案：**
```
docs/功能模塊/01-員工權限設定.md
docs/功能模塊/02-業務規則管理.md
docs/功能模塊/23-客戶管理.md
```

---

#### 第二層：API 規格
- **目標讀者：** 前端開發者
- **內容：** 端點路徑、請求/回應格式、錯誤處理
- **行數建議：** 40-60 行/端點
- **技術細節：** 中（介面規格，不包含實作）

**組織結構：**
```
docs/API規格/
├── 認證/
│   ├── _概覽.md        -- 模塊概覽（列出所有端點）
│   ├── 登入.md         -- 單一端點詳細規格
│   ├── 登出.md
│   └── 驗證當前會話.md
└── 客戶管理/
    ├── _概覽.md
    ├── 客戶CRUD.md
    └── 標籤管理.md
```

---

#### 第三層：技術規格
- **目標讀者：** 後端開發者、前端開發者
- **內容：** 實作邏輯、演算法、UI設計、測試案例
- **行數建議：** 80-120 行/主題
- **技術細節：** 高（詳細實作細節）

**組織結構：**
```
docs/技術規格/
├── 員工權限/
│   ├── UI設計.md           -- 前端 UI 設計
│   ├── 權限驗證邏輯.md      -- 後端實作邏輯
│   └── 測試案例.md         -- 測試規格
└── 客戶管理/
    ├── 客戶列表UI.md
    ├── 客戶表單UI.md
    ├── 業務邏輯.md
    ├── 標籤系統.md
    ├── 驗證規則.md
    └── 測試案例.md
```

---

#### 第四層：資料庫設計
- **目標讀者：** 資料庫設計師、後端開發者
- **內容：** 表格定義、欄位說明、索引、常用查詢
- **行數建議：** 80-100 行/表格
- **技術細節：** 高（完整 SQL 定義）

**組織結構：**
```
docs/資料庫設計/
├── 核心業務/
│   ├── Users.md
│   ├── Clients.md
│   └── TimeLogs.md
├── 權限系統/
│   └── ModulePermissions.md
└── 任務系統/
    ├── TaskTemplates.md
    ├── ActiveTasks.md
    └── ActiveTaskStages.md
```

---

## 2. 文檔命名規範

### 2.1 目錄命名

**使用中文，描述性名稱：**
```
✅ docs/功能模塊/
✅ docs/API規格/
✅ docs/技術規格/
✅ docs/資料庫設計/

❌ docs/features/          -- 不使用英文
❌ docs/specs/             -- 太模糊
❌ docs/文件/              -- 太籠統
```

---

### 2.2 檔案命名

**功能模塊：** `{編號}-{功能名稱}.md`
```
✅ 01-員工權限設定.md
✅ 02-業務規則管理.md
✅ 23-客戶管理.md

❌ employee-permissions.md  -- 不使用英文
❌ 功能1.md                  -- 名稱不清楚
```

**API 規格：** `{端點/功能描述}.md`
```
✅ 登入.md
✅ 獲取客戶列表.md
✅ 新增客戶.md
✅ _概覽.md               -- 概覽檔案使用底線前綴

❌ login.md              -- 不使用英文
❌ get-clients.md        -- 不使用英文
❌ api-1.md              -- 名稱不清楚
```

**技術規格：** `{技術主題}.md`
```
✅ UI設計.md
✅ 權限驗證邏輯.md
✅ 測試案例.md

❌ ui-design.md          -- 不使用英文
❌ 文件1.md              -- 名稱不清楚
```

**資料庫設計：** `{表名}.md`（與資料表同名）
```
✅ Users.md              -- 對應 Users 表
✅ ModulePermissions.md  -- 對應 ModulePermissions 表
✅ ClientTagAssignments.md

❌ users.md              -- 不使用小寫（表名是 PascalCase）
❌ 用戶表.md              -- 不使用中文（表名是英文）
```

---

## 3. 文檔內容結構

### 3.1 功能模塊文檔範本

```markdown
# {編號} - {功能名稱}

**所屬模塊：** {所屬大類}  
**頁面路徑：** `/path/to/page`  
**權限：** {權限要求}  
**最後更新：** YYYY年MM月DD日

---

## 功能概述

{簡短描述此功能的目的和核心特點}

**核心特點：**
- ✓ 特點一
- ✓ 特點二
- ✓ 特點三

---

## 使用場景

### 場景 1：{場景名稱}
{描述此場景}

### 場景 2：{場景名稱}
{描述此場景}

---

## {功能細節章節}

{根據功能性質，描述具體功能}

---

## 技術規格文檔索引

詳細的實作規格請參考：

### UI 設計與互動
- [UI設計](../../技術規格/{模塊}/UI設計.md)
- [業務邏輯](../../技術規格/{模塊}/業務邏輯.md)

### 測試
- [測試案例](../../技術規格/{模塊}/測試案例.md)

---

## API 規格索引

完整 API 設計請參考：
- [{模塊} API 概覽](../../API規格/{模塊}/_概覽.md)

---

## 資料表索引

- [TableName](../../資料庫設計/{分類}/{表名}.md)

---

## 相關文檔

- [相關功能A](./XX-功能A.md)
- [相關功能B](./YY-功能B.md)

---

**最後更新：** YYYY年MM月DD日  
**文檔版本：** X.X
```

---

### 3.2 API 規格文檔範本

```markdown
# {端點名稱}

## 端點資訊
- **路徑：** `/api/v1/{resource}`
- **方法：** `GET` / `POST` / `PUT` / `PATCH` / `DELETE`
- **權限：** 需登入，需 `{permission_name}` 權限

---

## 功能描述

{詳細說明此端點的功能}

---

## 請求參數

### URL 參數
| 參數 | 類型 | 必填 | 說明 | 範例 |
|------|------|------|------|------|
| id | string | 是 | ... | ... |

### Query 參數
| 參數 | 類型 | 必填 | 說明 | 預設值 | 範例 |
|------|------|------|------|--------|------|
| page | number | 否 | 頁碼 | 1 | 2 |

### Body 參數
| 參數 | 類型 | 必填 | 說明 | 範例 |
|------|------|------|------|------|
| field | string | 是 | ... | ... |

---

## 成功回應

### 200 OK
```json
{
  "success": true,
  "data": { ... }
}
```

---

## 錯誤回應

### 400 Bad Request
{說明}
```json
{ ... }
```

### 401 Unauthorized
{說明}

### 403 Forbidden
{說明}

### 404 Not Found
{說明}

---

## 範例

### 請求
```bash
curl -X GET "..." \
  -H "Authorization: Bearer {token}"
```

### 回應
```json
{ ... }
```

---

## 相關端點
- [端點A](./端點A.md)

## 資料表
- [TableName](../../資料庫設計/{分類}/{表名}.md)

---

**最後更新：** YYYY年MM月DD日
```

---

### 3.3 技術規格文檔範本

```markdown
# {技術主題}

**所屬功能：** {功能名稱}  
**最後更新：** YYYY年MM月DD日

---

## 概述

{簡短描述}

---

## {主要章節}

{詳細技術說明}

---

## 實作範例

```typescript
// 代碼範例
```

---

## 測試案例（如適用）

### 案例 1：{案例名稱}
- **測試內容：** ...
- **預期結果：** ...

---

## 相關文檔

- [功能模塊](../../功能模塊/XX-功能.md)
- [API 規格](../../API規格/{模塊}/_概覽.md)

---

**最後更新：** YYYY年MM月DD日
```

---

### 3.4 資料庫設計文檔範本

```markdown
# {表名}（{中文名稱}）

**所屬分類：** {分類名稱}  
**最後更新：** YYYY年MM月DD日

---

## 表格定義

```sql
CREATE TABLE {TableName} (
    -- 主鍵
    {primary_key} INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- 業務欄位
    field_name TYPE CONSTRAINTS,
    
    -- 審計欄位
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL,
    created_by INTEGER,
    updated_by INTEGER,
    
    -- 軟刪除（如適用）
    is_deleted BOOLEAN DEFAULT 0,
    deleted_at TEXT,
    deleted_by INTEGER,
    
    -- 外鍵約束
    FOREIGN KEY (foreign_key) REFERENCES OtherTable(other_key)
);
```

---

## 欄位說明

| 欄位 | 類型 | 約束 | 說明 | 範例 |
|------|------|------|------|------|
| field | TYPE | NOT NULL | ... | ... |

---

## 索引

```sql
CREATE INDEX idx_{table}_{field} ON {TableName}({field});
```

**索引說明：**
- `idx_{table}_{field}`: {為何需要此索引}

---

## 常用查詢

### 查詢所有啟用的資料
```sql
SELECT * FROM {TableName}
WHERE is_active = 1 AND is_deleted = 0;
```

### 查詢特定條件的資料
```sql
SELECT * FROM {TableName}
WHERE {condition}
ORDER BY {field};
```

---

## 關聯表格

- **{RelatedTable}**: {關聯說明}
  - 透過 `{foreign_key}` 關聯

---

## 資料驗證規則

1. **{欄位名稱}**: {驗證規則}
2. **{欄位名稱}**: {驗證規則}

---

## 相關文檔

- [功能模塊](../../功能模塊/XX-功能.md)
- [API 規格](../../API規格/{模塊}/_概覽.md)
- [其他關聯表](./RelatedTable.md)

---

**最後更新：** YYYY年MM月DD日  
**文檔版本：** X.X
```

---

## 4. 交叉引用規範

### 4.1 引用方向

**由上而下引用（功能 → API → 技術 → 資料庫）：**
```markdown
功能模塊文檔：
## 技術規格文檔索引
- [UI設計](../../技術規格/模塊/UI設計.md)

## API 規格索引
- [API 概覽](../../API規格/模塊/_概覽.md)

## 資料表索引
- [TableName](../../資料庫設計/分類/TableName.md)
```

**同層互相引用：**
```markdown
## 相關端點
- [獲取列表](./獲取列表.md)
- [創建資源](./創建資源.md)
```

**由下而上引用（資料庫 → 技術 → API → 功能）：**
```markdown
資料庫設計文檔：
## 相關文檔
- [功能模塊](../../功能模塊/01-功能.md)
- [API 規格](../../API規格/模塊/端點.md)
```

---

### 4.2 引用格式

**相對路徑：**
```markdown
✅ [功能名稱](../../功能模塊/01-功能.md)
✅ [API 端點](../../API規格/模塊/端點.md)

❌ [功能名稱](/docs/功能模塊/01-功能.md)  -- 不使用絕對路徑
```

**章節引用：**
```markdown
✅ [功能名稱 - 使用場景](../../功能模塊/01-功能.md#使用場景)
```

---

## 5. 文檔大小建議

### 5.1 行數建議

| 文檔類型 | 建議行數 | 最大行數 |
|----------|----------|----------|
| 功能模塊 | 100-150 | 200 |
| API 規格（單一端點） | 40-60 | 80 |
| API 概覽 | 30-50 | 70 |
| 技術規格 | 80-120 | 150 |
| 資料庫設計（單一表格） | 80-100 | 120 |

**超過建議行數時：**
1. 檢查是否可拆分成多個文檔
2. 檢查是否有重複內容
3. 檢查是否過於詳細（應移至技術規格層）

---

### 5.2 拆分原則

**功能模塊拆分：**
```
原文檔：客戶管理（300行）

拆分為：
- 客戶基本管理（150行）
- 客戶標籤管理（100行）
- 客戶服務設定（150行）
```

**API 規格拆分：**
```
原文檔：客戶 API（200行）

拆分為：
- _概覽.md（列出所有端點，50行）
- 客戶CRUD.md（包含增刪改查，80行）
- 標籤管理.md（包含標籤相關端點，60行）
```

---

## 6. 版本管理

### 6.1 版本號規則

**格式：** `主版本.次版本`

**範例：**
- `1.0` - 初版
- `1.1` - 小幅修改（新增章節、修正錯誤）
- `2.0` - 重大變更（重新組織結構）

---

### 6.2 文檔底部資訊

**每個文檔底部必須包含：**
```markdown
---

**最後更新：** 2025年10月27日  
**文檔版本：** 2.0  
**變更記錄：** 新增標籤功能相關說明
```

---

## 7. 概覽文檔（_概覽.md）

### 7.1 用途

概覽文檔用於：
1. 快速瀏覽該模塊的所有內容
2. 提供完整的端點/功能索引
3. 說明模塊整體架構

### 7.2 範本

```markdown
# {模塊名稱} - 概覽

**最後更新：** YYYY年MM月DD日

---

## 模塊說明

{簡短描述此模塊的用途}

---

## 端點列表

### 認證
| 端點 | 方法 | 路徑 | 說明 | 文檔 |
|------|------|------|------|------|
| 登入 | POST | /api/v1/auth/login | 用戶登入 | [查看](./登入.md) |
| 登出 | POST | /api/v1/auth/logout | 用戶登出 | [查看](./登出.md) |

### CRUD 操作
| 端點 | 方法 | 路徑 | 說明 | 文檔 |
|------|------|------|------|------|
| 列表 | GET | /api/v1/clients | 獲取客戶列表 | [查看](./客戶CRUD.md#列表) |
| 單一 | GET | /api/v1/clients/:id | 獲取單一客戶 | [查看](./客戶CRUD.md#單一) |
| 創建 | POST | /api/v1/clients | 創建客戶 | [查看](./客戶CRUD.md#創建) |
| 更新 | PUT | /api/v1/clients/:id | 更新客戶 | [查看](./客戶CRUD.md#更新) |
| 刪除 | DELETE | /api/v1/clients/:id | 刪除客戶 | [查看](./客戶CRUD.md#刪除) |

---

## 相關資料表

- [Clients](../../資料庫設計/核心業務/Clients.md)
- [ClientTags](../../資料庫設計/核心業務/ClientTags.md)

---

## 權限要求

此模塊的所有端點需要以下權限：
- **登入：** 是
- **模塊權限：** `client_management`

---

**最後更新：** YYYY年MM月DD日
```

---

## 8. Markdown 格式規範

### 8.1 標題層級

```markdown
# 文檔標題（H1）- 每個文檔只有一個

## 主要章節（H2）

### 子章節（H3）

#### 小節（H4）- 避免使用更深層級
```

---

### 8.2 列表格式

**無序列表：**
```markdown
- 項目一
- 項目二
  - 子項目
  - 子項目
- 項目三
```

**有序列表：**
```markdown
1. 步驟一
2. 步驟二
3. 步驟三
```

**核心特點列表（使用 ✓）：**
```markdown
**核心特點：**
- ✓ 特點一
- ✓ 特點二
- ✓ 特點三
```

---

### 8.3 表格格式

```markdown
| 欄位 | 類型 | 必填 | 說明 | 範例 |
|------|------|------|------|------|
| id | number | 是 | 唯一識別碼 | 1 |
| name | string | 是 | 名稱 | "John" |
```

---

### 8.4 代碼區塊

**標註語言：**
```markdown
```typescript
const user: User = { ... };
```

```sql
SELECT * FROM Users;
```

```json
{ "success": true }
```

```bash
curl -X GET "..."
```
```

---

### 8.5 強調格式

```markdown
**粗體：** 重要內容
*斜體：* 強調（少用）
`代碼：` 變數名、檔案名、指令
```

---

## 9. AI 開發文檔檢查清單

### 9.1 新增文檔前

- [ ] 確定文檔應該屬於哪一層（功能/API/技術/資料庫）
- [ ] 檢查是否已有類似文檔（避免重複）
- [ ] 確定文檔命名（遵循命名規範）
- [ ] 確定文檔大小（是否需要拆分）

### 9.2 撰寫文檔時

- [ ] 使用正確的範本
- [ ] 包含所有必要章節
- [ ] 遵循 Markdown 格式規範
- [ ] 代碼範例使用正確的語言標註
- [ ] 表格對齊正確

### 9.3 完成文檔後

- [ ] 行數符合建議範圍
- [ ] 交叉引用已建立
- [ ] 相關文檔已更新（雙向連結）
- [ ] 概覽文檔已更新（如適用）
- [ ] 文檔底部資訊已填寫

---

## 10. 相關文檔

- [專案開發規格總覽](../AI開發指南/專案開發規格總覽.md)
- [代碼規範](./代碼規範.md)
- [API 標準規範](../API設計/00-API標準規範.md)

---

**最後更新：** 2025年10月27日  
**文檔版本：** 1.0

