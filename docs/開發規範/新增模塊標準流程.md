# 新增功能模塊的標準流程

**最後更新：** 2025年10月27日

---

## 標準流程

未來若要新增「模塊九：資產管理」，**必須**遵循以下步驟：

---

## 步驟一：定義 Schema

在 `資料庫設計/` 中新增表格文檔：

```sql
-- docs/資料庫設計/資產管理/Assets.md

CREATE TABLE Assets (
  asset_id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  category TEXT,
  purchase_date TEXT,
  value REAL,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);
```

---

## 步驟二：建立後端 API

```
1. 建立 Service：worker/src/services/asset.service.ts
2. 建立 Repository：worker/src/repositories/asset.repository.ts
3. 建立 Route：worker/src/routes/assets.routes.ts
4. 在 index.ts 中掛載路由
```

### Service 範例

```typescript
// services/asset.service.ts
export class AssetService {
  constructor(private db: D1Database) {}
  
  async getAssets() {
    const repo = new AssetRepository(this.db);
    return await repo.findAll();
  }
}
```

---

## 步驟三：建立前端頁面

```
1. 建立頁面：frontend/src/pages/Assets.vue
2. 建立 API Service：frontend/src/api/asset.api.ts
3. 建立 Store：frontend/src/stores/asset.store.ts
4. 在 router 中註冊路由
5. 重用共用組件：<StyledTable>, <StyledButton> 等
```

### API Service 範例

```typescript
// api/asset.api.ts
import { api } from './base.api';

export const assetAPI = {
  async getAssets() {
    return await api.get('/assets');
  },
  
  async createAsset(data: any) {
    return await api.post('/assets', data);
  }
};
```

---

## 步驟四：整合權限系統

### 新增權限記錄

```sql
-- 在 ModulePermissions 中為所有用戶新增記錄
INSERT INTO ModulePermissions (user_id, module_name, has_access)
SELECT user_id, 'assets', 0
FROM Users;
```

### 管理介面

在「員工權限設定」頁面中新增勾選框：`[ ] 資產管理`

---

## 步驟五：創建功能文檔

1. **功能模塊文檔**：`docs/功能模塊/23-資產管理.md`
2. **技術規格文檔**：`docs/技術規格/資產管理/`
3. **API 規格文檔**：`docs/API規格/資產管理/`
4. **資料庫設計文檔**：`docs/資料庫設計/資產管理/Assets.md`

---

## 步驟六：測試

1. 建立測試案例
2. 執行單元測試
3. 執行集成測試
4. 驗證權限控制

---

## 檢查清單

- [ ] 資料表已定義並建立索引
- [ ] 後端 API 完整實作（Service + Repository + Route）
- [ ] 前端頁面完整實作（Page + Component + Store + API）
- [ ] 權限系統已整合
- [ ] 功能文檔已完成
- [ ] 測試案例已執行通過
- [ ] 使用共用組件（無重複實作）
- [ ] 遵循命名規範
- [ ] API 使用 /api/v1/ 前綴
- [ ] 錯誤處理符合標準

---

## 相關文檔

- [開發規範](../開發規範.md)
- [代碼規範](./代碼規範.md)
- [後端開發規範](./後端開發規範.md)
- [前端開發規範](./前端開發規範.md)

---

**最後更新：** 2025年10月27日



**最後更新：** 2025年10月27日

---

## 標準流程

未來若要新增「模塊九：資產管理」，**必須**遵循以下步驟：

---

## 步驟一：定義 Schema

在 `資料庫設計/` 中新增表格文檔：

```sql
-- docs/資料庫設計/資產管理/Assets.md

CREATE TABLE Assets (
  asset_id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  category TEXT,
  purchase_date TEXT,
  value REAL,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);
```

---

## 步驟二：建立後端 API

```
1. 建立 Service：worker/src/services/asset.service.ts
2. 建立 Repository：worker/src/repositories/asset.repository.ts
3. 建立 Route：worker/src/routes/assets.routes.ts
4. 在 index.ts 中掛載路由
```

### Service 範例

```typescript
// services/asset.service.ts
export class AssetService {
  constructor(private db: D1Database) {}
  
  async getAssets() {
    const repo = new AssetRepository(this.db);
    return await repo.findAll();
  }
}
```

---

## 步驟三：建立前端頁面

```
1. 建立頁面：frontend/src/pages/Assets.vue
2. 建立 API Service：frontend/src/api/asset.api.ts
3. 建立 Store：frontend/src/stores/asset.store.ts
4. 在 router 中註冊路由
5. 重用共用組件：<StyledTable>, <StyledButton> 等
```

### API Service 範例

```typescript
// api/asset.api.ts
import { api } from './base.api';

export const assetAPI = {
  async getAssets() {
    return await api.get('/assets');
  },
  
  async createAsset(data: any) {
    return await api.post('/assets', data);
  }
};
```

---

## 步驟四：整合權限系統

### 新增權限記錄

```sql
-- 在 ModulePermissions 中為所有用戶新增記錄
INSERT INTO ModulePermissions (user_id, module_name, has_access)
SELECT user_id, 'assets', 0
FROM Users;
```

### 管理介面

在「員工權限設定」頁面中新增勾選框：`[ ] 資產管理`

---

## 步驟五：創建功能文檔

1. **功能模塊文檔**：`docs/功能模塊/23-資產管理.md`
2. **技術規格文檔**：`docs/技術規格/資產管理/`
3. **API 規格文檔**：`docs/API規格/資產管理/`
4. **資料庫設計文檔**：`docs/資料庫設計/資產管理/Assets.md`

---

## 步驟六：測試

1. 建立測試案例
2. 執行單元測試
3. 執行集成測試
4. 驗證權限控制

---

## 檢查清單

- [ ] 資料表已定義並建立索引
- [ ] 後端 API 完整實作（Service + Repository + Route）
- [ ] 前端頁面完整實作（Page + Component + Store + API）
- [ ] 權限系統已整合
- [ ] 功能文檔已完成
- [ ] 測試案例已執行通過
- [ ] 使用共用組件（無重複實作）
- [ ] 遵循命名規範
- [ ] API 使用 /api/v1/ 前綴
- [ ] 錯誤處理符合標準

---

## 相關文檔

- [開發規範](../開發規範.md)
- [代碼規範](./代碼規範.md)
- [後端開發規範](./後端開發規範.md)
- [前端開發規範](./前端開發規範.md)

---

**最後更新：** 2025年10月27日



