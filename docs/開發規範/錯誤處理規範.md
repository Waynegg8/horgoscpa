# éŒ¯èª¤è™•ç†è¦ç¯„

**é©ç”¨ç¯„åœï¼š** å‰å¾Œç«¯çµ±ä¸€éŒ¯èª¤è™•ç†  
**æœ€å¾Œæ›´æ–°ï¼š** 2025å¹´10æœˆ27æ—¥

---

## AppError éŒ¯èª¤é¡åˆ¥

```typescript
// errors/AppError.ts
export class AppError extends Error {
  constructor(
    public code: string,
    public message: string,
    public statusCode: number = 500,
    public details?: any
  ) {
    super(message);
    this.name = 'AppError';
  }
}
```

---

## æ¨™æº–éŒ¯èª¤ä»£ç¢¼

| éŒ¯èª¤ä»£ç¢¼ | HTTP | èªªæ˜ | ç¯„ä¾‹ |
|----------|------|------|------|
| `VALIDATION_ERROR` | 422 | é©—è­‰å¤±æ•— | æ¬„ä½æ ¼å¼ä¸æ­£ç¢º |
| `UNAUTHORIZED` | 401 | æœªç™»å…¥ | Token ç„¡æ•ˆ |
| `FORBIDDEN` | 403 | ç„¡æ¬Šé™ | éç®¡ç†å“¡ |
| `NOT_FOUND` | 404 | è³‡æºä¸å­˜åœ¨ | å®¢æˆ¶ä¸å­˜åœ¨ |
| `CONFLICT` | 409 | è³‡æºè¡çª | çµ±ä¸€ç·¨è™Ÿå·²å­˜åœ¨ |
| `INTERNAL_ERROR` | 500 | ä¼ºæœå™¨éŒ¯èª¤ | æœªé æœŸçš„éŒ¯èª¤ |

---

## ä½¿ç”¨ç¯„ä¾‹

### Service å±¤
```typescript
async getClient(clientId: string): Promise<Client> {
  const client = await this.repository.findById(clientId);
  
  if (!client) {
    throw new AppError('NOT_FOUND', 'å®¢æˆ¶ä¸å­˜åœ¨', 404);
  }
  
  return client;
}

async createClient(data: CreateClientRequest): Promise<Client> {
  if (!data.company_name) {
    throw new AppError('VALIDATION_ERROR', 'å…¬å¸åç¨±ç‚ºå¿…å¡«', 422);
  }

  const existing = await this.repository.findById(data.client_id);
  if (existing) {
    throw new AppError('CONFLICT', 'çµ±ä¸€ç·¨è™Ÿå·²å­˜åœ¨', 409);
  }

  return this.repository.create(data);
}
```

### å…¨å±€éŒ¯èª¤è™•ç†
```typescript
app.onError((err, c) => {
  console.error('Error:', err);
  
  if (err instanceof AppError) {
    return c.json({
      success: false,
      error: {
        code: err.code,
        message: err.message,
        details: err.details
      }
    }, err.statusCode);
  }
  
  return c.json({
    success: false,
    error: {
      code: 'INTERNAL_ERROR',
      message: 'ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤'
    }
  }, 500);
});
```

---

## éŒ¯èª¤å›æ‡‰æ ¼å¼

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "å®¢æˆ¶ä¸å­˜åœ¨",
    "details": {
      "clientId": "12345678"
    }
  }
}
```

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [API å…±ç”¨è¦ç¯„](../APIè¦æ ¼/APIå…±ç”¨è¦ç¯„.md)
- [éŒ¯èª¤ç¢¼é€ŸæŸ¥è¡¨](../å¿«é€Ÿåƒè€ƒ/éŒ¯èª¤ç¢¼é€ŸæŸ¥è¡¨.md)

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025å¹´10æœˆ27æ—¥

