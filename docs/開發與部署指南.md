# é–‹ç™¼èˆ‡éƒ¨ç½²æŒ‡å—

**ç‰ˆæœ¬**: 2.0  
**æœ€å¾Œæ›´æ–°**: 2025-10-26

---

## ğŸ¯ æ ¸å¿ƒé–‹ç™¼åŸå‰‡

### âš ï¸ æœ€é‡è¦ï¼šå…ˆæ”¹è¨­è¨ˆï¼Œå†æ”¹ä»£ç¢¼

**ä»»ä½•åŠŸèƒ½ä¿®æ”¹æˆ–æ–°å¢ï¼Œå¿…é ˆéµå¾ªä»¥ä¸‹é †åºï¼š**

1. **ç¬¬ä¸€æ­¥ï¼šæ›´æ–°è¨­è¨ˆæ–‡æª”**
   - æ‰¾åˆ°å°æ‡‰çš„è¨­è¨ˆæ–‡æª”ï¼ˆåœ¨ `docs/` ç›®éŒ„ï¼‰
   - æ›´æ–°åŠŸèƒ½æè¿°ã€è³‡æ–™è¡¨çµæ§‹ã€API è¨­è¨ˆ
   - ç¢ºä¿è¨­è¨ˆå®Œæ•´ã€æ¸…æ™°ã€å¯è¡Œ

2. **ç¬¬äºŒæ­¥ï¼šæŒ‰è¨­è¨ˆå¯¦æ–½**
   - åš´æ ¼æŒ‰ç…§è¨­è¨ˆæ–‡æª”é€²è¡Œé–‹ç™¼
   - è³‡æ–™åº«é·ç§»ã€å¾Œç«¯ APIã€å‰ç«¯ä»‹é¢
   - ä¸è¦åœ¨å¯¦æ–½éç¨‹ä¸­éš¨æ„è®Šæ›´è¨­è¨ˆ

3. **ç¬¬ä¸‰æ­¥ï¼šæ¸¬è©¦èˆ‡æ¸…ç†**
   - æ¸¬è©¦åŠŸèƒ½æ˜¯å¦ç¬¦åˆè¨­è¨ˆè¦æ±‚
   - æ¸¬è©¦é€šéå¾Œç«‹å³åˆªé™¤æ¸¬è©¦è…³æœ¬
   - ä¸ä¿ç•™ä»»ä½•ä¸­é–“æª”æ¡ˆ

4. **ç¬¬å››æ­¥ï¼šåŒæ­¥æ–‡æª”**
   - å¦‚æœ‰è¨­è¨ˆè®Šæ›´ï¼Œç«‹å³å›é ­æ›´æ–°è¨­è¨ˆæ–‡æª”
   - ä¿æŒæ–‡æª”èˆ‡ä»£ç¢¼ 100% åŒæ­¥

### å…¶ä»–é–‹ç™¼åŸå‰‡

#### è‡ªå‹•åŒ–æ¸¬è©¦èˆ‡é©—è­‰
- âœ… å®ŒæˆåŠŸèƒ½å¾Œç«‹å³æ¸¬è©¦
- âœ… æ¸¬è©¦é€šéæ‰èƒ½ç¹¼çºŒä¸‹ä¸€æ­¥
- âŒ ä¸ä¿ç•™æ¸¬è©¦è…³æœ¬å’Œè‡¨æ™‚æª”æ¡ˆ

#### ç³»çµ±æ•´åˆå„ªå…ˆ
- âœ… æ‰€æœ‰æ–°åŠŸèƒ½å¿…é ˆèˆ‡ç¾æœ‰ç³»çµ±å®Œç¾æ•´åˆ
- âœ… æª¢æŸ¥æ˜¯å¦å·²æœ‰ç›¸ä¼¼åŠŸèƒ½ï¼Œé¿å…é‡è¤‡
- âŒ ä¸å‰µå»ºç¨ç«‹çš„ã€ä¸æ•´åˆçš„åŠŸèƒ½

#### ä¿æŒå°ˆæ¡ˆæ•´æ½”
- âœ… æ¸¬è©¦å®Œæˆç«‹å³åˆªé™¤ä¸­é–“æª”æ¡ˆ
- âœ… åŠæ™‚åˆªé™¤éæ™‚æ–‡æª”
- âŒ ä¸ç”Ÿæˆå®Œæˆå ±å‘Šã€ç¸½çµã€å¿«é€Ÿå•Ÿå‹•ç­‰æ–‡ä»¶
- âŒ ä¸ä¿ç•™è‡¨æ™‚æ¸¬è©¦æª”æ¡ˆ

---

## ğŸ“ ä»£ç¢¼è¦ç¯„

### Git Commit æ ¼å¼
```
ç°¡æ½”æè¿°è®Šæ›´å…§å®¹ï¼ˆç¹é«”ä¸­æ–‡ï¼‰

ä¾‹å¦‚ï¼š
- æ–°å¢å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–åŠŸèƒ½
- ä¿®å¾©å ±è¡¨ç”ŸæˆéŒ¯èª¤
- æ›´æ–° API ç«¯é»æ–‡æª”
```

### JavaScript/TypeScript
```javascript
// ä½¿ç”¨ ES6+ èªæ³•
const result = await fetchData();

// éŒ¯èª¤è™•ç†
try {
  const data = await apiCall();
} catch (error) {
  console.error('æ“ä½œå¤±æ•—:', error);
  throw new Error('è‡ªå®šç¾©éŒ¯èª¤è¨Šæ¯');
}

// API Response æ ¼å¼
return new Response(JSON.stringify({
  success: true,
  data: result
}), {
  headers: { 'Content-Type': 'application/json' }
});
```

### SQL
```sql
-- è¡¨åä½¿ç”¨å°å¯«åŠ åº•ç·š
CREATE TABLE client_services (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id INTEGER NOT NULL
);

-- ç´¢å¼•å‘½å: idx_è¡¨å_æ¬„ä½å
CREATE INDEX idx_client_services_client ON client_services(client_id);
```

---

## ğŸ—„ï¸ è³‡æ–™åº«è¦ç¯„

### Migration å‘½å
```
001_åŠŸèƒ½æè¿°.sql
002_åŠŸèƒ½æè¿°.sql
```

### åŸ·è¡Œé †åº
```bash
# 1. æœ¬åœ°æ¸¬è©¦
npx wrangler d1 execute timesheet-db --local --file=migrations/XXX.sql

# 2. ç¢ºèªç„¡èª¤å¾Œéƒ¨ç½²åˆ°é ç«¯
npx wrangler d1 execute timesheet-db --remote --file=migrations/XXX.sql
```

### è³‡æ–™åº«æ“ä½œåŸå‰‡
- âœ… ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢é˜²æ­¢ SQL æ³¨å…¥
- âœ… å»ºç«‹é©ç•¶çš„ç´¢å¼•å„ªåŒ–æŸ¥è©¢
- âœ… ä½¿ç”¨äº‹å‹™è™•ç†é—œè¯æ“ä½œ
- âœ… å®šæœŸå‚™ä»½è³‡æ–™åº«

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### è‡ªå‹•éƒ¨ç½²è¨­å®š

**âœ… å·²å•Ÿç”¨ GitHub Actions è‡ªå‹•éƒ¨ç½²**

æœ¬ç³»çµ±å·²é…ç½®å®Œæ•´çš„è‡ªå‹•åŒ–éƒ¨ç½²æµç¨‹ï¼š

1. **æ¨é€åˆ° main åˆ†æ”¯æ™‚è‡ªå‹•éƒ¨ç½²**
   - ä»£ç¢¼æ¨é€åˆ° GitHub main åˆ†æ”¯
   - GitHub Actions è‡ªå‹•åŸ·è¡Œ
   - è‡ªå‹•éƒ¨ç½² Worker åˆ°ç”Ÿç”¢ç’°å¢ƒ
   - ç„¡éœ€æ‰‹å‹•æ“ä½œ

2. **æ¯æ—¥è‡ªå‹•ç”Ÿæˆå®¢æˆ¶æœå‹™ä»»å‹™**
   - æ¯å¤© 00:00 (å°åŒ—æ™‚é–“) è‡ªå‹•åŸ·è¡Œ
   - GitHub Actions èª¿ç”¨ `/api/automated-tasks/generate`
   - è‡ªå‹•å‰µå»ºåˆ°æœŸçš„å®¢æˆ¶æœå‹™ä»»å‹™

3. **æ‰‹å‹•è§¸ç™¼éƒ¨ç½²**
   - å¯åœ¨ GitHub Actions é é¢æ‰‹å‹•è§¸ç™¼
   - é©ç”¨æ–¼ç·Šæ€¥éƒ¨ç½²æˆ–æ¸¬è©¦

### è‡ªå‹•éƒ¨ç½²æ­¥é©Ÿï¼ˆGitHub Actionsï¼‰

#### 1. è‡ªå‹• Worker éƒ¨ç½²
åœ¨ `.github/workflows/deploy.yml` é…ç½®ï¼š

```yaml
name: éƒ¨ç½²åˆ° Cloudflare Workers

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: å®‰è£ä¾è³´
        run: |
          cd timesheet-api
          npm ci
      - name: éƒ¨ç½²åˆ° Cloudflare
        run: |
          cd timesheet-api
          npx wrangler deploy
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
```

#### 2. è‡ªå‹•ä»»å‹™ç”Ÿæˆ
åœ¨ `.github/workflows/auto-generate-tasks.yml` é…ç½®ï¼š

```yaml
name: è‡ªå‹•ç”Ÿæˆå®¢æˆ¶æœå‹™ä»»å‹™

on:
  schedule:
    - cron: '0 16 * * *'  # æ¯å¤© 00:00 å°åŒ—æ™‚é–“ (UTC+8)
  workflow_dispatch:

jobs:
  generate-tasks:
    runs-on: ubuntu-latest
    steps:
      - name: èª¿ç”¨ä»»å‹™ç”Ÿæˆ API
        run: |
          curl -X POST https://timesheet-api.hergscpa.workers.dev/api/automated-tasks/generate \
            -H "Authorization: Bearer ${{ secrets.API_TOKEN }}" \
            -H "Content-Type: application/json"
```

### æ‰‹å‹•éƒ¨ç½²æ­¥é©Ÿï¼ˆåƒ…ç‰¹æ®Šæƒ…æ³ï¼‰

#### 1. è³‡æ–™åº«é·ç§»
```bash
cd timesheet-api

# å‚™ä»½ï¼ˆå»ºè­°å…ˆå‚™ä»½ï¼‰
npx wrangler d1 execute timesheet-db --remote --command="SELECT name FROM sqlite_master" > backup.sql

# åŸ·è¡Œé·ç§»
npx wrangler d1 execute timesheet-db --remote --file=migrations/XXX.sql
```

#### 2. Worker éƒ¨ç½²ï¼ˆæ‰‹å‹•ï¼‰
```bash
# ç”Ÿç”¢ç’°å¢ƒ
npx wrangler deploy

# é è¦½ç’°å¢ƒ
npx wrangler deploy --env preview
```

#### 3. é©—è­‰éƒ¨ç½²
```bash
# æª¢æŸ¥ API ç‹€æ…‹
curl https://timesheet-api.hergscpa.workers.dev/api/verify

# æª¢æŸ¥è³‡æ–™åº«é€£æ¥
npx wrangler d1 execute timesheet-db --remote --command="SELECT COUNT(*) FROM users;"
```

### éƒ¨ç½²æ³¨æ„äº‹é …

- âœ… **æ¨è–¦**ï¼šä½¿ç”¨ GitHub Actions è‡ªå‹•éƒ¨ç½²
- âš ï¸ **è³‡æ–™åº«é·ç§»**ï¼šé¦–æ¬¡é·ç§»å»ºè­°æ‰‹å‹•åŸ·è¡Œä¸¦é©—è­‰
- âš ï¸ **ç’°å¢ƒè®Šæ•¸**ï¼šç¢ºä¿ GitHub Secrets å·²æ­£ç¢ºé…ç½®
- âœ… **é›¶åœæ©Ÿæ™‚é–“**ï¼šCloudflare Workers æ”¯æ´ç„¡ç¸«éƒ¨ç½²

---

## ğŸ”§ é–‹ç™¼ç’°å¢ƒè¨­å®š

### æœ¬åœ°é–‹ç™¼
```bash
cd timesheet-api

# å®‰è£ä¾è³´
npm install

# å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
npx wrangler dev --local --persist-to .wrangler/state
```

### ç’°å¢ƒè®Šæ•¸
åœ¨ `wrangler.jsonc` ä¸­é…ç½®ï¼š
```json
{
  "name": "timesheet-api",
  "main": "src/index.js",
  "compatibility_date": "2025-10-26",
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "timesheet-db",
      "database_id": "your-database-id"
    }
  ]
}
```

---

## ğŸ“¦ API è¨­è¨ˆåŸå‰‡

### ç«¯é»å‘½å
```
GET    /api/è³‡æºåç¨±          # ç²å–åˆ—è¡¨
GET    /api/è³‡æºåç¨±/:id      # ç²å–å–®å€‹
POST   /api/è³‡æºåç¨±          # å‰µå»º
PUT    /api/è³‡æºåç¨±/:id      # æ›´æ–°
DELETE /api/è³‡æºåç¨±/:id      # åˆªé™¤
```

### å›æ‡‰æ ¼å¼
```javascript
// æˆåŠŸ
{
  "success": true,
  "data": { ... }
}

// å¤±æ•—
{
  "success": false,
  "error": "éŒ¯èª¤è¨Šæ¯"
}
```

### éŒ¯èª¤è™•ç†
```javascript
// çµ±ä¸€éŒ¯èª¤è™•ç†
try {
  // æ¥­å‹™é‚è¼¯
} catch (error) {
  return new Response(JSON.stringify({
    success: false,
    error: error.message
  }), {
    status: 500,
    headers: { 'Content-Type': 'application/json' }
  });
}
```

---

## ğŸ§ª æ¸¬è©¦è¦ç¯„

### API æ¸¬è©¦
```bash
# æœ¬åœ°æ¸¬è©¦
curl http://localhost:8787/api/endpoint

# ç”Ÿç”¢æ¸¬è©¦
curl https://your-worker.workers.dev/api/endpoint
```

### åŠŸèƒ½æ¸¬è©¦æª¢æŸ¥æ¸…å–®
- [ ] API æ­£å¸¸å›æ‡‰
- [ ] è³‡æ–™åº«æ“ä½œæˆåŠŸ
- [ ] éŒ¯èª¤è™•ç†æ­£ç¢º
- [ ] èªè­‰æˆæ¬Šæœ‰æ•ˆ
- [ ] å‰ç«¯æ•´åˆç„¡èª¤

---

## ğŸ“š æ–‡æª”ç¶­è­·

### æ–‡æª”æ›´æ–°åŸå‰‡
- âœ… åŠŸèƒ½è®Šæ›´å¿…é ˆæ›´æ–°æ–‡æª”
- âœ… é‡å¤§è®Šæ›´éœ€è¦ç‰ˆæœ¬æ¨™è¨˜
- âœ… éæ™‚å…§å®¹åŠæ™‚åˆªé™¤
- âŒ ä¸ç”Ÿæˆè‡¨æ™‚å ±å‘Š
- âŒ ä¸ä¿ç•™éæ™‚æ–‡æª”

### ç•¶å‰æ–‡æª”çµæ§‹
```
docs/
â”œâ”€â”€ README.md                         # æ–‡æª”å°èˆªï¼ˆå¾é€™è£¡é–‹å§‹ï¼‰
â”œâ”€â”€ ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md                   # â­ ç¸½é«”æ¶æ§‹ï¼ˆå¿…è®€ï¼‰
â”œâ”€â”€ å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md         # è©³ç´°åŠŸèƒ½è¨­è¨ˆ
â”œâ”€â”€ å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–å¯¦æ–½ç¸½çµ.md         # å¯¦æ–½è¨˜éŒ„
â”œâ”€â”€ é–‹ç™¼èˆ‡éƒ¨ç½²æŒ‡å—.md                 # æœ¬æ–‡ä»¶ï¼ˆé–‹ç™¼è¦ç¯„ï¼‰
â”œâ”€â”€ APIç«¯é»æ–‡æª”.md                    # API åƒè€ƒæ‰‹å†Š
â”œâ”€â”€ GitHub Actionsè¨­å®š.md             # è‡ªå‹•åŒ–é…ç½®
â”œâ”€â”€ SEOéƒ¨ç½²æŒ‡å—.md                    # SEO å„ªåŒ–
â””â”€â”€ timesheet-api/
    â”œâ”€â”€ README.md
    â””â”€â”€ è³‡æ–™åº«é‚„åŸæŒ‡å—.md
```

**âš ï¸ ä¿®æ”¹åŠŸèƒ½å‰å¿…è®€ï¼š**
1. å…ˆçœ‹ [ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md](./ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md) ç­è§£æ•´é«”
2. æ‰¾åˆ°å°æ‡‰çš„è©³ç´°è¨­è¨ˆæ–‡æª”
3. æ›´æ–°è¨­è¨ˆæ–‡æª”
4. å†é–‹å§‹å¯«ä»£ç¢¼

---

## ğŸ” å®‰å…¨è¦ç¯„

### èªè­‰èˆ‡æˆæ¬Š
```javascript
// æª¢æŸ¥èªè­‰
const auth = await requireAuth(env.DB, request);
if (!auth.authorized) {
  return jsonResponse({ error: 'Unauthorized' }, 401);
}

// æª¢æŸ¥æ¬Šé™
if (auth.user.role !== 'admin') {
  return jsonResponse({ error: 'Forbidden' }, 403);
}
```

### è³‡æ–™é©—è­‰
```javascript
// è¼¸å…¥é©—è­‰
if (!data.email || !data.email.includes('@')) {
  return jsonResponse({ error: 'ç„¡æ•ˆçš„é›»å­éƒµä»¶' }, 400);
}

// SQL æ³¨å…¥é˜²è­·
const result = await db.get(
  'SELECT * FROM users WHERE id = ?',
  [userId]  // ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢
);
```

---

## ğŸ†˜ å¸¸è¦‹å•é¡Œ

### Q: å¦‚ä½•æ¸¬è©¦ APIï¼Ÿ
A: ä½¿ç”¨ `curl` æˆ– Postman æ¸¬è©¦ç«¯é»ï¼Œç¢ºä¿å›æ‡‰æ­£ç¢ºã€‚

### Q: è³‡æ–™åº«é·ç§»å¤±æ•—æ€éº¼è¾¦ï¼Ÿ
A: æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯ï¼Œæª¢æŸ¥ SQL èªæ³•ï¼Œå¿…è¦æ™‚å›æ»¾ã€‚åƒè€ƒ [è³‡æ–™åº«é‚„åŸæŒ‡å—](./timesheet-api/è³‡æ–™åº«é‚„åŸæŒ‡å—.md)ã€‚

### Q: å¦‚ä½•æ–°å¢ API ç«¯é»ï¼Ÿ
A: 
1. åœ¨ `src/index.js` æ·»åŠ è·¯ç”±
2. å¯¦ç¾è™•ç†å‡½æ•¸
3. æ›´æ–° [APIç«¯é»æ–‡æª”.md](./APIç«¯é»æ–‡æª”.md)
4. æ¸¬è©¦ç«¯é»

---

**æç¤º**ï¼šé–‹ç™¼æ™‚éµå¾ªé€™äº›è¦ç¯„ï¼Œä¿æŒä»£ç¢¼æ•´æ½”ã€ç³»çµ±ç©©å®šã€‚

