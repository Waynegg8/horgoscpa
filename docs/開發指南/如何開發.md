# 如何開發

**給 AI：** 開發任何功能的標準流程

---

## 🚀 開發流程

### 1. 閱讀對應的完整規格
```
用戶說："開發客戶管理功能"
  ↓
AI 閱讀：開發指南/客戶管理-完整規格.md
  ↓
理解：資料表、API、前端組件、業務邏輯
  ↓
開始實現
```

### 2. 按順序實現

#### 步驟1：創建資料表
```sql
-- 根據規格文檔中的 CREATE TABLE
-- 複製貼上即可
```

#### 步驟2：實現後端
```
1. Repository 層（資料存取）
2. Service 層（業務邏輯）
3. Route 層（API 端點）
```

#### 步驟3：實現前端
```
1. API Service（調用後端）
2. Page 組件（頁面）
3. 子組件（表單、列表等）
```

#### 步驟4：測試
```
1. 測試 API 端點
2. 測試權限控制
3. 測試前端功能
```

---

## 📁 項目結構

### 後端（Cloudflare Workers）
```
timesheet-api/
├── src/
│   ├── routes/
│   │   ├── clients.ts
│   │   ├── timelogs.ts
│   │   ├── leave.ts
│   │   └── index.ts
│   ├── services/
│   │   ├── ClientService.ts
│   │   ├── TimeLogService.ts
│   │   └── LeaveService.ts
│   ├── repositories/
│   │   ├── ClientRepository.ts
│   │   ├── TimeLogRepository.ts
│   │   └── LeaveRepository.ts
│   ├── middleware/
│   │   ├── auth.ts
│   │   └── error.ts
│   └── index.ts
├── wrangler.toml
└── schema.sql
```

### 前端（Vue.js）
```
src/
├── pages/
│   ├── ClientsPage.vue
│   ├── TimesheetPage.vue
│   ├── LeavePage.vue
│   └── DashboardPage.vue
├── components/
│   ├── shared/
│   │   ├── StyledButton.vue
│   │   ├── StyledInput.vue
│   │   └── Modal.vue
│   └── clients/
│       ├── ClientList.vue
│       └── ClientForm.vue
├── api/
│   ├── clients.js
│   ├── timelogs.js
│   └── leave.js
├── router/
│   └── index.js
└── App.vue
```

---

## 🔧 實現規範

### 後端三層架構

#### Repository 層（資料存取）
```typescript
// 只負責 SQL 操作
class ClientRepository {
  async findAll(filters) {
    // 執行 SQL
  }
  async create(data) {
    // INSERT
  }
}
```

#### Service 層（業務邏輯）
```typescript
// 負責驗證、業務規則、權限
class ClientService {
  async getClients(filters, user) {
    // 權限過濾
    if (!user.is_admin) {
      filters.assignee_user_id = user.user_id;
    }
    return await this.repository.findAll(filters);
  }
  
  async createClient(data, userId) {
    // 驗證
    this.validate(data);
    // 檢查唯一性
    // 創建
  }
}
```

#### Route 層（API 端點）
```typescript
// 只負責接收請求、調用 Service、返回響應
app.get('/api/v1/clients', authMiddleware, async (c) => {
  const service = new ClientService(c.env.DB);
  const result = await service.getClients(c.req.query(), c.get('user'));
  return c.json(successResponse(result));
});
```

---

## 📝 共用規範

### API 響應格式
```json
// 成功
{
  "success": true,
  "data": { ... }
}

// 錯誤
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "錯誤訊息"
  }
}
```

### 權限控制
```typescript
// 前端路由
{ path: '/admin/*', meta: { requireAdmin: true } }

// 後端 API
app.post('/api/v1/admin/*', requireAdmin, handler);

// Service 層資料過濾
if (!user.is_admin) {
  filters.user_id = user.user_id;
}
```

### 錯誤處理
```typescript
throw new ValidationError('訊息');  // 422
throw new NotFoundError('訊息');    // 404
throw new ConflictError('訊息');    // 409
throw new ForbiddenError('訊息');   // 403
```

---

## 🎯 開發檢查清單

開發任何功能前，確認：

- [ ] 已閱讀對應的完整規格文檔
- [ ] 理解資料表結構
- [ ] 理解 API 端點
- [ ] 理解權限控制規則
- [ ] 理解業務邏輯流程

實現完成後，確認：

- [ ] 資料表已創建，索引已建立
- [ ] API 端點已實現，測試通過
- [ ] 權限控制已實現（管理員/員工）
- [ ] 前端頁面已實現，可以使用
- [ ] 錯誤處理完整
- [ ] 驗證規則正確

---

## 📚 完整規格文檔清單

### 核心功能
- [客戶管理-完整規格.md](./客戶管理-完整規格.md)
- [工時管理-完整規格.md](./工時管理-完整規格.md)
- [假期管理-完整規格.md](./假期管理-完整規格.md)
- [任務管理-完整規格.md](./任務管理-完整規格.md)

### 系統設定（管理員）
- [業務規則-完整規格.md](./業務規則-完整規格.md)
- [員工管理-完整規格.md](./員工管理-完整規格.md)

### 共用規範
- [共用規範.md](./共用規範.md) - API格式、權限、錯誤處理等

---

**AI 開發時只需要閱讀"開發指南"目錄下的文檔即可！**

