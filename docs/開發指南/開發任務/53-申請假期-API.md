# 開發任務 53：申請假期 API

**對應規格：** 後端 `docs/開發指南/後端/假期管理-後端規格.md`

**對應手冊：** `docs/使用手冊/功能模組-05-假期管理.md`

## 範圍

實作 `POST /api/v1/leave/applications` API，允許員工申請假期。

## 輸入

- `leave_type_id`（假別 ID，必填）
- `start_date`（起始日期，YYYY-MM-DD，必填）
- `end_date`（結束日期，YYYY-MM-DD，必填）
- `days`（天數，必填）
- `hours`（小時數，選填）
- `reason`（原因，選填，最多 200 字）

## 輸出

- 成功：201，返回申請單資料
- 失敗：400/409/422，返回錯誤訊息

## 驗證與權限

- 需登入
- 員工只能申請自己的假
- 驗證規則：
  - `start_date <= end_date`
  - 不得與本人已核准/待審假期重疊
  - 假別啟用且符合性別限制
  - 餘額足夠（含生理假併入病假檢查）

## 實作重點

- 建立 `LeaveApplications` 記錄，狀態為 `pending`
- 檢查假期重疊（日期區間重疊檢查）
- 檢查餘額（查詢 `LeaveBalance` 或相關表）
- 生理假邏輯：第 1-3 日不併入病假，第 4 日起超過部分併入病假
- 遵守 JSON Envelope 格式

## 驗收標準

- [ ] API 正確建立申請單
- [ ] 驗證規則正確執行
- [ ] 重疊檢查正確
- [ ] 餘額檢查正確
- [ ] 性別限制正確
- [ ] 錯誤訊息清楚（繁體中文）
- [ ] 已部署並可透過前端呼叫







