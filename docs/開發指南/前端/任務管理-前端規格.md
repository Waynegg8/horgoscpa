## 任務管理－前端規格

**範圍**：本文件僅涵蓋 UI/UX、畫面顯示邏輯與前端驗證。完全省略資料庫、API 與後端計算邏輯。

**依據**：對應《使用手冊》中的「功能模組－任務管理」、「場景 5：月度任務自動生成」、「自動化｜每月自動執行」、「場景 10：員工使用知識庫 SOP 處理任務」，並以此為最高優先。

---

## 使用者與可見性（UI 層）

- 員工：僅能看到「自己的任務」。
- 管理員：可切換檢視「所有人的任務」或針對人員/客戶過濾。
- 任務卡/列需視角色動態顯示「負責人」欄位（員工隱藏、管理員顯示）。

---

## 頁面與元件

### 任務管理頁

- **視圖切換**：看板視圖 / 列表視圖。
- **共同功能**：
  - 搜尋：以「任務名稱、客戶名稱」關鍵字模糊搜尋。
  - 篩選：狀態（待開始、進行中、已完成）、到期狀態（全部/即將到期/已逾期）。
  - 排序：到期日（預設由近到遠）。
  - 分頁（於列表視圖）：每頁 20 筆，記憶使用者選擇。
  - 空狀態：顯示「目前沒有任務」，並提供引導文案「如需建立任務，請設定客戶服務（需權限）」；一般員工僅顯示說明，不顯示設定入口。

#### 看板視圖

欄位：
- 待開始｜進行中｜已完成

任務卡資訊：
- 任務名稱（建議格式：客戶名 − 月份 + 任務名稱，例如：「ABC科技 − 12 月記帳服務」）
- 進度摘要：已完成階段數 / 全部階段數（例：0/3）
- 到期日（例：12-31）
- SOP 標記：有 SOP 時顯示徽章「有 SOP」
- 逾期標示：到期 < 今日顯示紅色標記；距到期 ≤ 3 天顯示黃色提示

互動：
- 點擊卡片 → 開啟「任務詳情」。

#### 列表視圖

欄位：
- 任務名稱、客戶、（管理員可見）負責人、進度（x/y）、到期日、狀態徽章、SOP、有無、操作（查看、備註）

互動：
- 點擊任務列或「查看」→ 開啟「任務詳情」。
- 點擊「備註」→ 聚焦詳情中的備註輸入區。

### 任務詳情（側邊欄/彈窗）

結構：
- 標題列：任務名稱、狀態徽章、到期日、（管理員可見）負責人
- 基本資訊區：客戶、服務（唯讀）、進度條（x/y）
- SOP 區塊：
  - 通用 SOP：顯示標題與版本，提供「開啟」連結
  - 客戶專屬 SOP：顯示標題與版本，提供「開啟」連結
  - 若無對應 SOP，顯示「尚未連結 SOP」
- 附件區：
  - 目的：上傳/查看/下載/刪除任務相關附件（遵循《附件系統－前端規格》）
  - 呈現：附件列表（檔名、大小、上傳者、上傳時間）＋ 上傳元件（AttachmentUploader）
  - 權限：依附件系統規則（員工/管理員可見自身或具存取權之任務附件）
  - 限制：任務附件上限 10 筆；超出顯示禁用提示
  - 整合方式：以 `entityType = 'task'`、`entityId = task_id` 呼叫附件系統通用端點
- 階段清單（依序號遞增）：
  - 每筆顯示：序號、階段名稱、狀態、開始/完成時間（有則顯示）、操作按鈕
  - 狀態對應按鈕：
    - 待開始：顯示「開始此階段」按鈕（可能被禁用，見前端驗證）
    - 進行中：顯示「完成此階段」按鈕
    - 已完成：顯示勾選圖示，無操作
- 備註區：可編輯文字框（最大 2000 字），提供「儲存」按鈕；未變更時按鈕禁用；儲存成功顯示提示。

提示與樣式：
- 狀態色彩（建議）：
  - 待開始：灰色背景、灰邊框
  - 進行中：藍色背景、藍邊框
  - 已完成：綠色背景、綠邊框
- 逾期：整體顯示紅色角標或標籤；即將到期（≤ 3 天）顯示黃色角標
- SOP 連結於新視窗開啟，提供鍵盤可聚焦樣式

### 新任務提示（通知呈現）

- 月初自動生成任務後，於任務管理頁頂部顯示提醒條：「你有 X 個新任務，請儘速確認」。
- 提醒條可被關閉，當頁不再顯示；重新載入仍以「是否尚未閱讀新任務」的狀態決定是否顯示（狀態由系統提供）。

---

## 前端驗證與互動規則

### 角色可見性

- 員工：清單/看板只呈現屬於登入者的任務；不顯示其他人的任務或篩選器。
- 管理員：可切換「所有」或指定員工/客戶過濾。

### 階段操作前置檢查（UI 防呆）

- 「開始此階段」按鈕：
  - 階段 1 永遠可按。
  - 階段 2 以上：僅當「前一階段狀態 = 已完成」時可按。
  - 禁用時顯示說明文字：
    - 「⚠️ 請先完成『{前一階段名稱}』（階段 {n-1}）」

- 「完成此階段」按鈕：
  - 僅當「當前階段狀態 = 進行中」時可按；否則禁用並於滑鼠提示顯示：「請先開始此階段」。

### 備註欄位

- 最大長度 2000 字，超出時顯示錯誤並禁止送出。
- 按鈕僅在內容變更後啟用；儲存成功顯示「已儲存」提示；儲存失敗顯示「儲存失敗，請稍後再試」。

### SOP 連結

- 有連結時顯示「開啟」；無連結顯示「尚未連結 SOP」。
- 連結在新視窗開啟，並具可見的焦點樣式與對應的無障礙名稱。

---

## 顯示邏輯

- 進度（x/y）：x 為已完成階段數、y 為總階段數（由畫面資料直接計算）。
- 逾期/即將到期：
  - 逾期：到期日 < 今日 → 紅色警示。
  - 即將到期：距離到期 ≤ 3 天 → 黃色提示。
- 狀態徽章文案：
  - 待開始、進行中、已完成。

---

## 無障礙與國際化

- 所有互動元件可鍵盤操作（Tab/Shift+Tab 走訪、Enter/Space 觸發）。
- 為狀態徽章、SOP 連結、操作按鈕提供明確 aria-label。
- 文案可國際化：
  - 「開始此階段」「完成此階段」「有 SOP」「尚未連結 SOP」「請先完成…」「你有 X 個新任務」。

---

## 錯誤與提示文案（建議）

- 開始階段前置條件不符：
  - 「請先完成『{前一階段名稱}』（階段 {n-1}）」
- 完成階段前置條件不符：
  - 「只能完成進行中的階段，請先開始此階段」
- 儲存備註成功/失敗：
  - 成功：「已儲存」
  - 失敗：「儲存失敗，請稍後再試」

---

## 與《使用手冊》的對應關係

- 自動產生任務（每月 1 日）：任務會在列表/看板出現，並以提醒條提示「新任務」。
- 任務連結 SOP：詳情頁顯示通用與客戶專屬 SOP 的標題與開啟連結。
- 階段必須依序進行：前端按鈕狀態與禁用提示完整表現順序規則。
- 角色可見性：員工只看自己的任務，管理員可查看所有並過濾。


