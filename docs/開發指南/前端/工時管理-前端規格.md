## 工時管理－前端規格

對應使用手冊：`docs/使用手冊/功能模組-03-工時管理.md`

**對應文件：** 使用手冊《功能模組-03-工時管理》《場景-02-員工填寫日常工時》

**範圍：** 僅涵蓋 UI/UX、畫面顯示邏輯與前端驗證；不含資料庫、API 與後端計算細節。

---

## 角色與權限（UI 行為）

- **員工**：
  - 新增/編輯/刪除「自己的」工時。
  - 僅可檢視自己的工時與統計。
  - 不能檢視或編輯他人工時。
- **管理員**：
  - 可切換/篩選查看所有員工工時與統計。
  - 預設不提供代填/代編輯操作（UI 禁用或隱藏新增/編輯/刪除）。

---

## 導覽與入口

- **儀表板快速入口**：
  - 按鈕「填寫今日工時」→ 導至工時填寫頁，預選今日日期。
  - 導覽後保留返回儀表板的明確返回控制（如麵包屑或返回按鈕）。

---

## 頁面與元件

### 1) 工時填寫頁（週視圖，支援單日多筆）

- **結構**：
  - 週切換器（上一週/下一週 + 目前週期顯示）。
  - 週內 7 天區塊，每日可列出多筆工時記錄與一條「新增工時」行。
  - 週彙總區塊：本週總工時、加班工時、加權工時（以後端回傳值為準）。

- **每日區塊元素**：
  - 日期與徽章：
    - 國定假日：顯示「國定假日」徽章。
    - 例假日（通常週日）：顯示「例假日」。
    - 補班日：顯示「補班日」。
  - 工時列表：已存在的多筆記錄，逐列顯示主要欄位與操作。
  - 新增工時行：點擊後展開可編輯列或彈窗表單（擇一即可，建議行內編輯）。

### 2) 新增/編輯工時表單（行內或彈窗）

- **欄位**（均遵循使用手冊必填/選填）：
  - 日期（必填，日期選擇器；預設為當日或所選日）。
  - 客戶（必填，下拉選單，可搜尋）。
  - 服務項目（必填，下拉選單，可搜尋）。
  - 工作類型（必填，下拉選單；動態篩選，見「動態顯示與邏輯」）。
  - 工時（必填，數字輸入，0.5 的倍數；步進 0.5）。
  - 備註（選填，單行文字）。
- **操作**：儲存、取消；編輯狀態下提供刪除按鈕。
- **行為**：
  - 儲存成功後，該日列表即時插入/更新記錄並刷新當日/本週彙總。
  - 連續新增：儲存後保留先前選擇（客戶/服務/類型），提升連續填寫效率。

### 3) 記錄列顯示與操作

- 顯示欄：日期、客戶、服務、工作類型、工時、備註。
- 操作：編輯、刪除（僅限本人記錄；管理員視圖不顯示或禁用）。
- 刪除須二次確認（確認框文字見「提示與錯誤訊息」）。

### 4) 彙總與指標區塊

- 本日合計、本週合計、本月累計（總工時/加班工時/加權工時）。
- 數值以後端回傳為準；前端更新資料後需觸發重新載入彙總指標。

### 5) 管理員檢視（僅檢視）

- 追加篩選器：員工、日期區間、客戶、服務、工作類型。
- 列表呈現跨員工的記錄；所有新增/編輯/刪除操作隱藏或禁用。

---

## 動態顯示與邏輯

### 日期徽章與提示

- 國定假日/例假日/補班日由系統資料決定，前端據此顯示徽章與工具提示：
  - 補班日提示：「今日為補班日（視為平日）」。
  - 國定假日提示：「今日為國定假日」；例假日提示：「今日為例假日」。

### 工作類型下拉選單的動態篩選

- 一般工作日（非假日、非補班）：顯示「正常工時」與「平日加班（前2小時/後2小時）」。
- 休息日（通常週六）：顯示各「休息日加班」選項（前2小時/第3-8/第9-12）。
- 補班日：僅顯示「正常工時」與「平日加班（前/後2小時）」，隱藏所有「休息日加班」。
- 國定假日：顯示「國定假日」相關選項（8小時內、第9-10、第11-12）；非國定假日日期隱藏該組選項。
- 例假日：顯示「例假日」相關選項（8小時內、第9-12）；非例假日日期隱藏該組選項。

### 工時欄位的動態限制

- 選「國定假日（8小時內）」或「例假日（8小時內）」時，工時輸入的最大值動態限制為 8。超過即顯示錯誤並回退至 8。
- 其他類型最大值為 12（仍受「單日總工時上限」約束）。

### 單日總工時上限

- 同一用戶同一日期下，所有記錄合計不得超過 12 小時。
- 新增/編輯時，需即時計算「已存在記錄合計 + 當前輸入值」是否超標，超過即阻止儲存並提示。

---

## 前端驗證規則（僅列 UI 規則）

- 必填：日期、客戶、服務、工作類型、工時。
- 工時數值：
  - 僅允許 0.5 的倍數（例：0.5、1.0、1.5）。
  - 範圍 0.5–12（含）；8 小時內類型的最大值 8。
  - 輸入非 0.5 倍數時，自動四捨五入至最接近的 0.5，並提示已自動修正。
- 工作類型 X 日期條件：
  - 補班日不可選「休息日加班」。
  - 非國定假日不可選國定假日類型；非例假日不可選例假日類型。
- 單日總工時 ≤ 12：若超過，阻止儲存並顯示錯誤。

---

## 提示與錯誤訊息（文案）

- 儲存成功：
  - 「已儲存工時。」
- 刪除確認：
  - 「確定要刪除此筆工時嗎？刪除後將無法復原。」
- 欄位驗證：
  - 「請選擇日期。」/「請選擇客戶。」/「請選擇服務。」/「請選擇工作類型。」/「請輸入工時。」
  - 「工時必須是 0.5 的倍數。」
  - 「每日工時合計不可超過 12 小時。」
  - 「『8 小時內』類型的工時不可超過 8 小時。」
  - 「補班日不可選『休息日加班』。」
- 自動修正提示：
  - 「已自動將工時修正為最接近的 0.5 倍數。」

---

## 無障礙（a11y）與國際化（i18n）

- 欄位具備可見標籤與 aria-* 屬性；表單錯誤以文字提示且關聯到欄位。
- 下拉選單可鍵盤操作；儲存/取消可使用 Enter/Esc。
- 所有提示文字可國際化；時間/日期/數字遵循使用者在地化設定。

---

## 邊界情境與 UI 行為

- 當日已有多筆記錄時，新增行預設沿用上一筆的「客戶/服務/工作類型」。
- 變更日期後，工作類型清單即時重新篩選；若原選項於新日期不適用，需清除並提示。
- 網路錯誤：保留使用者輸入於暫存區，提供重試；失敗時不清空表單。

---

## 性能與互動

- 客戶/服務下拉需支援快速搜尋與虛擬清單（避免大型清單卡頓）。
- 週切換保留使用者已輸入但未儲存的內容，切換前提示是否離開/儲存。


