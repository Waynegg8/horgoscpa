# 報表分析｜前端規格（UI/UX）

> 僅包含 UI、UX、畫面顯示邏輯與前端驗證；完全省略後端與資料庫細節。

---

## 1. 目標與範圍
- 提供管理員的管理報表：
  - 客戶成本分析（含年終獎金分攤切換、管理成本警示）
  - 員工工時分析
  - 薪資報表
  - 收款報表（含帳齡分析/月度趨勢）
- 提供員工的個人報表：
  - 我的工時統計、我的假期使用（僅個人）
- 權限顯示依使用手冊：員工不可見成本/盈利等管理報表；管理員可見全部

---

## 2. 角色與可見性
- 員工：
  - 可見：我的工時統計、我的假期使用
  - 隱藏：客戶成本分析、盈利分析、應收帳款帳齡、收款報表、營收報表
- 管理員：
  - 可見：全部管理報表（客戶成本、員工工時、薪資、收款/營收、應收帳款帳齡）

> 權限不足時：隱藏頁籤與入口；若透過網址直入，顯示訊息條『您沒有權限檢視此報表』。

---

## 3. 頁面結構與主要元件

### 3.1 報表中心頁（Tab 導覽）
- Tab：
  - 客戶成本分析（管理員）
  - 員工工時分析（管理員；員工看到精簡版「我的工時」）
  - 薪資報表（管理員）
  - 收款分析（管理員）
- 共通：
  - 篩選區：日期/區間、客戶/員工（依報表而定）、查詢按鈕、重置按鈕
  - 匯出：CSV / PDF（可選；依產品策略）
  - 載入中狀態、空資料狀態（含建議文案）

### 3.2 客戶成本分析（管理員）
- 篩選區：
  - 日期區間（起訖）
  - 客戶（可選）
  - 『包含年終獎金分攤』切換（預設關閉）
  - 年底提示（UI）：若區間包含 12 月，顯示提示『建議勾選包含年終獎金以查看真實成本』
- 資料呈現：
  - 表格欄位：客戶、實際工時、加權工時、薪資成本、管理成本、年終分攤（切換時顯示）、總成本、收據金額、毛利、毛利率
  - 警示區（頂部訊息條）：
    - 管理成本未輸入：『本期間管理成本未輸入，僅含薪資成本』
    - 管理成本不完整：『管理成本尚未完整輸入，目前僅包含：項目A、B』
- 視覺化：
  - 長條圖：客戶毛利率排名（X=客戶、Y=毛利率）
- 互動：
  - 點擊列可展開『員工明細』：實際/加權工時、時薪成本率、薪資/管理成本拆分、年終分攤占比

### 3.3 員工工時分析
- 篩選區：
  - 年/月（必填）、員工（可選）
- 資料呈現：
  - 員工卡片：總工時、正常工時、加班工時、可計費/非計費、使用率
  - 客戶工時分布（餅圖）：各客戶工時占比
  - 每日工時（折線圖）：日期-工時趨勢
- 員工視角（員工登入）：僅顯示本人資料；移除跨員工清單

### 3.4 薪資報表（管理員）
- 篩選區：年/月（必填）、員工（可選）
- 資料呈現：
  - 匯總卡：總底薪、津貼、獎金、加班費、總薪資、淨發
  - 表格（每位員工）：底薪、津貼、獎金、加班費、應發、淨發、是否全勤

### 3.5 收款分析（管理員）
- 篩選區：日期區間（必填）
- 資料呈現：
  - 匯總卡：總開立、已收、應收、收款率
  - 月度趨勢（折線）：開立 vs 收款
  - 客戶清單：各客戶的開立/已收/應收
  - 帳齡分析入口（導向應收帳款頁）

---

## 4. 交互流程（UX）
- 查詢：
  - 填寫篩選 → 點擊查詢 → 顯示載入動畫 → 結束後渲染表格與圖表
- 切換『包含年終獎金』：
  - 即時重新查詢並更新成本欄位與毛利率
- 警示顯示：
  - 若回傳 warnings，於頁面頂部顯示訊息條（可含缺漏項目清單）
- 匯出：
  - 依目前篩選條件匯出資料；匯出過程顯示進度/成功提示

---

## 5. 前端驗證與錯誤訊息
- 篩選表單：
  - 日期必填且有效；開始日期不得晚於結束日期 → 『請選擇有效日期區間』
  - 年/月必填（員工工時、薪資報表） → 『請選擇查詢月份』
- 權限：
  - 員工嘗試查看管理報表 → 顯示『您沒有權限檢視此報表』
- 請求錯誤：
  - 顯示後端 message；未知錯誤顯示『查詢失敗，請稍後再試』

---

## 6. 狀態與樣式
- 狀態提示：
  - 成功查詢：Toast『已更新』
  - 警示：藍色/黃色訊息條含說明與建議動作（例如導向管理成本設定）
- 圖表樣式：
  - 毛利率顏色：>0 綠色；≤0 紅色
  - 使用率以進度條顯示百分比

---

## 7. 無障礙與可用性
- 鍵盤操作：Tab 巡覽、Enter 觸發查詢
- 篩選元件提供明確 aria-label
- 圖表提供替代數值表格切換

---

## 8. 業務需求對應（覆蓋檢核）
- 角色可視：員工（僅個人報表）、管理員（全部管理報表）
- 客戶成本分析：加權工時概念提示、年終獎金切換、管理成本警示
- 員工工時分析：月度工時分布、客戶占比、使用率
- 薪資報表：月度薪資匯總與個人明細
- 收款報表：應收、收款率、月度趨勢與按客戶明細
