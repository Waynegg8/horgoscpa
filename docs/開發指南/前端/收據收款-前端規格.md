## 收據收款－前端規格

**範圍**：僅涵蓋 UI/UX、畫面顯示邏輯與前端驗證；不含資料庫、API 與後端計算。

**依據**：對應《使用手冊》「功能模組－收據收款管理」「場景 6：開立收據並記錄收款」，並優先滿足其業務需求；技術細節以《收據收款－完整規格》為參考。

---

## 角色可見性與行為（UI）

- 員工：
  - 可開立收據、查看所有收據列表、編輯收據、記錄收款、查看應收帳款。
  - 無「作廢收據」操作入口。
- 管理員：
  - 具上述全部能力，且可作廢收據、查看帳齡分析、查看收款統計與營收報表入口。
  - 「作廢」按鈕僅管理員可見。

---

## 頁面與元件

### 收據列表頁（ReceiptListPage）

- 篩選與搜尋：
  - 依狀態：未收款、部分收款、已收款、已作廢（多選）。
  - 日期區間：開立日期起訖；到期日起訖。
  - 客戶：下拉搜尋（支援模糊）。
  - 關鍵字：收據號碼、客戶名稱、備註。
- 排序：
  - 預設依開立日期（新→舊）；可切換到期日、金額、狀態。
- 表格欄位：
  - 收據號碼、客戶、開立日、到期日、總金額、已收金額、應收餘額、狀態徽章。
  - 逾期標示：`到期日 < 今日 且 狀態 ≠ 已收款/已作廢` → 以紅色角標或列高亮。
  - 客戶收款備註：以 tooltip 或次欄顯示（來自客戶資料），輔助收款。
- 操作：
  - 查看/編輯、記錄收款、（管理員）作廢。
  - 右上角「開立收據」按鈕。
- 空狀態：顯示「尚無收據」，並提供「開立收據」主動引導。

### 開立/編輯收據（ReceiptFormModal / Page）

- 欄位與互動：
  - 客戶（必填，下拉）
  - 開立日期（必填，預設今日）
  - 到期日（選填，日期選擇器）
  - 收據號碼區塊：
    - 預設顯示「自動生成」的預覽欄位（唯讀）。
    - 可切換為「手動輸入」：
      - 輸入格式驗證：`^\d{6}-\d{3}$`（YYYYMM-NNN）。
      - 失焦即時驗證唯一性：顯示三態 UI（檢查中 / 可用 / 已存在）。
      - 錯誤文案：
        - 格式錯誤：「格式錯誤（應為：YYYYMM-NNN）」
        - 已存在：「此收據號碼已存在，請更換」
  - 項目明細（可多筆）：
    - 服務項目（下拉，從該客戶的服務清單）
    - 數量（預設 1，>0，允許小數）
    - 單價（≥0）
    - 小計（即時計算，數量 × 單價）
    - 刪除/新增列按鈕
  - 總金額（自動；所有小計加總；⚠️ 無稅額顯示）
  - 備註（選填，最多 1000 字）
- 驗證規則：
  - 必填：客戶、開立日期、至少 1 筆有效項目（數量>0、單價≥0）。
  - 手動收據號碼：格式正確且唯一。
  - 總金額需 > 0。
- 提示與狀態：
  - 儲存成功：toast「已開立收據」或「已更新收據」。
  - 取消：關閉時有未儲存變更警示。

### 記錄收款（PaymentRecordModal）

- 欄位：
  - 收款日期（必填，預設今日）
  - 金額（必填，>0，且 ≤ 應收餘額）
  - 收款方式：現金 / 轉帳 / 支票（必填）
  - 參考號碼（選填）
  - 備註（選填，最多 500 字）
- 顯示資訊：
  - 應收餘額與本次入帳後的預估餘額（即時計算）。
- 驗證與提示：
  - 金額超過餘額時，顯示錯誤並禁用送出：「金額不可超過應收餘額」。
  - 成功後關閉並回寫列表/詳情之狀態與金額。

### 帳齡分析（ARAgingPage，管理員）

- 檢視：
  - 匯總卡片：總應收、逾期 1–30 / 31–60 / 61–90 / >90 天。
  - 客戶維度彙總表：各區間金額與客戶收款備註。
  - 明細表：每張收據的到期日、逾期天數、餘額、備註。
- 篩選：查詢日（as-of date）、客戶、狀態（未收/部分收）。
- 匯出：CSV/Excel（可選）。

---

## 顯示與狀態規則（前端）

- 逾期：`到期日 < 今日 且 狀態 ≠ 已收款/已作廢` → 以紅色顯示。
- 狀態徽章文案與色彩：
  - 未收款：紅色
  - 部分收款：橘色
  - 已收款：綠色
  - 已作廢：灰色
- 金額顯示：使用地區貨幣格式化；總金額為各項目小計合計（無稅額）。

---

## 無障礙與國際化

- 互動元件提供可見焦點、鍵盤操作（Tab/Enter/Space）。
- 為狀態徽章、作廢按鈕、記錄收款按鈕與收據號碼驗證結果提供 aria-label。
- 文案可國際化：
  - 「開立收據」「記錄收款」「作廢」「格式錯誤（應為：YYYYMM-NNN）」「此收據號碼已存在」「金額不可超過應收餘額」。

---

## 錯誤與提示文案（建議）

- 收據號碼格式錯誤：
  - 「格式錯誤（應為：YYYYMM-NNN）」
- 收據號碼已存在：
  - 「此收據號碼已存在，請更換」
- 項目驗證不通過：
  - 「至少需 1 筆有效項目（數量>0、單價≥0）」
- 記錄收款金額超額：
  - 「金額不可超過應收餘額」
- 儲存成功：
  - 「已開立收據」／「已更新收據」／「已記錄收款」

---

## 與《使用手冊》的對應

- 開立收據：完整覆蓋必填欄位、項目小計與總金額（無稅額）、收據號碼規則（自動/手動、格式、唯一性）。
- 記錄收款：金額不得超過餘額、支持多次部分收款，成功後更新狀態與餘額。
- 應收帳款：列表與逾期高亮、顯示客戶收款備註；管理員提供帳齡分析檢視。
- 角色差異：員工無作廢權限，管理員具作廢與報表分析入口。


