# 知識管理（內部知識庫）｜前端規格（UI/UX）

對應使用手冊：`docs/使用手冊/功能模組-09-知識管理（內部知識庫）.md`

> 僅包含 UI、UX、畫面顯示邏輯與前端驗證；完全省略後端與資料庫細節。

---

## 1. 目標與範圍
- 管理內部 SOP 文件與工作流程文件
- 員工可：查看／新增／編輯 SOP、指派客戶專屬 SOP、查看客戶專屬 SOP
- 管理員可：管理所有 SOP、刪除 SOP、指派客戶專屬 SOP
- 支援：分類、標籤、發布狀態、版本呈現、附件上傳與下載、改進建議提交

---

## 2. 角色與可見性（前端層級）
- 員工
  - 可見按鈕：新增 SOP、編輯、發布/取消發布、指派客戶 SOP、提交建議
  - 不可見：刪除 SOP（隱藏刪除按鈕與入口）
- 管理員
  - 可見按鈕：新增 SOP、編輯、發布/取消發布、指派客戶 SOP、刪除 SOP、提交建議

> 若使用者無權限，相關按鈕不渲染；若透過 URL 直入，顯示「權限不足」訊息條。

---

## 3. 主要畫面與元件

### 3.1 SOP 列表頁
- 篩選/搜尋
  - 關鍵字搜尋（標題、標籤；300ms debounce）
  - 分類下拉：全部｜記帳流程｜稅務流程｜工商登記｜內部…
  - 標籤多選（可清空）
  - 發布狀態切換：全部｜已發布｜草稿
- 列表卡片欄位
  - 標題、分類、版本徽章（v1、v2…）、發布狀態徽章（已發布/草稿）
  - 標籤 chips
  - 附件指示（有附件時顯示圖示與數量）
  - 操作：查看、（有權限時）編輯
- 其他
  - 右上角「新增 SOP」（員工/管理員可見）
  - 空狀態：顯示「尚無 SOP」，員工/管理員顯示「新增 SOP」快捷

### 3.2 SOP 詳情頁
- 頂部區塊
  - 標題、版本徽章、發布狀態徽章
  - 分類、標籤 chips
  - 操作按鈕：
    - 編輯（員工/管理員）
    - 發布/取消發布（員工/管理員）
    - 指派給客戶（員工/管理員）
    - 刪除（僅管理員）
    - 建議修改（所有人可見；用於提交改進建議）
- 內容區
  - SOP 內容（富文本呈現，支援標題/清單/表格/連結）
- 附件區
  - 附件清單（檔名、大小、上傳者、上傳時間）
  - 下載按鈕；（有權限時）新增附件、移除附件
- 客戶專屬 SOP 區（可折疊）
  - 已指派之客戶清單（搜尋/分頁）
  - 「指派給客戶」按鈕（開啟指派對話框）
- 建議區（可折疊）
  - 最近建議列表（內容截斷、提交者、時間）；點擊展開全文

### 3.3 SOP 編輯頁/對話框
- 表單欄位
  - 標題（必填）
  - 分類（選填，下拉選單）
  - 標籤（多選）
  - 內容編輯器（必填；工具列含粗體/斜體/清單/表格/連結）
  - 發布（切換；預設關閉）
  - 附件上傳（拖放/選檔；可多檔）
- 操作按鈕
  - 取消、儲存（通過驗證前為禁用）
- 儲存成功後
  - 顯示 Toast「已儲存」；返回詳情頁並刷新內容

### 3.4 指派客戶對話框
- 欄位
  - 搜尋客戶（輸入後顯示清單，可選一個）
  - 備註（選填）
- 提示
  - 若客戶已關聯該 SOP，顯示『此客戶已指派該 SOP』
- 結果
  - 成功後 Toast「已指派給客戶」；詳情頁客戶清單即時更新

### 3.5 提交建議對話框
- 欄位
  - 建議內容（必填，最多 500 字）
- 結果
  - 成功後 Toast「已送出建議」；詳情頁建議區顯示最新建議

---

## 4. 操作流程（UX）
- 新增 SOP：列表頁 → 新增 SOP → 填寫表單 → 儲存（可同時發布）
- 編輯 SOP：詳情頁 → 編輯 → 修改內容/附件/標籤 → 儲存
- 發布/取消發布：詳情頁切換發布狀態 → 確認 → 成功提示
- 指派客戶 SOP：詳情頁 → 指派給客戶 → 選客戶 → 確認 → 成功提示
- 提交建議：詳情頁 → 建議修改 → 填寫 → 送出 → 成功提示

---

## 5. 狀態與樣式
- 版本徽章：vN（藍色）
- 發布狀態徽章：已發布（綠）／草稿（灰）
- 附件指示：附件圖示 + 數量（深灰）
- 權限不足：在頂部顯示紅色訊息條『您沒有權限執行此操作』

---

## 6. 前端驗證與錯誤訊息
- SOP 表單
  - 標題：必填；最長 100 字 → 『請輸入標題（最多 100 字）』
  - 內容：必填；（富文本至少含一段文字）→ 『請輸入內容』
  - 標籤：最多 10 個 → 『最多可選 10 個標籤』
  - 附件：
    - 單檔大小 ≤ 10MB、總數 ≤ 10 個
    - 檔案型別：pdf、docx、xlsx、csv、png、jpg
    - 錯誤訊息：
      - 『每個附件大小不可超過 10MB』
      - 『最多上傳 10 個附件』
      - 『不支援的檔案格式』
- 指派對話框
  - 客戶必選 → 『請選擇客戶』
  - 已存在關聯 → 顯示『此客戶已指派該 SOP』
- 建議對話框
  - 內容必填；最長 500 字 → 『請輸入建議（最多 500 字）』
- 通用
  - 權限不足：『您沒有權限執行此操作』
  - 未知錯誤：『操作失敗，請稍後再試』

---

## 7. 提示訊息（Toast／訊息條）
- 新增/儲存 SOP：『已儲存』
- 發布 SOP：『已發布』／『已取消發布』
- 指派客戶 SOP：『已指派給客戶』
- 上傳附件：『附件已上傳』；移除附件：『附件已移除』
- 提交建議：『已送出建議』

---

## 8. 無障礙與可用性
- 表單主要動作鍵盤可達：Enter 送出、Esc 關閉
- 對話框開啟聚焦第一欄位
- 元件狀態變更（發布、指派、上傳）皆有明確提示

---

## 9. 與其他模組的 UI 整合（僅前端表現）
- 任務詳情頁（由任務模組實作）若有關聯 SOP：顯示『有 SOP』提示與快速連結（通用 SOP 與客戶專屬 SOP）

---

## 10. 覆蓋之業務需求（對應）
- 角色與權限可視：員工可新增/編輯/發布/指派、管理員另含刪除
- SOP 欄位：標題、內容、分類、標籤、版本、發布、附件
- 客戶專屬 SOP：指派與查看（唯一性提示）
- 改善建議：提供『建議修改』入口與提交流程
