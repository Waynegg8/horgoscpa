# 開始前檢查清單

**給 AI：每次收到用戶需求後，先完成這個清單，再開始開發！**

---

## ✅ 第一步：確認編碼（必須！）

```
[ ] 確認終端編碼是 UTF-8
[ ] 確認讀取文件使用 UTF-8 編碼
[ ] 確認寫入文件使用 UTF-8 編碼
[ ] PowerShell 腳本必須 UTF-8 with BOM
```

## ⚠️ 重要：PowerShell 命令語法限制

**🚨 絕對不能使用 `&&` 操作符！**

```
❌ 錯誤寫法：
npm install && npm run build

✅ 正確寫法：
npm install; if ($LASTEXITCODE -eq 0) { npm run build }

✅ 或使用分號：
npm install; npm run build
```

**原因：** PowerShell 不支持 `&&` 操作符，會導致命令執行失敗！

**替代方案：**
- 使用 `;` 分隔命令
- 使用 `if ($LASTEXITCODE -eq 0) { ... }` 檢查前一個命令是否成功
- 使用 `try-catch` 語句處理錯誤

**測試命令：**
```powershell
# 測試能否正確讀取繁體中文
Get-Content "docs\README.md" -Encoding UTF8 | Select-Object -First 5
# 應該看到清晰的繁體中文，不是亂碼
```

**如果看到亂碼 → 停止！先解決編碼問題！**

---

## ✅ 第二步：理解需求

**用戶說：** "開發客戶管理功能"

**你要做：**
1. [ ] 確認是哪個功能模塊（客戶管理）
2. [ ] 確認需要做什麼（開發 = 資料表 + API + 前端）
3. [ ] 確認有沒有特殊要求

---

## ✅ 第三步：閱讀完整規格

```
[ ] 找到對應的完整規格文檔
    開發指南/客戶管理-完整規格.md
    
[ ] 從頭到尾完整閱讀一遍

[ ] 理解以下內容：
    - 需要哪些資料表
    - 需要哪些 API 端點
    - 需要哪些前端組件
    - 有哪些業務規則
    - 有哪些驗證規則
```

**不要跳過這一步！完整規格包含所有細節！**

---

## ✅ 第四步：列出需要修改的文檔

**根據功能類型，列出清單：**

### 新增功能
```
[ ] 使用手冊/XX管理.md（新建）
[ ] 開發指南/XX管理-完整規格.md（新建）
[ ] 系統資料/數據表清單.md（如有新表）
[ ] 系統資料/API清單.md（如有新API）
[ ] 完整功能清單.md（更新功能列表）
[ ] 其他使用手冊的"相關功能"部分（補充引用）
```

### 修改現有功能
```
[ ] 使用手冊/XX管理.md（更新）
[ ] 開發指南/XX管理-完整規格.md（更新）
[ ] 系統資料/數據表清單.md（如有表結構變動）
[ ] 系統資料/API清單.md（如有API變動）
[ ] 相關功能的使用手冊（更新引用）
```

### 新增資料表
```
[ ] 系統資料/數據表清單.md（SSOT - 必須！）
[ ] 開發指南/XX管理-完整規格.md（定義表結構）
[ ] 所有提到資料表數量的文檔（搜索並更新）
```

### 新增API
```
[ ] 系統資料/API清單.md（SSOT - 必須！）
[ ] 開發指南/XX管理-完整規格.md（定義API）
[ ] 所有提到API數量的文檔（搜索並更新）
```

---

## ✅ 第五步：準備驗證命令

**複製這些命令，準備好待用：**

```powershell
# 檢查資料表數量一致性
cd docs
Get-ChildItem -Filter "*.md" -Recurse | Select-String "個.*表" | ForEach-Object {
    if ($_.Line -match '(\d+)個') { "$($_.FileName): $($matches[1])個" }
} | Sort-Object | Get-Unique

# 檢查API數量一致性
Get-ChildItem -Filter "*.md" -Recurse | Select-String "個.*API" | ForEach-Object {
    if ($_.Line -match '(\d+)個') { "$($_.FileName): $($matches[1])個" }
} | Sort-Object | Get-Unique

# 檢查SSOT真相
Get-Content "系統資料\數據表清單.md" | Select-String "資料表總覽"
Get-Content "系統資料\API清單.md" | Select-String "總計"
```

---

## ✅ 第六步：確認編碼設定（再次確認！）

```
[ ] 所有讀取操作都使用 UTF-8
[ ] 所有寫入操作都使用 UTF-8
[ ] 如果要寫 PowerShell 腳本，確保 UTF-8 with BOM
```

**常用編碼代碼片段：**

```javascript
// Node.js 讀取
const fs = require('fs');
const content = fs.readFileSync('docs/README.md', 'utf-8');

// Node.js 寫入
fs.writeFileSync('docs/README.md', content, 'utf-8');
```

```python
# Python 讀取
with open('docs/README.md', 'r', encoding='utf-8') as f:
    content = f.read()

# Python 寫入
with open('docs/README.md', 'w', encoding='utf-8') as f:
    f.write(content)
```

```powershell
# PowerShell 讀取
$content = Get-Content "docs\README.md" -Encoding UTF8

# PowerShell 寫入
$content | Out-File "docs\README.md" -Encoding UTF8
```

---

## ✅ 第七步：最終確認

```
[ ] 我已經閱讀了完整規格
[ ] 我知道要修改哪些文檔
[ ] 我已經準備好驗證命令
[ ] 我確認所有操作使用 UTF-8 編碼
[ ] 我記得要檢查一致性
[ ] 我不會問技術問題
[ ] 我會自己測試驗證（絕不讓用戶測試！）⚠️

✅ 現在可以開始開發了！
```

---

## 🧪 開發完成後：自行測試（必須！）

**開發完成 ≠ 可以說完成**

**必須先完成以下測試：**

### 測試清單

```
□ 功能測試
  - 所有功能都能正常運作
  - 按鈕、表單、連結都能使用
  
□ 邊界條件測試
  - 測試空值、超長文字、特殊字符
  
□ 錯誤處理測試
  - 必填欄位、格式驗證、權限檢查
  
□ 權限測試
  - 管理員、員工權限分別測試
  
□ 中文編碼測試 ⚠️
  - 繁體中文顯示正確
  - 儲存讀取沒有亂碼
  
□ 資料一致性測試
  - 新增、修改、刪除、查詢都正常
```

### 快速測試方法

```javascript
// 1. 測試 API
const result = await testFunction();
console.log('結果：', result);

// 2. 測試繁體中文
const chineseText = '繁體中文測試';
const saved = await save(chineseText);
const loaded = await load(saved.id);
assert(loaded.text === chineseText, '中文應該相同');

// 3. 測試權限
const adminResult = await testAsAdmin();
const employeeResult = await testAsEmployee();
assert(adminResult.success === true, '管理員應該成功');
assert(employeeResult.forbidden === true, '員工應該被拒絕');
```

### 測試通過後的下一步

```
測試通過 ≠ 可以說完成

還需要：
□ 自動部署上線 ⚠️
□ 驗證線上環境正常

然後才能說完成！
```

---

## 🚀 測試完成後：自動部署（必須！）

**測試通過後，必須自動部署！**

**絕對不讓用戶手動部署！用戶沒有技術背景！**

### 部署步驟

```powershell
# 使用自動部署腳本
.\scripts\deploy.ps1

# 或手動執行：
git add .
git commit -m "新增XX功能：功能描述"
git push origin main
```

### 部署後驗證

```
□ Cloudflare Pages 建置成功
□ 網站能正常訪問
□ 新功能正常運作
□ 繁體中文顯示正確
□ 沒有控制台錯誤
```

### 最終回報格式

```
❌ 錯誤：「已完成XX功能，已自行測試通過」
   → 沒有部署就說完成

✅ 正確：「已完成XX功能，已自行測試通過，已自動部署上線！」
   → 附上測試報告 + 部署報告 + 線上網址
```

---

## 🚨 常見錯誤（必須避免！）

❌ **使用 PowerShell 不支持的 `&&` 操作符**
```
後果：命令執行失敗，開發流程中斷
正確：使用 ; 分隔命令或 if ($LASTEXITCODE -eq 0) 檢查
```

❌ **直接開始寫代碼，沒有閱讀完整規格**
```
後果：做錯功能、遺漏需求
正確：先讀完整規格，理解所有細節
```

❌ **忘記更新文檔**
```
後果：文檔與代碼不一致
正確：列出需要修改的文檔清單
```

❌ **沒有檢查編碼**
```
後果：中文變亂碼
正確：確認所有操作使用 UTF-8
```

❌ **開發完就說完成，沒有驗證一致性**
```
後果：數字不一致、引用缺失
正確：執行一致性驗證命令
```

❌ **修改數字時，只改了一個文檔**
```
後果：文檔不一致
正確：搜索所有相關文檔，逐一更新
```

---

## 📋 印出來貼在牆上

```
=====================================
    AI 開發前檢查清單
=====================================

□ 1. 編碼確認（UTF-8）
□ 2. 理解需求
□ 3. 閱讀完整規格
□ 4. 列出文檔清單
□ 5. 準備驗證命令
□ 6. 再次確認編碼
□ 7. 最終確認

✅ 全部完成 → 開始開發
❌ 有任何未完成 → 停止，先完成

=====================================
```

---

**每次開發前都要過一遍這個清單！養成習慣！**

