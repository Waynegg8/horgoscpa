# ä»»å‹™ç®¡ç†ç³»çµ±è¨­è¨ˆ

**ç‰ˆæœ¬**: 2.0  
**æœ€å¾Œæ›´æ–°**: 2025-10-26

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

çµ±ä¸€ä»»å‹™ç®¡ç†ç³»çµ±ï¼Œæ‰€æœ‰é¡å‹çš„ä»»å‹™éƒ½åœ¨åŒä¸€å€‹ä»‹é¢ç®¡ç†ï¼Œé€éæ¨™ç±¤åˆ†é¡ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- çµ±ä¸€ä»»å‹™ç®¡ç†ä»‹é¢ï¼ˆtasks.htmlï¼‰
- 7å€‹æ¨™ç±¤åˆ†é¡ï¼šå…¨éƒ¨ä»»å‹™ã€æˆ‘çš„ä»»å‹™ã€å‘¨æœŸä»»å‹™ã€å·¥å•†ç™»è¨˜ã€è²¡ç¨…ç°½è­‰ã€å®¢æˆ¶æœå‹™ã€æœå‹™é…ç½®
- å¤šéšæ®µä»»å‹™æ”¯æ´
- å‘¨æœŸä»»å‹™è‡ªå‹•ç”Ÿæˆ
- å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ä»»å‹™
- ä»»å‹™ç¯„æœ¬ç³»çµ±
- æª¢æŸ¥æ¸…å–®èˆ‡å¯©æ ¸

**å„ªåŒ–é‡é»** - âœ… å·²å¯¦æ–½ï¼š
- âœ… **å¯è¦–åŒ–æ¨¡æ¿ç·¨è¼¯å™¨**ï¼šæ‹–æ‹½æ–¹å¼èª¿æ•´éšæ®µé †åºï¼ˆå·²å¯¦æ–½ 2025-10-26ï¼‰
- âœ… **æ¨¡æ¿å¸‚å ´**ï¼š12å€‹é è¨­æ¨¡æ¿ï¼Œå¯ä¸€éµä½¿ç”¨ï¼ˆå·²å¯¦æ–½ 2025-10-26ï¼‰
- âœ… **æ¨¡æ¿é è¦½**ï¼šæ™‚é–“è»¸è¦–åœ–å³æ™‚é è¦½ï¼ˆå·²å¯¦æ–½ 2025-10-26ï¼‰
- âœ… **å¿«é€Ÿå®¢è£½åŒ–**ï¼šå¾ç¾æœ‰ä»»å‹™æˆ–æ¨¡æ¿è¤‡è£½ç·¨è¼¯ï¼ˆå·²å¯¦æ–½ 2025-10-26ï¼‰

---

## ğŸ—ï¸ çµ±ä¸€æ¶æ§‹

### ä»»å‹™åˆ†é¡ï¼ˆcategory æ¬„ä½ï¼‰

**âš ï¸ é‡è¦ï¼šçµ±ä¸€ä½¿ç”¨è‹±æ–‡å€¼ï¼Œä¸­æ–‡åƒ…ç”¨æ–¼é¡¯ç¤º**

```javascript
const TASK_CATEGORIES = {
  recurring: 'å‘¨æœŸä»»å‹™',       // ä¸€èˆ¬å‘¨æœŸæ€§ä»»å‹™
  business: 'å·¥å•†ç™»è¨˜',         // å…¬å¸è¨­ç«‹ã€è®Šæ›´ã€è§£æ•£ç­‰
  finance: 'è²¡ç¨…ç°½è­‰',          // è²¡ç¨…ç›¸é—œä»»å‹™ã€å¯©è¨ˆã€ç°½è­‰
  client_service: 'å®¢æˆ¶æœå‹™',   // è‡ªå‹•ç”Ÿæˆçš„å®¢æˆ¶æœå‹™ä»»å‹™ï¼ˆè¨˜å¸³ã€å ±ç¨…ï¼‰
  project: 'å°ˆæ¡ˆä»»å‹™',          // å¤§å‹å°ˆæ¡ˆï¼ˆä½µè³¼ã€ç‰¹æ®Šå°ˆæ¡ˆç­‰ï¼‰
  general: 'ä¸€èˆ¬ä»»å‹™'           // å…¶ä»–ä»»å‹™
};
```

**è³‡æ–™åº«å­˜å„²è¦ç¯„** (å·²å¯¦æ–½ 2025-10-26):
- âœ… **è³‡æ–™åº«**: çµ±ä¸€ä½¿ç”¨è‹±æ–‡å€¼ (`recurring`, `business`, `finance`, `client_service`, `project`, `general`)
- âœ… **API**: ä½¿ç”¨è‹±æ–‡å€¼å‚³è¼¸
- âœ… **å‰ç«¯**: ä½¿ç”¨æ˜ å°„è¡¨å°‡è‹±æ–‡å€¼è½‰æ›ç‚ºä¸­æ–‡é¡¯ç¤ºï¼ˆtasks.html ç¬¬530-537è¡Œï¼‰

**ç¯„ä¾‹**:
```javascript
// è³‡æ–™åº«å­˜å„²
INSERT INTO tasks (title, category) VALUES ('ç‡Ÿæ¥­ç¨…ç”³å ±', 'client_service');  // âœ… è‹±æ–‡

// å‰ç«¯é¡¯ç¤º
const categoryMap = {
  'client_service': 'å®¢æˆ¶æœå‹™'  // è‹±æ–‡ â†’ ä¸­æ–‡
};
```

**èªªæ˜**ï¼š
- **å·¥å•†ç™»è¨˜**ï¼šå…¬å¸è¨­ç«‹ã€è®Šæ›´ç™»è¨˜ã€è§£æ•£æ¸…ç®—ç­‰å·¥å•†æ¥­å‹™
- **è²¡ç¨…ç°½è­‰**ï¼šè²¡ç¨…æŸ¥æ ¸ã€ç°½è­‰ã€ç‰¹æ®Šè²¡ç¨…æ¡ˆä»¶
- **å®¢æˆ¶æœå‹™**ï¼šæ—¥å¸¸çš„è¨˜å¸³ã€ç‡Ÿæ¥­ç¨…ã€ç‡Ÿæ‰€ç¨…ç­‰è‡ªå‹•ç”Ÿæˆçš„ä»»å‹™
- **å°ˆæ¡ˆä»»å‹™**ï¼šå¤§å‹ä½µè³¼æ¡ˆã€IPOã€é‡çµ„ç­‰ç‰¹æ®Šå°ˆæ¡ˆ

### æ¨™ç±¤å°æ‡‰

| æ¨™ç±¤ | ç¯©é¸æ¢ä»¶ | èªªæ˜ |
|------|----------|------|
| å…¨éƒ¨ä»»å‹™ | æ‰€æœ‰ä»»å‹™ | é¡¯ç¤ºæ‰€æœ‰é¡å‹çš„ä»»å‹™ |
| æˆ‘çš„ä»»å‹™ | assigned_user = ç•¶å‰ç”¨æˆ¶ | åªé¡¯ç¤ºæŒ‡æ´¾çµ¦æˆ‘çš„ä»»å‹™ |
| å‘¨æœŸä»»å‹™ | category = 'recurring' | å‘¨æœŸæ€§ä»»å‹™ |
| å·¥å•†ç™»è¨˜ | category = 'business' | å…¬å¸è¨­ç«‹ã€è®Šæ›´ã€è§£æ•£ç­‰ |
| è²¡ç¨…ç°½è­‰ | category = 'finance' | è²¡ç¨…æŸ¥æ ¸ã€ç°½è­‰ã€å¯©è¨ˆç­‰ |
| å®¢æˆ¶æœå‹™ | category = 'client_service' | è¨˜å¸³ã€å ±ç¨…ç­‰è‡ªå‹•ç”Ÿæˆä»»å‹™ |
| æœå‹™é…ç½® | éä»»å‹™ï¼Œé¡¯ç¤ºé…ç½®ç®¡ç†ä»‹é¢ | ç®¡ç† client_services é…ç½® |

**å°ˆæ¡ˆä»»å‹™**ï¼šå¤§å‹å°ˆæ¡ˆï¼ˆcategory = 'project'ï¼‰ä¹Ÿåœ¨ä»»å‹™ç³»çµ±ä¸­ç®¡ç†ï¼Œå¯åœ¨"å…¨éƒ¨ä»»å‹™"æˆ–"æˆ‘çš„ä»»å‹™"ä¸­æŸ¥çœ‹ï¼Œæˆ–ä½¿ç”¨æœå°‹/ç¯©é¸åŠŸèƒ½ã€‚

---

## ğŸ—„ï¸ è³‡æ–™è¡¨çµæ§‹

### tasks (çµ±ä¸€ä»»å‹™è¡¨)
```sql
CREATE TABLE tasks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'pending',        -- pending, in_progress, completed, cancelled
  priority TEXT DEFAULT 'medium',       -- low, medium, high
  due_date DATETIME,
  assigned_user TEXT,
  created_by TEXT,
  category TEXT,                        -- recurring, business, finance, client_service, project
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### multi_stage_tasks (å¤šéšæ®µä»»å‹™)
```sql
CREATE TABLE multi_stage_tasks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  task_id INTEGER NOT NULL UNIQUE,
  total_stages INTEGER NOT NULL,
  completed_stages INTEGER DEFAULT 0,
  overall_progress INTEGER DEFAULT 0,
  current_stage INTEGER DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE
);
```

### task_stages (ä»»å‹™éšæ®µ)
```sql
CREATE TABLE task_stages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  multi_stage_task_id INTEGER NOT NULL,
  stage_order INTEGER NOT NULL,
  stage_name TEXT NOT NULL,
  stage_description TEXT,
  status TEXT DEFAULT 'pending',
  checklist TEXT,                      -- JSON æ ¼å¼
  estimated_hours DECIMAL(5,2),
  actual_hours DECIMAL(5,2),
  assigned_to TEXT,
  completed_by TEXT,
  completed_at DATETIME,
  notes TEXT,
  requires_approval BOOLEAN DEFAULT 0,
  approved_by TEXT,
  approved_at DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (multi_stage_task_id) REFERENCES multi_stage_tasks(id) ON DELETE CASCADE
);
```

### ç¯„æœ¬ç›¸é—œè¡¨

#### multi_stage_templates (å¤šéšæ®µä»»å‹™ç¯„æœ¬)
```sql
CREATE TABLE multi_stage_templates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  template_name TEXT NOT NULL,
  category TEXT,
  description TEXT,
  total_stages INTEGER NOT NULL,
  is_active BOOLEAN DEFAULT 1,
  created_by TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### template_stages (ç¯„æœ¬éšæ®µ)
```sql
CREATE TABLE template_stages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  template_id INTEGER NOT NULL,
  stage_order INTEGER NOT NULL,
  stage_name TEXT NOT NULL,
  stage_description TEXT,
  checklist TEXT,
  estimated_hours DECIMAL(5,2),
  requires_approval BOOLEAN DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (template_id) REFERENCES multi_stage_templates(id) ON DELETE CASCADE
);
```

#### service_checklist_templates (æœå‹™æª¢æŸ¥æ¸…å–®ç¯„æœ¬)
```sql
CREATE TABLE service_checklist_templates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  service_type TEXT NOT NULL,        -- accounting, vat, income_tax
  template_name TEXT NOT NULL,
  version INTEGER DEFAULT 1,
  checklist_data TEXT NOT NULL,      -- JSON æ ¼å¼
  is_active BOOLEAN DEFAULT 1,
  is_default BOOLEAN DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  created_by INTEGER,
  FOREIGN KEY (created_by) REFERENCES users(id)
);
```

### å‘¨æœŸä»»å‹™ç›¸é—œ

#### recurring_task_templates (å‘¨æœŸä»»å‹™ç¯„æœ¬)
```sql
CREATE TABLE recurring_task_templates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  template_name TEXT NOT NULL,
  category TEXT,
  description TEXT,
  frequency TEXT NOT NULL,           -- daily, weekly, monthly, quarterly
  task_template TEXT NOT NULL,       -- JSON æ ¼å¼ä»»å‹™ç¯„æœ¬
  is_active BOOLEAN DEFAULT 1,
  created_by TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### recurring_task_instances (å‘¨æœŸä»»å‹™å¯¦ä¾‹)
```sql
CREATE TABLE recurring_task_instances (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  template_id INTEGER NOT NULL,
  task_id INTEGER,
  scheduled_date DATE NOT NULL,
  status TEXT DEFAULT 'pending',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (template_id) REFERENCES recurring_task_templates(id),
  FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE
);
```

### å°ˆæ¡ˆç›¸é—œè³‡æ–™è¡¨ï¼ˆå·²æ•´åˆåˆ°çµ±ä¸€ä»»å‹™ç³»çµ±ï¼‰

**âœ… æ•´åˆå®Œæˆ**ï¼šå°ˆæ¡ˆç®¡ç†å·²æ•´åˆåˆ°çµ±ä¸€ä»»å‹™ç³»çµ±
- âœ… Migration 010: `multi_stage_tasks` è¡¨æ”¯æ´æ‰€æœ‰é¡å‹ä»»å‹™ï¼ˆåŒ…å«å°ˆæ¡ˆï¼‰
- âœ… ä½¿ç”¨ `tasks.category = 'project'` æ¨™è¨˜å°ˆæ¡ˆé¡å‹ä»»å‹™
- ğŸ“‹ èˆŠè¡¨ (`projects`, `project_tasks`, `project_checklist`) ä¿ç•™ä½œç‚ºæ­·å²è³‡æ–™
- ğŸ”„ Migration 020 åŸ·è¡Œè³‡æ–™é·ç§»å¾Œå¯è€ƒæ…®åˆªé™¤èˆŠè¡¨

**ä¸å†ä½¿ç”¨ä»¥ä¸‹è¡¨**ï¼š

#### projects (å°ˆæ¡ˆ - å·²å»¢æ£„)
```sql
CREATE TABLE projects (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  client_name TEXT,
  category TEXT,                     -- å°ˆæ¡ˆåˆ†é¡
  description TEXT,
  status TEXT DEFAULT 'planning',
  priority TEXT DEFAULT 'medium',
  start_date DATE,
  due_date DATE,
  completed_date DATE,
  budget DECIMAL(12,2),
  actual_cost DECIMAL(12,2),
  assigned_to TEXT,
  created_by TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**æ•´åˆæ–¹æ¡ˆ**ï¼šæœªä¾†å¯å°‡å°ˆæ¡ˆè³‡è¨Šæ•´åˆåˆ° tasks è¡¨çš„æ“´å±•æ¬„ä½ä¸­ã€‚

---

### å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç›¸é—œ

#### client_services (å®¢æˆ¶æœå‹™é…ç½®)
```sql
CREATE TABLE client_services (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id INTEGER NOT NULL,
  service_type TEXT NOT NULL,
  frequency TEXT NOT NULL,
  fee DECIMAL(10,2) DEFAULT 0,
  estimated_hours DECIMAL(5,2),
  assigned_to INTEGER,
  backup_assignee INTEGER,
  start_month INTEGER,
  execution_day INTEGER,
  advance_days INTEGER DEFAULT 7,
  due_days INTEGER DEFAULT 15,
  invoice_count INTEGER DEFAULT 0,
  difficulty_level INTEGER,
  is_active BOOLEAN DEFAULT 1,
  notes TEXT,
  special_requirements TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_generated_at DATETIME,
  FOREIGN KEY (assigned_to) REFERENCES users(id),
  FOREIGN KEY (backup_assignee) REFERENCES users(id)
);
```

#### task_generation_log (ä»»å‹™ç”Ÿæˆè¨˜éŒ„)
```sql
CREATE TABLE task_generation_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_service_id INTEGER NOT NULL,
  execution_period TEXT NOT NULL,    -- '2025-10'
  generated_task_id INTEGER,
  generated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  generation_method TEXT,            -- 'auto' æˆ– 'manual'
  FOREIGN KEY (client_service_id) REFERENCES client_services(id),
  FOREIGN KEY (generated_task_id) REFERENCES tasks(id),
  UNIQUE(client_service_id, execution_period)
);
```

---

## ğŸ”„ çµ±ä¸€ä»»å‹™æµç¨‹

### ä»»å‹™é¡¯ç¤ºé‚è¼¯

æ‰€æœ‰ä»»å‹™éƒ½å¾ `tasks` è¡¨æŸ¥è©¢ï¼Œæ ¹æ“šæ¨™ç±¤ç¯©é¸ï¼š

```javascript
// æ¨™ç±¤é»æ“Šäº‹ä»¶
function switchTab(tabName) {
  switch(tabName) {
    case 'all':
      // é¡¯ç¤ºæ‰€æœ‰ä»»å‹™
      loadTasks({ });
      break;
      
    case 'my-tasks':
      // åªé¡¯ç¤ºæˆ‘çš„ä»»å‹™
      loadTasks({ assigned_user: currentUser.id });
      break;
      
    case 'recurring':
      // å‘¨æœŸä»»å‹™
      loadTasks({ category: 'recurring' });
      break;
      
    case 'business':
      // å·¥å•†ç™»è¨˜
      loadTasks({ category: 'business' });
      break;
      
    case 'finance':
      // è²¡ç¨…ç°½è­‰
      loadTasks({ category: 'finance' });
      break;
      
    case 'client-service':
      // å®¢æˆ¶æœå‹™
      loadTasks({ category: 'client_service' });
      break;
      
    case 'config':
      // é¡¯ç¤ºæœå‹™é…ç½®ä»‹é¢ï¼ˆä¸æ˜¯ä»»å‹™åˆ—è¡¨ï¼‰
      showServiceConfig();
      break;
  }
}
```

### ä»»å‹™å¡ç‰‡çµ±ä¸€æ¨£å¼

æ‰€æœ‰é¡å‹ä»»å‹™ä½¿ç”¨ç›¸åŒçš„å¡ç‰‡æ¨£å¼ï¼š

```html
<div class="task-card">
  <div class="task-header">
    <h3>{ä»»å‹™æ¨™é¡Œ}</h3>
    <span class="status-badge">{ç‹€æ…‹}</span>
  </div>
  
  <!-- å¦‚æœæ˜¯å¤šéšæ®µä»»å‹™ï¼Œé¡¯ç¤ºé€²åº¦æ¢ -->
  <div class="progress-bar">
    <div class="progress-fill" style="width: {é€²åº¦}%"></div>
    <span>{å·²å®Œæˆéšæ®µ}/{ç¸½éšæ®µ}</span>
  </div>
  
  <div class="task-meta">
    <span class="category-badge">{åˆ†é¡}</span>
    <span>è² è²¬ï¼š{è² è²¬äºº}</span>
    <span>æˆªæ­¢ï¼š{æˆªæ­¢æ—¥æœŸ}</span>
  </div>
</div>
```

---

## ğŸ”Œ API è¨­è¨ˆ

### å–å¾—ä»»å‹™åˆ—è¡¨ï¼ˆçµ±ä¸€ç«¯é»ï¼‰
```
GET /api/tasks/multi-stage?category=client_service&status=in_progress&assigned_user=user1

Response:
{
  "success": true,
  "tasks": [
    {
      "id": 123,
      "title": "å®¢æˆ¶101 - è¨˜å¸³æœå‹™",
      "category": "client_service",
      "status": "in_progress",
      "total_stages": 4,
      "completed_stages": 2,
      "overall_progress": 50,
      "due_date": "2025-11-15",
      "assigned_user": "ç´œè“"
    }
  ]
}
```

### è‡ªå‹•ä»»å‹™ç”Ÿæˆç›¸é—œ

```
POST /api/automated-tasks/generate    # æ‰¹æ¬¡ç”Ÿæˆä»»å‹™
POST /api/automated-tasks/generate/:service_id  # ç‚ºç‰¹å®šæœå‹™ç”Ÿæˆ
GET  /api/automated-tasks/preview     # é è¦½å°‡ç”Ÿæˆçš„ä»»å‹™
```

### å‘¨æœŸä»»å‹™ç›¸é—œ

```
GET  /api/recurring-templates         # å–å¾—å‘¨æœŸä»»å‹™ç¯„æœ¬
POST /api/recurring-tasks/generate    # ç”Ÿæˆå‘¨æœŸä»»å‹™å¯¦ä¾‹
GET  /api/recurring-tasks/instances   # å–å¾—ä»»å‹™å¯¦ä¾‹
```

---

## ğŸ’» å‰ç«¯è¨­è¨ˆ

### çµ±ä¸€é é¢ï¼štasks.html

#### æ¨™ç±¤çµæ§‹
```
[å…¨éƒ¨ä»»å‹™] [æˆ‘çš„ä»»å‹™] [å‘¨æœŸä»»å‹™] [å·¥å•†ç™»è¨˜] [è²¡ç¨…ç°½è­‰] [å®¢æˆ¶æœå‹™] [æœå‹™é…ç½®]
```

#### å·¥å…·åˆ—ï¼ˆæ‰€æœ‰æ¨™ç±¤å…±ç”¨ï¼‰
```
[+ å‰µå»ºä»»å‹™] [ç‹€æ…‹ç¯©é¸â–¾] [æœå°‹...]
```

#### ä»»å‹™åˆ—è¡¨å€ï¼ˆæ¨™ç±¤1-6ï¼‰
```
é¡¯ç¤ºä»»å‹™å¡ç‰‡åˆ—è¡¨
- çµ±ä¸€å¡ç‰‡æ¨£å¼
- å¤šéšæ®µä»»å‹™é¡¯ç¤ºé€²åº¦æ¢
- é»æ“Šå¡ç‰‡æ‰“é–‹è©³æƒ…
```

#### æœå‹™é…ç½®å€ï¼ˆæ¨™ç±¤7ï¼‰
```
é¡¯ç¤ºå®¢æˆ¶æœå‹™é…ç½®ç®¡ç†ä»‹é¢
- å®¢æˆ¶æœå‹™é…ç½®åˆ—è¡¨
- æ–°å¢/ç·¨è¼¯é…ç½®
- [é è¦½å¾…ç”Ÿæˆä»»å‹™] [ç«‹å³ç”Ÿæˆä»»å‹™] æŒ‰éˆ•
```

### å»¢æ£„çš„é é¢

ä»¥ä¸‹é é¢æ‡‰æ•´åˆåˆ° tasks.htmlï¼š
- âŒ ~~multi-stage-tasks.html~~ â†’ æ”¹ç‚ºä»»å‹™è©³æƒ…å´é‚Šæ¬„æˆ–å½ˆçª—
- âŒ ~~recurring-tasks.html~~ â†’ æ•´åˆåˆ° tasks.html çš„"å‘¨æœŸä»»å‹™"æ¨™ç±¤
- âŒ ~~service-config.html~~ â†’ æ•´åˆåˆ° tasks.html çš„"æœå‹™é…ç½®"æ¨™ç±¤

---

## ğŸ”„ å„é¡å‹ä»»å‹™ç”Ÿæˆæµç¨‹ï¼ˆå·²å„ªåŒ–ï¼‰

### 1. ä¸€èˆ¬ä»»å‹™ - ä½¿ç”¨æ¨¡æ¿å¸‚å ´
```
æ‰‹å‹•å‰µå»º
  â†“
ç€è¦½æ¨¡æ¿å¸‚å ´ï¼ˆ10+ é è¨­æ¨¡æ¿ï¼‰
  â”œâ”€ é è¦½æ¨¡æ¿ï¼ˆæ™‚é–“è»¸ã€éšæ®µè©³æƒ…ï¼‰
  â”œâ”€ é¸æ“‡ã€Œç›´æ¥ä½¿ç”¨ã€æˆ–ã€Œè¤‡è£½ç·¨è¼¯ã€
  â””â”€ ä½¿ç”¨æ‹–æ‹½ç·¨è¼¯å™¨èª¿æ•´
  â†“
å¡«å¯«åŸºæœ¬è³‡è¨Šï¼ˆå®¢æˆ¶ã€æ—¥æœŸç­‰ï¼‰
  â†“
ç¢ºèªä¸¦å„²å­˜
  â†“
INSERT INTO tasks + multi_stage_tasks + task_stages
```

### 2. å‘¨æœŸä»»å‹™
```
å»ºç«‹å‘¨æœŸç¯„æœ¬
  â†“
è¨­å®šé »ç‡ï¼ˆæ¯æ—¥/æ¯é€±/æ¯æœˆ/æ¯å­£ï¼‰
  â†“
ç³»çµ±å®šæœŸæª¢æŸ¥ï¼ˆGitHub Actions æˆ–æ‰‹å‹•è§¸ç™¼ï¼‰
  â†“
è‡ªå‹•ç”Ÿæˆä»»å‹™å¯¦ä¾‹
  â†“
INSERT INTO tasks + recurring_task_instances
```

### 3. å®¢æˆ¶æœå‹™ä»»å‹™ï¼ˆè‡ªå‹•åŒ–ï¼‰
```
é…ç½®å®¢æˆ¶æœå‹™ï¼ˆclient_servicesï¼‰
  â†“
è¨­å®šåŸ·è¡Œé »ç‡èˆ‡æ—¥æœŸ
  â†“
ç³»çµ±å®šæœŸæª¢æŸ¥ï¼ˆæ¯æ—¥ 00:00ï¼‰
  â†“
åˆ¤æ–·æ˜¯å¦éœ€è¦ç”Ÿæˆä»»å‹™
  â†“
è¼‰å…¥æœå‹™æª¢æŸ¥æ¸…å–®ç¯„æœ¬
  â†“
è‡ªå‹•ç”Ÿæˆå¤šéšæ®µä»»å‹™
  â†“
INSERT INTO tasks + multi_stage_tasks + task_stages + task_generation_log
```

### 4. å·¥å•†/è²¡ç¨…/å°ˆæ¡ˆä»»å‹™
```
æ‰‹å‹•å‰µå»ºæˆ–å¾ç¯„æœ¬å‰µå»º
  â†“
è¨­å®š category = 'business', 'finance' æˆ– 'project'
  â†“
é€šå¸¸ç‚ºå¤šéšæ®µä»»å‹™
  â†“
ä½¿ç”¨å°ˆç”¨ç¯„æœ¬ï¼ˆå…¬å¸è¨­ç«‹ã€è²¡ç¨…ç°½è­‰ã€ä½µè³¼æ¡ˆç­‰ï¼‰
  â†“
INSERT INTO tasks + multi_stage_tasks + task_stages
```

**ç¯„æœ¬ç¯„ä¾‹**ï¼š
- å·¥å•†ç™»è¨˜ç¯„æœ¬ï¼šå…¬å¸è¨­ç«‹æµç¨‹ï¼ˆ8éšæ®µï¼‰ã€è®Šæ›´ç™»è¨˜æµç¨‹ï¼ˆ5éšæ®µï¼‰
- è²¡ç¨…ç°½è­‰ç¯„æœ¬ï¼šè²¡å‹™ç°½è­‰æµç¨‹ï¼ˆ10éšæ®µï¼‰ã€ç¨…å‹™æŸ¥æ ¸æµç¨‹ï¼ˆ7éšæ®µï¼‰
- å°ˆæ¡ˆç¯„æœ¬ï¼šä½µè³¼æ¡ˆæµç¨‹ï¼ˆ15éšæ®µï¼‰ã€IPOæµç¨‹ï¼ˆ20éšæ®µï¼‰

---

## ğŸ“Š ä»»å‹™çµ±è¨ˆï¼ˆè·¨æ‰€æœ‰é¡å‹ï¼‰

### æ•´é«”ä»»å‹™çµ±è¨ˆ
```sql
SELECT 
  category,
  COUNT(*) as total,
  SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,
  SUM(CASE WHEN status = 'in_progress' THEN 1 ELSE 0 END) as in_progress,
  SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) as pending
FROM tasks
GROUP BY category;
```

### å€‹äººä»»å‹™çµ±è¨ˆ
```sql
SELECT 
  t.category,
  COUNT(*) as my_tasks,
  AVG(mst.overall_progress) as avg_progress
FROM tasks t
LEFT JOIN multi_stage_tasks mst ON t.id = mst.task_id
WHERE t.assigned_user = ?
  AND t.status IN ('pending', 'in_progress')
GROUP BY t.category;
```

---

## ğŸ”Œ çµ±ä¸€ API è¨­è¨ˆ

### å–å¾—ä»»å‹™åˆ—è¡¨ï¼ˆçµ±ä¸€ç«¯é»ï¼‰
```
GET /api/tasks/multi-stage?category={category}&status={status}&assigned_user={user}

æ”¯æ´åƒæ•¸ï¼š
- category: recurring, business, finance, client_service, project
- status: pending, in_progress, completed, cancelled
- assigned_user: ç”¨æˆ¶ ID æˆ–ç”¨æˆ¶å
- start_date: é–‹å§‹æ—¥æœŸç¯©é¸
- end_date: çµæŸæ—¥æœŸç¯©é¸
- search: æœå°‹é—œéµå­—

Response: çµ±ä¸€çš„ä»»å‹™åˆ—è¡¨æ ¼å¼
```

### å‰µå»ºä»»å‹™ï¼ˆçµ±ä¸€ç«¯é»ï¼‰
```
POST /api/tasks/multi-stage

Request:
{
  "title": "ä»»å‹™æ¨™é¡Œ",
  "category": "client_service",
  "template_id": 1,  // å¯é¸
  "stages": [...]    // æˆ–ä½¿ç”¨ç¯„æœ¬
}
```

---

## ğŸ’» å‰ç«¯å¯¦æ–½ï¼ˆå·²å„ªåŒ–ï¼‰

### æª”æ¡ˆçµæ§‹
```
assets/js/
â”œâ”€â”€ unified-tasks.js         # çµ±ä¸€ä»»å‹™ç®¡ç†ï¼ˆâœ… å·²å‰µå»ºä¸¦ä¿®å¾© 2025-10-26ï¼‰
â”œâ”€â”€ auth-common.js           # å…±ç”¨èªè­‰ä»£ç¢¼ï¼ˆâœ… æ–°å¢ 2025-10-26ï¼‰
â”œâ”€â”€ config.js                # ç³»çµ±é…ç½®ï¼ˆâœ… æ–°å¢ 2025-10-26ï¼‰
â”œâ”€â”€ common-utils.js          # å…±ç”¨å·¥å…·å‡½æ•¸ï¼ˆâœ… æ–°å¢ 2025-10-26ï¼‰
â”œâ”€â”€ error-handler.js         # å…¨å±€éŒ¯èª¤è™•ç†ï¼ˆâœ… æ–°å¢ 2025-10-26ï¼‰
â”œâ”€â”€ multi-stage-tasks.js     # å¤šéšæ®µä»»å‹™é‚è¼¯ï¼ˆç¾æœ‰ï¼‰
â”œâ”€â”€ recurring-tasks.js       # å‘¨æœŸä»»å‹™é‚è¼¯ï¼ˆç¾æœ‰ï¼‰
â”œâ”€â”€ template-market.js       # æ¨¡æ¿å¸‚å ´ï¼ˆå«åœ¨ unified-tasks.jsï¼‰
â””â”€â”€ template-editor.js       # æ‹–æ‹½å¼æ¨¡æ¿ç·¨è¼¯å™¨ï¼ˆå«åœ¨ unified-tasks.jsï¼‰

assets/css/
â”œâ”€â”€ internal-system.css      # åŸºç¤æ¨£å¼ï¼ˆâœ… çµ±ä¸€ä½¿ç”¨ï¼‰
â”œâ”€â”€ internal-components.css  # çµ„ä»¶æ¨£å¼ï¼ˆâœ… çµ±ä¸€ä½¿ç”¨ï¼‰
â”œâ”€â”€ tasks-page.css           # ä»»å‹™é é¢æ¨£å¼ï¼ˆâœ… å·²å‰µå»ºï¼‰
â””â”€â”€ settings-page.css        # è¨­å®šé é¢æ¨£å¼ï¼ˆâœ… å·²å‰µå»ºï¼‰
```

### å…±ç”¨æ¨¡å¡Šèªªæ˜ï¼ˆ2025-10-26 æ–°å¢ï¼‰

#### auth-common.js
- çµ±ä¸€èªè­‰æª¢æŸ¥ `checkAuth()`
- ç”¨æˆ¶ä¿¡æ¯æ›´æ–° `updateUserInfo()`
- æ¬Šé™UIæ§åˆ¶ `updateUIByRole()`
- çµ±ä¸€APIè«‹æ±‚ `apiRequest()` ï¼ˆå«è¶…æ™‚è™•ç†ï¼‰
- ç™»å‡ºè™•ç† `handleLogout()`

#### config.js
- API URL é…ç½®ï¼ˆè‡ªå‹•é©æ‡‰é–‹ç™¼/ç”Ÿç”¢ç’°å¢ƒï¼‰
- ç³»çµ±å¸¸é‡å®šç¾©
- æœå‹™é¡å‹/é »ç‡æ˜ å°„è¡¨
- ä»»å‹™ç‹€æ…‹/åˆ†é¡æ˜ å°„è¡¨

#### common-utils.js
- æ—¥æœŸæ ¼å¼åŒ–å·¥å…·
- HTMLè½‰ç¾©ï¼ˆé˜²XSSï¼‰
- æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
- é€šçŸ¥é¡¯ç¤º `showNotification()`
- localStorageå®‰å…¨è®€å¯«
- æ•¸æ“šé©—è­‰å‡½æ•¸

#### error-handler.js
- å…¨å±€éŒ¯èª¤æ•ç²
- PromiseéŒ¯èª¤è™•ç†
- APIéŒ¯èª¤çµ±ä¸€è™•ç†
- å‹å¥½çš„éŒ¯èª¤æç¤º

### tasks.html çµæ§‹
```html
<div class="tabs-container">
  <!-- 7å€‹æ¨™ç±¤ -->
  <div class="tab-nav">
    <button onclick="switchTab('all')">å…¨éƒ¨ä»»å‹™</button>
    <button onclick="switchTab('my-tasks')">æˆ‘çš„ä»»å‹™</button>
    <button onclick="switchTab('recurring')">å‘¨æœŸä»»å‹™</button>
    <button onclick="switchTab('business')">å·¥å•†ç™»è¨˜</button>
    <button onclick="switchTab('finance')">è²¡ç¨…ç°½è­‰</button>
    <button onclick="switchTab('client-service')">å®¢æˆ¶æœå‹™</button>
    <button onclick="switchTab('config')">æœå‹™é…ç½®</button>
  </div>
  
  <!-- å·¥å…·åˆ— -->
  <div class="toolbar">
    <button onclick="createTask()">+ å‰µå»ºä»»å‹™</button>
    <select id="statusFilter">...</select>
    <input type="text" id="searchInput">
  </div>
  
  <!-- ä»»å‹™åˆ—è¡¨å®¹å™¨ï¼ˆå‹•æ…‹è¼‰å…¥ï¼‰ -->
  <div id="tasksContainer"></div>
</div>

<script src="assets/js/unified-tasks.js"></script>
```

---

## ğŸ¯ å„æ¨™ç±¤ç‰¹æ®ŠåŠŸèƒ½

### å‘¨æœŸä»»å‹™æ¨™ç±¤
é¡å¤–é¡¯ç¤ºï¼š
- å‘¨æœŸç¯„æœ¬ç®¡ç†
- æ‰‹å‹•ç”Ÿæˆå¯¦ä¾‹æŒ‰éˆ•

### å®¢æˆ¶æœå‹™æ¨™ç±¤
é¡å¤–é¡¯ç¤ºï¼š
- æœå‹™é¡å‹ç¯©é¸
- å®¢æˆ¶ç¯©é¸
- è‡ªå‹•ç”Ÿæˆçµ±è¨ˆ

### æœå‹™é…ç½®æ¨™ç±¤
å®Œå…¨ä¸åŒçš„ä»‹é¢ï¼š
- âœ… å®¢æˆ¶æœå‹™é…ç½®åˆ—è¡¨ï¼ˆå·²å¯¦æ–½ 2025-10-26ï¼‰
- âœ… é…ç½®å¡ç‰‡é¡¯ç¤ºï¼ˆå«æœå‹™é¡å‹ã€é »ç‡ã€è²»ç”¨ã€å·¥æ™‚ã€é›£åº¦ç­‰ï¼‰
- âœ… æ“ä½œæŒ‰éˆ•ï¼ˆæ¸¬è©¦ç”Ÿæˆã€åŸ·è¡Œæ­·å²ã€å•Ÿç”¨/åœç”¨ï¼‰
- âœ… [é è¦½å¾…ç”Ÿæˆä»»å‹™] æŒ‰éˆ•ï¼ˆå·²å¯¦æ–½ï¼‰
- âœ… [ç«‹å³ç”Ÿæˆä»»å‹™] æŒ‰éˆ•ï¼ˆå·²å¯¦æ–½ï¼‰
- ğŸ“‹ CRUD æ“ä½œï¼ˆæŸ¥çœ‹å’Œåˆ‡æ›ç‹€æ…‹å·²å¯¦æ–½ï¼Œç·¨è¼¯åŠŸèƒ½åœ¨ settings.htmlï¼‰

**å¯¦æ–½ç‹€æ…‹**: 
- å‰ç«¯ï¼šâœ… å®Œæ•´å¯¦ç¾ï¼ˆtasks.html ç¬¬760-908è¡Œï¼‰
- å¾Œç«¯ï¼šâœ… API å®Œæ•´ï¼ˆ/api/client-servicesï¼‰
- é¡¯ç¤ºï¼šâœ… ç¾åŒ–çš„é…ç½®å¡ç‰‡ï¼ŒåŒ…å«æ‰€æœ‰é—œéµä¿¡æ¯

---

## ğŸš€ æœªä¾†æ“´å±•

### è¨ˆåŠƒåŠŸèƒ½
- [ ] ä»»å‹™çœ‹æ¿è¦–åœ–ï¼ˆæ‹–æ›³æ’åºï¼‰
- [ ] ä»»å‹™ä¾è³´é—œä¿‚åœ–
- [ ] æ‰¹æ¬¡æ“ä½œï¼ˆæ‰¹æ¬¡æŒ‡æ´¾ã€æ‰¹æ¬¡å®Œæˆï¼‰
- [x] ~~ä»»å‹™ç¯„æœ¬å¸‚å ´~~ âœ… å·²å¯¦æ–½
- [ ] ä»»å‹™å”ä½œï¼ˆå¤šäººä»»å‹™ï¼‰
- [ ] ä»»å‹™è©•è«–ç³»çµ±
- [ ] ä»»å‹™é™„ä»¶ç®¡ç†

### å·²å¯¦æ–½çš„å„ªåŒ– âœ…
- [x] å¯è¦–åŒ–æ¨¡æ¿ç·¨è¼¯å™¨ï¼ˆæ‹–æ‹½èª¿æ•´éšæ®µï¼‰- âœ… 2025-10-26
- [x] æ¨¡æ¿å¸‚å ´ï¼ˆ12å€‹é è¨­æ¨¡æ¿ï¼‰- âœ… 2025-10-26
- [x] æ¨¡æ¿é è¦½åŠŸèƒ½ - âœ… 2025-10-26
- [x] ä¸€éµè¤‡è£½å’Œå®¢è£½åŒ– - âœ… 2025-10-26
- [ ] æ¨¡æ¿ä½¿ç”¨çµ±è¨ˆ - âš ï¸ éƒ¨åˆ†å¯¦æ–½ï¼ˆè³‡æ–™è¡¨å·²å»ºç«‹ï¼‰

---

**ç›¸é—œæ–‡æª”**ï¼š
- [ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md](./ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md) - æ•´é«”æ¶æ§‹
- [å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md](./å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md) - è‡ªå‹•åŒ–é‚è¼¯
- [APIç«¯é»æ–‡æª”.md](./APIç«¯é»æ–‡æª”.md) - API åƒè€ƒ

