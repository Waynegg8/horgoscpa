# å®¢æˆ¶ç®¡ç†ç³»çµ±è¨­è¨ˆ

**ç‰ˆæœ¬**: 1.0  
**æœ€å¾Œæ›´æ–°**: 2025-10-26

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®¢æˆ¶ç®¡ç†ç³»çµ±ç”¨æ–¼ç®¡ç†æœƒè¨ˆå¸«äº‹å‹™æ‰€çš„å®¢æˆ¶åŸºæœ¬è³‡æ–™ã€æœå‹™é…ç½®ã€äº’å‹•è¨˜éŒ„ç­‰ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- å®¢æˆ¶åŸºæœ¬è³‡æ–™ CRUD
- å®¢æˆ¶æœå‹™é…ç½®ç®¡ç†
- æœå‹™æ’ç¨‹è¨­å®š
- å®¢æˆ¶äº’å‹•è¨˜éŒ„
- å®¢æˆ¶æ¨™ç±¤èˆ‡åˆ†é¡
- å®¢æˆ¶çµ±è¨ˆå ±è¡¨

---

## ğŸ—„ï¸ è³‡æ–™è¡¨çµæ§‹

### clients (å®¢æˆ¶ä¸»è¡¨)
```sql
CREATE TABLE clients (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL UNIQUE,
    tax_id TEXT UNIQUE,
    contact_person TEXT,
    phone TEXT,
    email TEXT,
    address TEXT,
    status TEXT DEFAULT 'active' CHECK(status IN ('active', 'inactive', 'potential')),
    region TEXT CHECK(region IN ('å°ä¸­', 'å°åŒ—', 'å…¶ä»–')),
    notes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```
**èªªæ˜**: é€™æ˜¯å®¢æˆ¶è³‡æ–™çš„å”¯ä¸€ä¾†æºï¼Œå–ä»£äº†èˆŠæœ‰çš„ `clients` å’Œ `clients_extended` è¡¨ã€‚ä¸»éµå·²æ”¹ç‚º `id` (INTEGER)ã€‚

### client_services (å®¢æˆ¶æœå‹™é…ç½®)
```sql
CREATE TABLE client_services (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id INTEGER NOT NULL, -- Changed from client_name
  service_type TEXT NOT NULL,
  frequency TEXT NOT NULL,
  fee DECIMAL(10,2) DEFAULT 0,
  estimated_hours DECIMAL(5,2),
  assigned_to INTEGER, -- User ID
  backup_assignee INTEGER, -- User ID
  start_month INTEGER,
  execution_day INTEGER,
  advance_days INTEGER DEFAULT 7,
  due_days INTEGER DEFAULT 15,
  is_active BOOLEAN DEFAULT 1,
  notes TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_generated_at DATETIME,
  FOREIGN KEY (client_id) REFERENCES clients(id) ON DELETE CASCADE,
  FOREIGN KEY (assigned_to) REFERENCES users(id) ON DELETE SET NULL,
  FOREIGN KEY (backup_assignee) REFERENCES users(id) ON DELETE SET NULL
);
```

### client_interactions (å®¢æˆ¶äº’å‹•è¨˜éŒ„)
```sql
CREATE TABLE client_interactions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id INTEGER NOT NULL, -- Changed from client_name
  interaction_type TEXT NOT NULL,
  subject TEXT,
  content TEXT,
  interaction_date DATETIME,
  participants TEXT,
  follow_up_required BOOLEAN DEFAULT 0,
  follow_up_date DATE,
  created_by TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (client_id) REFERENCES clients(id) ON DELETE CASCADE
);
```

### timesheets (å·¥æ™‚è¡¨) - é—œè¯æ›´æ–°
```sql
-- ... (other columns)
  client_id INTEGER, -- Changed from client_name
-- ... (other columns)
  FOREIGN KEY (client_id) REFERENCES clients(id) ON DELETE SET NULL
-- ... (other columns)
```

**âš ï¸ å»¢æ£„çš„è³‡æ–™è¡¨**:
- `clients_extended`: å·²åˆä½µè‡³ `clients`ã€‚
- `service_schedule`: å·²ç”± `client_services` å®Œå…¨å–ä»£ã€‚
- `client_assignments`: åŠŸèƒ½å·²æ•´åˆè‡³ `client_services` çš„ `assigned_to` æ¬„ä½ï¼Œä¸å†ä½¿ç”¨ã€‚

---

## ğŸ”„ æ¥­å‹™æµç¨‹

### æ–°å¢å®¢æˆ¶æµç¨‹
```
1. è¼¸å…¥å®¢æˆ¶åŸºæœ¬è³‡æ–™
   - çµ±ä¸€ç·¨è™Ÿã€å…¬å¸åç¨±
   - è¯çµ¡äººã€é›»è©±ã€Email
   - åœ°å€ã€ç”¢æ¥­é¡åˆ¥
   â†“
2. é…ç½®æœå‹™é …ç›®
   - é¸æ“‡æœå‹™é¡å‹ï¼ˆè¨˜å¸³ã€ç‡Ÿæ¥­ç¨…ç­‰ï¼‰
   - è¨­å®šé »ç‡
   - æŒ‡æ´¾è² è²¬äºº
   - è¨­å®šè²»ç”¨èˆ‡å·¥æ™‚
   â†“
3. å„²å­˜å®¢æˆ¶è³‡æ–™
   - INSERT INTO clients
   - INSERT INTO client_services (å¤šç­†)
   â†“
4. å»ºç«‹å®¢æˆ¶æŒ‡æ´¾
   - INSERT INTO client_assignments
```

### æœå‹™é…ç½®ç®¡ç†
```
1. æŸ¥çœ‹å®¢æˆ¶æœå‹™åˆ—è¡¨
   - SELECT FROM client_services WHERE client_id = ?
   â†“
2. æ–°å¢æœå‹™
   - é¸æ“‡æœå‹™é¡å‹
   - è¨­å®šåŸ·è¡Œé »ç‡èˆ‡æ—¥æœŸ
   - è¨­å®šè²»ç”¨èˆ‡é›£åº¦
   â†“
3. ç·¨è¼¯æœå‹™
   - ä¿®æ”¹åŸ·è¡Œæ—¥æœŸ
   - èª¿æ•´è²»ç”¨
   - æ›´æ›è² è²¬äºº
   â†“
4. åœç”¨æœå‹™
   - UPDATE is_active = 0
   - ä¸åˆªé™¤æ­·å²è¨˜éŒ„
```

### å®¢æˆ¶äº’å‹•è¨˜éŒ„
```
1. è¨˜éŒ„å®¢æˆ¶äº’å‹•
   - é¸æ“‡äº’å‹•é¡å‹ï¼ˆæœƒè­°ã€é›»è©±ã€Emailï¼‰
   - å¡«å¯«ä¸»æ—¨èˆ‡å…§å®¹
   - è¨˜éŒ„åƒèˆ‡äººå“¡
   â†“
2. è¨­å®šå¾ŒçºŒè¿½è¹¤
   - æ˜¯å¦éœ€è¦è¿½è¹¤
   - è¿½è¹¤æ—¥æœŸ
   â†“
3. å„²å­˜è¨˜éŒ„
   - INSERT INTO client_interactions
```

---

## ğŸ”Œ API è¨­è¨ˆ

### å–å¾—å®¢æˆ¶åˆ—è¡¨
`GET /api/clients?status=active&region=å°ä¸­`

### å–å¾—å®¢æˆ¶è©³æƒ…
`GET /api/clients/{id}`

### æ–°å¢å®¢æˆ¶
`POST /api/clients`

### æ›´æ–°å®¢æˆ¶
`PUT /api/clients/{id}`

### åˆªé™¤å®¢æˆ¶
`DELETE /api/clients/{id}`

### é…ç½®å®¢æˆ¶æœå‹™
`POST /api/client-services` (Request body now uses `client_id`)

### å–å¾—å®¢æˆ¶æœå‹™åˆ—è¡¨
`GET /api/client-services?client_id=1`

### è¨˜éŒ„å®¢æˆ¶äº’å‹•
`POST /api/client-interactions` (Request body now uses `client_id`)

---

## ğŸ’» å‰ç«¯è¨­è¨ˆ

### é é¢ï¼šsettings.html (å®¢æˆ¶ç®¡ç†æ¨™ç±¤)

#### å®¢æˆ¶åˆ—è¡¨è¦–åœ–
```
æœå°‹: [æœå°‹å®¢æˆ¶...]  ç‹€æ…‹: [å…¨éƒ¨â–¾]  [+ æ–°å¢å®¢æˆ¶]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ABCç§‘æŠ€å…¬å¸                          â”‚
â”‚ çµ±ç·¨: 12345678 | è¯çµ¡äºº: ç‹å°æ˜      â”‚
â”‚ æœå‹™: è¨˜å¸³ã€ç‡Ÿæ¥­ç¨…ã€ç‡Ÿæ‰€ç¨…           â”‚
â”‚ è² è²¬: ç´œè“                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®¢æˆ¶è©³æƒ…å´é‚Šæ¬„
```
ABCç§‘æŠ€å…¬å¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
çµ±ä¸€ç·¨è™Ÿ: 12345678
è¯çµ¡äºº: ç‹å°æ˜
é›»è©±: 02-1234-5678
Email: contact@abc.com

[æœå‹™é…ç½®]
âœ“ è¨˜å¸³æœå‹™ - æ¯æœˆ15æ—¥ - $5,000
âœ“ ç‡Ÿæ¥­ç¨…ç”³å ± - é›™æœˆ20æ—¥ - $2,000
âœ“ ç‡Ÿæ‰€ç¨…ç”³å ± - å¹´åº¦ - $15,000

[äº’å‹•è¨˜éŒ„]
2025-10-26 æœƒè­° - å¹´åº¦ç¨…å‹™è¦åŠƒ
2025-09-15 é›»è©± - ç™¼ç¥¨å•é¡Œè«®è©¢

[ç·¨è¼¯] [åˆªé™¤] [æ–°å¢æœå‹™]
```

---

## ğŸ“Š çµ±è¨ˆåŠŸèƒ½

### å®¢æˆ¶çµ±è¨ˆ
```sql
-- å®¢æˆ¶ç¸½æ•¸èˆ‡ç‹€æ…‹åˆ†å¸ƒ
SELECT 
  status,
  COUNT(*) as count
FROM clients
GROUP BY status;
```

### æœå‹™çµ±è¨ˆ
```sql
-- å„æœå‹™é¡å‹å®¢æˆ¶æ•¸
SELECT 
  service_type,
  COUNT(DISTINCT client_id) as client_count,
  SUM(fee) as total_monthly_revenue
FROM client_services
WHERE is_active = 1
GROUP BY service_type
ORDER BY client_count DESC;
```

### è² è²¬äººå·¥ä½œé‡
```sql
-- æ¯ä½æœƒè¨ˆå¸«è² è²¬çš„å®¢æˆ¶æ•¸èˆ‡æœå‹™æ•¸
SELECT 
  u.username,
  COUNT(DISTINCT cs.client_id) as client_count,
  COUNT(cs.id) as service_count,
  SUM(cs.estimated_hours) as total_hours
FROM client_services cs
JOIN users u ON cs.assigned_to = u.id
WHERE cs.is_active = 1
GROUP BY u.id
ORDER BY total_hours DESC;
```

---

## ğŸ”§ å¯¦æ–½ç´°ç¯€

### æœå‹™é¡å‹å®šç¾©
```javascript
const SERVICE_TYPES = {
  accounting: 'è¨˜å¸³æœå‹™',
  vat: 'ç‡Ÿæ¥­ç¨…ç”³å ±',
  income_tax: 'ç‡Ÿæ‰€ç¨…ç”³å ±',
  withholding: 'æ‰£ç¹³ç”³å ±',
  prepayment: 'æš«ç¹³ç”³å ±',
  dividend: 'ç›ˆé¤˜åˆ†é…',
  nhi: 'äºŒä»£å¥ä¿è£œå……ä¿è²»',
  shareholder_tax: 'è‚¡æ±å¯æ‰£æŠµç¨…é¡',
  audit: 'è²¡å‹™ç°½è­‰',
  company_setup: 'å…¬å¸è¨­ç«‹ç™»è¨˜'
};
```

### æœå‹™é »ç‡å®šç¾©
```javascript
const FREQUENCY_TYPES = {
  monthly: 'æ¯æœˆ',
  bimonthly: 'é›™æœˆ',
  quarterly: 'æ¯å­£',
  biannual: 'åŠå¹´',
  annual: 'å¹´åº¦'
};
```

### é›£åº¦ç­‰ç´šå®šç¾©
```javascript
const DIFFICULTY_LEVELS = {
  1: 'ç°¡å–® - ç™¼ç¥¨å°‘ã€å¸³å‹™å–®ç´”',
  2: 'æ™®é€š - ä¸€èˆ¬ä¼æ¥­',
  3: 'ä¸­ç­‰ - äº¤æ˜“é »ç¹æˆ–ç§‘ç›®è¤‡é›œ',
  4: 'å›°é›£ - å¤šè§’åŒ–ç¶“ç‡Ÿæˆ–ç‰¹æ®Šè¡Œæ¥­',
  5: 'æ¥µé›£ - å¤§å‹ä¼æ¥­æˆ–è·¨åœ‹æ¥­å‹™'
};
```

---

## ğŸš€ æœªä¾†æ“´å±•

### è¨ˆåŠƒåŠŸèƒ½
- [ ] å®¢æˆ¶åˆ†ç´šç®¡ç†ï¼ˆVIPã€ä¸€èˆ¬ã€æ½›åœ¨ï¼‰
- [ ] å®¢æˆ¶ç”Ÿå‘½é€±æœŸè¿½è¹¤
- [ ] åˆç´„ç®¡ç†ï¼ˆèµ·è¿„æ—¥æœŸã€çºŒç´„æé†’ï¼‰
- [ ] å®¢æˆ¶æ»¿æ„åº¦èª¿æŸ¥
- [ ] å®¢æˆ¶æ–‡ä»¶åº«ï¼ˆä¸Šå‚³åˆç´„ã€è­‰ä»¶ç­‰ï¼‰
- [ ] å®¢æˆ¶æ¨™ç±¤ç³»çµ±
- [ ] å®¢æˆ¶æ¨è–¦ä¾†æºè¿½è¹¤
- [ ] å®¢æˆ¶æ”¶å…¥åˆ†æå ±è¡¨

---

**ç›¸é—œæ–‡æª”**ï¼š
- [ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md](./ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md) - æ•´é«”æ¶æ§‹
- [å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md](./å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md) - è‡ªå‹•ä»»å‹™ç”Ÿæˆ
- [APIç«¯é»æ–‡æª”.md](./APIç«¯é»æ–‡æª”.md) - API åƒè€ƒ

