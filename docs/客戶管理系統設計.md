# å®¢æˆ¶ç®¡ç†ç³»çµ±è¨­è¨ˆ

**ç‰ˆæœ¬**: 1.0  
**æœ€å¾Œæ›´æ–°**: 2025-10-26

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®¢æˆ¶ç®¡ç†ç³»çµ±ç”¨æ–¼ç®¡ç†æœƒè¨ˆå¸«äº‹å‹™æ‰€çš„å®¢æˆ¶åŸºæœ¬è³‡æ–™ã€æœå‹™é…ç½®ã€äº’å‹•è¨˜éŒ„ç­‰ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- å®¢æˆ¶åŸºæœ¬è³‡æ–™ CRUD
- å®¢æˆ¶æœå‹™é…ç½®ç®¡ç†
- æœå‹™æ’ç¨‹è¨­å®š
- å®¢æˆ¶äº’å‹•è¨˜éŒ„
- å®¢æˆ¶æ¨™ç±¤èˆ‡åˆ†é¡
- å®¢æˆ¶çµ±è¨ˆå ±è¡¨

---

## ğŸ—„ï¸ è³‡æ–™è¡¨çµæ§‹

### clients (å®¢æˆ¶åŸºæœ¬è³‡æ–™)
```sql
CREATE TABLE clients (
  name TEXT PRIMARY KEY              -- ç›®å‰ä½¿ç”¨å®¢æˆ¶åç¨±ç‚ºä¸»éµ
);
```

**æ³¨æ„**ï¼šç›®å‰çµæ§‹ç°¡åŒ–ï¼Œæœªä¾†æ‡‰æ“´å±•ç‚ºï¼š
```sql
CREATE TABLE clients (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  tax_id TEXT UNIQUE,                -- çµ±ä¸€ç·¨è™Ÿ
  name TEXT NOT NULL,                -- å…¬å¸åç¨±
  contact_person TEXT,               -- è¯çµ¡äºº
  phone TEXT,
  email TEXT,
  address TEXT,
  status TEXT DEFAULT 'active',      -- active, inactive, suspended
  industry TEXT,                     -- ç”¢æ¥­é¡åˆ¥
  company_type TEXT,                 -- å…¬å¸é¡å‹
  founded_date DATE,                 -- æˆç«‹æ—¥æœŸ
  notes TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### client_services (å®¢æˆ¶æœå‹™é…ç½®)
```sql
CREATE TABLE client_services (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id INTEGER NOT NULL,
  service_type TEXT NOT NULL,        -- accounting, vat, income_tax, etc.
  frequency TEXT NOT NULL,           -- monthly, bimonthly, quarterly, annual
  fee DECIMAL(10,2) DEFAULT 0,       -- æœå‹™è²»ç”¨
  estimated_hours DECIMAL(5,2),      -- é ä¼°å·¥æ™‚
  assigned_to INTEGER,               -- è² è²¬æœƒè¨ˆå¸«
  backup_assignee INTEGER,           -- å‚™æ´è² è²¬äºº
  start_month INTEGER,               -- æœå‹™é–‹å§‹æœˆä»½
  execution_day INTEGER,             -- æ¯æœˆåŸ·è¡Œæ—¥
  advance_days INTEGER DEFAULT 7,   -- æå‰ç”Ÿæˆä»»å‹™å¤©æ•¸
  due_days INTEGER DEFAULT 15,      -- ä»»å‹™æœŸé™å¤©æ•¸
  invoice_count INTEGER DEFAULT 0,  -- æ¯æœˆç™¼ç¥¨å¼µæ•¸
  difficulty_level INTEGER,          -- é›£åº¦ 1-5
  is_active BOOLEAN DEFAULT 1,
  notes TEXT,
  special_requirements TEXT,         -- ç‰¹æ®Šéœ€æ±‚ï¼ˆJSONï¼‰
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_generated_at DATETIME,        -- æœ€å¾Œç”Ÿæˆä»»å‹™æ™‚é–“
  FOREIGN KEY (assigned_to) REFERENCES users(id),
  FOREIGN KEY (backup_assignee) REFERENCES users(id)
);
```

### client_service_schedules (æœå‹™æ’ç¨‹ - èˆŠç‰ˆ)
```sql
CREATE TABLE client_service_schedules (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_name TEXT NOT NULL,
  service_name TEXT NOT NULL,
  service_category TEXT,
  frequency TEXT DEFAULT 'æ¯æœˆ',
  fee REAL DEFAULT 0,
  estimated_hours REAL DEFAULT 0,
  monthly_schedule TEXT DEFAULT '{}', -- JSON æ ¼å¼
  billing_timing TEXT,
  billing_notes TEXT,
  service_notes TEXT,
  is_active BOOLEAN DEFAULT 1,
  assigned_to TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (client_name) REFERENCES clients(name)
);
```
**æ³¨æ„**ï¼šæ­¤è¡¨ç‚ºèˆŠæ¶æ§‹ï¼Œå°‡é€æ­¥é·ç§»è‡³ client_servicesã€‚

### client_interactions (å®¢æˆ¶äº’å‹•è¨˜éŒ„)
```sql
CREATE TABLE client_interactions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_name TEXT NOT NULL,
  interaction_type TEXT NOT NULL,    -- meeting, call, email, visit
  subject TEXT,                      -- ä¸»æ—¨
  content TEXT,                      -- å…§å®¹
  interaction_date DATETIME,         -- äº’å‹•æ—¥æœŸ
  participants TEXT,                 -- åƒèˆ‡äººå“¡ï¼ˆJSONï¼‰
  follow_up_required BOOLEAN DEFAULT 0,
  follow_up_date DATE,
  created_by TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (client_name) REFERENCES clients(name)
);
```

### client_assignments (å®¢æˆ¶æŒ‡æ´¾)
```sql
CREATE TABLE client_assignments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_name TEXT NOT NULL,
  assigned_to TEXT NOT NULL,         -- è² è²¬äºº
  role TEXT,                         -- è§’è‰²ï¼ˆä¸»è¦è² è²¬ã€å”åŠ©ï¼‰
  start_date DATE,
  end_date DATE,
  is_active BOOLEAN DEFAULT 1,
  notes TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (client_name) REFERENCES clients(name)
);
```

---

## ğŸ”„ æ¥­å‹™æµç¨‹

### æ–°å¢å®¢æˆ¶æµç¨‹
```
1. è¼¸å…¥å®¢æˆ¶åŸºæœ¬è³‡æ–™
   - çµ±ä¸€ç·¨è™Ÿã€å…¬å¸åç¨±
   - è¯çµ¡äººã€é›»è©±ã€Email
   - åœ°å€ã€ç”¢æ¥­é¡åˆ¥
   â†“
2. é…ç½®æœå‹™é …ç›®
   - é¸æ“‡æœå‹™é¡å‹ï¼ˆè¨˜å¸³ã€ç‡Ÿæ¥­ç¨…ç­‰ï¼‰
   - è¨­å®šé »ç‡
   - æŒ‡æ´¾è² è²¬äºº
   - è¨­å®šè²»ç”¨èˆ‡å·¥æ™‚
   â†“
3. å„²å­˜å®¢æˆ¶è³‡æ–™
   - INSERT INTO clients
   - INSERT INTO client_services (å¤šç­†)
   â†“
4. å»ºç«‹å®¢æˆ¶æŒ‡æ´¾
   - INSERT INTO client_assignments
```

### æœå‹™é…ç½®ç®¡ç†
```
1. æŸ¥çœ‹å®¢æˆ¶æœå‹™åˆ—è¡¨
   - SELECT FROM client_services WHERE client_id = ?
   â†“
2. æ–°å¢æœå‹™
   - é¸æ“‡æœå‹™é¡å‹
   - è¨­å®šåŸ·è¡Œé »ç‡èˆ‡æ—¥æœŸ
   - è¨­å®šè²»ç”¨èˆ‡é›£åº¦
   â†“
3. ç·¨è¼¯æœå‹™
   - ä¿®æ”¹åŸ·è¡Œæ—¥æœŸ
   - èª¿æ•´è²»ç”¨
   - æ›´æ›è² è²¬äºº
   â†“
4. åœç”¨æœå‹™
   - UPDATE is_active = 0
   - ä¸åˆªé™¤æ­·å²è¨˜éŒ„
```

### å®¢æˆ¶äº’å‹•è¨˜éŒ„
```
1. è¨˜éŒ„å®¢æˆ¶äº’å‹•
   - é¸æ“‡äº’å‹•é¡å‹ï¼ˆæœƒè­°ã€é›»è©±ã€Emailï¼‰
   - å¡«å¯«ä¸»æ—¨èˆ‡å…§å®¹
   - è¨˜éŒ„åƒèˆ‡äººå“¡
   â†“
2. è¨­å®šå¾ŒçºŒè¿½è¹¤
   - æ˜¯å¦éœ€è¦è¿½è¹¤
   - è¿½è¹¤æ—¥æœŸ
   â†“
3. å„²å­˜è¨˜éŒ„
   - INSERT INTO client_interactions
```

---

## ğŸ”Œ API è¨­è¨ˆ

### å–å¾—å®¢æˆ¶åˆ—è¡¨
```
GET /api/clients?status=active&industry=ç§‘æŠ€æ¥­

Response:
{
  "success": true,
  "clients": [
    {
      "id": 1,
      "tax_id": "12345678",
      "name": "ABCç§‘æŠ€å…¬å¸",
      "contact_person": "ç‹å°æ˜",
      "phone": "02-1234-5678",
      "status": "active",
      "service_count": 3
    }
  ]
}
```

### å–å¾—å®¢æˆ¶è©³æƒ…
```
GET /api/clients/{id}

Response:
{
  "success": true,
  "client": {
    "id": 1,
    "tax_id": "12345678",
    "name": "ABCç§‘æŠ€å…¬å¸",
    "contact_person": "ç‹å°æ˜",
    "phone": "02-1234-5678",
    "email": "contact@abc.com",
    "address": "å°åŒ—å¸‚...",
    "status": "active",
    "created_at": "2025-01-15"
  },
  "services": [
    {
      "service_type": "accounting",
      "frequency": "monthly",
      "fee": 5000,
      "assigned_to": "ç´œè“"
    }
  ],
  "recent_interactions": [...]
}
```

### æ–°å¢å®¢æˆ¶
```
POST /api/clients

Request:
{
  "tax_id": "12345678",
  "name": "ABCç§‘æŠ€å…¬å¸",
  "contact_person": "ç‹å°æ˜",
  "phone": "02-1234-5678",
  "email": "contact@abc.com"
}

Response:
{
  "success": true,
  "client_id": 1
}
```

### é…ç½®å®¢æˆ¶æœå‹™
```
POST /api/client-services

Request:
{
  "client_id": 1,
  "service_type": "accounting",
  "frequency": "monthly",
  "fee": 5000,
  "assigned_to": 7,
  "execution_day": 15,
  "estimated_hours": 4.0,
  "difficulty_level": 3
}

Response:
{
  "success": true,
  "service_id": 10
}
```

### å–å¾—å®¢æˆ¶æœå‹™åˆ—è¡¨
```
GET /api/client-services?client_id=1

Response:
{
  "success": true,
  "services": [
    {
      "id": 10,
      "service_type": "accounting",
      "frequency": "monthly",
      "fee": 5000,
      "assigned_to": "ç´œè“",
      "last_generated_at": "2025-10-01",
      "next_execution_date": "2025-11-15"
    }
  ]
}
```

### è¨˜éŒ„å®¢æˆ¶äº’å‹•
```
POST /api/client-interactions

Request:
{
  "client_name": "ABCç§‘æŠ€å…¬å¸",
  "interaction_type": "meeting",
  "subject": "å¹´åº¦ç¨…å‹™è¦åŠƒ",
  "content": "è¨è«–æ˜å¹´ç¨…å‹™ç­–ç•¥...",
  "interaction_date": "2025-10-26T14:00:00Z",
  "participants": ["user1", "user2"],
  "follow_up_required": true,
  "follow_up_date": "2025-11-15"
}

Response:
{
  "success": true,
  "interaction_id": 45
}
```

---

## ğŸ’» å‰ç«¯è¨­è¨ˆ

### é é¢ï¼šsettings.html (å®¢æˆ¶ç®¡ç†æ¨™ç±¤)

#### å®¢æˆ¶åˆ—è¡¨è¦–åœ–
```
æœå°‹: [æœå°‹å®¢æˆ¶...]  ç‹€æ…‹: [å…¨éƒ¨â–¾]  [+ æ–°å¢å®¢æˆ¶]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ABCç§‘æŠ€å…¬å¸                          â”‚
â”‚ çµ±ç·¨: 12345678 | è¯çµ¡äºº: ç‹å°æ˜      â”‚
â”‚ æœå‹™: è¨˜å¸³ã€ç‡Ÿæ¥­ç¨…ã€ç‡Ÿæ‰€ç¨…           â”‚
â”‚ è² è²¬: ç´œè“                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®¢æˆ¶è©³æƒ…å´é‚Šæ¬„
```
ABCç§‘æŠ€å…¬å¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
çµ±ä¸€ç·¨è™Ÿ: 12345678
è¯çµ¡äºº: ç‹å°æ˜
é›»è©±: 02-1234-5678
Email: contact@abc.com

[æœå‹™é…ç½®]
âœ“ è¨˜å¸³æœå‹™ - æ¯æœˆ15æ—¥ - $5,000
âœ“ ç‡Ÿæ¥­ç¨…ç”³å ± - é›™æœˆ20æ—¥ - $2,000
âœ“ ç‡Ÿæ‰€ç¨…ç”³å ± - å¹´åº¦ - $15,000

[äº’å‹•è¨˜éŒ„]
2025-10-26 æœƒè­° - å¹´åº¦ç¨…å‹™è¦åŠƒ
2025-09-15 é›»è©± - ç™¼ç¥¨å•é¡Œè«®è©¢

[ç·¨è¼¯] [åˆªé™¤] [æ–°å¢æœå‹™]
```

---

## ğŸ“Š çµ±è¨ˆåŠŸèƒ½

### å®¢æˆ¶çµ±è¨ˆ
```sql
-- å®¢æˆ¶ç¸½æ•¸èˆ‡ç‹€æ…‹åˆ†å¸ƒ
SELECT 
  status,
  COUNT(*) as count
FROM clients
GROUP BY status;
```

### æœå‹™çµ±è¨ˆ
```sql
-- å„æœå‹™é¡å‹å®¢æˆ¶æ•¸
SELECT 
  service_type,
  COUNT(DISTINCT client_id) as client_count,
  SUM(fee) as total_monthly_revenue
FROM client_services
WHERE is_active = 1
GROUP BY service_type
ORDER BY client_count DESC;
```

### è² è²¬äººå·¥ä½œé‡
```sql
-- æ¯ä½æœƒè¨ˆå¸«è² è²¬çš„å®¢æˆ¶æ•¸èˆ‡æœå‹™æ•¸
SELECT 
  u.employee_name,
  COUNT(DISTINCT cs.client_id) as client_count,
  COUNT(cs.id) as service_count,
  SUM(cs.estimated_hours) as total_hours
FROM client_services cs
JOIN users u ON cs.assigned_to = u.id
WHERE cs.is_active = 1
GROUP BY u.id
ORDER BY total_hours DESC;
```

---

## ğŸ”§ å¯¦æ–½ç´°ç¯€

### æœå‹™é¡å‹å®šç¾©
```javascript
const SERVICE_TYPES = {
  accounting: 'è¨˜å¸³æœå‹™',
  vat: 'ç‡Ÿæ¥­ç¨…ç”³å ±',
  income_tax: 'ç‡Ÿæ‰€ç¨…ç”³å ±',
  withholding: 'æ‰£ç¹³ç”³å ±',
  prepayment: 'æš«ç¹³ç”³å ±',
  dividend: 'ç›ˆé¤˜åˆ†é…',
  nhi: 'äºŒä»£å¥ä¿è£œå……ä¿è²»',
  shareholder_tax: 'è‚¡æ±å¯æ‰£æŠµç¨…é¡',
  audit: 'è²¡å‹™ç°½è­‰',
  company_setup: 'å…¬å¸è¨­ç«‹ç™»è¨˜'
};
```

### æœå‹™é »ç‡å®šç¾©
```javascript
const FREQUENCY_TYPES = {
  monthly: 'æ¯æœˆ',
  bimonthly: 'é›™æœˆ',
  quarterly: 'æ¯å­£',
  biannual: 'åŠå¹´',
  annual: 'å¹´åº¦'
};
```

### é›£åº¦ç­‰ç´šå®šç¾©
```javascript
const DIFFICULTY_LEVELS = {
  1: 'ç°¡å–® - ç™¼ç¥¨å°‘ã€å¸³å‹™å–®ç´”',
  2: 'æ™®é€š - ä¸€èˆ¬ä¼æ¥­',
  3: 'ä¸­ç­‰ - äº¤æ˜“é »ç¹æˆ–ç§‘ç›®è¤‡é›œ',
  4: 'å›°é›£ - å¤šè§’åŒ–ç¶“ç‡Ÿæˆ–ç‰¹æ®Šè¡Œæ¥­',
  5: 'æ¥µé›£ - å¤§å‹ä¼æ¥­æˆ–è·¨åœ‹æ¥­å‹™'
};
```

---

## ğŸš€ æœªä¾†æ“´å±•

### è¨ˆåŠƒåŠŸèƒ½
- [ ] å®¢æˆ¶åˆ†ç´šç®¡ç†ï¼ˆVIPã€ä¸€èˆ¬ã€æ½›åœ¨ï¼‰
- [ ] å®¢æˆ¶ç”Ÿå‘½é€±æœŸè¿½è¹¤
- [ ] åˆç´„ç®¡ç†ï¼ˆèµ·è¿„æ—¥æœŸã€çºŒç´„æé†’ï¼‰
- [ ] å®¢æˆ¶æ»¿æ„åº¦èª¿æŸ¥
- [ ] å®¢æˆ¶æ–‡ä»¶åº«ï¼ˆä¸Šå‚³åˆç´„ã€è­‰ä»¶ç­‰ï¼‰
- [ ] å®¢æˆ¶æ¨™ç±¤ç³»çµ±
- [ ] å®¢æˆ¶æ¨è–¦ä¾†æºè¿½è¹¤
- [ ] å®¢æˆ¶æ”¶å…¥åˆ†æå ±è¡¨

---

**ç›¸é—œæ–‡æª”**ï¼š
- [ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md](./ç³»çµ±æ¶æ§‹è¨­è¨ˆ.md) - æ•´é«”æ¶æ§‹
- [å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md](./å®¢æˆ¶æœå‹™è‡ªå‹•åŒ–ç³»çµ±è¨­è¨ˆ.md) - è‡ªå‹•ä»»å‹™ç”Ÿæˆ
- [APIç«¯é»æ–‡æª”.md](./APIç«¯é»æ–‡æª”.md) - API åƒè€ƒ

