# 11 - 假期登記

**所屬模塊：** 假期管理  
**頁面路徑：** `/leave`  
**權限：** 所有使用者  
**最後更新：** 2025年10月27日

---

## 功能概述

員工自主登記請假，無需審批，登記即生效。

---

## UI 設計（日曆視圖）

```
假期管理 - 2025年11月
───────────────────────────────────
一  二  三  四  五  六  日
              1   2
3   4   5   6   7   8   9
       [病]
10  11  12  13  14  15  16
           [特][特]

新增請假
日期：[2025-11-15 ▼]
假別：[特休 ▼]      ← 選項由 gender 決定
時數：[8] 小時
備註：[        ]

[送出]
```

---

## 性別連動

- 男性員工：看不到「生理假」、「產假」
- 女性員工：可看到所有假別

---

## 資料表

`TimeLogs` (leave_type, leave_hours)

---

## 假期衝突檢測

**功能：** 防止同一天重複請假

**實際運作：**
```
員工嘗試登記：2025-11-15 特休
    ↓
系統檢查：2025-11-15 已登記「病假」
    ↓
❌ 提示：「此日期已登記病假，不可重複請假」
```

**後端驗證邏輯：**
```typescript
// services/leave.service.ts
async function checkLeaveConflict(userId: number, date: string) {
  const existing = await db.prepare(`
    SELECT leave_type FROM TimeLogs 
    WHERE user_id = ? 
      AND work_date = ? 
      AND leave_type IS NOT NULL
      AND is_deleted = 0
  `).bind(userId, date).first();
  
  if (existing) {
    throw new ValidationError(
      `${date} 已登記${existing.leave_type}，不可重複請假`
    );
  }
}
```

---

## API

```
POST /api/v1/leave/apply
GET  /api/v1/leave/types        # 獲取可用假別（根據gender）
GET  /api/v1/leave/calendar?month=2025-11
```

---

**相關：** [假期API](../API設計/假期API.md), [假期餘額查詢](./13-假期餘額查詢.md)

