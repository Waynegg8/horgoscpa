# 16 - ä»»å‹™é€²åº¦è¿½è¹¤

**æ‰€å±¬æ¨¡å¡Šï¼š** ä»»å‹™è¿½è¹¤ç³»çµ±  
**é é¢è·¯å¾‘ï¼š** `/tasks`  
**æ¬Šé™ï¼š** æ‰€æœ‰å“¡å·¥ï¼ˆå–æ±ºæ–¼ `module_visibility_tasks`ï¼‰  
**æœ€å¾Œæ›´æ–°ï¼š** 2025å¹´10æœˆ27æ—¥

---

## åŠŸèƒ½æ¦‚è¿°

æŸ¥çœ‹æŒ‡æ´¾çµ¦è‡ªå·±çš„æ‰€æœ‰ä»»å‹™ï¼Œæ”¯æ´çœ‹æ¿è¦–åœ–å’Œåˆ—è¡¨è¦–åœ–ã€‚

---

## çœ‹æ¿è¦–åœ–

```
æˆ‘çš„ä»»å‹™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€å¾…é–‹å§‹â”€â”¬â”€é€²è¡Œä¸­â”€â”¬â”€å·²å®Œæˆâ”€â”¬â”€é€¾æœŸâ”€â”
â”‚ å®é”   â”‚ ä»Ÿé‘½   â”‚ æ–°å‰µ   â”‚ å¤§æˆ â”‚
â”‚ 0% â–‘â–‘  â”‚ 50% â–ˆâ–ˆ â”‚ 100% â–ˆâ–ˆâ”‚ 75% â–ˆâ”‚
â”‚ å‰©15å¤© â”‚ å‰©8å¤©  â”‚ å·²å®Œæˆ â”‚ é€¾5å¤©â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

---

## åˆ—è¡¨è¦–åœ–

```
| å®¢æˆ¶ | ä»»å‹™      | é€²åº¦ | åˆ°æœŸ     | ç‹€æ…‹   |
|------|-----------|------|----------|--------|
| ä»Ÿé‘½ | è¨˜å¸³-9-10 | 50%  | 11-15    | ğŸŸ¡é€²è¡Œä¸­|
| å®é” | å·¥å•†-11   | 0%   | 11-20    | âšªå¾…é–‹å§‹|
```

---

## ç¯©é¸åŠŸèƒ½

- å®¢æˆ¶ç¯©é¸
- ç‹€æ…‹ç¯©é¸
- æœˆä»½ç¯©é¸

---

## API

```
GET /api/v1/tasks?status=é€²è¡Œä¸­&page=1
```

---

## æ‰¹é‡æ“ä½œ

### æ‰¹é‡æ›´æ–°éšæ®µç‹€æ…‹

**ä½¿ç”¨å ´æ™¯ï¼š** 10 å€‹å®¢æˆ¶éƒ½å®Œæˆã€Œè³‡æ–™æ”¶é›†ã€éšæ®µï¼Œä¸€æ¬¡å…¨éƒ¨æ¨™è¨˜å®Œæˆ

**UI è¨­è¨ˆï¼š**
```
ä»»å‹™ç®¡ç†ï¼ˆåˆ—è¡¨è¦–åœ–ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[æ‰¹é‡æ“ä½œ â–¼]

â˜‘ ä»Ÿé‘½-è¨˜å¸³-9-10æœˆ   éšæ®µ1: è³‡æ–™æ”¶é›†  [é€²è¡Œä¸­]
â˜‘ å®é”-è¨˜å¸³-9-10æœˆ   éšæ®µ1: è³‡æ–™æ”¶é›†  [é€²è¡Œä¸­]
â˜‘ æ–°å‰µ-è¨˜å¸³-9-10æœˆ   éšæ®µ1: è³‡æ–™æ”¶é›†  [é€²è¡Œä¸­]
â˜ å¤§æˆ-ç¨…å‹™-10æœˆ     éšæ®µ2: ç¨…é¡è¨ˆç®—  [é€²è¡Œä¸­]

å·²é¸æ“‡ 3 å€‹ä»»å‹™çš„ç›¸åŒéšæ®µ

[æ‰¹é‡æ¨™è¨˜ç‚ºã€Œå·²å®Œæˆã€]
```

**APIï¼š**
```
POST /api/v1/tasks/stages/batch-update
Body: {
  "stage_ids": [1, 5, 9],
  "status": "å·²å®Œæˆ",
  "notes": "æ‰¹é‡å®Œæˆ"
}
```

**å¾Œç«¯é‚è¼¯ï¼š**
```typescript
async function batchUpdateStages(stageIds: number[], status: string, notes?: string) {
  const completedDate = new Date().toISOString().split('T')[0];
  
  for (const stageId of stageIds) {
    await db.prepare(`
      UPDATE ActiveTaskStages 
      SET status = ?, completed_date = ?, notes = ?
      WHERE active_stage_id = ?
    `).bind(status, completedDate, notes, stageId).run();
  }
  
  return { updated_count: stageIds.length };
}
```

---

### æ‰¹é‡æŒ‡æ´¾å®¢æˆ¶

**ä½¿ç”¨å ´æ™¯ï¼š** å“¡å·¥é›¢è·ï¼Œå°‡å…¶è² è²¬çš„ 20 å€‹å®¢æˆ¶è½‰çµ¦å…¶ä»–äºº

**UI è¨­è¨ˆï¼š**
```
å®¢æˆ¶ç®¡ç†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è² è²¬å“¡å·¥ç¯©é¸ï¼š[å·²é›¢è·å“¡å·¥ â–¼]

â˜‘ ä»Ÿé‘½ä¼æ¥­
â˜‘ å®é”å…¬å¸
â˜‘ æ–°å‰µç§‘æŠ€
... (å…± 20 ç­†)

å·²é¸æ“‡ 20 å€‹å®¢æˆ¶

[æ‰¹é‡é‡æ–°æŒ‡æ´¾]

â”Œâ”€ æ‰¹é‡æŒ‡æ´¾å®¢æˆ¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°è² è²¬äººï¼š[å‡±é–” â–¼]     â”‚
â”‚ [ç¢ºå®š] [å–æ¶ˆ]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**APIï¼š**
```
POST /api/v1/clients/batch-reassign
Body: {
  "client_ids": ["12345678", "87654321", ...],
  "new_assignee_id": 3
}
```

**å¾Œç«¯é‚è¼¯ï¼š**
```typescript
async function batchReassignClients(clientIds: string[], newAssigneeId: number) {
  for (const clientId of clientIds) {
    await db.prepare(`
      UPDATE Clients 
      SET assignee_user_id = ?, updated_at = datetime('now')
      WHERE client_id = ?
    `).bind(newAssigneeId, clientId).run();
    
    // åŒæ™‚æ›´æ–°è©²å®¢æˆ¶çš„æ‰€æœ‰åŸ·è¡Œä¸­ä»»å‹™
    await db.prepare(`
      UPDATE ActiveTasks 
      SET assigned_user_id = ?
      WHERE client_id = ? AND status IN ('é€²è¡Œä¸­', 'å¾…é–‹å§‹')
    `).bind(newAssigneeId, clientId).run();
  }
  
  return { updated_count: clientIds.length };
}
```

---

**ç›¸é—œï¼š** [ä»»å‹™API](../APIè¨­è¨ˆ/ä»»å‹™API.md), [éšæ®µé€²åº¦æ›´æ–°](./17-éšæ®µé€²åº¦æ›´æ–°.md), [å®¢æˆ¶API](../APIè¨­è¨ˆ/å®¢æˆ¶API.md)

