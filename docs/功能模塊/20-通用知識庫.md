# 20 - 通用知識庫

**所屬模塊：** 知識管理  
**頁面路徑：** `/knowledge`  
**權限：** 所有使用者  
**最後更新：** 2025年10月27日

---

## 功能概述

儲存內部 FAQ、教學文件、公司政策等非 SOP 類型的文件。

---

## UI 設計

```
內部知識庫
───────────────────────
[+ 新增文件]  🔍搜尋...

分類：[FAQ ▼]

┌─ FAQ ──────────────┐
│ • 如何申請特休？    │
│ • 加班費如何計算？  │
└─────────────────────┘

┌─ 教學文件 ─────────┐
│ • 工時表填寫指南    │
│ • 任務進度更新教學  │
└─────────────────────┘
```

---

## 資料表

```sql
CREATE TABLE KnowledgeBase (
  doc_id INTEGER PRIMARY KEY,
  title TEXT,
  category TEXT,  -- 'FAQ', '教學', '政策'
  content TEXT,
  created_at TEXT
);
```

---

## API

```
GET  /api/v1/knowledge
GET  /api/v1/knowledge?category=FAQ
GET  /api/v1/knowledge/search?q=特休
POST /api/v1/knowledge
PUT  /api/v1/knowledge/:docId
```

---

## 全文搜尋功能

**功能：** 搜尋知識庫和 SOP 的標題與內容

**UI 設計：**
```
內部知識庫
───────────────────────────────────
🔍 [搜尋：如何申請特休        ] [搜尋]

搜尋結果 (3筆)：
─────────────────────────────────

📄 如何申請特休？
   分類：FAQ
   ...登入系統後，進入「假期管理」頁面，選擇日期和假別...
   [查看全文]

📄 假期管理模塊使用指南
   分類：教學
   ...特休申請流程說明：1. 進入假期管理 2. 點擊日曆...
   [查看全文]

📘 記帳服務 SOP
   分類：SOP
   ...資料收集步驟包含：發票、對帳單...
   [查看全文]
```

**搜尋範圍：**
- `KnowledgeBase` 表（通用知識庫）
- `SOPDocuments` 表（SOP 文件）

**SQL 查詢：**
```sql
-- 搜尋知識庫
SELECT * FROM KnowledgeBase 
WHERE (title LIKE ? OR content LIKE ?)
  AND is_deleted = 0
UNION ALL
-- 搜尋 SOP
SELECT sop_id as doc_id, title, content, 'SOP' as category
FROM SOPDocuments
WHERE (title LIKE ? OR content LIKE ?)
ORDER BY updated_at DESC
```

**API：**
```
GET /api/v1/knowledge/search?q=特休
GET /api/v1/search/global?q=特休  # 全域搜尋（知識庫+SOP）
```

**回應範例：**
```json
{
  "success": true,
  "data": {
    "query": "特休",
    "results": [
      {
        "doc_id": 5,
        "title": "如何申請特休？",
        "category": "FAQ",
        "excerpt": "...登入系統後，進入「假期管理」頁面...",
        "relevance_score": 0.95
      },
      {
        "doc_id": 12,
        "title": "假期管理模塊使用指南",
        "category": "教學",
        "excerpt": "...特休申請流程說明...",
        "relevance_score": 0.88
      }
    ],
    "total": 3
  }
}
```

---

**相關：** [SOP文件管理](./18-SOP文件管理.md), [開發規範](../開發規範.md)

