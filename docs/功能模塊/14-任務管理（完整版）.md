# 任務管理（完整版）

**模塊編號：** 14-17（合併）  
**權限要求：** 管理員 / 員工（視權限設定）  
**頁面路徑：** `/tasks`  
**最後更新：** 2025年10月28日

---

## 📋 目錄
- [功能概述](#功能概述)
- [任務模板管理](#任務模板管理)
- [客戶服務設定](#客戶服務設定)
- [任務進度追蹤](#任務進度追蹤)
- [階段進度更新](#階段進度更新)
- [自動化流程](#自動化流程)

---

## 功能概述

### 核心功能
1. **任務模板管理** - 定義可重複使用的多階段任務模板
2. **客戶服務設定** - 為客戶配置週期性服務
3. **任務進度追蹤** - 查看和管理執行中的任務
4. **階段進度更新** - 更新任務各階段的狀態

### 設計原則
- ✅ 模板可重複使用
- ✅ 任務自動生成（根據觸發月份）
- ✅ 多階段流程管理
- ✅ 看板視圖追蹤進度

---

## 任務模板管理

### 功能描述
定義標準化的任務流程，包含多個階段。

### UI 設計
```
┌─────────────────────────────────────┐
│ 任務模板管理              [+ 新增]  │
├─────────────────────────────────────┤
│ 📋 記帳服務流程                     │
│    階段1: 收集憑證 (預計3天)        │
│    階段2: 整理傳票 (預計2天)        │
│    階段3: 結帳報表 (預計2天)        │
│    [編輯] [複製] [刪除]             │
├─────────────────────────────────────┤
│ 📋 工商登記流程                     │
│    階段1: 準備文件 (預計5天)        │
│    階段2: 送件申請 (預計1天)        │
│    階段3: 領取證明 (預計3天)        │
│    [編輯] [複製] [刪除]             │
└─────────────────────────────────────┘
```

### 核心功能
1. **新增模板** - 定義任務名稱和階段
2. **編輯模板** - 修改階段名稱和預計天數
3. **複製模板** - 快速建立類似模板
4. **刪除模板** - 軟刪除（不影響已生成任務）
5. **關聯服務** - 模板可關聯到特定服務項目

---

## 客戶服務設定

### 功能描述
為客戶配置週期性服務，系統自動生成任務。

### UI 設計
```
┌─────────────────────────────────────┐
│ 客戶A - 服務設定                    │
├─────────────────────────────────────┤
│ 服務項目：[記帳服務 - 收集憑證 ▼]  │
│ 週期類型：[雙月 ▼]                  │
│ 觸發月份：☑1月 ☐2月 ☑3月 ☑5月...  │
│ 任務模板：[記帳服務流程 ▼]         │
│ 開始日期：[2025-01-01]              │
│                     [取消] [儲存]   │
├─────────────────────────────────────┤
│ 已設定服務：                        │
│ ✓ 記帳服務 - 雙月（1,3,5,7,9,11月）│
│   使用模板：記帳服務流程            │
│   [編輯] [停用]                     │
└─────────────────────────────────────┘
```

### 核心功能
1. **選擇服務** - 從服務項目中選擇
2. **設定週期** - 選擇週期類型（每月/雙月/每季等）
3. **設定觸發月份** - 選擇哪些月份執行
4. **關聯模板** - 選擇任務模板（自動套用流程）
5. **啟用/停用** - 控制是否自動生成任務

### 唯一性規則
- 同一客戶不能重複訂閱同一服務
- 週期性服務必須設定觸發月份

---

## 任務進度追蹤

### 功能描述
查看和管理所有執行中的任務，支持看板和列表視圖。

### 看板視圖
```
┌──────────┬──────────┬──────────┬──────────┐
│ 待開始   │ 進行中   │ 已完成   │ 已取消   │
├──────────┼──────────┼──────────┼──────────┤
│ 📋客戶A  │ 📋客戶B  │ 📋客戶C  │          │
│ 記帳服務 │ 記帳服務 │ 工商登記 │          │
│ 1/3階段  │ 2/3階段  │ 3/3階段  │          │
│          │ ⚠️逾期   │ ✓已完成  │          │
└──────────┴──────────┴──────────┴──────────┘
```

### 列表視圖
```
┌─────────────────────────────────────────────────┐
│ 篩選: [客戶▼] [服務▼] [狀態▼] [負責人▼]       │
├─────────────────────────────────────────────────┤
│ 客戶  │ 任務名稱  │ 進度   │ 到期日   │ 負責人 │
│ 客戶A │ 記帳服務  │ 1/3    │ 11-30   │ 紜蓁   │
│ 客戶B │ 記帳服務  │ 2/3    │ 11-15⚠️ │ 曉明   │
│ 客戶C │ 工商登記  │ 3/3 ✓  │ 10-20   │ 小華   │
└─────────────────────────────────────────────────┘
```

### 核心功能
1. **看板視圖** - 拖放式任務管理
2. **列表視圖** - 表格式任務列表
3. **篩選功能** - 按客戶、服務、狀態篩選
4. **逾期警示** - 自動標示逾期任務
5. **進度顯示** - 顯示完成階段/總階段數

---

## 階段進度更新

### 功能描述
更新任務各階段的狀態，記錄開始和完成時間。

### UI 設計
```
┌─────────────────────────────────────┐
│ 客戶A - 記帳服務流程                │
├─────────────────────────────────────┤
│ ✓ 階段1: 收集憑證                   │
│   開始：2025-11-01                  │
│   完成：2025-11-03                  │
│   負責人：紜蓁                      │
├─────────────────────────────────────┤
│ ▶ 階段2: 整理傳票 [進行中]          │
│   開始：2025-11-04                  │
│   負責人：[紜蓁 ▼]                  │
│   [完成此階段]                      │
├─────────────────────────────────────┤
│ ○ 階段3: 結帳報表 [待開始]          │
│   預計天數：2天                     │
└─────────────────────────────────────┘
```

### 階段狀態
- **○ 待開始** (pending)
- **▶ 進行中** (in_progress)
- **✓ 已完成** (completed)

### 狀態轉換
```
pending → [開始階段] → in_progress → [完成階段] → completed
```

### 核心功能
1. **開始階段** - 點擊「開始」，記錄開始時間
2. **完成階段** - 點擊「完成」，記錄完成時間
3. **指派負責人** - 為階段指派特定員工
4. **添加備註** - 記錄階段執行的備註
5. **自動進入下一階段** - 完成後自動將下一階段設為可開始

---

## 自動化流程

### 任務自動生成
```
每月 1 日 Cron Job：
1. 查詢 ClientServices 表
   ↓
2. 檢查 trigger_months 是否包含當前月份
   ↓
3. 查詢關聯的 TaskTemplate
   ↓
4. 生成 ActiveTasks（設定到期日）
   ↓
5. 生成 ActiveTaskStages（複製階段模板）
   ↓
6. 通知負責員工
```

### 逾期檢測
```
每日執行 Cron Job：
1. 查詢 due_date < 今天且 status != 'completed'
   ↓
2. 標記為逾期
   ↓
3. 發送提醒通知
```

---

## 🔗 相關文檔

- **API 規格：** 任務管理API（待創建，遵循相同模式）
- **資料庫設計：** [任務系統表](../資料庫設計/任務系統表.md)
- **自動化流程：** [任務生成器](../自動化流程/01-任務生成器.md), [逾期檢測器](../自動化流程/02-逾期檢測器.md)

---

**最後更新：** 2025年10月28日  
**本文檔合併了以下4個功能模塊：**
1. 14-任務模板管理.md
2. 15-客戶服務設定.md
3. 16-任務進度追蹤.md
4. 17-階段進度更新.md

