# AI 核心工作规范

**本文档仅供 AI 阅读和遵守**  
**用户永远不需要看这个文档**

---

## 🎯 核心理念

**用户只说"要什么"，AI 负责"怎么做"**

用户不懂技术，也不想懂技术。AI 必须：
- 完全自主决策所有技术方案
- 完全自主实现所有代码
- 完全自主测试验证
- 完全自主部署上线
- 完全自主监控和修复问题

---

## 🚨 绝对禁止（立即停止）

### 禁止 1：问技术问题

❌ 禁止问：
- "数据要存在哪个表？"
- "要用什么API？"
- "要建索引吗？"
- "要用什么组件？"

✅ 正确做法：
- 自己检查现有设计
- 自己做技术决策
- 只问业务问题

### 禁止 2：让用户测试

❌ 禁止说：
- "请您测试看看"
- "麻烦您验证一下"
- "您可以试试看"

✅ 正确做法：
- 自己完整测试（至少15项）
- 自己验证功能
- 确认无误才说"已完成"

### 禁止 3：修改外部网站

❌ 禁止修改：
- 根目录的 .html 文件
- blog/ 目录
- services/ 目录
- assets/ 目录
- content/ 目录

✅ 只能修改：
- timesheet-api/ 目录
- 内部管理系统相关

---

## 📋 标准工作流程

### 用户说需求

```
用户: "我需要客户评分功能"
```

### AI 自动执行（无声工作）

```
步骤1：理解需求（2分钟）
✅ 检查 docs/AI開發指南/業務術語詞典.md
✅ 将业务术语转换为技术需求
✅ 检查现有类似功能

步骤2：技术决策（3分钟）
✅ 查阅 docs/AI開發指南/技術決策樹.md
✅ 自主决定：
   - 数据表设计（新表 vs 现有表）
   - API 设计（端点、参数）
   - 前端实现（组件、交互）
   - 权限设计
   - 性能优化

步骤3：准备业务问题（2分钟）
✅ 列出需要确认的业务细节
✅ 为每个问题准备选项
✅ 标注推荐选项和理由
```

### AI 询问业务细节

```
AI: Q1: 评分范围？
    A) 1-5分 ← 推荐（简单易用）
    B) 1-10分
    C) 0-100分

用户: A

AI: Q2: 谁可以评分？
    A) 仅管理员
    B) 所有员工 ← 推荐
    C) 负责该客户的员工

用户: B

AI: 理解您的需求：
    - 1-5分星星评分
    - 所有员工可评分
    开始实现，预计30分钟完成。
```

### AI 自动完成一切（30分钟）

```
步骤4：更新设计文档（5分钟）
✅ 创建数据库设计文档
✅ 创建API规格文档
✅ 创建技术规格文档
✅ 更新功能模块文档

步骤5：实现代码（15分钟）
✅ 创建数据表（DDL）
✅ 实现后端API（Repository/Service/Route）
✅ 实现前端组件（Vue）
✅ 实现权限检查
✅ 实现错误处理

步骤6：自动测试（5分钟）
✅ 运行 ./scripts/auto-test.sh
✅ 测试15+种情况：
   - 正常情况（5项）
   - 边界条件（3项）
   - 异常情况（3项）
   - 权限测试（2项）
   - 性能测试（2项）

步骤7：自动部署（3分钟）
✅ 运行 ./scripts/auto-deploy.sh
✅ Git commit
✅ 部署到 Cloudflare Workers
✅ 验证部署成功

步骤8：强制质量检查（5分钟）⭐⭐⭐
✅ 运行质量检查脚本
   Windows: ./scripts/quality-check.ps1
   Linux/Mac: ./scripts/quality-check.sh
✅ 确保所有检查通过
✅ 如有失败，立即修复
✅ 重新运行直到全部通过

步骤9：全局验证（2分钟）
✅ 实际访问新功能
✅ 检查相关功能无影响
✅ 检查错误日志
✅ 检查性能指标
```

### AI 报告完成（必须包含质量检查结果）

```
AI: ✅ 客户评分功能已完成

    ━━━━━━━━━━━━━━━━━━━━━━━━
    【质量检查】⭐ 必须有
    
    质量检查：17/17 通过 (100%) ✅
      ✅ 标准化：4/4
      ✅ 模块化：3/3
      ✅ 一致性：2/2
      ✅ 安全性：2/2
      ✅ 功能质量：6/6
    
    ━━━━━━━━━━━━━━━━━━━━━━━━
    【已完成内容】
    
    - 创建 ClientRatings 表
    - 实现 4 个API端点
    - 实现前端评分组件
    - 自动测试验证（15项全部通过）
    - 已部署上线
    
    ━━━━━━━━━━━━━━━━━━━━━━━━
    【测试结果】
    
    - ✅ 新增评分成功
    - ✅ 查询评分成功
    - ✅ 更新评分成功
    - ✅ 删除评分成功
    - ✅ 评分历史正确
    - ✅ 权限检查正常
    - ✅ 性能良好（<100ms）
    - ✅ 无影响其他功能
    
    ━━━━━━━━━━━━━━━━━━━━━━━━
    
    您可以直接使用：
    客户管理 → 点击客户 → 看到评分功能
```

---

## 🚨 强制质量检查（绝不可跳过）

### 每次说"已完成"前必须执行

```bash
# Windows
./scripts/quality-check.ps1

# Linux/Mac
./scripts/quality-check.sh
```

### 检查内容（17项）

1. **标准化检查（4项）**
   - 无硬编码业务规则
   - API使用/api/v1/前缀
   - SQL注入防护
   - 表格命名规范

2. **模块化检查（3项）**
   - 文件大小<300行
   - 分层架构清晰
   - 使用共用组件

3. **全局一致性（2项）**
   - 文档已更新
   - 命名风格一致

4. **安全性检查（2项）**
   - 未修改外部网站
   - 密码安全

5. **功能质量（6项）**
   - 自动测试通过
   - 手动验证通过
   - 无错误日志
   - 性能良好
   - UI正常
   - 边界情况

### 如果检查失败

```
绝不能说"已完成"
必须修复失败项
重新运行检查
直到全部通过
```

---

## 🔧 技术决策规则

### 决策1：数据存储

```
如果需要历史记录：
  → 创建独立表（带时间戳、软删除）
  
如果是简单属性且无历史需求：
  → 在现有表添加字段
  
如果是多对多关系：
  → 创建关联表（两个外键）
  
如果是配置数据：
  → 创建配置表（支持动态修改）
```

### 决策2：API 设计

```
如果是资源的 CRUD：
  GET /api/v1/resource          # 列表
  GET /api/v1/resource/:id      # 详情
  POST /api/v1/resource         # 新增
  PUT /api/v1/resource/:id      # 更新
  DELETE /api/v1/resource/:id   # 删除

如果是操作：
  POST /api/v1/resource/:id/action
```

### 决策3：前端组件

```
如果需要表格：
  → 使用 <DataTable> 组件
  
如果需要表单：
  → 使用 <FormContainer> 组件
  
如果需要按钮：
  → 使用 <StyledButton> 组件
  
如果需要新组件：
  → 参考现有组件风格
  → 创建可复用组件
```

### 决策4：权限设计

```
如果是敏感操作（删除、修改关键数据）：
  → 仅管理员

如果是日常操作（查询、新增、修改自己的数据）：
  → 所有员工

如果需要细粒度控制：
  → 检查 is_assigned（是否负责）
```

---

## 🧪 自动测试标准

### 必须测试的15项

**功能测试（5项）**
1. 正常新增
2. 正常查询
3. 正常更新
4. 正常删除
5. 历史记录正确

**边界测试（3项）**
6. 最小值
7. 最大值
8. 空值处理

**异常测试（3项）**
9. 无效输入
10. 数据不存在
11. 缺少必填项

**权限测试（2项）**
12. 管理员权限
13. 普通员工权限

**性能测试（2项）**
14. 响应时间 < 500ms
15. 并发请求无问题

### 测试脚本

```bash
# AI 自动运行
./scripts/auto-test.sh

# 输出示例
✅ 1/15 正常新增 - 通过
✅ 2/15 正常查询 - 通过
✅ 3/15 正常更新 - 通过
...
✅ 15/15 并发测试 - 通过

总计：15/15 通过 (100%)
```

---

## 🚀 自动部署流程

```bash
# AI 自动运行
./scripts/auto-deploy.sh

# 流程：
1. 检查代码变更
2. 运行测试（15项）
3. Git commit
4. 部署到 Cloudflare
5. 验证部署成功
6. 检查服务运行

# 只有全部成功才说"已完成"
```

---

## 🔍 问题诊断流程

### 用户报告问题

```
用户: "评分功能有问题"
```

### AI 自动诊断

```
步骤1：收集信息（自动）
✅ 运行 ./scripts/diagnose.sh
✅ 检查错误日志
✅ 检查性能指标
✅ 重现问题

步骤2：分析原因（自动）
✅ 识别症状
✅ Why 分析（找根本原因）
✅ 评估影响范围

步骤3：修复（自动）
✅ 设计修复方案
✅ 实施修复
✅ 更新文档

步骤4：验证（自动）
✅ 测试修复有效
✅ 测试无副作用
✅ 重新部署

步骤5：报告结果
AI: ✅ 问题已修复
    原因：前端缺少加载提示
    修复：添加加载状态和错误处理
    验证：所有情况测试通过
```

---

## 📊 自检清单

### 每个任务完成前必须确认

```
□ 我是否问了技术问题？（应该 = 0）
□ 我是否让用户测试？（应该 = 否）
□ 我是否自己完整测试了？（应该 = 是，15+项）
□ 我是否运行了质量检查脚本？（应该 = 是）⭐⭐⭐
□ 质量检查是否全部通过？（应该 = 是，17/17）⭐⭐⭐
□ 我是否自己部署了？（应该 = 是）
□ 我是否验证功能正常？（应该 = 是）
□ 我是否检查了副作用？（应该 = 是）
□ 我是否修改了外部网站？（应该 = 否）
□ 用户是否可以直接使用？（应该 = 是）
□ 我是否提供了质量检查报告？（应该 = 是）⭐⭐⭐
```

### 红旗警示（立即停止）

```
⚠️ 我想问"数据存哪里？"
⚠️ 我想说"请您测试"
⚠️ 我没有自己测试
⚠️ 我要修改 blog/ 目录
⚠️ 我不确定功能是否正常
```

---

## 🎯 成功标准

### 用户视角

```
✅ 我只说需求
✅ AI 自动完成
✅ 我不需要测试
✅ 直接可以使用
✅ 有问题 AI 自己修
```

### AI 视角

```
✅ 理解业务需求
✅ 自主技术决策
✅ 完整实现代码
✅ 完整测试验证
✅ 自主部署上线
✅ 自主监控和修复
```

---

## 📚 必读文档（AI启动时）

```
1. 本文档（AI核心工作規範.md）⭐⭐⭐
2. docs/AI開發指南/AI強制質量檢查.md ⭐⭐⭐
3. docs/AI開發指南/技術決策樹.md ⭐⭐
4. docs/AI開發指南/業務術語詞典.md ⭐⭐
5. docs/開發規範/ 目录下的所有规范 ⭐
```

---

## 🔄 持续学习

### AI 应该记录

```
每完成一个功能：
✅ 记录业务需求 → 技术实现的映射
✅ 记录遇到的问题和解决方案
✅ 更新参考案例库
✅ 优化决策树

每修复一个问题：
✅ 记录问题根因
✅ 记录修复方法
✅ 更新测试案例
✅ 避免重复问题
```

---

**核心承诺：用户不需要懂技术，AI 负责一切！** 🤖

