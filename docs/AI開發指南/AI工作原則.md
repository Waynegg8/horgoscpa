# AI工作原則

**最後更新：** 2025年10月27日

---

## 核心原則

### 原則 1：AI要主動和智能，不問技術問題

**❌ 禁止問的問題：**
```
Q: 資料要存在新表還是現有表？
Q: 要用哪個API端點？
Q: 要建立索引嗎？
Q: 要用什麼UI組件？
```

**✅ AI應該做的：**
```
1. 先自動檢查現有設計文檔
2. 自動分析可用選項
3. 給出推薦方案並說明理由
4. 只問業務需求，不問技術細節
```

**正確示例：**
```
AI：我檢查了現有資料庫設計，發現：
    - 方案A：使用現有的 Clients 表（新增 rating 欄位）
      優點：簡單，查詢快速
      缺點：無法保留評分歷史
      
    - 方案B：創建新的 ClientRatings 表
      優點：可以記錄評分歷史，支援多人評分
      缺點：需要JOIN查詢
      
    我推薦：方案B
    理由：根據您的需求（多人可評分），方案B更適合
    
    您覺得呢？
```

---

### 原則 2：自動檢查現有設計，不讓用戶重複告知

**AI在每個流程開始時應該自動做的：**

**✅ 自動讀取相關文檔**
```
1. 功能模塊文檔
2. 技術規格文檔
3. API規格文檔
4. 資料庫設計文檔
5. 開發規範文檔
```

**✅ 自動分析現有實作**
```
1. 掃描相關代碼
2. 分析類似功能的實作方式
3. 檢查是否有可復用的組件/邏輯
4. 對比最佳實踐
```

**✅ 自動給出建議**
```
1. 基於現有設計的推薦方案
2. 說明推薦理由
3. 列出替代方案
4. 只問業務決策問題
```

---

### 原則 3：標準化和模塊化優先

**AI在所有任務中應該自動檢查：**

**標準化檢查：**
- [ ] 業務規則是否存在資料表中（而非硬編碼）？
- [ ] API是否使用 `/api/v1/` 前綴？
- [ ] 是否使用標準回應格式？
- [ ] 是否使用參數化查詢？
- [ ] 錯誤處理是否符合標準？

**模塊化檢查：**
- [ ] 是否使用共用組件（而非重複實作）？
- [ ] 是否有重複的業務邏輯（應提取到Service/Utils）？
- [ ] Service層是否職責單一？
- [ ] 是否符合分層架構？

**AI發現問題時應該：**
```
1. 明確指出問題
2. 對比正確的實作方式（引用其他模塊的代碼）
3. 給出修復建議
4. 自動修復（先改文檔再改代碼）
```

---

### 原則 4：與其他代碼對比學習

**AI應該自動對比：**

```
當發現某個實作時，AI應該：
1. 檢查其他模塊是否有類似功能
2. 對比實作方式
3. 選擇最佳實踐
4. 確保一致性
```

**示例：**
```
AI發現：TimesheetGrid.vue 自己實作了按鈕

AI自動執行：
1. ✅ 搜索其他 .vue 檔案中的按鈕實作
2. ✅ 發現 TaskBoard.vue 使用 <StyledButton>
3. ✅ 檢查 components/common/StyledButton.vue 定義
4. ✅ 確認這是共用組件

AI建議：
"我發現 TaskBoard.vue 正確使用了 <StyledButton> 共用組件，
 建議 TimesheetGrid.vue 也改用此組件以保持一致性"
```

---

### 原則 5：先更新文檔，再修改代碼

**所有代碼變更前：**

```
1. ✅ 先更新設計文檔
   - 資料庫設計（如有資料表變更）
   - API規格（如有端點變更）
   - 技術規格（如有邏輯變更）
   - 功能模塊（如有功能變更）

2. ✅ 確認文檔已更新

3. ✅ 依照文檔開始編程

4. ✅ 驗證代碼與文檔一致
```

---

### 原則 6：自動化代碼審查

**當用戶要求優化/檢查代碼時：**

```
AI自動執行：
1. ✅ 列出所有功能模塊讓用戶選擇
2. ✅ 掃描所選模塊的所有代碼
3. ✅ 自動檢查：
   - 標準化問題
   - 模塊化問題
   - 命名規範問題
   - 安全問題
   - 效能問題
   - 文檔一致性問題
4. ✅ 與其他模塊對比
5. ✅ 給出優先級排序的問題列表
6. ✅ 詢問是否自動修復
7. ✅ 自動修復所有問題
```

---

### 原則 7：絕不修改外部網站

**所有任務開始前自動檢查：**
- [ ] 是否會影響外部網站檔案？
- [ ] 如果是，立即停止並提醒用戶

**外部網站檔案清單：**

所有位於專案根目錄的公開網站檔案，包括：
- 根目錄的所有 `.html` 檔案（index.html, contact.html, services.html 等）
- `blog/` 目錄下的所有檔案
- `services/` 目錄下的所有檔案
- `assets/` 整個目錄（css, js, images, fonts, data）
- `content/` 整個目錄（posts, resources）
- `templates/post.html`

**允許修改：**
- `timesheet-api/` 目錄（內部管理系統後端）
- 未來的 `admin/` 或 `internal/` 目錄（內部管理系統前端）

詳細清單請參閱 [🚨外部網站禁止修改清單](../🚨外部網站禁止修改清單.md)

---

### 原則 8：提供選項，一次只問一個點

**討論需求時，應該提供選項：**

```
✅ 正確：
AI：Q1: 評分範圍是多少？
    A) 1-5分（星星評分）
    B) 1-10分（數字評分）
    C) 0-100分（百分比）
用戶：A

AI：Q2: 誰可以評分？
    A) 僅管理員
    B) 僅負責該客戶的員工
    C) 所有員工都可以
    D) 管理員和負責員工都可以
用戶：D

AI：Q3: ...

❌ 錯誤（開放式問題）：
AI：Q2: 誰可以評分？
用戶：呃...負責員工？
（用戶不確定有哪些選項）

❌ 錯誤（一次問太多）：
AI：請告訴我：
    1. 評分範圍是多少？
    2. 誰可以評分？
    3. 要存在哪裡？
    4. 如何顯示？
    ... (一次問太多)
```

**選項設計原則：**
- 涵蓋常見情況（A, B, C）
- 提供"其他"選項（D: 其他，請說明）
- 每個選項簡短清晰
- 基於AI檢查現有設計給出合理選項

---

### 原則 9：深入追問找根本原因（不限5次）

**修復問題時：**
```
AI不應該：
❌ 只修改報錯的那一行
❌ 表面修復
❌ 問5次就停止（如果還沒找到根本原因）

AI應該：
✅ 持續問"為什麼"，直到找到根本原因
✅ 根本原因通常是：設計缺陷、邏輯錯誤、缺少驗證
✅ 可能3次就夠，也可能需要8次以上
✅ 找出根本原因後，系統性解決
✅ 檢查所有類似問題
✅ 防止再次發生
```

**示例：**
```
問題：工時表儲存時出現 "hours must be between 0 and 24"

為什麼1：為什麼出現這個錯誤？
→ 因為資料庫檢查失敗

為什麼2：為什麼資料庫檢查失敗？
→ 因為 hours 的值不符合範圍

為什麼3：為什麼 hours 的值不符合範圍？
→ 因為 hours 是字串 "8" 而非數字 8

為什麼4：為什麼 hours 是字串？
→ 因為前端 input type="text"，未做類型轉換

為什麼5：為什麼前端沒做類型轉換？
→ 因為技術規格文檔缺少驗證說明

為什麼6：為什麼後端沒驗證類型？
→ 因為API規格文檔缺少類型驗證要求

根本原因：
1. 設計文檔不完整（缺少驗證規範）
2. 前端實作錯誤（input類型、類型轉換）
3. 後端驗證不足（未檢查資料類型）

系統性解決：
1. 補充文檔（驗證規範）
2. 修復前端（input type, 類型轉換，前端驗證）
3. 修復後端（類型驗證，範圍驗證）
4. 檢查其他類似欄位（leave_hours, overtime_hours）
```

---

### 原則 10：AI自己測試驗證，不讓用戶測試

**⚠️ 超級重要：用戶沒有技術背景，AI必須自己驗證！**

```
❌ 禁止說的話：
"請您測試看看是否正常"
"您可以試試看功能是否運作"
"麻煩您驗證一下"

✅ AI應該做的：
1. 自動部署代碼（使用終端工具）
2. 自動運行測試（使用終端工具）
3. 自動驗證功能（檢查日誌、回應）
4. 確認沒問題後才告訴用戶"已完成並驗證"
```

**AI自動驗證流程：**

```
步驟1：自動部署
- 使用 run_terminal_cmd 部署代碼
- 檢查部署是否成功
- 檢查服務是否啟動

步驟2：自動測試
- 運行自動化測試（如有）
- 使用 curl 或 API 工具測試端點
- 檢查回應是否符合預期
- 檢查錯誤處理是否正常

步驟3：系統性檢查（全局角度）
- 檢查是否影響其他功能
- 檢查是否造成新的問題
- 檢查相關功能是否正常
- 檢查邊界條件

步驟4：確認無誤
- 所有測試通過
- 無新問題產生
- 相關功能正常
- 才告訴用戶"已完成"
```

---

### 原則 11：全局思考，系統性驗證

**AI不能偷懶！**

```
❌ 錯誤做法（只解決一個點）：
- 修復了報錯的那一行
- 沒檢查是否影響其他地方
- 自以為問題解決了
- 讓用戶測試，結果問題還在

✅ 正確做法（全局思考）：
1. 找出根本原因（不是表面症狀）
2. 思考影響範圍（哪些地方會受影響？）
3. 系統性解決（修復所有相關問題）
4. 全面驗證（不只驗證修復的點）
5. 確認無副作用（沒有造成新問題）
```

**系統性驗證檢查清單：**

```
修復問題後，AI必須檢查：

□ 原問題是否真的解決？（不是只改了代碼）
  - 實際運行測試
  - 檢查日誌無錯誤
  - 驗證各種情況（正常、邊界、異常）

□ 是否影響相關功能？
  - 檢查相同模塊的其他功能
  - 檢查使用相同資料表的功能
  - 檢查調用相同API的功能

□ 是否造成新問題？
  - 檢查其他測試是否通過
  - 檢查錯誤日誌
  - 檢查效能是否劣化

□ 是否解決所有類似問題？
  - 搜索相同邏輯的代碼
  - 一併修復

□ 文檔是否同步更新？
  - 設計文檔反映新邏輯
  - 測試案例涵蓋新情況
```

**範例：全局思考 vs 局部思考**

```
問題：工時表儲存失敗

❌ 局部思考（偷懶）：
1. 發現是資料類型問題
2. 修改那一行代碼
3. "已修復，請您測試"
4. 用戶測試：問題還在（因為只改了一個地方）

✅ 全局思考（正確）：
1. 找出根本原因（前端、後端、文檔都有問題）
2. 系統性修復：
   - 前端：input類型、類型轉換、驗證
   - 後端：類型驗證、範圍驗證
   - 文檔：補充驗證規範
3. 檢查類似問題（leave_hours, overtime_hours）
4. 自動測試驗證：
   - 測試正常情況
   - 測試邊界值（0, 24）
   - 測試異常值（-1, 25, "abc"）
5. 檢查影響範圍：
   - 報表功能是否正常？
   - 計算邏輯是否正確？
6. 確認無副作用
7. "已完成並驗證，所有測試通過"
```

---

### 原則 12：自動部署和測試

**AI使用工具自動完成，不讓用戶手動：**

```
部署流程：
1. git add 修改的檔案
2. git commit（不推送，等用戶確認）
3. 運行建置命令（如需要）
4. 重啟服務（如需要）
5. 檢查服務狀態

測試流程：
1. 運行自動化測試（如有）
2. 使用 curl 測試API端點
3. 檢查回應格式和內容
4. 測試錯誤處理
5. 檢查日誌無錯誤
```

**AI完成報告格式：**

```
✅ 功能開發完成：{功能名稱}

已完成：
- ✅ 更新設計文檔
- ✅ 實作代碼
- ✅ 自動部署
- ✅ 自動測試驗證

測試結果：
- ✅ 正常情況測試通過（測試了X種情況）
- ✅ 邊界條件測試通過
- ✅ 錯誤處理測試通過
- ✅ 相關功能測試通過（檢查了Y個相關功能）
- ✅ 無新問題產生

系統性驗證：
- ✅ 原問題已解決（實際驗證，不是猜測）
- ✅ 無影響其他功能（檢查了Z個相關功能）
- ✅ 無造成新問題（所有測試通過）
- ✅ 文檔與代碼一致

您可以直接使用，無需測試。
如有任何問題，我會立即修復。
```

---

### 原則 13：符合專案規範

**每個任務完成後自動檢查：**

```
文檔規範：
- [ ] 所有設計文檔已更新
- [ ] 文檔與代碼一致
- [ ] 每個文檔 < 200 行
- [ ] 交叉引用已更新

代碼規範：
- [ ] 命名符合規範
- [ ] API 使用 /api/v1/ 前綴
- [ ] 使用共用組件
- [ ] 使用標準回應格式
- [ ] 錯誤處理符合標準

資料庫規範：
- [ ] 表格命名：PascalCase
- [ ] 欄位命名：snake_case
- [ ] 外鍵約束已加上
- [ ] 索引已建立

安全規範：
- [ ] 未修改外部網站
- [ ] 密碼使用 Argon2
- [ ] 參數化查詢
- [ ] 權限檢查已實作
```

---

## 工作流程總結

```
用戶需求
    ↓
AI自動識別任務類型
    ↓
AI自動讀取所有相關文檔
    ↓
AI自動分析現有設計和代碼
    ↓
AI自動給出推薦方案（只問業務問題，不問技術問題）
    ↓
與用戶討論確認（提供選項，一次一個點）
    ↓
AI自動更新設計文檔
    ↓
AI依照文檔開始編程
    ↓
AI自動部署代碼 ⭐ 新增
    ↓
AI自動測試驗證 ⭐ 新增
    ↓
AI系統性檢查（全局角度）⭐ 新增
    ↓
AI確認無問題後才輸出完成報告 ⭐ 新增
    ↓
用戶可直接使用，無需測試 ⭐ 新增
```

**⚠️ 重點：AI自己驗證，不讓用戶測試！**

---

## 相關文檔

- [AI開發指南](../AI開發指南.md)
- [任務類型自動識別](./任務類型自動識別.md)
- [開發規範](../../開發規範.md)
- [🚨外部網站禁止修改清單](../../🚨外部網站禁止修改清單.md)

---

**最後更新：** 2025年10月27日

