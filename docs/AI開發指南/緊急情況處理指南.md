# 緊急情況處理指南

**最後更新：** 2025年10月27日

---

## 📌 本指南的目的

當AI在開發過程中遇到**緊急情況、嚴重錯誤或不確定的情況**時，應該如何應對和處理。

> **核心原則：** 遇到問題時，**立即停止** → **分析問題** → **提供方案** → **徵求用戶確認**

---

## 🚨 緊急情況分類

### 等級 1：最高優先級（立即停止）

#### 情況 1：即將修改外部網站文件

**識別標誌：**
- 文件路徑包含 `assets/`
- 文件路徑包含 `blog/`、`services/`、`content/`
- 根目錄的 `.html` 文件（除內部系統）

**AI立即執行：**
```
⚠️ 等等！我發現一個嚴重問題：

您要求修改的檔案 "{檔案路徑}" 在外部網站禁止修改清單中。

這個問題會導致：
- 外部網站被破壞
- 正式環境受影響
- 違反專案規範

我建議：
{提供替代方案}

請確認是否繼續，或者我們重新討論需求？
```

**絕對禁止：**
- ❌ 繼續修改
- ❌ 假裝沒看到
- ❌ 只提醒但還是修改了

---

#### 情況 2：用戶要求直接刪除資料庫

**識別標誌：**
- "刪除所有資料"
- "清空資料庫"
- "DROP TABLE"

**AI立即執行：**
```
⚠️ 等等！這是一個危險操作：

您要求：{總結需求}

風險：
- 所有資料將永久刪除
- 無法恢復
- 可能影響正式環境

確認問題：
Q1: 這是測試環境還是正式環境？
Q2: 您是否需要備份？
Q3: 是否只想清空特定資料而非全部？

更安全的替代方案：
A) 軟刪除（標記為 deleted）
B) 備份後再刪除
C) 只刪除測試資料

您希望如何處理？
```

---

#### 情況 3：發現設計文檔與代碼嚴重不一致

**識別標誌：**
- 文檔說一個表結構，代碼用另一個
- API文檔與實際端點不符
- 業務規則文檔與代碼邏輯完全不同

**AI立即執行：**
```
⚠️ 我發現一個嚴重不一致：

文檔說明：{文檔內容}
實際代碼：{代碼內容}

這會導致：
- 未來維護困惑
- 其他AI讀錯文檔
- 功能異常

我建議先暫停，處理這個不一致：
A) 更新文檔以符合代碼（代碼是對的）
B) 更新代碼以符合文檔（文檔是對的）
C) 與您確認哪個才是正確的

您認為哪個是正確的？
```

---

### 等級 2：高優先級（需要確認）

#### 情況 4：用戶需求不明確或矛盾

**識別標誌：**
- 前後需求矛盾
- 關鍵資訊缺失
- 無法判斷用戶真實意圖

**AI立即執行：**
```
我需要進一步了解您的需求，因為：

{指出不明確或矛盾的地方}

讓我們逐步確認：

Q1: {第一個需要確認的問題}
   A) {選項A}
   B) {選項B}
   C) {選項C}

（一次只問一個問題，等用戶回答後再繼續）
```

---

#### 情況 5：需要大規模重構

**識別標誌：**
- 需要修改10+個文件
- 需要遷移大量資料
- 影響多個核心模塊

**AI立即執行：**
```
我分析了您的需求，發現這是一個大規模變更：

影響範圍：
- 需要修改 {數量} 個文件
- 需要更新 {數量} 個文檔
- 可能需要資料遷移
- 影響 {模塊列表}

建議分階段進行：

階段1：{第一階段內容}（預計X小時）
階段2：{第二階段內容}（預計Y小時）
階段3：{第三階段內容}（預計Z小時）

或者，我們可以：
方案B：{簡化方案}

您希望如何進行？
```

---

#### 情況 6：發現安全漏洞

**識別標誌：**
- SQL Injection 風險
- XSS 風險
- 權限控制缺失
- 密碼明文儲存

**AI立即執行：**
```
⚠️ 安全警告：我發現一個安全問題：

問題：{安全問題描述}
位置：{文件路徑}
風險：{風險評估}

我建議立即修復：
{修復方案}

這個修復會：
- 影響：{影響範圍}
- 需要：{需要做的事}

您希望我立即修復嗎？
```

---

### 等級 3：中優先級（提供建議）

#### 情況 7：效能問題

**識別標誌：**
- N+1 查詢問題
- 缺少索引
- 大量資料未分頁

**AI立即執行：**
```
提醒：我注意到一個潛在的效能問題：

問題：{效能問題描述}
影響：當資料量增加時，{可能的影響}

建議優化：
{優化方案}

您希望：
A) 現在優化
B) 記錄在技術債清單，之後處理
C) 資料量不大，暫時不處理
```

---

#### 情況 8：與最佳實踐不符

**識別標誌：**
- 命名不符合規範
- 資料結構設計不佳
- 代碼重複

**AI立即執行：**
```
建議：我發現一個可以改進的地方：

目前：{現狀}
建議：{改進方案}
理由：{為什麼這樣更好}

您希望：
A) 採用建議
B) 保持現狀（有特殊原因）
C) 提供其他想法
```

---

## 🔧 常見錯誤的應對

### 錯誤類型 1：部署失敗

**症狀：**
```
Error: Module not found
Error: Syntax error
Error: Permission denied
```

**AI應對流程：**
```
1. 檢查錯誤日誌
2. 識別錯誤原因
3. 提供修復方案
4. 自動修復（如可以）
5. 驗證修復成功
```

**AI輸出：**
```
部署失敗，我已找到原因：

錯誤原因：{原因}
修復方式：{修復方式}

我已自動修復並重新部署：
- ✅ 錯誤已修復
- ✅ 重新部署成功
- ✅ 服務運作正常

請確認功能是否正常。
```

---

### 錯誤類型 2：測試失敗

**症狀：**
```
API返回 500 錯誤
功能無法正常運作
資料未正確儲存
```

**AI應對流程：**
```
1. 重現問題
2. 檢查錯誤日誌
3. 定位錯誤代碼
4. 分析根本原因
5. 修復並重新測試
6. 確認修復成功
```

**AI輸出：**
```
測試失敗，我已找到根本原因：

根本原因：{根本原因}
錯誤位置：{文件:行號}

修復方式：
- 已修改：{文件列表}
- 修復內容：{修復說明}

重新測試結果：
- ✅ 原問題已解決
- ✅ 所有測試通過
- ✅ 無造成新問題

功能現在正常運作。
```

---

### 錯誤類型 3：修改了不應該修改的文件

**發現時機：**
- 自我檢查時發現
- 用戶指出

**AI應對流程：**
```
1. 立即停止
2. 識別被修改的文件
3. 使用 git restore 恢復
4. 檢查是否有其他影響
5. 重新執行正確的修改
```

**AI輸出：**
```
⚠️ 非常抱歉，我修改了不應該修改的文件：

已修改：{文件列表}
原因：{為什麼會誤修改}

我已立即：
- ✅ 使用 git restore 恢復原檔案
- ✅ 檢查無其他檔案被影響
- ✅ 重新以正確方式實作

目前狀態：
- ✅ 外部網站檔案已恢復
- ✅ 功能已正確實作
- ✅ 所有測試通過

再次為此錯誤致歉。
```

---

## 🆘 不確定時的處理原則

### 原則 1：不確定就問

```
❌ 錯誤：自己猜測，可能猜錯
✅ 正確：提供選項，讓用戶選擇
```

**示例：**
```
我不確定您指的是：
A) {理解A}
B) {理解B}

請問您指的是哪一個？
```

---

### 原則 2：提供足夠資訊

```
❌ 錯誤："這樣可以嗎？"（用戶不知道"這樣"是什麼）
✅ 正確：清楚說明方案，讓用戶判斷
```

**示例：**
```
我建議：{具體方案}

這個方案會：
- {效果1}
- {效果2}
- {效果3}

優點：{優點}
缺點：{缺點}

您覺得這樣可以嗎？
```

---

### 原則 3：說明風險

```
❌ 錯誤：隱藏風險
✅ 正確：明確說明所有風險
```

**示例：**
```
這個方案的風險：
- ⚠️ 風險1：{風險描述}
- ⚠️ 風險2：{風險描述}

如何降低風險：
- {降低風險的方法}
```

---

## 📞 需要用戶介入的情況

### 情況清單

以下情況**必須**徵求用戶確認，**不可自行決定**：

1. **刪除任何資料**
   - 刪除資料表
   - 刪除資料記錄
   - 清空資料

2. **大規模重構**
   - 修改10+個文件
   - 變更核心架構
   - 資料遷移

3. **安全相關**
   - 變更權限設計
   - 修改認證邏輯
   - 變更密碼政策

4. **外部依賴**
   - 新增套件依賴
   - 升級主要版本
   - 變更API服務商

5. **業務邏輯變更**
   - 變更計算公式
   - 變更業務規則
   - 變更工作流程

---

## 🎯 緊急情況處理流程圖

```
遇到問題
    ↓
立即停止當前操作
    ↓
分類問題（等級1/2/3）
    ↓
    ├─→ 等級1：立即停止，警告用戶
    ├─→ 等級2：暫停，徵求確認
    └─→ 等級3：提供建議，繼續執行
    ↓
提供解決方案（含選項）
    ↓
等待用戶確認
    ↓
執行確認的方案
    ↓
驗證問題已解決
    ↓
輸出完成報告
```

---

## 📚 相關文檔

- [AI開發指南](../AI開發指南.md)
- [AI工作原則](./AI工作原則.md)
- [常見錯誤和陷阱](./常見錯誤和陷阱.md)
- [AI自檢清單](./AI自檢清單.md)
- [🚨外部網站禁止修改清單](../🚨外部網站禁止修改清單.md)

---

**最後更新：** 2025年10月27日


