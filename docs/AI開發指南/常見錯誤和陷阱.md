# 常見錯誤和陷阱

**最後更新：** 2025年10月27日

---

## 📌 本文檔的目的

記錄AI在開發過程中**容易犯的錯誤**和**需要避免的陷阱**，通過學習這些反例，提升AI的工作質量。

> **重要：** 這些都是真實案例或高風險場景，每個錯誤都附有正確做法。

---

## 🚨 嚴重錯誤（絕對禁止）

### 錯誤 1：修改外部網站文件

**錯誤示例：**
```
用戶：新增客戶評分功能

AI：我會在客戶列表顯示評分...
    
❌ 修改了：index.html（外部網站首頁）
❌ 修改了：assets/css/common.css（外部網站樣式）
```

**為什麼錯誤：**
- 外部網站已上線，任何修改都會影響正式環境
- 內部管理系統應該有自己獨立的文件

**正確做法：**
```
✅ 檢查文件路徑是否在禁止清單中
✅ 內部系統文件應該在 timesheet-api/ 或未來的 admin/ 目錄
✅ 如果不確定，先詢問用戶
```

**預防方法：**
- 每次修改文件前，先檢查 [🚨外部網站禁止修改清單](../🚨外部網站禁止修改清單.md)
- 文件路徑包含 `assets/`、`blog/`、`services/`、`content/` → 立即停止

---

### 錯誤 2：未更新文檔就直接修改代碼

**錯誤示例：**
```
用戶：新增客戶評分功能

AI：好的，我直接開始編程...
    
❌ 直接創建了：clientRating.service.ts
❌ 沒有更新：資料庫設計文檔
❌ 沒有更新：API規格文檔
```

**為什麼錯誤：**
- 文檔與代碼不一致，後續維護困難
- 其他AI讀取文檔時會產生混淆
- 違反了"文檔優先"的核心原則

**正確做法：**
```
✅ 步驟1：與用戶確認所有需求細節
✅ 步驟2：按順序更新設計文檔：
   - 資料庫設計文檔
   - API規格文檔
   - 技術規格文檔
   - 功能模塊文檔
✅ 步驟3：依照文檔開始編程
✅ 步驟4：驗證代碼與文檔一致
```

---

### 錯誤 3：表面修復問題（沒有找根本原因）

**錯誤示例：**
```
用戶：工時表儲存時出現錯誤："hours must be between 0 and 24"

AI：問題：hours 超過 24
    
❌ 解決方案：在前端加上 max="24" 限制
❌ 完成！
```

**為什麼錯誤：**
- 只修復了表面症狀，沒有找根本原因
- 用戶可能繞過前端限制（API調用）
- 可能還有其他類似問題沒有發現

**正確做法：**
```
✅ 持續追問找根本原因：
   Q1: 為什麼會出現這個錯誤？
   A1: 因為 hours 值超過 24
   
   Q2: 為什麼 hours 會超過 24？
   A2: 用戶輸入了 25
   
   Q3: 為什麼用戶能輸入 25？
   A3: 前端沒有限制
   
   Q4: 為什麼後端允許 25？
   A4: 後端驗證有問題
   
   Q5: 為什麼設計時沒有考慮這個？
   A5: 缺少業務規則文檔 ← 根本原因！

✅ 系統性解決方案：
   1. 創建業務規則文檔（工時限制）
   2. 前端添加驗證
   3. 後端添加驗證
   4. 檢查其他類似欄位（如加班時數）
```

---

### 錯誤 4：只解決一個點，沒有全局思考

**錯誤示例：**
```
用戶：修改補休機制為先進先出

AI：已修改 CompensatoryLeaveUsage 表的查詢邏輯
    ✅ 完成！
    
問題：
❌ 只修改了使用邏輯，沒有檢查累積邏輯
❌ 沒有檢查顯示邏輯（前端可能還是顯示錯誤）
❌ 沒有檢查報表邏輯
❌ 沒有更新相關文檔
```

**為什麼錯誤：**
- 系統是相互關聯的，修改一處可能影響多處
- 造成新的不一致問題
- 用戶會發現其他地方還是有問題

**正確做法：**
```
✅ 全局思考影響範圍：
   1. 資料層：查詢邏輯、儲存邏輯
   2. 業務層：計算邏輯、驗證邏輯
   3. 前端層：顯示邏輯、輸入邏輯
   4. 報表層：統計邏輯
   5. 文檔層：所有相關文檔
   
✅ 系統性修改：
   - 補休使用 Service（FIFO邏輯）
   - 補休累積 Service（確保有 date 記錄）
   - 前端顯示組件（顯示日期）
   - 報表查詢（更新統計邏輯）
   - 更新所有相關文檔
   
✅ 全面驗證：
   - 測試正常情況
   - 測試邊界情況
   - 檢查相關功能
   - 確認無副作用
```

---

### 錯誤 5：讓用戶測試（而非AI自己測試）

**錯誤示例：**
```
AI：✅ 功能開發完成！
    
    請您測試看看是否正常。
```

**為什麼錯誤：**
- 用戶沒有技術背景，無法有效測試
- AI沒有真正驗證功能是否正常
- 容易出現"AI以為解決了，實際還有問題"

**正確做法：**
```
✅ AI自己測試驗證：
   1. 使用終端工具部署代碼
   2. 使用終端工具運行測試（curl、API工具）
   3. 測試正常情況（至少3-5種情況）
   4. 測試邊界條件
   5. 測試權限控制
   6. 檢查錯誤日誌
   7. 驗證無影響其他功能
   8. 確認無造成新問題
   
✅ 完成報告：
    ✅ 功能開發完成並已驗證
    
    已自動部署和測試：
    - ✅ 正常情況測試通過（測試了5種情況）
    - ✅ 邊界條件測試通過
    - ✅ 權限控制測試通過
    - ✅ 無影響其他功能
    - ✅ 無造成新問題
    
    您可以直接使用，無需測試。
```

---

## ⚠️ 中等錯誤（需要避免）

### 錯誤 6：問用戶技術問題

**錯誤示例：**
```
用戶：新增客戶評分功能

AI：Q1: 評分要存在新表還是舊表？
    Q2: 需要建立索引嗎？
    Q3: 使用 INTEGER 還是 DECIMAL？
```

**為什麼錯誤：**
- 用戶沒有技術背景，無法回答技術問題
- AI應該自己分析並提供建議
- 這是AI的工作，不是用戶的工作

**正確做法：**
```
✅ AI自己檢查和分析：
   1. 讀取現有資料庫設計
   2. 檢查類似功能的實作（如任務評分）
   3. 分析優缺點
   4. 給出推薦方案
   
✅ 只問業務問題：
   AI：我檢查了現有設計，發現兩種方案：
       
       方案A：在 Clients 表新增 rating 欄位
         優點：查詢簡單
         缺點：無法記錄評分歷史
         
       方案B：創建新的 ClientRatings 表
         優點：可記錄歷史、多人評分
         缺點：查詢需要JOIN
       
       我推薦：方案B
       理由：您提到需要記錄誰評的分，方案B更合適
       
       您覺得呢？
```

---

### 錯誤 7：一次問太多問題

**錯誤示例：**
```
AI：請確認以下需求：
    1. 評分範圍是多少？
    2. 誰可以評分？
    3. 評分存在哪裡？
    4. 前端顯示在哪？
    5. 需要評分歷史嗎？
    6. 需要評論嗎？
    7. 需要通知嗎？
    ...（一次10個問題）
```

**為什麼錯誤：**
- 用戶看到一大堆問題會感到壓力
- 容易遺漏或誤解某些問題
- 不符合"逐點確認"的原則

**正確做法：**
```
✅ 一次只問一個點：
   AI：Q1: 評分範圍是多少？（例如：1-5分？1-10分？）
   用戶：1-5分
   
   AI：Q2: 誰可以評分？
       A) 僅管理員
       B) 僅負責該客戶的員工
       C) 所有員工都可以
       D) 管理員和負責員工都可以
   用戶：D
   
   AI：Q3: ...
```

---

### 錯誤 8：沒有提供選項（開放式提問）

**錯誤示例：**
```
AI：Q: 誰可以評分？
```

**為什麼錯誤：**
- 用戶需要猜測有哪些選項
- 可能提出不合理的需求
- 效率低下

**正確做法：**
```
✅ 提供清晰的選項：
   AI：Q: 誰可以評分？
       A) 僅管理員
       B) 僅負責該客戶的員工
       C) 所有員工都可以
       D) 管理員和負責員工都可以
       E) 其他（請說明）
   
   這樣用戶可以快速選擇，也知道有哪些可能性。
```

---

### 錯誤 9：沒有檢查現有設計就提建議

**錯誤示例：**
```
用戶：新增客戶評分功能

AI：我建議創建 ClientRatings 表，包含：
    - id
    - client_id
    - rating
    - created_at
```

**為什麼錯誤：**
- 沒有檢查專案的命名規範（可能是 snake_case）
- 沒有檢查是否需要軟刪除
- 沒有檢查是否需要記錄評分人
- 沒有參考類似功能的設計

**正確做法：**
```
✅ 先檢查現有設計：
   1. 讀取資料庫設計文檔
   2. 檢查命名規範
   3. 檢查類似表的結構（如 TaskRatings）
   4. 檢查通用欄位（created_by, updated_by, deleted_at）
   
✅ 參考現有設計提建議：
   AI：我檢查了現有的 TaskRatings 表，建議：
       
       ClientRatings 表：
       - id (INTEGER PRIMARY KEY)
       - client_id (INTEGER, FK)
       - user_id (INTEGER, FK) ← 參考 TaskRatings
       - rating (INTEGER, 1-5)
       - comment (TEXT) ← 參考 TaskRatings
       - created_at (DATETIME)
       - updated_at (DATETIME)
       
       這樣與任務評分保持一致性。
```

---

### 錯誤 10：沒有與其他模塊對比

**錯誤示例：**
```
用戶：新增客戶標籤功能

AI：創建 ClientTags 表...
    （沒有檢查是否已有標籤功能）
    
結果：
❌ 專案中已有 TaskTags 表，結構不一致
❌ 無法共用標籤管理組件
❌ 代碼重複
```

**正確做法：**
```
✅ 檢查類似功能：
   1. 搜索現有代碼中的類似功能
   2. 對比結構和實作方式
   3. 評估是否可以共用
   
✅ 保持一致性：
   AI：我檢查了現有的標籤功能：
       
       發現 TaskTags 表使用了以下結構：
       - 多對多關係（TaskTagRelations）
       - 標籤可重複使用
       - 標籤顏色可自定義
       
       建議 ClientTags 也採用相同方式：
       - Tags 表（共用標籤定義）
       - ClientTagRelations 表（多對多）
       
       這樣可以：
       - 共用標籤管理組件
       - 統一用戶體驗
       - 減少代碼重複
```

---

## 💡 容易忽略的細節

### 細節 1：忘記更新索引文檔

**錯誤示例：**
```
AI：已創建 ClientRatings.md
    
❌ 沒有更新 資料庫設計.md 的索引
```

**正確做法：**
```
✅ 同時更新主文檔索引：
   - 創建子文檔
   - 更新主文檔的列表/鏈接
   - 更新相關交叉引用
```

---

### 細節 2：忘記更新交叉引用

**錯誤示例：**
```
AI：已更新 API規格/客戶/新增評分.md
    
❌ 功能模塊/客戶管理.md 中沒有提到評分API
```

**正確做法：**
```
✅ 更新所有相關引用：
   - 功能模塊文檔 → 技術規格文檔
   - 技術規格文檔 → API規格文檔
   - API規格文檔 → 資料庫設計文檔
   - 確保雙向鏈接完整
```

---

### 細節 3：文檔太長（超過建議行數）

**錯誤示例：**
```
創建了 300 行的 客戶管理.md
```

**正確做法：**
```
✅ 遵循文檔長度規範：
   - 功能模塊：100-150 行
   - 技術規格：80-120 行
   - API 規格：40-60 行/端點
   - 資料庫設計：80-100 行/表
   
   如果太長，拆分成子文檔。
```

---

### 細節 4：沒有添加示例

**錯誤示例：**
```markdown
## API 端點

POST /api/v1/clients/:id/ratings

請求體：JSON
回應：JSON
```

**正確做法：**
```markdown
## API 端點

POST /api/v1/clients/:id/ratings

### 請求範例
\`\`\`json
{
  "rating": 4,
  "comment": "合作愉快"
}
\`\`\`

### 成功回應範例
\`\`\`json
{
  "success": true,
  "data": {
    "id": 123,
    "client_id": 456,
    "rating": 4,
    "comment": "合作愉快"
  }
}
\`\`\`
```

---

## 🔍 自我檢查清單

完成任何任務後，AI應該自我檢查：

### 文檔方面
- [ ] 所有相關文檔都已更新？
- [ ] 文檔與代碼一致？
- [ ] 主文檔索引已更新？
- [ ] 交叉引用完整？
- [ ] 文檔長度符合規範？
- [ ] 包含足夠的示例？

### 代碼方面
- [ ] 符合命名規範？
- [ ] 使用了共用組件？
- [ ] 沒有硬編碼業務規則？
- [ ] 沒有重複代碼？
- [ ] 與類似模塊保持一致？

### 測試方面
- [ ] 已自動部署？
- [ ] 已自動測試？
- [ ] 測試了正常情況？
- [ ] 測試了邊界條件？
- [ ] 測試了權限控制？
- [ ] 檢查了錯誤日誌？

### 安全方面
- [ ] 沒有修改外部網站文件？
- [ ] 所有查詢使用參數化？
- [ ] 權限檢查已實作？

---

## 📚 相關文檔

- [AI開發指南](../AI開發指南.md)
- [AI工作原則](./AI工作原則.md)
- [AI自檢清單](./AI自檢清單.md)
- [🚨外部網站禁止修改清單](../🚨外部網站禁止修改清單.md)

---

**最後更新：** 2025年10月27日


