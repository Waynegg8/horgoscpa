# 客戶服務設定 - 測試案例

**最後更新：** 2025年10月27日

---

## 新增客戶服務

### 測試 1：成功新增雙月記帳服務
**前置條件：**
- 客戶「冠群資訊」存在（ID=12345678）
- 服務項目「記帳服務」存在（ID=3）
- 頻率類型「雙月」存在（ID=2）

**操作：**
1. 進入客戶詳情頁
2. 點擊「+ 新增」
3. 選擇服務項目：「記帳服務」
4. 選擇頻率：「雙月」
5. 勾選觸發月份：1,3,5,7,9,11
6. 輸入費用：15000
7. 選擇難易度：「中等」
8. 點擊「儲存」

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 列表中出現新服務
- ✅ 資料庫插入記錄，`trigger_months = "[1,3,5,7,9,11]"`

---

### 測試 2：重複訂閱同一服務
**前置條件：** 客戶已訂閱「記帳服務」

**操作：**
1. 嘗試再次新增「記帳服務」

**預期結果：**
- ❌ 顯示錯誤：「此客戶已訂閱該服務項目」
- ❌ 不插入資料庫

---

### 測試 3：週期性服務未選擇觸發月份
**操作：**
1. 選擇服務項目：「記帳服務」
2. 選擇頻率：「雙月」
3. 不勾選任何觸發月份
4. 點擊「儲存」

**預期結果：**
- ❌ 顯示錯誤：「週期性服務必須設定觸發月份」
- ❌ 不插入資料庫

---

### 測試 4：新增單次性服務
**操作：**
1. 選擇服務項目：「工商登記服務 - 公司設立」
2. 選擇頻率：「單次」
3. 設定開始日期：2025-01-01
4. 設定結束日期：2025-01-31
5. 輸入費用：50000
6. 選擇難易度：「困難」
7. 點擊「儲存」

**預期結果：**
- ✅ 成功新增
- ✅ `trigger_months = NULL`
- ✅ 設定了 `start_date` 和 `end_date`

---

## 編輯客戶服務

### 測試 5：成功修改服務費用
**前置條件：** 客戶已訂閱「記帳服務」（費用15000）

**操作：**
1. 點擊「編輯」按鈕
2. 修改費用為 18000
3. 點擊「儲存」

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 資料庫更新 `fee_amount = 18000`
- ✅ 列表顯示新費用

---

### 測試 6：修改觸發月份
**前置條件：** 服務觸發月份為 [1,3,5,7,9,11]

**操作：**
1. 編輯服務
2. 改為每月：勾選 1-12 月
3. 點擊「儲存」

**預期結果：**
- ✅ 成功更新
- ✅ `trigger_months = "[1,2,3,4,5,6,7,8,9,10,11,12]"`

---

### 測試 7：嘗試修改服務項目（不允許）
**操作：**
1. 點擊「編輯」按鈕
2. 服務項目下拉選單為灰色（disabled）

**預期結果：**
- ✅ 服務項目欄位不可修改

---

## 停用/啟用服務

### 測試 8：停用服務
**前置條件：** 服務啟用中（`is_active = 1`）

**操作：**
1. 點擊「停用」按鈕
2. 確認停用

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 資料庫更新 `is_active = 0`
- ✅ 卡片樣式變為灰色
- ✅ 狀態顯示「⊗」

---

### 測試 9：啟用服務
**前置條件：** 服務已停用（`is_active = 0`）

**操作：**
1. 點擊「啟用」按鈕
2. 確認啟用

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 資料庫更新 `is_active = 1`
- ✅ 卡片樣式恢復正常
- ✅ 狀態顯示「✓」

---

## 刪除客戶服務

### 測試 10：刪除無關聯任務的服務
**前置條件：** 服務無關聯的任務記錄

**操作：**
1. 點擊「刪除」按鈕
2. 確認刪除

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 列表中移除該服務
- ✅ 資料庫 `is_deleted = 1`

---

### 測試 11：刪除有關聯任務的服務
**前置條件：** 服務有關聯的任務記錄

**操作：**
1. 嘗試刪除服務

**預期結果：**
- ❌ 顯示錯誤：「此服務有關聯的任務，無法刪除」
- ❌ 不更新資料庫

---

## 查詢客戶服務

### 測試 12：查詢客戶的所有服務
**前置條件：**
- 客戶有3個服務：
  - 記帳服務（啟用）
  - 工商登記服務（啟用）
  - 稅務申報服務（停用）

**操作：**
1. 進入客戶詳情頁
2. 點擊「服務項目」頁籤

**預期結果：**
- ✅ 顯示3個服務
- ✅ 啟用的服務在前
- ✅ 停用的服務顯示灰色
- ✅ 每個服務顯示完整資訊

---

### 測試 13：空服務列表
**前置條件：** 客戶尚未訂閱任何服務

**操作：**
1. 進入客戶詳情頁
2. 點擊「服務項目」頁籤

**預期結果：**
- ✅ 顯示「尚未設定服務」提示
- ✅ 顯示「+ 新增」按鈕

---

## 自動建立任務（Cron Job）

### 測試 14：每月1日自動建立任務
**前置條件：**
- 客戶A訂閱「記帳服務」，觸發月份 [1,3,5]
- 客戶B訂閱「記帳服務」，觸發月份 [2,4,6]
- 當前日期：2025-01-01

**操作：**
1. Cron Job 執行 `createMonthlyTasks()`

**預期結果：**
- ✅ 為客戶A建立任務（1月在觸發列表）
- ✅ 不為客戶B建立任務（1月不在觸發列表）
- ✅ 任務關聯正確的任務模板

---

### 測試 15：停用的服務不建立任務
**前置條件：**
- 客戶A訂閱「記帳服務」，`is_active = 0`，觸發月份 [1]
- 當前日期：2025-01-01

**操作：**
1. Cron Job 執行

**預期結果：**
- ❌ 不為客戶A建立任務（服務已停用）

---

### 測試 16：已結束的服務不建立任務
**前置條件：**
- 客戶A訂閱「記帳服務」，`end_date = 2024-12-31`
- 當前日期：2025-01-01

**操作：**
1. Cron Job 執行

**預期結果：**
- ❌ 不為客戶A建立任務（服務已結束）

---

## 權限控制

### 測試 17：會計師只能管理自己負責的客戶
**前置條件：**
- 會計師A登入
- 客戶X由會計師B負責

**操作：**
1. 嘗試訪問客戶X的服務頁面

**預期結果：**
- ❌ 顯示 403 錯誤或導向其他頁面
- ❌ 不顯示「+ 新增」按鈕

---

### 測試 18：管理員可管理所有客戶
**前置條件：** 管理員登入

**操作：**
1. 訪問任意客戶的服務頁面

**預期結果：**
- ✅ 可查看所有服務
- ✅ 可新增/編輯/刪除服務

---

## 整合測試

### 測試 19：服務與任務的整合
**前置條件：**
- 客戶訂閱「記帳服務」
- 關聯任務模板「記帳標準流程」

**操作：**
1. Cron Job 建立任務

**預期結果：**
- ✅ 任務自動套用「記帳標準流程」的階段
- ✅ 任務名稱包含服務名稱和日期
- ✅ 任務關聯正確的客戶

---

### 測試 20：服務與工時的整合
**前置條件：** 客戶訂閱「記帳服務」

**操作：**
1. 員工填寫工時
2. 選擇該客戶和服務

**預期結果：**
- ✅ 工時記錄成功關聯服務
- ✅ 可統計該服務的總工時

---

## 相關文檔

- [功能模塊 - 客戶服務設定](../../功能模塊/15-客戶服務設定.md)
- [UI 設計](./UI設計.md)
- [業務邏輯](./業務邏輯.md)


