# 員工帳號管理 - 業務邏輯

**最後更新：** 2025年10月27日

---

## 密碼雜湊

```typescript
import argon2 from 'argon2';

export async function hashPassword(password: string): Promise<string> {
  return await argon2.hash(password, {
    type: argon2.argon2id,
    memoryCost: 65536,
    timeCost: 3,
    parallelism: 4
  });
}

export async function verifyPassword(
  password: string, 
  hash: string
): Promise<boolean> {
  return await argon2.verify(hash, password);
}
```

---

## 新增員工

```typescript
async function createUser(input: CreateUserInput, adminId: number) {
  // 1. 檢查帳號是否重複
  const existing = await db.prepare(
    'SELECT * FROM Users WHERE username = ?'
  ).bind(input.username).first();
  
  if (existing) {
    throw new Error('帳號已存在');
  }
  
  // 2. 雜湊密碼
  const hashedPassword = await hashPassword(input.password);
  
  // 3. 建立帳號
  const result = await db.prepare(`
    INSERT INTO Users (
      name, username, password, gender, is_admin, created_by
    ) VALUES (?, ?, ?, ?, ?, ?)
  `).bind(
    input.name,
    input.username,
    hashedPassword,
    input.gender,
    input.is_admin || false,
    adminId
  ).run();
  
  const userId = result.meta.last_row_id;
  
  // 4. 建立預設權限
  await createDefaultPermissions(userId);
  
  return userId;
}
```


