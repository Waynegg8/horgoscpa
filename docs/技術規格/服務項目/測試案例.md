# 服務項目管理 - 測試案例

**最後更新：** 2025年10月27日

---

## 新增主項目

### 測試 1：成功新增主項目
**前置條件：** 用戶已登入，有服務管理權限  
**操作：**
1. 點擊「新增主項目」
2. 輸入服務名稱：「記帳服務」
3. 輸入說明：「雙月記帳標準服務」
4. 點擊「儲存」

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 列表中出現「記帳服務」
- ✅ 資料庫插入一筆記錄，`parent_service_id = NULL`

---

### 測試 2：主項目名稱重複
**前置條件：** 已存在主項目「記帳服務」  
**操作：**
1. 嘗試新增主項目「記帳服務」

**預期結果：**
- ❌ 顯示錯誤：「服務名稱已存在」
- ❌ 不插入資料庫

---

### 測試 3：服務名稱為空
**操作：**
1. 點擊「新增主項目」
2. 服務名稱留空
3. 點擊「儲存」

**預期結果：**
- ❌ 顯示錯誤：「服務名稱不可為空」
- ❌ 不插入資料庫

---

## 新增子項目

### 測試 4：成功新增子項目
**前置條件：** 已存在主項目「記帳服務」（ID=1）  
**操作：**
1. 點擊「記帳服務」下的「新增子項目」
2. 輸入服務名稱：「收集憑證」
3. 點擊「儲存」

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 「記帳服務」下出現「收集憑證」
- ✅ 資料庫插入一筆記錄，`parent_service_id = 1`

---

### 測試 5：同一主項目下子項目名稱重複
**前置條件：** 
- 主項目「記帳服務」（ID=1）
- 已有子項目「收集憑證」

**操作：**
1. 嘗試在「記帳服務」下再次新增「收集憑證」

**預期結果：**
- ❌ 顯示錯誤：「服務名稱已存在」
- ❌ 不插入資料庫

---

### 測試 6：不同主項目下可有相同名稱子項目
**前置條件：**
- 主項目「記帳服務」（ID=1）已有子項目「諮詢」
- 主項目「工商登記服務」（ID=2）

**操作：**
1. 在「工商登記服務」下新增子項目「諮詢」

**預期結果：**
- ✅ 成功新增
- ✅ 兩個主項目分別有各自的「諮詢」子項目

---

## 編輯服務項目

### 測試 7：成功編輯主項目
**前置條件：** 已存在主項目「記帳服務」  
**操作：**
1. 點擊「記帳服務」的「編輯」按鈕
2. 修改名稱為「會計記帳服務」
3. 點擊「儲存」

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 列表中更新為「會計記帳服務」
- ✅ 資料庫 `updated_at` 更新

---

### 測試 8：編輯時名稱重複
**前置條件：**
- 主項目「記帳服務」（ID=1）
- 主項目「工商登記服務」（ID=2）

**操作：**
1. 編輯「工商登記服務」
2. 名稱改為「記帳服務」
3. 點擊「儲存」

**預期結果：**
- ❌ 顯示錯誤：「服務名稱已存在」
- ❌ 不更新資料庫

---

## 刪除服務項目

### 測試 9：刪除無依賴的子項目
**前置條件：**
- 主項目「記帳服務」
- 子項目「收集憑證」（未被使用）

**操作：**
1. 點擊「收集憑證」的「刪除」按鈕
2. 確認刪除

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 列表中移除「收集憑證」
- ✅ 資料庫 `is_deleted = 1`

---

### 測試 10：刪除有依賴的子項目
**前置條件：**
- 子項目「收集憑證」（ID=3）
- 客戶A有服務設定使用該子項目

**操作：**
1. 嘗試刪除「收集憑證」

**預期結果：**
- ❌ 顯示錯誤：「此服務項目已被使用，無法刪除」
- ❌ 不更新資料庫

---

### 測試 11：刪除主項目（級聯刪除子項目）
**前置條件：**
- 主項目「記帳服務」（ID=1）
- 子項目「收集憑證」（ID=3）、「整理傳票」（ID=4）
- 均未被使用

**操作：**
1. 刪除主項目「記帳服務」
2. 確認刪除

**預期結果：**
- ✅ 顯示成功訊息
- ✅ 列表中移除「記帳服務」及其所有子項目
- ✅ 資料庫中主項目和所有子項目的 `is_deleted = 1`

---

### 測試 12：刪除主項目時有子項目被使用
**前置條件：**
- 主項目「記帳服務」（ID=1）
- 子項目「收集憑證」（ID=3）被客戶A使用

**操作：**
1. 嘗試刪除主項目「記帳服務」

**預期結果：**
- ❌ 顯示錯誤：「此服務項目已被使用，無法刪除」
- ❌ 不更新資料庫

---

## 查詢服務列表

### 測試 13：查詢所有服務（層級結構）
**前置條件：**
- 主項目「記帳服務」
  - 子項目「收集憑證」
  - 子項目「整理傳票」
- 主項目「工商登記服務」
  - 子項目「公司設立」

**操作：**
1. 進入服務項目管理頁面

**預期結果：**
- ✅ 顯示正確的層級結構
- ✅ 主項目在前，子項目縮排顯示
- ✅ 依照 `sort_order` 和名稱排序

---

## 權限控制

### 測試 14：員工無權限時隱藏功能
**前置條件：**
- 員工用戶登入
- 無 `service_management` 權限

**操作：**
1. 訪問 `/settings/services`

**預期結果：**
- ❌ 顯示 403 錯誤或導向其他頁面
- ❌ 不顯示任何服務列表

---

### 測試 15：管理員有完整權限
**前置條件：** 管理員用戶登入  
**操作：**
1. 訪問 `/settings/services`

**預期結果：**
- ✅ 顯示完整服務列表
- ✅ 所有「新增」、「編輯」、「刪除」按鈕可見且可用

---

## 整合測試

### 測試 16：服務項目與工時表整合
**前置條件：**
- 主項目「記帳服務」
- 子項目「收集憑證」

**操作：**
1. 進入工時表填寫頁面
2. 選擇服務項目

**預期結果：**
- ✅ 下拉選單顯示「記帳服務 - 收集憑證」
- ✅ 選擇後可成功記錄工時

---

### 測試 17：服務項目與客戶服務設定整合
**前置條件：**
- 主項目「記帳服務」
- 客戶A

**操作：**
1. 為客戶A設定服務
2. 選擇「記帳服務」

**預期結果：**
- ✅ 成功建立 `ClientServices` 記錄
- ✅ 客戶A的服務列表顯示「記帳服務」

---

## 相關文檔

- [功能模塊 - 服務項目管理](../../功能模塊/03-服務項目管理.md)
- [UI 設計](./UI設計.md)
- [業務邏輯](./業務邏輯.md)


