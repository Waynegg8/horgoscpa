# 階段進度更新 - 測試案例

**最後更新：** 2025年10月27日

---

## 開始階段

### 測試 1：成功開始階段
**前置條件：** 階段1無依賴，狀態為「pending」

**操作：**
1. 點擊「開始此階段」

**預期結果：**
- ✅ 階段狀態更新為「in_progress」
- ✅ 設定 `actual_start_date` 為今天
- ✅ 自動計算 `expected_due_date`
- ✅ 任務狀態更新為「in_progress」

---

### 測試 2：依賴未完成無法開始
**前置條件：** 階段2依賴階段1，階段1未完成

**操作：**
1. 嘗試開始階段2

**預期結果：**
- ❌ 顯示提示：「需先完成『階段1：資料收集』」
- ❌ 「開始此階段」按鈕禁用
- ❌ 不更新資料庫

---

### 測試 3：依賴完成後可開始
**前置條件：** 階段2依賴階段1，階段1已完成

**操作：**
1. 點擊「開始此階段」

**預期結果：**
- ✅ 階段2成功開始
- ✅ 日期正確計算

---

## 完成階段

### 測試 4：成功完成階段
**前置條件：** 階段1進行中

**操作：**
1. 點擊「標記完成」
2. 輸入備註（可選）
3. 確認

**預期結果：**
- ✅ 階段狀態更新為「completed」
- ✅ 設定 `actual_completion_date`
- ✅ 備註儲存成功
- ✅ 任務進度自動更新

---

### 測試 5：完成所有階段自動完成任務
**前置條件：** 任務有3個階段，2個已完成

**操作：**
1. 完成最後1個階段

**預期結果：**
- ✅ 階段3標記為完成
- ✅ 任務進度更新為 100%
- ✅ 任務狀態更新為「completed」
- ✅ 設定任務的 `actual_completion_date`

---

## 備註管理

### 測試 6：新增階段備註
**前置條件：** 階段進行中，無備註

**操作：**
1. 點擊「新增備註」
2. 輸入：「已收到全部發票」
3. 點擊「儲存」

**預期結果：**
- ✅ 備註儲存成功
- ✅ 階段卡片顯示備註
- ✅ 按鈕文字變為「編輯備註」

---

### 測試 7：編輯階段備註
**前置條件：** 階段已有備註

**操作：**
1. 點擊「編輯備註」
2. 修改內容
3. 點擊「儲存」

**預期結果：**
- ✅ 備註更新成功
- ✅ 顯示新內容

---

## 日期計算

### 測試 8：階段到期日計算
**前置條件：** 階段預計3天，今天開始

**操作：**
1. 開始階段

**預期結果：**
- ✅ `actual_start_date` = 今天
- ✅ `expected_due_date` = 今天 + 3天

---

### 測試 9：剩餘天數顯示
**前置條件：** 階段到期日為明天

**操作：**
1. 查看階段詳情

**預期結果：**
- ✅ 顯示「剩1天」
- ✅ 圖示為黃色🟡

---

### 測試 10：逾期標記
**前置條件：** 階段到期日為昨天，未完成

**操作：**
1. 查看階段詳情

**預期結果：**
- ✅ 顯示「逾1天」
- ✅ 圖示為紅色🔴
- ✅ 卡片標記為紅色

---

## 依賴鏈測試

### 測試 11：線性依賴
**前置條件：** 階段1→2→3→4線性依賴

**操作：**
1. 完成階段1
2. 檢查階段2

**預期結果：**
- ✅ 階段2可以開始
- ✅ 階段3、4仍然鎖定

---

### 測試 12：跳過階段嘗試
**前置條件：** 階段1→2→3依賴

**操作：**
1. 嘗試直接開始階段3（階段1、2未完成）

**預期結果：**
- ❌ 階段3按鈕禁用
- ❌ 顯示依賴提示

---

## 進度計算

### 測試 13：自動更新任務進度
**前置條件：** 任務有4個階段

**操作：**
1. 完成階段1

**預期結果：**
- ✅ 任務進度：25%
- ✅ 進度條正確顯示

---

### 測試 14：多階段完成更新
**前置條件：** 任務有4個階段，1個已完成

**操作：**
1. 連續完成階段2、3

**預期結果：**
- ✅ 完成階段2後：進度50%
- ✅ 完成階段3後：進度75%

---

## 整合測試

### 測試 15：完整任務流程
**操作：**
1. 開始階段1（資料收集，3天）
2. 完成階段1，新增備註
3. 開始階段2（營業稅過帳，2天）
4. 完成階段2
5. 開始階段3（提列折舊，1天）
6. 完成階段3
7. 開始階段4（報表產出，2天）
8. 完成階段4

**預期結果：**
- ✅ 所有階段按順序完成
- ✅ 任務進度正確更新（25% → 50% → 75% → 100%）
- ✅ 任務狀態從「pending」→「in_progress」→「completed」
- ✅ 所有日期正確記錄

---

## 相關文檔

- [功能模塊 - 階段進度更新](../../功能模塊/17-階段進度更新.md)
- [UI 設計](./UI設計.md)
- [業務邏輯](./業務邏輯.md)





