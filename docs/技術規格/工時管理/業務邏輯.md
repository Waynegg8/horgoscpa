# 工時表填寫 - 業務邏輯

**最後更新：** 2025年10月27日

---

## 加權工時計算

```typescript
function calculateWeightedHours(
  hours: number,
  workTypeId: number,
  workDate: string
): number {
  // 1. 查詢工時類型的加權比率
  const workType = await db.prepare(
    'SELECT multiplier FROM WorkTypes WHERE work_type_id = ?'
  ).bind(workTypeId).first();
  
  // 2. 檢查是否為假日
  const isHoliday = await checkHoliday(workDate);
  
  // 3. 計算加權
  let weighted = hours * (workType.multiplier || 1.0);
  
  // 假日額外加成（例如：1.5倍）
  if (isHoliday) {
    weighted *= 1.5;
  }
  
  return weighted;
}
```

---

## 工時異常檢測

```typescript
async function validateDailyHours(userId: number, workDate: string) {
  const total = await db.prepare(`
    SELECT SUM(hours) as total 
    FROM TimeLogs 
    WHERE user_id = ? AND work_date = ?
  `).bind(userId, workDate).first();
  
  if (total.total > 12) {
    return {
      warning: true,
      message: `${workDate} 的工時為 ${total.total}小時，請確認是否正確`
    };
  }
  
  return { warning: false };
}
```

---

## 相關文檔

- [功能模塊 - 工時表填寫](../../功能模塊/08-工時表填寫.md)


