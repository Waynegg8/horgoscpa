# 員工權限設定 - 測試案例

**所屬功能：** [員工權限設定](../../功能模塊/01-員工權限設定.md)  
**最後更新：** 2025年10月27日

---

## 測試案例 1：修改預設權限模板並同步員工

### 前置條件
- 管理員已登入
- 系統有 3 位員工：
  - 張大明（使用預設模板）
  - 李小華（有個別調整）
  - 王美麗（使用預設模板）
- 預設模板狀態：
  - 儀表板：☑
  - 工時表：☑
  - 報表中心：▢

### 測試步驟
1. 進入「員工權限設定」頁面
2. 確認在「預設權限」Tab
3. 勾選「報表中心」
4. 點擊「儲存變更」
5. 系統彈出「同步現有員工」對話框
6. 確認對話框顯示：
   - ☑ 張大明 [使用預設模板]
   - ▢ 李小華 [已個別調整]
   - ☑ 王美麗 [使用預設模板]
7. 保持預設勾選狀態，點擊「確認」

### 預期結果
- ✅ 預設模板成功更新（報表中心：☑）
- ✅ 張大明的權限已更新（報表中心：☑）
- ✅ 王美麗的權限已更新（報表中心：☑）
- ✅ 李小華的權限未改變（保持個別調整）
- ✅ 顯示成功訊息：「已更新預設模板，並同步 2 位員工」

---

## 測試案例 2：個別調整員工權限

### 前置條件
- 管理員已登入
- 員工「李小華」當前使用預設模板
- 預設模板：儀表板☑、工時表☑、報表中心▢

### 測試步驟
1. 進入「員工權限設定」頁面
2. 切換到「個別調整」Tab
3. 從下拉選單選擇「李小華」
4. 確認當前權限顯示：
   - ☑ 儀表板 [預設]
   - ☑ 工時表 [預設]
   - ▢ 報表中心 [預設]
5. 勾選「報表中心」
6. 確認狀態更新為：
   - ☑ 報表中心 [已調整] 🔵
7. 點擊「儲存變更」

### 預期結果
- ✅ 李小華的權限成功更新
- ✅ 李小華現在可以存取報表中心
- ✅ 李小華被標記為「已個別調整」
- ✅ 顯示成功訊息：「已更新李小華的權限」
- ✅ 資料庫新增一筆記錄：`user_id=李小華, module_name=reports, is_enabled=TRUE`

---

## 測試案例 3：恢復為預設模板

### 前置條件
- 管理員已登入
- 員工「李小華」有 3 個個別調整：
  - 報表中心：☑ [已調整]
  - 任務追蹤：☑ [已調整]
  - SOP管理：☑ [已調整]

### 測試步驟
1. 進入「員工權限設定」頁面
2. 切換到「個別調整」Tab
3. 選擇「李小華」
4. 確認看到 3 個 [已調整] 標籤
5. 點擊「恢復為預設」按鈕
6. 系統彈出確認對話框：
   「確定要將李小華的權限恢復為預設模板？」
7. 點擊「確認」

### 預期結果
- ✅ 李小華的所有個別調整被清除
- ✅ 李小華的權限恢復為預設模板
- ✅ 所有模塊顯示 [預設] 標籤
- ✅ 李小華被標記為「使用預設模板」
- ✅ 顯示成功訊息：「已恢復為預設模板」
- ✅ 資料庫刪除李小華的所有個別權限記錄

---

## 測試案例 4：權限變更立即生效

### 前置條件
- 員工「張大明」已登入系統
- 張大明當前可存取「報表中心」
- 張大明正在瀏覽報表頁面
- 管理員在另一個瀏覽器登入

### 測試步驟
1. 管理員進入「員工權限設定」
2. 切換到「個別調整」Tab
3. 選擇「張大明」
4. 取消勾選「報表中心」
5. 點擊「儲存變更」

### 預期結果（張大明的瀏覽器）
- ✅ 張大明收到權限更新通知
- ✅ 頁面顯示提示：「權限已更新，請重新確認可存取的功能」
- ✅ 張大明被導向首頁
- ✅ 左側選單中「報表中心」項目消失或變灰

---

## 測試案例 5：新員工自動套用預設模板

### 前置條件
- 管理員已登入
- 預設模板狀態：
  - 儀表板：☑
  - 工時表：☑
  - 個人設定：☑
  - 報表中心：▢

### 測試步驟
1. 管理員進入「員工帳號管理」
2. 點擊「新增員工」
3. 填寫員工資料：
   - 姓名：陳小新
   - 角色：員工
4. 點擊「儲存」
5. 陳小新使用帳號首次登入
6. 檢查陳小新可存取的模塊

### 預期結果
- ✅ 陳小新可以存取：儀表板、工時表、個人設定
- ✅ 陳小新無法存取：報表中心
- ✅ 資料庫無陳小新的個別權限記錄（使用預設）
- ✅ 在「個別調整」Tab 查看陳小新，所有模塊顯示 [預設]

---

## 測試案例 6：管理員不受權限限制

### 前置條件
- 管理員已登入
- 預設模板中「報表中心」未勾選

### 測試步驟
1. 管理員嘗試存取「報表中心」頁面
2. 管理員嘗試存取「員工權限設定」頁面

### 預期結果
- ✅ 管理員可以存取所有模塊（包含報表中心）
- ✅ 管理員可以存取所有管理員專屬模塊
- ✅ 不查詢 ModulePermissions 表（直接放行）

---

## 測試案例 7：員工無法存取管理員專屬模塊

### 前置條件
- 員工「張大明」已登入
- 張大明的所有可開放模塊都已啟用

### 測試步驟
1. 張大明嘗試透過 URL 直接存取 `/settings/permissions`
2. 張大明嘗試呼叫 API：`GET /api/v1/module-permissions/default`

### 預期結果
- ✅ 前端導向 403 無權限頁面
- ✅ API 回應 403 Forbidden：
  ```json
  {
    "success": false,
    "error": {
      "code": "PERMISSION_DENIED",
      "message": "無權限存取此功能"
    }
  }
  ```

---

## 測試案例 8：更新預設模板時手動勾選已調整員工

### 前置條件
- 管理員已登入
- 員工「李小華」有個別調整（報表中心：☑）
- 預設模板中報表中心：▢

### 測試步驟
1. 進入「預設權限」Tab
2. 勾選「報表中心」
3. 點擊「儲存變更」
4. 在彈出的對話框中：
   - 李小華 [已個別調整] ▢ 預設不勾選
5. 手動勾選李小華
6. 點擊「確認」

### 預期結果
- ✅ 預設模板更新（報表中心：☑）
- ✅ 李小華的權限被覆蓋，使用新的預設模板
- ✅ 李小華的個別調整被清除
- ✅ 李小華被標記為「使用預設模板」
- ✅ 顯示成功訊息中包含李小華

---

## 性能測試

### 測試案例 9：大量員工同步

**測試條件：**
- 100 位員工使用預設模板
- 10 位員工有個別調整

**測試步驟：**
1. 更新預設模板
2. 在同步對話框勾選所有 110 位員工
3. 點擊確認

**預期結果：**
- ✅ 所有員工在 5 秒內完成更新
- ✅ 無資料庫錯誤
- ✅ 無超時錯誤

---

## 安全測試

### 測試案例 10：越權操作

**測試步驟：**
1. 員工「張大明」登入
2. 透過開發者工具呼叫 API：
   ```
   PATCH /api/v1/module-permissions/default
   { "module_name": "reports", "is_enabled": true }
   ```

**預期結果：**
- ✅ API 回應 403 Forbidden
- ✅ 預設模板未被修改
- ✅ 後端記錄安全日誌

---

## 資料一致性測試

### 測試案例 11：同時修改衝突

**測試步驟：**
1. 管理員 A 開啟員工權限設定頁面
2. 管理員 B 同時開啟員工權限設定頁面
3. 管理員 A 更新預設模板（開放報表中心）
4. 管理員 B 更新預設模板（關閉工時表）
5. A 先儲存，B 後儲存

**預期結果：**
- ✅ B 的更新覆蓋 A 的更新
- ✅ 最終狀態：報表中心☑、工時表▢
- ✅ 無資料不一致問題

---

## 相關文檔

- [功能模塊](../../功能模塊/01-員工權限設定.md)
- [UI設計](./UI設計.md)
- [權限驗證邏輯](./權限驗證邏輯.md)

---

**最後更新：** 2025年10月27日



**所屬功能：** [員工權限設定](../../功能模塊/01-員工權限設定.md)  
**最後更新：** 2025年10月27日

---

## 測試案例 1：修改預設權限模板並同步員工

### 前置條件
- 管理員已登入
- 系統有 3 位員工：
  - 張大明（使用預設模板）
  - 李小華（有個別調整）
  - 王美麗（使用預設模板）
- 預設模板狀態：
  - 儀表板：☑
  - 工時表：☑
  - 報表中心：▢

### 測試步驟
1. 進入「員工權限設定」頁面
2. 確認在「預設權限」Tab
3. 勾選「報表中心」
4. 點擊「儲存變更」
5. 系統彈出「同步現有員工」對話框
6. 確認對話框顯示：
   - ☑ 張大明 [使用預設模板]
   - ▢ 李小華 [已個別調整]
   - ☑ 王美麗 [使用預設模板]
7. 保持預設勾選狀態，點擊「確認」

### 預期結果
- ✅ 預設模板成功更新（報表中心：☑）
- ✅ 張大明的權限已更新（報表中心：☑）
- ✅ 王美麗的權限已更新（報表中心：☑）
- ✅ 李小華的權限未改變（保持個別調整）
- ✅ 顯示成功訊息：「已更新預設模板，並同步 2 位員工」

---

## 測試案例 2：個別調整員工權限

### 前置條件
- 管理員已登入
- 員工「李小華」當前使用預設模板
- 預設模板：儀表板☑、工時表☑、報表中心▢

### 測試步驟
1. 進入「員工權限設定」頁面
2. 切換到「個別調整」Tab
3. 從下拉選單選擇「李小華」
4. 確認當前權限顯示：
   - ☑ 儀表板 [預設]
   - ☑ 工時表 [預設]
   - ▢ 報表中心 [預設]
5. 勾選「報表中心」
6. 確認狀態更新為：
   - ☑ 報表中心 [已調整] 🔵
7. 點擊「儲存變更」

### 預期結果
- ✅ 李小華的權限成功更新
- ✅ 李小華現在可以存取報表中心
- ✅ 李小華被標記為「已個別調整」
- ✅ 顯示成功訊息：「已更新李小華的權限」
- ✅ 資料庫新增一筆記錄：`user_id=李小華, module_name=reports, is_enabled=TRUE`

---

## 測試案例 3：恢復為預設模板

### 前置條件
- 管理員已登入
- 員工「李小華」有 3 個個別調整：
  - 報表中心：☑ [已調整]
  - 任務追蹤：☑ [已調整]
  - SOP管理：☑ [已調整]

### 測試步驟
1. 進入「員工權限設定」頁面
2. 切換到「個別調整」Tab
3. 選擇「李小華」
4. 確認看到 3 個 [已調整] 標籤
5. 點擊「恢復為預設」按鈕
6. 系統彈出確認對話框：
   「確定要將李小華的權限恢復為預設模板？」
7. 點擊「確認」

### 預期結果
- ✅ 李小華的所有個別調整被清除
- ✅ 李小華的權限恢復為預設模板
- ✅ 所有模塊顯示 [預設] 標籤
- ✅ 李小華被標記為「使用預設模板」
- ✅ 顯示成功訊息：「已恢復為預設模板」
- ✅ 資料庫刪除李小華的所有個別權限記錄

---

## 測試案例 4：權限變更立即生效

### 前置條件
- 員工「張大明」已登入系統
- 張大明當前可存取「報表中心」
- 張大明正在瀏覽報表頁面
- 管理員在另一個瀏覽器登入

### 測試步驟
1. 管理員進入「員工權限設定」
2. 切換到「個別調整」Tab
3. 選擇「張大明」
4. 取消勾選「報表中心」
5. 點擊「儲存變更」

### 預期結果（張大明的瀏覽器）
- ✅ 張大明收到權限更新通知
- ✅ 頁面顯示提示：「權限已更新，請重新確認可存取的功能」
- ✅ 張大明被導向首頁
- ✅ 左側選單中「報表中心」項目消失或變灰

---

## 測試案例 5：新員工自動套用預設模板

### 前置條件
- 管理員已登入
- 預設模板狀態：
  - 儀表板：☑
  - 工時表：☑
  - 個人設定：☑
  - 報表中心：▢

### 測試步驟
1. 管理員進入「員工帳號管理」
2. 點擊「新增員工」
3. 填寫員工資料：
   - 姓名：陳小新
   - 角色：員工
4. 點擊「儲存」
5. 陳小新使用帳號首次登入
6. 檢查陳小新可存取的模塊

### 預期結果
- ✅ 陳小新可以存取：儀表板、工時表、個人設定
- ✅ 陳小新無法存取：報表中心
- ✅ 資料庫無陳小新的個別權限記錄（使用預設）
- ✅ 在「個別調整」Tab 查看陳小新，所有模塊顯示 [預設]

---

## 測試案例 6：管理員不受權限限制

### 前置條件
- 管理員已登入
- 預設模板中「報表中心」未勾選

### 測試步驟
1. 管理員嘗試存取「報表中心」頁面
2. 管理員嘗試存取「員工權限設定」頁面

### 預期結果
- ✅ 管理員可以存取所有模塊（包含報表中心）
- ✅ 管理員可以存取所有管理員專屬模塊
- ✅ 不查詢 ModulePermissions 表（直接放行）

---

## 測試案例 7：員工無法存取管理員專屬模塊

### 前置條件
- 員工「張大明」已登入
- 張大明的所有可開放模塊都已啟用

### 測試步驟
1. 張大明嘗試透過 URL 直接存取 `/settings/permissions`
2. 張大明嘗試呼叫 API：`GET /api/v1/module-permissions/default`

### 預期結果
- ✅ 前端導向 403 無權限頁面
- ✅ API 回應 403 Forbidden：
  ```json
  {
    "success": false,
    "error": {
      "code": "PERMISSION_DENIED",
      "message": "無權限存取此功能"
    }
  }
  ```

---

## 測試案例 8：更新預設模板時手動勾選已調整員工

### 前置條件
- 管理員已登入
- 員工「李小華」有個別調整（報表中心：☑）
- 預設模板中報表中心：▢

### 測試步驟
1. 進入「預設權限」Tab
2. 勾選「報表中心」
3. 點擊「儲存變更」
4. 在彈出的對話框中：
   - 李小華 [已個別調整] ▢ 預設不勾選
5. 手動勾選李小華
6. 點擊「確認」

### 預期結果
- ✅ 預設模板更新（報表中心：☑）
- ✅ 李小華的權限被覆蓋，使用新的預設模板
- ✅ 李小華的個別調整被清除
- ✅ 李小華被標記為「使用預設模板」
- ✅ 顯示成功訊息中包含李小華

---

## 性能測試

### 測試案例 9：大量員工同步

**測試條件：**
- 100 位員工使用預設模板
- 10 位員工有個別調整

**測試步驟：**
1. 更新預設模板
2. 在同步對話框勾選所有 110 位員工
3. 點擊確認

**預期結果：**
- ✅ 所有員工在 5 秒內完成更新
- ✅ 無資料庫錯誤
- ✅ 無超時錯誤

---

## 安全測試

### 測試案例 10：越權操作

**測試步驟：**
1. 員工「張大明」登入
2. 透過開發者工具呼叫 API：
   ```
   PATCH /api/v1/module-permissions/default
   { "module_name": "reports", "is_enabled": true }
   ```

**預期結果：**
- ✅ API 回應 403 Forbidden
- ✅ 預設模板未被修改
- ✅ 後端記錄安全日誌

---

## 資料一致性測試

### 測試案例 11：同時修改衝突

**測試步驟：**
1. 管理員 A 開啟員工權限設定頁面
2. 管理員 B 同時開啟員工權限設定頁面
3. 管理員 A 更新預設模板（開放報表中心）
4. 管理員 B 更新預設模板（關閉工時表）
5. A 先儲存，B 後儲存

**預期結果：**
- ✅ B 的更新覆蓋 A 的更新
- ✅ 最終狀態：報表中心☑、工時表▢
- ✅ 無資料不一致問題

---

## 相關文檔

- [功能模塊](../../功能模塊/01-員工權限設定.md)
- [UI設計](./UI設計.md)
- [權限驗證邏輯](./權限驗證邏輯.md)

---

**最後更新：** 2025年10月27日



