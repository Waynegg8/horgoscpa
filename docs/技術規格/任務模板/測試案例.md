# 任務模板管理 - 測試案例

**最後更新：** 2025年10月27日

---

## 新增任務模板

### 測試 1：成功新增記帳流程模板
**操作：**
1. 點擊「新增模板」
2. 輸入名稱：「記帳標準流程（雙月）」
3. 選擇關聯服務：「記帳服務 - 收集憑證」
4. 新增4個階段：
   - 資料收集（3天）
   - 營業稅過帳（2天，依賴階段1）
   - 提列折舊（1天，依賴階段2）
   - 報表產出（2天，依賴階段3）
5. 點擊「儲存」

**預期結果：**
- ✅ 模板建立成功
- ✅ 自動計算總天數 = 8天
- ✅ 階段依賴正確設定

---

### 測試 2：循環依賴檢測
**操作：**
1. 新增模板，3個階段：
   - 階段1（依賴階段3）← 循環
   - 階段2（依賴階段1）
   - 階段3（依賴階段2）
2. 點擊「儲存」

**預期結果：**
- ❌ 顯示錯誤：「檢測到循環依賴」
- ❌ 不建立模板

---

### 測試 3：依賴順序錯誤
**操作：**
1. 新增模板
2. 階段1（依賴階段2）← 依賴後面的階段
3. 階段2（無依賴）

**預期結果：**
- ❌ 顯示錯誤：「依賴階段必須在當前階段之前」
- ❌ 不建立模板

---

## 編輯任務模板

### 測試 4：成功修改模板名稱
**前置條件：** 模板「記帳標準流程（雙月）」已存在

**操作：**
1. 點擊「編輯」
2. 修改名稱為「記帳標準流程 v2.0」
3. 點擊「儲存」

**預期結果：**
- ✅ 模板名稱更新成功
- ✅ 階段不受影響

---

### 測試 5：新增階段到現有模板
**操作：**
1. 編輯模板
2. 新增階段5：「客戶確認（1天，依賴階段4）」
3. 點擊「儲存」

**預期結果：**
- ✅ 新階段建立成功
- ✅ 總天數自動更新為 9天

---

### 測試 6：刪除階段
**操作：**
1. 編輯模板
2. 刪除階段3「提列折舊」
3. 點擊「儲存」

**預期結果：**
- ✅ 階段刪除成功
- ✅ 階段4的依賴自動清除（因為依賴的階段3被刪除）
- ✅ 總天數自動更新

---

## 複製任務模板

### 測試 7：成功複製模板
**操作：**
1. 點擊「複製模板」
2. 系統自動建立副本

**預期結果：**
- ✅ 新模板名稱：「記帳標準流程（雙月）(副本)」
- ✅ 所有階段完整複製
- ✅ 階段依賴關係正確複製

---

### 測試 8：複製後獨立修改
**前置條件：** 已複製模板

**操作：**
1. 編輯副本模板
2. 修改階段2的天數從2天改為3天
3. 點擊「儲存」

**預期結果：**
- ✅ 副本模板更新成功
- ✅ 原模板不受影響

---

## 刪除任務模板

### 測試 9：刪除無使用的模板
**前置條件：** 模板未被任何客戶服務或任務使用

**操作：**
1. 點擊「刪除」
2. 確認刪除

**預期結果：**
- ✅ 模板軟刪除成功
- ✅ 列表中不再顯示

---

### 測試 10：刪除正在使用的模板
**前置條件：** 客戶A的記帳服務關聯此模板

**操作：**
1. 嘗試刪除模板

**預期結果：**
- ❌ 顯示錯誤：「此模板正被客戶服務使用，無法刪除」
- ❌ 不執行刪除

---

### 測試 11：刪除有進行中任務的模板
**前置條件：** 有任務正在使用此模板

**操作：**
1. 嘗試刪除模板

**預期結果：**
- ❌ 顯示錯誤：「此模板有進行中的任務，無法刪除」
- ❌ 不執行刪除

---

## 階段依賴功能

### 測試 12：建立任務實例時複製依賴
**前置條件：** 模板有階段依賴設定

**操作：**
1. 系統根據模板自動建立任務

**預期結果：**
- ✅ 任務實例的階段正確複製
- ✅ 階段依賴關係正確複製
- ✅ 員工無法跳過階段

---

### 測試 13：拖曳調整階段順序
**操作：**
1. 編輯模板
2. 拖曳階段3移到階段2之前
3. 點擊「儲存」

**預期結果：**
- ✅ 階段順序更新
- ✅ 階段編號自動重新計算（1, 2, 3...）
- ✅ 無效依賴自動清除

---

## 查詢模板

### 測試 14：查詢所有模板
**操作：**
1. 進入任務模板管理頁面

**預期結果：**
- ✅ 顯示所有啟用的模板
- ✅ 顯示模板名稱、關聯服務、總天數、階段數
- ✅ 按名稱排序

---

### 測試 15：查詢特定模板詳情
**操作：**
1. 點擊模板卡片

**預期結果：**
- ✅ 顯示完整的階段列表
- ✅ 顯示階段依賴關係
- ✅ 顯示每階段的預計天數

---

## 整合測試

### 測試 16：模板與客戶服務整合
**操作：**
1. 建立任務模板「記帳標準流程」
2. 在客戶服務設定中選擇此模板
3. Cron Job 自動建立任務

**預期結果：**
- ✅ 任務自動套用模板流程
- ✅ 階段正確複製
- ✅ 依賴關係正確執行

---

### 測試 17：模板更新不影響現有任務
**前置條件：** 已有任務使用舊版模板

**操作：**
1. 修改模板（新增階段）
2. 檢查現有任務

**預期結果：**
- ✅ 現有任務不受影響
- ✅ 新建立的任務使用新版模板

---

## 權限測試

### 測試 18：非管理員無法訪問
**前置條件：** 一般員工登入

**操作：**
1. 嘗試訪問 `/settings/task-templates`

**預期結果：**
- ❌ 403 錯誤或導向其他頁面
- ❌ 不顯示任何模板

---

### 測試 19：管理員完整權限
**前置條件：** 管理員登入

**操作：**
1. 訪問任務模板管理頁面

**預期結果：**
- ✅ 可查看所有模板
- ✅ 可新增/編輯/刪除模板
- ✅ 可複製模板

---

## 相關文檔

- [功能模塊 - 任務模板管理](../../功能模塊/14-任務模板管理.md)
- [UI 設計](./UI設計.md)
- [業務邏輯](./業務邏輯.md)





