# 假期登記 - 業務邏輯

**最後更新：** 2025年10月27日

---

## 假期餘額檢查

```typescript
async function checkLeaveBalance(
  userId: number,
  leaveTypeId: number,
  requestedHours: number
): Promise<boolean> {
  const balance = await db.prepare(`
    SELECT balance FROM LeaveBalances 
    WHERE user_id = ? AND leave_type_id = ?
  `).bind(userId, leaveTypeId).first();
  
  if (!balance || balance.balance < requestedHours) {
    throw new Error('假期餘額不足');
  }
  
  return true;
}
```

---

## 自動計算時數

```typescript
function calculateLeaveDays(startDate: string, endDate: string): number {
  const start = new Date(startDate);
  const end = new Date(endDate);
  let workDays = 0;
  
  for (let d = start; d <= end; d.setDate(d.getDate() + 1)) {
    const dayOfWeek = d.getDay();
    // 排除週末
    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
      // 檢查是否為國定假日
      const isHoliday = await checkHoliday(d.toISOString().split('T')[0]);
      if (!isHoliday) {
        workDays++;
      }
    }
  }
  
  return workDays * 8; // 每天8小時
}
```





