# 系統設定頁面 - 測試指南

## 快速開始

### 前置條件
1. ✅ 確保你已登入系統
2. ✅ 確保你的帳號有管理員權限
3. ✅ 確保Worker已部署並運行

### 訪問頁面
打開瀏覽器訪問：
```
https://www.horgoscpa.com/internal/settings
```

或本地開發環境：
```
http://localhost:8787/internal/settings
```

## 測試步驟

### 1. 測試Tab切換功能 (5分鐘)

1. **檢查Tab導覽列**
   - ✅ 確認可以看到15個tab按鈕
   - ✅ 第一個tab「系統參數」應該是啟用狀態（藍色底線）

2. **測試切換**
   - ✅ 點擊「用戶管理」tab
   - ✅ 確認內容從「系統參數」切換到「用戶管理」
   - ✅ 確認「用戶管理」tab有藍色底線
   - ✅ 確認表格顯示「載入中...」然後顯示用戶列表

3. **測試所有Tab**
   - ✅ 依次點擊每個tab，確認都能正常切換
   - ✅ 確認每個tab都能載入數據（或顯示「暫無資料」）

### 2. 測試數據顯示功能 (10分鐘)

#### 2.1 用戶管理
1. 切換到「用戶管理」tab
2. 確認顯示內容：
   - ✅ 表格有9個欄位：ID、帳號、姓名、Email、性別、到職日、管理員、狀態、操作
   - ✅ 每個用戶都顯示正確
   - ✅ 管理員欄位顯示綠色標籤（是）或灰色標籤（否）
   - ✅ 狀態欄位顯示綠色標籤（正常）

#### 2.2 客戶管理
1. 切換到「客戶管理」tab
2. 確認顯示內容：
   - ✅ 表格有8個欄位：ID、客戶名稱、統編、聯絡人、Email、電話、狀態、操作
   - ✅ 點擊「查看」按鈕可以跳轉到客戶詳情頁
   - ✅ 狀態標籤顯示正確（綠色=正常，紅色=已刪除）

#### 2.3 任務管理
1. 切換到「任務管理」tab
2. 確認顯示內容：
   - ✅ 表格顯示任務列表
   - ✅ 狀態標籤顯示不同顏色：
     - 黃色 = 待處理
     - 藍色 = 進行中
     - 綠色 = 已完成
     - 紅色 = 已取消
   - ✅ 優先級顯示正確（低/中/高/緊急）

#### 2.4 工時管理
1. 切換到「工時管理」tab
2. 確認顯示內容：
   - ✅ 顯示今日工時記錄
   - ✅ 或顯示「暫無今日工時記錄」
   - ✅ 時數和加班時數顯示正確

#### 2.5 假期管理
1. 切換到「假期管理」tab
2. 確認顯示內容：
   - ✅ 假期類型正確（特休/病假/事假/補休）
   - ✅ 狀態標籤顯示正確：
     - 黃色 = 待審核
     - 綠色 = 已核准
     - 紅色 = 已拒絕

#### 2.6 收據收款
1. 切換到「收據收款」tab
2. 確認顯示內容：
   - ✅ 金額格式化顯示（千位分隔符）
   - ✅ 收款狀態標籤顯示正確：
     - 紅色 = 未收款
     - 黃色 = 部分收款
     - 綠色 = 已收款

#### 2.7 薪資管理
1. 切換到「薪資管理」tab
2. 確認顯示內容：
   - ✅ 顯示本月薪資記錄
   - ✅ 所有金額都有$符號和千位分隔符
   - ✅ 底薪、加班費、獎金、扣款、實發都顯示正確

#### 2.8 成本管理
1. 切換到「成本管理」tab
2. 確認顯示內容：
   - ✅ 顯示本月成本記錄
   - ✅ 類別顯示中文（租金/水電/軟體/行銷/其他）
   - ✅ 金額格式化正確

#### 2.9 其他Tab
依次測試：
- ✅ 附件系統：檔案大小顯示為KB
- ✅ 知識庫：版本號顯示正確
- ✅ 服務生命週期：狀態標籤正確
- ✅ CMS內容：發布狀態正確
- ✅ 自動化規則：啟用/停用標籤正確
- ✅ 國定假日：顯示本年度假日

### 3. 測試錯誤處理 (5分鐘)

#### 3.1 測試未登入
1. 登出系統
2. 訪問 `/internal/settings`
3. 確認：
   - ✅ 自動跳轉到登入頁
   - ✅ URL包含 `redirect=/internal/settings`

#### 3.2 測試非管理員
1. 使用非管理員帳號登入
2. 訪問 `/internal/settings`
3. 確認：
   - ✅ 顯示「您沒有權限檢視此頁面」
   - ✅ 所有輸入框和按鈕都是disabled狀態

#### 3.3 測試API錯誤
1. 在Chrome DevTools中：
   - 打開 Network 面板
   - 啟用 "Block request URL" 功能
   - 阻止任何 `/internal/api/v1/` 的請求
2. 切換到任意tab
3. 確認：
   - ✅ 顯示「載入失敗，請稍後再試」
   - ✅ 控制台顯示錯誤訊息

### 4. 測試響應式設計 (10分鐘)

#### 4.1 桌面版 (1920px)
1. 在正常桌面瀏覽器中測試
2. 確認：
   - ✅ 所有tab在同一行顯示
   - ✅ 表格不需要橫向滾動
   - ✅ 版面舒適，間距適當

#### 4.2 平板版 (768px)
1. 在Chrome DevTools中切換到iPad視圖
2. 確認：
   - ✅ Tab可以橫向滾動
   - ✅ 表格可以橫向滾動
   - ✅ 搜索框和按鈕堆疊顯示

#### 4.3 手機版 (375px)
1. 在Chrome DevTools中切換到iPhone SE視圖
2. 確認：
   - ✅ Tab導覽列可以流暢橫向滾動
   - ✅ 表格可以橫向滾動
   - ✅ 所有按鈕寬度100%
   - ✅ 文字大小適中，可讀性良好

### 5. 測試系統參數功能 (10分鐘)

這是唯一完整實現CRUD的tab，需要仔細測試：

#### 5.1 讀取參數
1. 切換到「系統參數」tab
2. 確認：
   - ✅ 4個設定區塊都顯示
   - ✅ 所有輸入框都有預設值
   - ✅ 危險設定有紅色背景提示

#### 5.2 修改一般設定
1. 修改「公司名稱」
2. 點擊「儲存一般設定」
3. 確認：
   - ✅ 顯示「儲存中…」
   - ✅ 成功後顯示「已更新一般設定。」（綠色）
   - ✅ 重新整理頁面後，修改仍然存在

#### 5.3 修改薪資參數
1. 修改「全勤獎金金額」
2. 點擊「儲存薪資參數」
3. 確認：
   - ✅ 驗證：必須為非負整數
   - ✅ 儲存成功

#### 5.4 修改成本參數
1. 修改「每小時管理成本」和「目標毛利率」
2. 點擊「儲存成本參數」
3. 確認：
   - ✅ 驗證：毛利率必須在0-100之間
   - ✅ 儲存成功

#### 5.5 修改危險設定
1. 修改「補休有效期規則」
2. 點擊「儲存危險設定」
3. 確認：
   - ✅ 需要confirmed確認
   - ✅ 儲存成功

## 常見問題排查

### 問題1：Tab點擊後沒反應
**檢查項目：**
- 確認 JavaScript 沒有錯誤（打開Console查看）
- 確認 tab-btn 有 `data-tab` 屬性
- 確認 tab-panel 有對應的 ID

### 問題2：表格顯示「載入中...」不消失
**檢查項目：**
- 打開Network面板，確認API請求成功
- 檢查API返回的數據格式
- 確認 `json.ok === true` 且 `json.data` 存在

### 問題3：狀態標籤顏色不對
**檢查項目：**
- 確認API返回的status值
- 確認statusMap有對應的映射
- 確認CSS中有對應的class（.status-badge.active等）

### 問題4：手機版tab滾不動
**檢查項目：**
- 確認 `.settings-tabs` 有 `overflow-x: auto`
- 確認tab-btn有 `white-space: nowrap`
- 嘗試在真實手機上測試（有些模擬器行為不同）

## 測試清單總結

- [ ] Tab切換功能正常
- [ ] 15個tab都能載入數據
- [ ] 狀態標籤顏色正確
- [ ] 金額格式化正確（千位分隔符）
- [ ] 錯誤處理正常（載入失敗、未登入、無權限）
- [ ] 響應式設計在所有尺寸下正常
- [ ] 系統參數的CRUD功能正常
- [ ] 客戶管理的「查看」按鈕可以跳轉
- [ ] 搜索框和篩選器的UI正常（雖然還沒功能）
- [ ] 新增按鈕的UI正常（雖然還沒功能）

## 測試完成後

✅ **如果所有測試都通過**：恭喜！系統設定頁面基礎功能已完成。

⚠️ **如果有測試失敗**：
1. 記錄失敗的測試項目
2. 查看瀏覽器Console的錯誤訊息
3. 查看Network面板的API請求
4. 參考「常見問題排查」章節
5. 如果無法解決，請提供詳細的錯誤訊息

## 下一步

完成測試後，可以開始：
1. 實現搜索功能
2. 實現新增/編輯/刪除功能
3. 添加分頁功能

參考文件：
- [快速開發 - 為Tab添加實際功能](./快速開發-為Tab添加實際功能.md)

