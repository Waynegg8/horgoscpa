# 部署檢查清單

**文檔類型：** 部署指南  
**最後更新：** 2025年10月27日

---

## 部署前檢查

### 環境設定

- [ ] Cloudflare D1 資料庫已建立並設定
- [ ] Cloudflare R2 儲存桶已建立
- [ ] wrangler.toml 配置正確
- [ ] 環境變數已設定（JWT_SECRET, ALLOWED_ORIGINS 等）

---

### 資料庫

- [ ] Schema 已執行（所有表格已建立）
- [ ] 索引已建立（F012）
- [ ] 管理員帳號已建立
- [ ] 業務規則已初始化（假期、加班費率等）
- [ ] 至少建立 1 個任務模板
- [ ] 至少建立 1 個服務項目

---

### 安全性

- [ ] 所有預設密碼已修改
- [ ] JWT_SECRET 已設定為強密碼
- [ ] Cookie 設定為 HttpOnly + Secure
- [ ] CORS 設定正確
- [ ] SSL/TLS 設為 Full (strict)
- [ ] Cloudflare WAF 規則已啟用
- [ ] CSP Header 已配置（F006）
- [ ] Rate Limiting 已測試（F005）

---

### API

- [ ] 所有端點都有權限檢查
- [ ] 錯誤處理統一（F004）
- [ ] API 版本控制正確（/api/v1/）
- [ ] 健康檢查端點運作正常（F020）

---

### Cron Jobs

- [ ] task-generator.ts 已測試
- [ ] overdue-detector.ts 已測試
- [ ] backup.ts 已設定（如啟用）
- [ ] Cron 觸發時間正確

---

### 前端

- [ ] 生產環境 build 成功
- [ ] 所有頁面路由正常
- [ ] 登入/登出功能正常
- [ ] 權限守衛運作正常
- [ ] 共用組件正常運作
- [ ] 行動裝置顯示正常

---

### 測試

- [ ] 管理員登入測試通過
- [ ] 員工登入測試通過
- [ ] 模塊可見性設定生效
- [ ] 工時表填寫與計算正確
- [ ] 任務自動建立功能正常
- [ ] 階段到期計算正確
- [ ] 假期計算正確

---

### 監控

- [ ] Cloudflare Analytics 已啟用（F181）
- [ ] 錯誤追蹤已設定（F182）
- [ ] 日誌系統已設定（F180）

---

### 文檔

- [ ] API 文檔已產生（F184-F185）
- [ ] README 已更新
- [ ] 使用者手冊已準備（可選）

---

## 上線當天

### 上線前 1 小時

- [ ] 備份當前資料庫
- [ ] 通知所有使用者即將上線
- [ ] 準備回滾方案

### 上線

- [ ] 執行部署指令
- [ ] 驗證網站可訪問
- [ ] 驗證 API 正常回應
- [ ] 驗證登入功能

### 上線後 1 小時

- [ ] 監控錯誤率
- [ ] 監控 API 回應時間
- [ ] 收集使用者反饋

---

## 回滾計畫

如發生嚴重問題：

```bash
# 1. 回滾 Worker
wrangler rollback

# 2. 回滾 Pages
wrangler pages deployment list
wrangler pages deployment rollback

# 3. 復原資料庫（如需要）
# 使用備份復原
```

---

**相關文檔：**
- [初始化流程](./初始化流程.md)
- [環境設定](./環境設定.md)

