# 工時資料上傳說明

## 功能說明

此腳本用於將 CSV 格式的工時記錄批次上傳到 Cloudflare D1 資料庫。

## CSV 檔案格式要求

### 必要欄位

- **員工姓名**: 員工的姓名（必須與資料庫中的員工姓名一致）
- **客戶名稱**: 客戶的名稱
- **工作日期**: 格式為 `YYYY/MM/DD`（例如：2025/10/14）
- **年度**: 工作年份（例如：2025）
- **月份**: 工作月份（1-12）
- **業務類型**: 業務類別（例如：記帳、營業稅等）

### 工時類型欄位（至少填寫一個）

- 正常工時
- 平日加班(1.34)
- 平日加班(1.67)
- 休息日加班(1.34)
- 休息日加班(1.67)
- 休息日加班(2.67)
- 本月例假日加班
- 本月例假日加班(2)
- 本月國定假日加班
- 本月國定假日加班(1.34)
- 本月國定假日加班(1.67)

### 請假欄位（選填）

- **假別**: 請假類型（例如：特休、病假等）
- **請假時數**: 請假的小時數

## 使用方法

### 1. 準備 CSV 檔案

確保您的 CSV 檔案命名為 `活頁簿4.csv` 並放在與腳本相同的目錄下。

### 2. 執行腳本

在命令提示字元或 PowerShell 中執行：

```bash
python upload_timesheet_data.py
```

### 3. 查看結果

腳本會顯示：
- 讀取的資料筆數
- 分組的員工/月份組合數量
- 每個員工的上傳狀態
- 最終的成功/失敗統計

## 執行範例

```
============================================================
工時資料上傳腳本
============================================================

[讀取] CSV 檔案: 活頁簿4.csv
[OK] 成功使用 big5 編碼讀取檔案
[OK] 成功讀取 23 筆資料

[處理] 解析資料...
[OK] 已分組 3 個員工/月份組合

[上傳] 上傳資料到 API...

處理: 莊凱閔 - 2025年10月
  - 工時記錄: 8 筆
  - 請假記錄: 0 筆
  [OK] 上傳成功

處理: 張紜蓁 - 2025年10月
  - 工時記錄: 5 筆
  - 請假記錄: 0 筆
  [OK] 上傳成功

處理: 呂柏澄 - 2025年10月
  - 工時記錄: 4 筆
  - 請假記錄: 0 筆
  [OK] 上傳成功

============================================================
上傳完成
成功: 3 筆
失敗: 0 筆
============================================================
```

## 注意事項

1. **資料會被覆蓋**: 上傳時會刪除該員工當月的所有現有記錄，然後重新插入新資料
2. **員工姓名**: 必須與資料庫中的員工姓名完全一致
3. **客戶名稱**: 建議與資料庫中的客戶名稱一致
4. **編碼支援**: 腳本自動偵測 UTF-8, Big5, GBK 等編碼
5. **網路連線**: 需要連接網際網路以存取 API

## 驗證上傳結果

上傳完成後，您可以：

1. 開啟瀏覽器訪問 `timesheet.html`
2. 選擇對應的員工和年月
3. 查看上傳的工時記錄是否正確顯示

## 常見問題

### Q: 顯示「讀取檔案失敗」

A: 請確認：
- CSV 檔案名稱是否正確
- 檔案是否存在於腳本所在目錄
- 檔案編碼是否為 UTF-8 或 Big5

### Q: 顯示「上傳失敗」

A: 請檢查：
- 網路連線是否正常
- API 服務是否運作中
- 員工姓名是否存在於資料庫中

### Q: 資料顯示為 0 個分組

A: 請確認：
- CSV 欄位名稱是否正確（特別是「年度」、「月份」、「假別」等）
- 資料列是否有填寫工時或請假時數
- 日期格式是否正確

## 技術支援

如有問題，請聯繫系統管理員。

