<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="noindex, nofollow" name="robots"/> <!-- 防止搜索引擎索引管理頁面 -->
<title>影片管理 | 霍爾果斯會計師事務所</title>
<!-- Favicon -->
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/assets/images/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/assets/images/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/site.webmanifest" rel="manifest"/>
<!-- 引用樣式表 -->
<link href="/assets/css/style.css" rel="stylesheet">
<style>
    /* 管理頁面特定樣式 */
    .admin-container {
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      max-width: 1000px;
      margin: 30px auto;
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .admin-title {
      margin: 0;
      color: #002147;
    }
    
    .admin-actions {
      display: flex;
      gap: 15px;
    }
    
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    
    .admin-table th,
    .admin-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .admin-table th {
      background-color: #f5f7fa;
      font-weight: 600;
    }
    
    .admin-table tr:hover {
      background-color: #f9f9f9;
    }
    
    .admin-table .actions {
      display: flex;
      gap: 10px;
    }
    
    .admin-btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .delete-btn {
      background-color: #ff4d4f;
      color: white;
    }
    
    .delete-btn:hover {
      background-color: #ff2e30;
    }
    
    .view-btn {
      background-color: #0066cc;
      color: white;
    }
    
    .view-btn:hover {
      background-color: #0055aa;
    }
    
    .refresh-btn {
      background-color: #52c41a;
      color: white;
    }
    
    .refresh-btn:hover {
      background-color: #47a919;
    }
    
    /* 分頁樣式 */
    .admin-pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    
    .page-btn {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background-color: #fff;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .page-btn.active {
      background-color: #0066cc;
      color: white;
      border-color: #0066cc;
    }
    
    .page-btn:hover:not(.active) {
      background-color: #f0f0f0;
    }
    
    /* 確認彈窗樣式 */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      max-width: 450px;
      width: 80%;
      text-align: center;
    }
    
    .modal-title {
      margin-top: 0;
      color: #333;
    }
    
    .modal-message {
      margin-bottom: 25px;
      line-height: 1.6;
    }
    
    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    
    .cancel-btn {
      background-color: #f0f0f0;
      color: #333;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .cancel-btn:hover {
      background-color: #e0e0e0;
    }
    
    .confirm-btn {
      background-color: #ff4d4f;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .confirm-btn:hover {
      background-color: #ff2e30;
    }
    
    /* 加載動畫 */
    .loading {
      text-align: center;
      padding: 50px;
    }
    
    .loading-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 3px solid rgba(0, 102, 204, 0.2);
      border-radius: 50%;
      border-top-color: #0066cc;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* 訊息提示 */
    .message {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
      text-align: center;
      font-weight: 500;
    }
    
    .success {
      background-color: #f6ffed;
      border: 1px solid #b7eb8f;
      color: #52c41a;
    }
    
    .error {
      background-color: #fff2f0;
      border: 1px solid #ffccc7;
      color: #ff4d4f;
    }
    
    .info {
      background-color: #e6f7ff;
      border: 1px solid #91d5ff;
      color: #1890ff;
    }
    
    /* 文件上傳區域 */
    .upload-area {
      margin-top: 30px;
      padding: 25px;
      background-color: #f9f9f9;
      border-radius: 8px;
      text-align: center;
    }
    
    .upload-title {
      margin-top: 0;
      color: #333;
    }
    
    .upload-input {
      margin: 15px 0;
    }
    
    .upload-btn {
      background-color: #0066cc;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .upload-btn:hover {
      background-color: #0055aa;
    }
    
    /* 管理員密碼輸入框 */
    .password-input {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      width: 100%;
      margin-bottom: 20px;
    }
    
    .password-input:focus {
      border-color: #0066cc;
      box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.2);
      outline: none;
    }

    /* 表單區塊樣式 */
    .form-group {
      margin-bottom: 15px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .form-group select {
      height: 38px;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .navigation-links {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 15px;
    }
    
    .navigation-links a {
      padding: 10px 15px;
      background-color: #f0f0f0;
      border-radius: 4px;
      text-decoration: none;
      color: #333;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .navigation-links a:hover {
      background-color: #e0e0e0;
    }
    
    .navigation-links a.active {
      background-color: #0066cc;
      color: white;
    }
  </style>
</link></head>
<body>
<!-- 導航欄 -->

<!-- 導航欄 -->
<nav class="site-nav">
<div class="nav-container">
<div class="logo">
<a href="/index.html">
<div class="logo-main">霍爾果斯會計師事務所</div>
<div class="logo-sub">HorgosCPA</div>
</a>
</div>
<input class="nav-toggle" id="nav-toggle" type="checkbox"/>
<label class="nav-toggle-label" for="nav-toggle">
<span></span>
</label>
<ul class="nav-menu">
<li class="nav-cta-item"><a class="nav-consult-btn" href="/booking.html">免費諮詢</a></li>
<li class="nav-cta-item"><a class="nav-line-btn" href="https://line.me/R/ti/p/@208ihted" target="_blank">LINE</a></li>
<li class="nav-divider"></li>
<li class="has-dropdown">
<a href="/services.html">服務項目</a>
<div class="dropdown-menu">
<a href="/services/tax.html">稅務服務</a>
<a href="/services/accounting.html">記帳與會計</a>
<a href="/services/consulting.html">企業顧問</a>
</div>
</li>
<li><a href="/team.html">服務團隊</a></li>
<li><a href="/blog.html">部落格</a></li>
<li><a href="/faq.html">常見問題</a></li>
<li><a href="/video.html">影片</a></li>
<li><a href="/contact.html">聯絡資訊</a></li>
</ul>
</div>
</nav>

<!-- 管理頁面內容 -->
<main class="admin-page">
<div class="container">
<div class="admin-container">
<div class="admin-header">
<h1 class="admin-title">影片管理平台</h1>
<div class="admin-actions">
<button class="admin-btn refresh-btn" id="refresh-btn">刷新列表</button>
<a class="admin-btn view-btn" href="/video.html">查看影片頁面</a>
</div>
</div>

<!-- 導航鏈接 -->
<div class="navigation-links">
  <a href="/blog-management.html">部落格管理</a>
  <a href="/video-management.html" class="active">影片管理</a>
</div>

<!-- 訊息容器 -->
<div id="message-container"></div>

<!-- 影片列表表格 -->
<div id="videos-container">
<div class="loading">
<div class="loading-spinner"></div>
<p>加載影片中...</p>
</div>
</div>

<!-- 影片分頁控制 -->
<div class="admin-pagination" id="pagination-container"></div>

<!-- 新增影片表單 -->
<div class="upload-area">
<h2 class="upload-title">新增影片</h2>
<p>填寫下方表單，將新影片加入到影片列表中</p>
<form id="video-form">
<div class="form-group">
<label for="video-title">影片標題</label>
<input id="video-title" required="" type="text"/>
</div>
<div class="form-group">
<label for="video-date">發布日期</label>
<input id="video-date" required="" type="date"/>
</div>
<div class="form-group">
<label for="video-description">影片描述</label>
<textarea id="video-description" required=""></textarea>
</div>
<div class="form-group">
<label for="video-embed">YouTube 嵌入網址</label>
<input id="video-embed" placeholder="例如：https://www.youtube.com/embed/xxxxxxxxxx" required="" type="text"/>
</div>
<div class="form-group">
<label for="video-category">影片分類</label>
<select id="video-category" required="">
<option value="tax">稅務相關</option>
<option value="accounting">會計記帳</option>
<option value="business">企業經營</option>
<option value="tutorial">操作教學</option>
</select>
</div>
<div class="form-group">
<label for="video-tags">標籤（以逗號分隔）</label>
<input id="video-tags" placeholder="例如：報稅,所得稅,企業稅務" type="text"/>
</div>
<button class="upload-btn" type="submit">新增影片</button>
</form>
</div>

</div>
</div>
</main>

<!-- 確認刪除影片彈窗 -->
<div class="modal" id="delete-modal">
<div class="modal-content">
<h2 class="modal-title">確認刪除影片</h2>
<p class="modal-message">您確定要刪除這個影片嗎？此操作不可恢復。</p>
<div style="margin-bottom: 20px;">
<input class="password-input" id="admin-password" placeholder="請輸入管理員密碼" required="" type="password"/>
</div>
<div class="modal-buttons">
<button class="cancel-btn" id="cancel-delete">取消</button>
<button class="confirm-btn" id="confirm-delete">確認刪除</button>
</div>
</div>
</div>

<!-- 新增影片密碼彈窗 -->
<div class="modal" id="add-video-modal">
<div class="modal-content">
<h2 class="modal-title">管理員驗證</h2>
<p class="modal-message">請輸入管理員密碼以新增影片</p>
<div style="margin-bottom: 20px;">
<input class="password-input" id="add-video-password" placeholder="請輸入管理員密碼" required="" type="password"/>
</div>
<div class="modal-buttons">
<button class="cancel-btn" id="cancel-add-video">取消</button>
<button class="confirm-btn" id="confirm-add-video">確認新增</button>
</div>
</div>
</div>

<!-- 處理進度彈窗 -->
<div class="modal" id="progress-modal">
<div class="modal-content">
<h2 class="modal-title">處理中</h2>
<div class="loading">
<div class="loading-spinner"></div>
<p id="progress-message">正在處理您的請求...</p>
</div>
</div>
</div>

<!-- 頁尾區域 -->
<footer class="site-footer">
<div class="footer-container">
<div class="footer-text">
<p>© 2025 霍爾果斯會計師事務所 | 台中市西區建國路21號3樓之1 | 電話：<a href="tel:+886422205606">04-2220-5606</a></p>
</div>
</div>
</footer>

<!-- GitHub API操作腳本 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // GitHub 設置
    const GITHUB_OWNER = 'waynegg8'; // 更改為您的GitHub用戶名
    const GITHUB_REPO = 'horgoscpa'; // 更改為您的儲存庫名稱
    const GITHUB_BRANCH = 'main';    // 更改為您的主分支名稱
    const ADMIN_PASSWORD = 'wayne4591'; // 管理員密碼
    
    // 元素
    const videosContainer = document.getElementById('videos-container');
    const paginationContainer = document.getElementById('pagination-container');
    const messageContainer = document.getElementById('message-container');
    const refreshBtn = document.getElementById('refresh-btn');
    const deleteModal = document.getElementById('delete-modal');
    const addVideoModal = document.getElementById('add-video-modal');
    const progressModal = document.getElementById('progress-modal');
    const progressMessage = document.getElementById('progress-message');
    const cancelDeleteBtn = document.getElementById('cancel-delete');
    const confirmDeleteBtn = document.getElementById('confirm-delete');
    const cancelAddVideoBtn = document.getElementById('cancel-add-video');
    const confirmAddVideoBtn = document.getElementById('confirm-add-video');
    const videoForm = document.getElementById('video-form');
    const adminPasswordInput = document.getElementById('admin-password');
    const addVideoPasswordInput = document.getElementById('add-video-password');
    
    // 狀態
    let videoData = null;
    let currentPage = 1;
    let itemsPerPage = 10;
    let videoToDelete = null;
    let videoToAdd = null;
    
    // 初始加載數據
    loadVideos();
    
    // 刷新按鈕事件
    refreshBtn.addEventListener('click', function() {
      loadVideos();
    });
    
    // 新增影片表單提交
    videoForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // 獲取表單數據
      const title = document.getElementById('video-title').value.trim();
      const date = document.getElementById('video-date').value;
      const description = document.getElementById('video-description').value.trim();
      const embedUrl = document.getElementById('video-embed').value.trim();
      const category = document.getElementById('video-category').value;
      const tagsInput = document.getElementById('video-tags').value.trim();
      
      // 處理標籤
      const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
      
      // 創建影片對象
      videoToAdd = {
        title,
        date,
        description,
        embedUrl,
        category,
        tags
      };
      
      // 驗證URL
      if (!embedUrl.startsWith('https://www.youtube.com/embed/')) {
        showMessage('請輸入有效的YouTube嵌入網址，以"https://www.youtube.com/embed/"開頭', 'error');
        return;
      }
      
      // 打開確認對話框
      openAddVideoModal();
    });
    
    // 確認新增影片按鈕事件
    confirmAddVideoBtn.addEventListener('click', function() {
      const password = addVideoPasswordInput.value.trim();
      if (password === ADMIN_PASSWORD) {
        addNewVideo(password);
        closeAddVideoModal();
      } else {
        alert('管理員密碼不正確');
      }
    });
    
    // 取消新增影片按鈕事件
    cancelAddVideoBtn.addEventListener('click', function() {
      closeAddVideoModal();
    });
    
    // 取消刪除影片按鈕
    cancelDeleteBtn.addEventListener('click', function() {
      closeDeleteModal();
    });
    
    // 確認刪除影片按鈕
    confirmDeleteBtn.addEventListener('click', function() {
      const password = adminPasswordInput.value.trim();
      if (password === ADMIN_PASSWORD && videoToDelete !== null) {
        deleteVideo(videoToDelete, password);
        closeDeleteModal();
      } else if (password !== ADMIN_PASSWORD) {
        alert('管理員密碼不正確');
      }
    });
    
    // 點擊模態框背景關閉
    window.addEventListener('click', function(e) {
      if (e.target === deleteModal) {
        closeDeleteModal();
      }
      if (e.target === addVideoModal) {
        closeAddVideoModal();
      }
    });
    
    // 按鍵事件 - 在密碼輸入框中按Enter鍵確認
    adminPasswordInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        confirmDeleteBtn.click();
      }
    });
    
    addVideoPasswordInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        confirmAddVideoBtn.click();
      }
    });
    
    /**
     * 加載影片列表
     */
    async function loadVideos() {
      try {
        // 顯示加載中
        videosContainer.innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <p>加載影片中...</p>
          </div>
        `;
        
        try {
          // 嘗試從服務器獲取JSON文件
          const videosJsonPath = '/assets/data/videos.json';
          const response = await fetch(videosJsonPath);
          
          if (!response.ok) {
            // 本地獲取失敗，嘗試從GitHub獲取
            const githubResponse = await fetch(`https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/assets/data/videos.json`);
            
            if (!githubResponse.ok) {
              throw new Error(`無法獲取影片數據 (狀態碼: ${githubResponse.status})`);
            }
            
            const data = await githubResponse.json();
            videoData = data;
          } else {
            const data = await response.json();
            videoData = data;
          }
          
          // 渲染影片列表
          renderVideos();
        } catch (error) {
          console.error('加載JSON出錯:', error);
          // 使用備用數據
          useVideoFallbackData();
        }
      } catch (error) {
        console.error('加載影片出錯:', error);
        videosContainer.innerHTML = `
          <div class="message error">
            加載影片時出現問題：${error.message}
          </div>
        `;
      }
    }
    
    /**
     * 使用影片備用數據
     */
    function useVideoFallbackData() {
      // 創建空的影片數據
      videoData = {
        videos: [],
        pagination: {
          total: 0,
          totalPages: 1,
          itemsPerPage: 6
        }
      };
      
      // 渲染空影片列表
      renderVideos();
      
      // 顯示說明信息
      videosContainer.innerHTML = `
        <div class="message info">
          <p>目前尚未有任何影片，或無法連接到影片資料。您可以在下方「新增影片」表單新增第一部影片。</p>
        </div>
      `;
    }
    
    /**
     * 渲染影片列表
     */
    function renderVideos() {
      if (!videoData || !videoData.videos || videoData.videos.length === 0) {
        videosContainer.innerHTML = `
          <div class="message info">尚無影片</div>
        `;
        paginationContainer.innerHTML = '';
        return;
      }
      
      const videos = videoData.videos;
      
      // 計算分頁
      const totalPages = Math.ceil(videos.length / itemsPerPage);
      currentPage = Math.min(currentPage, totalPages);
      
      // 獲取當前頁的影片
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, videos.length);
      const currentVideos = videos.slice(startIndex, endIndex);
      
      // 創建表格
      let tableHTML = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>標題</th>
              <th>日期</th>
              <th>分類</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      // 添加行
      currentVideos.forEach((video, index) => {
        tableHTML += `
          <tr>
            <td>${video.title}</td>
            <td>${video.date}</td>
            <td>${video.category}</td>
            <td class="actions">
              <a href="#" class="admin-btn view-btn video-preview" data-index="${startIndex + index}">預覽</a>
              <button class="admin-btn delete-btn" data-index="${startIndex + index}">刪除</button>
            </td>
          </tr>
        `;
      });
      
      tableHTML += `
          </tbody>
        </table>
      `;
      
      videosContainer.innerHTML = tableHTML;
      
      // 綁定刪除按鈕事件
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          videoToDelete = index;
          openDeleteModal();
        });
      });
      
      // 綁定預覽影片按鈕事件
      document.querySelectorAll('.video-preview').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          const index = parseInt(this.getAttribute('data-index'));
          const video = videoData.videos[index];
          
          // 創建預覽視窗
          const previewHTML = `
            <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1001; display: flex; justify-content: center; align-items: center;">
              <div style="background: white; width: 80%; max-width: 800px; border-radius: 8px; overflow: hidden; position: relative;">
                <div style="position: absolute; top: 10px; right: 10px; z-index: 10; width: 30px; height: 30px; background: #f0f0f0; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer;">✕</div>
                <div style="padding-top: 56.25%; position: relative;">
                  <iframe src="${video.embedUrl}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" allowfullscreen></iframe>
                </div>
                <div style="padding: 20px;">
                  <h3>${video.title}</h3>
                  <p><small>${video.date}</small></p>
                  <p>${video.description}</p>
                  <p><small>分類: ${video.category}</small></p>
                  <div>
                    ${video.tags.map(tag => `<span style="display: inline-block; margin-right: 5px; margin-bottom: 5px; padding: 2px 8px; background: #f0f0f0; border-radius: 12px; font-size: 0.8rem;">${tag}</span>`).join('')}
                  </div>
                </div>
              </div>
            </div>
          `;
          
          // 添加預覽視窗到頁面
          const previewElement = document.createElement('div');
          previewElement.innerHTML = previewHTML;
          document.body.appendChild(previewElement);
          
          // 綁定關閉按鈕
          previewElement.querySelector('div[style*="position: absolute; top: 10px; right: 10px;"]').addEventListener('click', function() {
            document.body.removeChild(previewElement);
          });
          
          // 點擊背景關閉
          previewElement.firstChild.addEventListener('click', function(e) {
            if (e.target === this) {
              document.body.removeChild(previewElement);
            }
          });
        });
      });
      
      // 渲染分頁
      renderPagination(totalPages);
    }
    
    /**
     * 渲染分頁控制
     */
    function renderPagination(totalPages) {
      if (!paginationContainer) {
        console.warn('找不到分頁容器元素');
        return;
      }
      
      if (totalPages <= 1) {
        paginationContainer.innerHTML = '';
        return;
      }
      
      paginationContainer.innerHTML = '';
      
      // 上一頁按鈕
      const prevBtn = document.createElement('button');
      prevBtn.className = `page-btn ${currentPage === 1 ? 'disabled' : ''}`;
      prevBtn.textContent = '上一頁';
      prevBtn.disabled = currentPage === 1;
      prevBtn.addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          renderVideos();
        }
      });
      paginationContainer.appendChild(prevBtn);
      
      // 頁碼按鈕
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        pageBtn.textContent = i;
        
        pageBtn.addEventListener('click', function() {
          currentPage = i;
          renderVideos();
        });
        
        paginationContainer.appendChild(pageBtn);
      }
      
      // 下一頁按鈕
      const nextBtn = document.createElement('button');
      nextBtn.className = `page-btn ${currentPage === totalPages ? 'disabled' : ''}`;
      nextBtn.textContent = '下一頁';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.addEventListener('click', function() {
        if (currentPage < totalPages) {
          currentPage++;
          renderVideos();
        }
      });
      paginationContainer.appendChild(nextBtn);
    }
    
    /**
     * 刪除影片
     */
    async function deleteVideo(videoIndex, password) {
      try {
        // 驗證管理員密碼
        if (password !== ADMIN_PASSWORD) {
          throw new Error('管理員密碼無效');
        }
        
        // 確認影片數據存在
        if (!videoData || !videoData.videos || !videoData.videos[videoIndex]) {
          throw new Error('找不到要刪除的影片');
        }
        
        // 顯示處理中提示
        showMessage(`正在刪除影片，請稍候...`, 'info');
        
        // 從videoData中刪除選定的影片
        const updatedVideoData = JSON.parse(JSON.stringify(videoData)); // 深拷貝
        const deletedVideo = updatedVideoData.videos.splice(videoIndex, 1)[0];
        
        // 更新分頁信息
        updatedVideoData.pagination.total = updatedVideoData.videos.length;
        updatedVideoData.pagination.totalPages = Math.ceil(updatedVideoData.videos.length / updatedVideoData.pagination.itemsPerPage);
        
        // 將更新後的數據保存為JSON
        const jsonContent = JSON.stringify(updatedVideoData, null, 2);
        
        try {
          // 使用GitHub repository_dispatch API觸發工作流程
          const response = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/dispatches`, {
            method: 'POST',
            headers: {
              'Authorization': `token ${getGitHubToken(password)}`,
              'Accept': 'application/vnd.github.v3+json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              event_type: 'update-videos',
              client_payload: {
                content: jsonContent,
                message: `刪除影片: ${deletedVideo.title}`
              }
            })
          });
          
          if (!response.ok) {
            throw new Error(`API請求失敗 (狀態碼: ${response.status})`);
          }
          
          // 更新本地數據
          videoData = updatedVideoData;
          
          // 重新渲染影片列表
          renderVideos();
          
          // 顯示成功訊息
          showMessage(`影片「${deletedVideo.title}」已成功刪除！`, 'success');
          
        } catch (apiError) {
          console.error('API請求失敗:', apiError);
          
          // 本地模式：僅更新前端顯示
          videoData = updatedVideoData;
          renderVideos();
          showMessage(`影片已在本地刪除，但可能尚未同步到伺服器。錯誤: ${apiError.message}`, 'info');
        }
      } catch (error) {
        console.error('刪除影片時出錯:', error);
        showMessage(`刪除失敗: ${error.message}`, 'error');
      }
    }
    
    /**
     * 新增影片
     */
    async function addNewVideo(password) {
      try {
        // 驗證管理員密碼
        if (password !== ADMIN_PASSWORD) {
          throw new Error('管理員密碼無效');
        }
        
        if (!videoToAdd) {
          throw new Error('影片數據無效');
        }
        
        // 顯示處理中提示
        showMessage(`正在新增影片，請稍候...`, 'info');
        
        // 確保影片數據已加載
        if (!videoData) {
          await loadVideos();
        }
        
        // 如果仍然沒有數據，創建基本結構
        if (!videoData) {
          videoData = {
            videos: [],
            pagination: {
              total: 0,
              totalPages: 1,
              itemsPerPage: 6
            }
          };
        }
        
        // 準備更新的數據
        const updatedVideoData = JSON.parse(JSON.stringify(videoData)); // 深拷貝
        updatedVideoData.videos.unshift(videoToAdd); // 添加到開頭
        
        // 更新分頁信息
        updatedVideoData.pagination.total = updatedVideoData.videos.length;
        updatedVideoData.pagination.totalPages = Math.ceil(updatedVideoData.videos.length / updatedVideoData.pagination.itemsPerPage);
        
        // 將更新後的數據保存為JSON
        const jsonContent = JSON.stringify(updatedVideoData, null, 2);
        
        try {
          // 使用GitHub repository_dispatch API觸發工作流程
          const response = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/dispatches`, {
            method: 'POST',
            headers: {
              'Authorization': `token ${getGitHubToken(password)}`,
              'Accept': 'application/vnd.github.v3+json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              event_type: 'update-videos',
              client_payload: {
                content: jsonContent,
                message: `新增影片: ${videoToAdd.title}`
              }
            })
          });
          
          if (!response.ok) {
            throw new Error(`API請求失敗 (狀態碼: ${response.status})`);
          }
          
          // 更新本地數據
          videoData = updatedVideoData;
          
          // 重置表單
          videoForm.reset();
          videoToAdd = null;
          
          // 重新渲染影片列表
          renderVideos();
          
          // 顯示成功訊息
          showMessage('影片新增成功！', 'success');
          
        } catch (apiError) {
          console.error('API請求失敗:', apiError);
          
          // 本地模式：僅更新前端顯示
          videoData = updatedVideoData;
          videoForm.reset();
          videoToAdd = null;
          renderVideos();
          
          showMessage('影片已在本地新增，但可能尚未同步到伺服器。請手動備份或嘗試刷新頁面。', 'info');
        }
      } catch (error) {
        console.error('新增影片時出錯:', error);
        showMessage(`新增失敗: ${error.message}`, 'error');
      }
    }
    
    /**
     * 從本機檔案保存更新影片數據（備份功能）
     */
    function saveVideosBackup() {
      if (!videoData) return;
      
      // 轉換為JSON字符串
      const jsonContent = JSON.stringify(videoData, null, 2);
      
      // 創建Blob對象
      const blob = new Blob([jsonContent], { type: 'application/json' });
      
      // 創建下載鏈接
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `videos_backup_${new Date().toISOString().slice(0, 10)}.json`;
      
      // 觸發下載
      document.body.appendChild(a);
      a.click();
      
      // 清理
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);
      
      showMessage('影片數據備份成功！', 'success');
    }
    
    /**
     * 顯示訊息
     */
    function showMessage(message, type = 'success') {
      messageContainer.innerHTML = `
        <div class="message ${type}">
          ${message}
        </div>
      `;
      
      // 5秒後自動隱藏訊息
      setTimeout(() => {
        if (messageContainer.querySelector(`.message.${type}`) !== null) {
          messageContainer.innerHTML = '';
        }
      }, 5000);
    }
    
    /**
     * 打開確認刪除影片彈窗
     */
    function openDeleteModal() {
      deleteModal.style.display = 'flex';
      adminPasswordInput.value = ''; // 清空密碼輸入
      adminPasswordInput.focus(); // 聚焦到密碼輸入框
    }
    
    /**
     * 關閉確認刪除影片彈窗
     */
    function closeDeleteModal() {
      deleteModal.style.display = 'none';
    }
    
    /**
     * 打開新增影片彈窗
     */
    function openAddVideoModal() {
      addVideoModal.style.display = 'flex';
      addVideoPasswordInput.value = ''; // 清空密碼輸入
      addVideoPasswordInput.focus(); // 聚焦到密碼輸入框
    }
    
    /**
     * 關閉新增影片彈窗
     */
    function closeAddVideoModal() {
      addVideoModal.style.display = 'none';
    }
    
    /**
     * 打開處理進度彈窗
     */
    function openProgressModal(message) {
      progressMessage.textContent = message;
      progressModal.style.display = 'flex';
    }
    
    /**
     * 關閉處理進度彈窗
     */
    function closeProgressModal() {
      progressModal.style.display = 'none';
    }
    
    /**
     * 獲取GitHub令牌
     */
    function getGitHubToken(password) {
      // 這裡只是一個簡單的示例
      // 在實際生產環境中，應該使用更安全的方式來處理令牌
      
      // 如果提供的是預設的管理員密碼，使用這個範例令牌
      // 注意：這個令牌是示例，不是實際可用的令牌
      // 在真實應用中，您可能需要讓用戶提供自己的令牌
      if (password === ADMIN_PASSWORD) {
        return 'ghp_YOUR_PERSONAL_ACCESS_TOKEN'; // 請替換為真實的Personal Access Token
      }
      
      return '';
    }
    
    // 添加備份按鈕到頁面
    const adminActions = document.querySelector('.admin-actions');
    const backupBtn = document.createElement('button');
    backupBtn.className = 'admin-btn refresh-btn';
    backupBtn.style.backgroundColor = '#ff9800';
    backupBtn.textContent = '備份數據';
    backupBtn.addEventListener('click', saveVideosBackup);
    adminActions.appendChild(backupBtn);
  });
</script>
<script src="/assets/js/navbar.js"></script></body>
</html>