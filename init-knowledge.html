<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆå§‹åŒ–çŸ¥è­˜åº«</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }
        button:hover {
            background: #1d4ed8;
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        #log {
            margin-top: 20px;
            padding: 15px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .log-line {
            margin: 5px 0;
        }
        .success { color: #059669; }
        .error { color: #dc2626; }
        .info { color: #2563eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ åˆå§‹åŒ–çŸ¥è­˜åº«</h1>
        <p>æ­¤å·¥å…·å°‡å‰µå»ºä»¥ä¸‹å…§å®¹ï¼š</p>
        <ul>
            <li>ğŸ“Š è¨˜å¸³æµç¨‹æ¨™æº–ä½œæ¥­ç¨‹åº</li>
            <li>ğŸ“‹ ç‡Ÿæ¥­ç¨…ç”³å ±æ¨™æº–ä½œæ¥­ç¨‹åº</li>
            <li>ğŸ‘¥ å®¢æˆ¶è³‡æ–™å»ºæª”æ¨™æº–ä½œæ¥­ç¨‹åº</li>
            <li>â“ 3å€‹FAQç¯„ä¾‹</li>
        </ul>
        <button id="startBtn" onclick="init()">é–‹å§‹åˆå§‹åŒ–</button>
        <div id="log"></div>
    </div>

    <script>
        const API_BASE = '/internal/api/v1';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const line = document.createElement('div');
            line.className = `log-line ${type}`;
            line.textContent = message;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function createSOP(title, category, content, tags) {
            log(`ğŸ“ å‰µå»ºSOP: ${title}`, 'info');
            
            const response = await fetch(`${API_BASE}/sop`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ title, category, content, tags })
            });
            
            if (!response.ok) {
                const error = await response.text();
                throw new Error(error);
            }
            
            const result = await response.json();
            log(`âœ… ${title} å‰µå»ºæˆåŠŸ (ID: ${result.data.sop_id})`, 'success');
            return result.data;
        }

        async function createFAQ(question, category, answer, tags) {
            log(`â“ å‰µå»ºFAQ: ${question}`, 'info');
            
            const response = await fetch(`${API_BASE}/faq`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ question, category, answer, tags })
            });
            
            if (!response.ok) {
                const error = await response.text();
                throw new Error(error);
            }
            
            const result = await response.json();
            log(`âœ… ${question} å‰µå»ºæˆåŠŸ (ID: ${result.data.faq_id})`, 'success');
            return result.data;
        }

        async function loadSOP(path) {
            const response = await fetch(path);
            return await response.text();
        }

        async function init() {
            const btn = document.getElementById('startBtn');
            btn.disabled = true;
            document.getElementById('log').innerHTML = '';
            
            try {
                log('ğŸš€ é–‹å§‹åˆå§‹åŒ–çŸ¥è­˜åº«...', 'info');
                log('', 'info');
                
                // å‰µå»ºSOP
                log('ğŸ“š é–‹å§‹å‰µå»ºSOP...', 'info');
                
                const sop1 = await loadSOP('/templates/sop/è¨˜å¸³æµç¨‹SOP.md');
                await createSOP('è¨˜å¸³æµç¨‹æ¨™æº–ä½œæ¥­ç¨‹åº', 'accounting', sop1, ['è¨˜å¸³', 'ä½œæ¥­æµç¨‹', 'æœˆçµ']);
                
                const sop2 = await loadSOP('/templates/sop/ç‡Ÿæ¥­ç¨…ç”³å ±SOP.md');
                await createSOP('ç‡Ÿæ¥­ç¨…ç”³å ±æ¨™æº–ä½œæ¥­ç¨‹åº', 'tax', sop2, ['ç¨…å‹™', 'ç”³å ±', 'ç‡Ÿæ¥­ç¨…']);
                
                const sop3 = await loadSOP('/templates/sop/å®¢æˆ¶è³‡æ–™å»ºæª”SOP.md');
                await createSOP('å®¢æˆ¶è³‡æ–™å»ºæª”æ¨™æº–ä½œæ¥­ç¨‹åº', 'internal', sop3, ['å®¢æˆ¶ç®¡ç†', 'å»ºæª”', 'æµç¨‹']);
                
                log('', 'info');
                log('â“ é–‹å§‹å‰µå»ºFAQ...', 'info');
                
                // å‰µå»ºFAQ
                await createFAQ(
                    'å¦‚ä½•ç”³è«‹ç‰¹åˆ¥ä¼‘å‡ï¼Ÿ',
                    'hr',
                    '<p>ç‰¹åˆ¥ä¼‘å‡ç”³è«‹æµç¨‹ï¼š</p><ol><li>å¡«å¯«è«‹å‡å–®</li><li>ä¸»ç®¡ç°½æ ¸</li><li>äººäº‹éƒ¨é–€æ ¸å‡†</li><li>ç³»çµ±ç™»è¨˜</li></ol><p>æ³¨æ„äº‹é …ï¼šè«‹å‡æ‡‰æå‰3æ—¥ç”³è«‹ï¼Œç·Šæ€¥æƒ…æ³è«‹é›»è©±å‘ŠçŸ¥ã€‚</p>',
                    ['è«‹å‡', 'ç‰¹ä¼‘', 'äººäº‹']
                );
                
                await createFAQ(
                    'ç‡Ÿæ¥­ç¨…ç”³å ±æœŸé™æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ',
                    'tax',
                    '<p><strong>é›™æœˆåˆ¶ç‡Ÿæ¥­äººï¼š</strong>å¥‡æ•¸æœˆ1-15æ—¥ç”³å ±</p><p><strong>æ¯æœˆç”³å ±ï¼š</strong>æ¬¡æœˆ15æ—¥å‰ç”³å ±</p><p>å»ºè­°æå‰æº–å‚™è³‡æ–™ï¼Œé¿å…é€¾æœŸå—ç½°ã€‚</p>',
                    ['ç‡Ÿæ¥­ç¨…', 'ç”³å ±', 'æœŸé™']
                );
                
                await createFAQ(
                    'å¦‚ä½•æŸ¥è©¢å®¢æˆ¶çš„è²¡å‹™å ±è¡¨ï¼Ÿ',
                    'accounting',
                    '<p>æŸ¥è©¢æ­¥é©Ÿï¼š</p><ol><li>ç™»å…¥ç³»çµ±</li><li>é€²å…¥ã€Œå®¢æˆ¶ç®¡ç†ã€</li><li>é¸æ“‡å®¢æˆ¶</li><li>é»é¸ã€Œè²¡å‹™å ±è¡¨ã€æ¨™ç±¤</li><li>é¸æ“‡å¹´æœˆæŸ¥çœ‹</li></ol>',
                    ['å®¢æˆ¶', 'å ±è¡¨', 'æŸ¥è©¢']
                );
                
                log('', 'info');
                log('âœ… çŸ¥è­˜åº«åˆå§‹åŒ–å®Œæˆï¼', 'success');
                log('ğŸ“ è«‹å‰å¾€ /internal/knowledge æŸ¥çœ‹çµæœ', 'info');
                
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>

