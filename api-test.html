<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API 測試頁面</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
    h1 { color: #333; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #1b65b8; color: white; border: none; border-radius: 4px; }
    button:hover { background: #154a8a; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    .success { color: #28a745; }
    .error { color: #dc3545; }
  </style>
</head>
<body>
  <h1>🔧 工時管理系統 API 測試</h1>
  
  <div class="test-section">
    <h2>1. 測試客戶列表 API</h2>
    <button onclick="testClientsAPI()">測試 GET /internal/api/v1/clients</button>
    <pre id="clientsResult">等待測試...</pre>
  </div>

  <div class="test-section">
    <h2>2. 測試假日 API</h2>
    <button onclick="testHolidaysAPI()">測試 GET /internal/api/v1/holidays</button>
    <pre id="holidaysResult">等待測試...</pre>
  </div>

  <div class="test-section">
    <h2>3. 測試客戶服務 API</h2>
    <input type="text" id="clientIdInput" placeholder="輸入客戶ID (如: c_002)" style="padding: 8px; width: 200px;">
    <button onclick="testClientServicesAPI()">測試 GET /internal/api/v1/clients/:id/services</button>
    <pre id="servicesResult">等待測試...</pre>
  </div>

  <div class="test-section">
    <h2>4. 測試服務子項目 API</h2>
    <input type="text" id="clientId2Input" placeholder="客戶ID (如: c_002)" style="padding: 8px; width: 150px;">
    <input type="text" id="serviceIdInput" placeholder="服務ID (如: 1)" style="padding: 8px; width: 100px;">
    <button onclick="testServiceItemsAPI()">測試 GET /internal/api/v1/clients/:id/services/:sid/items</button>
    <pre id="itemsResult">等待測試...</pre>
  </div>

  <script>
    async function testAPI(url, resultId) {
      const resultEl = document.getElementById(resultId);
      resultEl.textContent = '測試中...';
      
      try {
        const response = await fetch(url, {
          credentials: 'include'
        });
        
        const data = await response.json();
        
        if (response.ok) {
          resultEl.innerHTML = `<span class="success">✅ 成功 (${response.status})</span>\n${JSON.stringify(data, null, 2)}`;
        } else {
          resultEl.innerHTML = `<span class="error">❌ 失敗 (${response.status})</span>\n${JSON.stringify(data, null, 2)}`;
        }
      } catch (error) {
        resultEl.innerHTML = `<span class="error">❌ 錯誤</span>\n${error.message}\n${error.stack}`;
      }
    }

    function testClientsAPI() {
      testAPI('/internal/api/v1/clients?perPage=10', 'clientsResult');
    }

    function testHolidaysAPI() {
      const start = '2025-10-27';
      const end = '2025-11-02';
      testAPI(`/internal/api/v1/holidays?start_date=${start}&end_date=${end}`, 'holidaysResult');
    }

    function testClientServicesAPI() {
      const clientId = document.getElementById('clientIdInput').value || 'c_002';
      testAPI(`/internal/api/v1/clients/${clientId}/services`, 'servicesResult');
    }

    function testServiceItemsAPI() {
      const clientId = document.getElementById('clientId2Input').value || 'c_002';
      const serviceId = document.getElementById('serviceIdInput').value || '1';
      testAPI(`/internal/api/v1/clients/${clientId}/services/${serviceId}/items`, 'itemsResult');
    }
  </script>
</body>
</html>

